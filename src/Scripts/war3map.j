globals	boolean array cx	boolean array ge	boolean array ke	boolean array lo	boolean array nx	boolean array To	boolean array vx	boolean array Yo	boolean array ze	boolean array Ze	boolean Av=false	boolean ax=false	boolean Bo=false	boolean ce=false//	boolean co=false	boolean Cx=false	boolean eo=false	boolean er=false	boolean He=false//	boolean g_flag_tk=false	boolean Io=false//	boolean ix=false	boolean jx=false	boolean Jx=false	boolean Kx=false	boolean Me=false	boolean ne=false	boolean Nr=false	boolean Ox=false	boolean Po=false	boolean Pv=false//	boolean g_flag_b=false	boolean Rx=false	boolean se=false	boolean Sx=false	boolean tv=false	boolean uo=false	boolean Ve=false	boolean We=false	boolean xA=false	boolean Xr=false	boolean Xx=false	boolean Zo=false	boolexpr eN=null	camerasetup bn=null	camerasetup Nn=null	constant integer av=$68	constant integer D=$65	constant integer ev=$66	constant integer F=$66	constant integer H=$67	constant integer I=$96	constant integer iv=$67	constant integer J=$65	constant integer K=$66	constant integer M=$67	constant integer nv=$69	constant integer ov=$65	constant integer Q=$65	constant integer rv=$66	constant integer U=$66	constant integer vv=$65	constant integer Vv=StringLength("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_-+= \\!@#$^&*()/?>.<,;:'\"{}[]|`~")	constant integer W=$67	constant integer xv=$67	destructable g_gate=null	destructable QI=null	destructable sI=null	destructable SI=null	destructable tI=null	destructable TI=null	destructable uI=null	destructable UI=null	destructable wI=null	destructable WI=null	destructable yI=null	destructable YI=null	effect array Br	effect Ro=null	fogmodifier array No	force fe=null	force Fe=null	force io=null	force vN=null	gamecache Nv=null	group aA	group array Se	group bo=null	group cA	group HA	group Hx=null	group ko=null	group lx=null	group mx=null	group no=null	group rr=null	group ZA=null	group zo=null	hashtable eA	hashtable wx=null	integer AA	integer ae=0	integer Ae=0	integer ar=0	integer array Ce	integer array g_Heroes	integer array Ee	integer array Fv	integer array Hv	integer array ie	integer array Je	integer array jv	integer array Ko	integer array kv	integer array Kv	integer array lv	integer array Lv	integer array MA	integer array me	integer array pe	integer array qA	integer array sA	integer array Ue	integer array wo	integer array xo	integer array yo	integer Bv=0	integer bv=1//	integer de=0//	integer De=0	integer Do=0	integer dv=0	integer Dv=0	integer E=0	integer ee=0	integer fv=0	integer fx=0	integer go=0	integer he=0	integer Ho=0	integer hv=0	integer je=0	integer jo=0	integer KA=0	integer LA=0	integer Le=0	integer Lo=0	integer mA=0	integer mo=0	integer Mo=0	integer mv=0	integer Mv=0	integer Ne=0	integer O=0	integer Oe=0	integer oo=0	integer Oo=0	integer ox=0	integer pv=0	integer Px=0	integer qv=0	integer Qv=0	integer Qx=0	integer Rr=0	integer so=0	integer sv=0	integer number_of_heroes=0	integer to=0	integer Tx=0	integer ux=0	integer V=0	integer vr=0	integer Vx=0	integer wA	integer Xe=0	integer zv=0	location array ve	location kx=null	multiboard Jv=null	player array qe	player array Ux//	player array xx	player DA//	player ex=null	player hA	player IA	player g_host=Player(0)	real array pA	real array tA	real array TA	real array vo	real array Yv	real array Zv	real BA	real do=0	real FA	real gA	real Re=0	real vA=0	real YA=.0	real zA=.0	real ZI=0	rect aa=null	rect Aa=null	rect ai=null	rect Ai=null	rect an=null	rect An=null	rect array lA	rect array Te	rect ba=null	rect Ba=null	rect bi=null	rect Bi=null	rect ca=null	rect Ca=null	rect ci=null	rect Ci=null	rect da=null	rect Da=null//	rect di=null//	rect Di=null	rect ea=null	rect Ea=null	rect ei=null	rect Ei=null	rect en=null	rect En=null	rect fa=null	rect Fa=null//	rect fi=null	rect ga=null	rect Ga=null	rect ha=null	rect Ha=null	rect Hr=null	rect ia=null	rect Ia=null	rect ii=null	rect Ii=null	rect in=null	rect ja=null	rect Ja=null	rect jr=null	rect Jr=null	rect ka=null	rect Ka=null	rect kr=null	rect Kr=null	rect la=null	rect La=null	rect lr=null	rect Lr=null	rect ma=null	rect Ma=null	rect mr=null	rect Mr=null	rect na=null	rect Na=null	rect ni=null	rect Ni=null	rect nn=null	rect oa=null	rect Oa=null	rect oi=null	rect Oi=null	rect on=null	rect On=null	rect pa=null	rect Pa=null	rect pr=null	rect Pr=null	rect qa=null	rect Qa=null	rect qi=null	rect Qi=null	rect qr=null	rect Qr=null	rect ra=null	rect Ra=null	rect ri=null	rect Ri=null	rect rn=null	rect Rn=null	rect sa=null	rect Sa=null	rect si=null	rect Si=null	rect sr=null	rect Sr=null	rect Ta=null	rect Ti=null	rect tr=null	rect Tr=null	rect ua=null	rect Ua=null	rect ui=null	rect Ui=null	rect ur=null	rect Ur=null	rect va=null	rect Va=null	rect vi=null	rect Vi=null	rect vn=null	rect Vn=null	rect wa=null	rect Wa=null	rect wi=null	rect Wi=null	rect wr=null	rect Wr=null	rect xa=null	rect Xa=null	rect xi=null	rect Xi=null	rect xn=null	rect Xn=null	rect ya=null	rect Ya=null	rect yi=null	rect Yi=null	rect yr=null	rect Yr=null	rect za=null	rect Za=null	rect zi=null	rect Zi=null	rect zr=null	rect Zr=null	string A=""	string array bx	string array Ev	string array Iv	string array Ke	string array o	string array Ov	string array PA	string array QA	string array rA	string array Rv	string array g_hero_icons	string array Xv	texttag Jo=null	timer array be	timer CA	timer Cv=CreateTimer()	timerdialog array Be	timerdialog Fo=null	timerdialog ue=null	timer Ex=null	timer fo=null	timer Gv=null	timer ir=null	timer qo=null	timer Vr=null	timer WA=null	timer Xo=null	trigger aE=null	trigger AE=null	trigger aI=null	trigger aO=null	trigger AO=null	trigger aR=null	trigger AR=null	trigger aV=null	trigger AV=null	trigger aX=null	trigger AX=null	trigger bA=null	trigger bE=null	trigger BE=null//	trigger bI=null//	trigger BI=null	trigger Bn=null	trigger bO=null	trigger BO=null	trigger bR=null	trigger BR=null	trigger bV=null	trigger BV=null	trigger bX=null	trigger BX=null	trigger cE=null	trigger CE=null//	trigger cI=null//	trigger CI=null	trigger trig_MapInitialization=null	trigger cO=null	trigger CO=null	trigger cR=null	trigger CR=null	trigger cV=null	trigger CV=null	trigger cX=null	trigger CX=null	trigger dE=null	trigger DE=null	trigger dI=null	trigger DI=null	trigger dn=null//	trigger Dn=null	trigger dO=null	trigger DO=null	trigger dR=null	trigger DR=null	trigger dV=null	trigger DV=null	trigger dX=null	trigger DX=null	trigger eE=null	trigger EE=null	trigger eI=null	trigger EI=null	trigger eO=null	trigger EO=null	trigger eR=null	trigger ER=null	trigger eV=null	trigger EV=null	trigger eX=null	trigger EX=null	trigger fE=null	trigger FE=null	trigger fI=null	trigger FI=null	trigger fn=null	trigger Fn=null	trigger fO=null	trigger FO=null	trigger fR=null	trigger fV=null	trigger FV=null	trigger fX=null	trigger FX=null	trigger gE=null	trigger GE=null	trigger CommandLineRepick=null	trigger GI=null	trigger gn=null	trigger Gn=null	trigger gO=null	trigger GO=null//	trigger gR=null//	trigger GR=null	trigger gV=null	trigger GV=null	trigger gX=null	trigger GX=null	trigger hE=null	trigger HE=null	trigger hI=null	trigger HI=null	trigger hn=null	trigger Hn=null	trigger hO=null	trigger HO=null//	trigger hR=null	trigger HR=null	trigger hV=null	trigger HV=null	trigger hX=null	trigger HX=null	trigger iE=null	trigger IE=null	trigger trig_GameModeTest=null	trigger iO=null	trigger IO=null	trigger iR=null	trigger CommandLineReady=null	trigger iV=null	trigger IV=null	trigger iX=null	trigger IX=null	trigger JA=null	trigger jE=null	trigger JE=null	trigger jI=null	trigger JI=null	trigger jn=null	trigger trig_PickHost=null	trigger jO=null	trigger JO=null	trigger jR=null	trigger JR=null	trigger jV=null	trigger JV=null	trigger jX=null	trigger JX=null	trigger kE=null	trigger KE=null	trigger kI=null	trigger KI=null	trigger kn=null	trigger Kn=null	trigger kO=null	trigger KO=null	trigger kR=null	trigger KR=null	trigger kV=null	trigger KV=null	trigger kX=null	trigger KX=null	trigger lE=null	trigger LE=null	trigger lI=null	trigger LI=null	trigger ln=null	trigger Ln=null	trigger lO=null	trigger LO=null	trigger lR=null	trigger LR=null	trigger lV=null	trigger LV=null	trigger LX=null	trigger mE=null	trigger ME=null	trigger mI=null	trigger t_WhenPlayerLeave=null	trigger CommandLineZoom	trigger CommandLineRandom=null	trigger Mn=null	trigger mO=null	trigger MO=null	trigger mR=null	trigger MR=null	trigger mV=null	trigger MV=null	trigger mX=null	trigger MX=null	trigger NA=null	trigger nE=null	trigger NE=null	trigger nI=null//	trigger NI=null	trigger nO=null	trigger NO=null	trigger nR=null	trigger NR=null	trigger nV=null	trigger NV=null	trigger nX=null	trigger NX=null	trigger oA=null	trigger oE=null	trigger OE=null	trigger CommandLineSpeed=null//	trigger OI=null	trigger oO=null	trigger OO=null	trigger oR=null	trigger OR=null	trigger oV=null	trigger OV=null	trigger oX=null	trigger OX=null	trigger pE=null	trigger PE=null//	trigger pI=null	trigger PI=null	trigger pn=null	trigger Pn=null	trigger pO=null	trigger pR=null	trigger PR=null	trigger pV=null	trigger PV=null	trigger pX=null	trigger PX=null	trigger qE=null	trigger QE=null	trigger qI=null	trigger qn=null	trigger Qn=null	trigger qO=null	trigger QO=null	trigger qR=null	trigger QR=null	trigger qV=null	trigger QV=null	trigger qX=null	trigger QX=null	trigger rE=null	trigger RE=null	trigger CommandLineClear=null//	trigger RI=null	trigger ro=null	trigger rO=null	trigger RO=null	trigger rR=null	trigger RR=null	trigger rV=null	trigger RV=null	trigger rX=null	trigger RX=null	trigger sE=null	trigger SE=null	trigger sn=null	trigger Sn=null	trigger sO=null	trigger SO=null	trigger sR=null	trigger SR=null	trigger sV=null	trigger SV=null	trigger sX=null	trigger SX=null	trigger tE=null	trigger TE=null	trigger Tn=null	trigger tO=null	trigger TO=null	trigger tR=null	trigger TR=null	trigger tV=null	trigger TV=null	trigger tX=null	trigger TX=null	trigger UA=null	trigger UE=null	trigger Un=null	trigger uO=null	trigger Uo=null	trigger UO=null	trigger uR=null	trigger uV=null	trigger UV=null	trigger uX=null	trigger UX=null	trigger vE=null	trigger VE=null	trigger CommandLineTeleport=null	trigger VI=null	trigger vO=null	trigger VO=null	trigger vR=null	trigger VR=null	trigger vV=null	trigger VV=null	trigger vX=null	trigger VX=null	trigger wE=null	trigger WE=null	trigger wn=null	trigger Wn=null	trigger wO=null	trigger WO=null	trigger wR=null	trigger WR=null	trigger wV=null	trigger WV=null	trigger wX=null	trigger Wx=null	trigger WX=null	trigger xE=null	trigger XE=null	trigger xI=null//	trigger XI=null	trigger xO=null	trigger XO=null	trigger xR=null	trigger XR=null	trigger xV=null	trigger XV=null	trigger xX=null	trigger XX=null	trigger yE=null	trigger YE=null	trigger yn=null	trigger Yn=null	trigger yO=null	trigger YO=null	trigger yR=null	trigger YR=null	trigger yV=null	trigger YV=null	trigger yx=null	trigger yX=null	trigger Yx=null	trigger YX=null	trigger zE=null	trigger ZE=null	trigger zn=null	trigger Zn=null	trigger zO=null	trigger ZO=null	trigger zR=null	trigger ZR=null	trigger zV=null	trigger ZV=null	trigger zx=null	trigger zX=null	trigger Zx=null	trigger ZX=null	unit Ar=null	unit array ao	unit array g_shops	unit array g_taverns	unit array gv	unit array So	unit array Wo	unit Ax=null	unit br=null	unit Bx=null	unit dA	unit Dx=null	unit Eo=null	unit Er=null	unit fA	unit GA	unit Ge=null	unit gx=null	unit Gx=null	unit hx=null	unit iA	unit Ir=null	unit Ix=null	unit jA	unit kA	unit Lx=null	unit Mx=null	unit Nx=null	unit oe=null	unit Pe=null	unit px=null	unit Qe=null	unit qx=null	unit RA	unit Sv=null	unit Tv=null	unit uv=null	unit Uv=null	unit Vo=null	unit wv=null	unit Wv=null	unit xe=null	unit yv=null	unit zI	unitpool avalable_heroes=null	weathereffect Ie=null	trigger rht=nullendglobals//удалитьfunction PlaceRandomHero takes nothing returns nothing	local unit uuuu = PlaceRandomUnit(avalable_heroes, Player(0), GetRectCenterX(GetPlayableMapRect()), GetRectCenterY(GetPlayableMapRect()), 270)	local integer uid = GetUnitTypeId(uuuu)	local integer i	call DisplayTextToPlayer(Player(0), 0, 0, I2S(uid))	call UnitPoolRemoveUnitType(avalable_heroes, uid)	set i = 1	loop		exitwhen i > 6		call RemoveUnitFromStock(g_taverns[i], uid)		set i = 1 + i	endloop	set uuuu = nullendfunctionfunction InitAvalableHeroesPool takes nothing returns nothing	set avalable_heroes = CreateUnitPool()	call UnitPoolAddUnitType(avalable_heroes, 'E002', 1)	call UnitPoolAddUnitType(avalable_heroes, 'E004', 1)	call UnitPoolAddUnitType(avalable_heroes, 'E000', 1)	call UnitPoolAddUnitType(avalable_heroes, 'E005', 1)	call UnitPoolAddUnitType(avalable_heroes, 'H000', 1)	call UnitPoolAddUnitType(avalable_heroes, 'H00A', 1)	call UnitPoolAddUnitType(avalable_heroes, 'H001', 1)	call UnitPoolAddUnitType(avalable_heroes, 'H007', 1)	call UnitPoolAddUnitType(avalable_heroes, 'O003', 1)	call UnitPoolAddUnitType(avalable_heroes, 'O004', 1)	call UnitPoolAddUnitType(avalable_heroes, 'O000', 1)	call UnitPoolAddUnitType(avalable_heroes, 'O005', 1)	call UnitPoolAddUnitType(avalable_heroes, 'O002', 1)	call UnitPoolAddUnitType(avalable_heroes, 'U002', 1)	call UnitPoolAddUnitType(avalable_heroes, 'U000', 1)	call UnitPoolAddUnitType(avalable_heroes, 'E003', 1)	call UnitPoolAddUnitType(avalable_heroes, 'O001', 1)	call UnitPoolAddUnitType(avalable_heroes, 'H005', 1)	call UnitPoolAddUnitType(avalable_heroes, 'H003', 1)	call UnitPoolAddUnitType(avalable_heroes, 'N00H', 1)	call UnitPoolAddUnitType(avalable_heroes, 'H002', 1)	call UnitPoolAddUnitType(avalable_heroes, 'N00T', 1)	call UnitPoolAddUnitType(avalable_heroes, 'N00U', 1)	call UnitPoolAddUnitType(avalable_heroes, 'H008', 1)	call UnitPoolAddUnitType(avalable_heroes, 'N018', 1)	call UnitPoolAddUnitType(avalable_heroes, 'H006', 1)	call UnitPoolAddUnitType(avalable_heroes, 'E006', 1)	call UnitPoolAddUnitType(avalable_heroes, 'E007', 1)	call UnitPoolAddUnitType(avalable_heroes, 'H00B', 1)	call UnitPoolAddUnitType(avalable_heroes, 'N01I', 1)	call UnitPoolAddUnitType(avalable_heroes, 'H00F', 1)	call UnitPoolAddUnitType(avalable_heroes, 'U005', 1)	call UnitPoolAddUnitType(avalable_heroes, 'E00B', 1)	call UnitPoolAddUnitType(avalable_heroes, 'E00C', 1)	call UnitPoolAddUnitType(avalable_heroes, 'O00B', 1)	call UnitPoolAddUnitType(avalable_heroes, 'H00M', 1)	call UnitPoolAddUnitType(avalable_heroes, 'E00D', 1)	call UnitPoolAddUnitType(avalable_heroes, 'N02G', 1)	call UnitPoolAddUnitType(avalable_heroes, 'U00A', 1)	call UnitPoolAddUnitType(avalable_heroes, 'E00F', 1)	call UnitPoolAddUnitType(avalable_heroes, 'E00L', 1)	call UnitPoolAddUnitType(avalable_heroes, 'H00U', 1)	call UnitPoolAddUnitType(avalable_heroes, 'H00Z', 1)	call UnitPoolAddUnitType(avalable_heroes, 'U00B', 1)	call UnitPoolAddUnitType(avalable_heroes, 'O00G', 1)		set rht = CreateTrigger()	call TriggerRegisterPlayerKeyEventBJ(rht, Player(0), bj_KEYEVENTTYPE_DEPRESS, bj_KEYEVENTKEY_DOWN)	call TriggerAddAction( rht, function PlaceRandomHero)endfunction// Выбор игроком случайного герояfunction PickRandomHero takes nothing returns nothing	local player p = GetTriggerPlayer()	local integer id = (1 + GetPlayerId(p))	local unit hero	local integer uid	local integer i = 1	if ke[id] == false and ce == false and Pv == false and Ve == false then		call SetPlayerTechMaxAllowed(p,'HERO',0)		set ke[id] = true		set hero = PlaceRandomUnit(avalable_heroes, p, GetRandomInt(1824, 2848), -2930, 270)		set uid = GetUnitTypeId(hero)		call UnitPoolRemoveUnitType(avalable_heroes, uid)		loop			exitwhen i > 6			call RemoveUnitFromStock(g_taverns[i], uid)			set i = 1 + i		endloop		call DisplayTimedTextToPlayer(GetLocalPlayer(), 0, 0, 4, "Игрок "+rA[GetPlayerId(p)] + GetPlayerName(p) + "|R случайно получил |c00808080" + GetUnitName(hero) + "|R")		set i = 1		loop			exitwhen i > fv			if GetOwningPlayer(hero) == qe[i] then				call SetUnitUserData(hero,i)				set gv[i] = hero				set To[i] = true				//set ie[In] = ss			endif			set i = i + 1		endloop		call SaveUnitHandle(wx,StringHash("HeroInit"),0,hero)		call ExecuteFunc("HeroInit"+I2S(GetUnitTypeId(hero)))		call SetPlayerState(p, PLAYER_STATE_RESOURCE_GOLD, GetPlayerState(p, PLAYER_STATE_RESOURCE_GOLD) + 100)		call SelectUnitForPlayerSingle(hero, p)		call PanCameraToTimedLocForPlayer(p, GetUnitLoc(hero), 0)		if Sx then			call TriggerExecute(RR)		endif	endif	set p = null	set hero = nullendfunctionfunction setZoom takes nothing returns nothing	local player p = GetTriggerPlayer()	local string str = GetEventPlayerChatString()	local real h = S2R( SubString( str, 8, StringLength( str ) ) )	if h <= 100 and h >= 1 then		set h = (100 + h) * 16.5		call SetCameraFieldForPlayer(p,CAMERA_FIELD_TARGET_DISTANCE,h,1.)	else		call DisplayTimedTextToPlayer(p, 0, 0, 2.5,"|Cffff2400Ошибка:|r Введите значение от 1 до 100, отделив его от команды пробелом.|R")	endif	set p=nullendfunctionfunction oN takes real rN returns nothinglocal real iNlocal real st=TimerGetElapsed(WA)if st<=0 thenset WA=CreateTimer()call TimerStart(WA,$F4240,false,null)endifif(rN>0)thenloopset iN=rN-TimerGetElapsed(WA)+stexitwhen iN<=0if(iN>bj_POLLED_WAIT_SKIP_THRESHOLD)thencall TriggerSleepAction(.1*iN)elsecall TriggerSleepAction(bj_POLLED_WAIT_INTERVAL)endifendloopendifendfunctionfunction aN takes location nN,real VN,real EN returns locationreturn Location(GetLocationX(nN)+VN*Cos(EN*bj_DEGTORAD),GetLocationY(nN)+VN*Sin(EN*bj_DEGTORAD))endfunctionfunction XN takes nothing returns booleanlocal real dx=GetDestructableX(GetFilterDestructable())-YAlocal real dy=GetDestructableY(GetFilterDestructable())-zAreturn(dx*dx+dy*dy<=bj_enumDestructableRadius)endfunctionfunction ON takes rect r,boolexpr RN returns groupset ZA=CreateGroup()call GroupEnumUnitsInRect(ZA,r,RN)call DestroyBoolExpr(RN)return ZAendfunctionfunction IN takes rect r returns groupset ZA=CreateGroup()call GroupEnumUnitsInRect(ZA,r,eN)return ZAendfunctionfunction AN takes real NN,location bN,boolexpr RN returns groupset ZA=CreateGroup()call GroupEnumUnitsInRangeOfLoc(ZA,bN,NN,RN)return ZAendfunctionfunction BN takes real NN,location bN returns groupset ZA=CreateGroup()call GroupEnumUnitsInRangeOfLoc(ZA,bN,NN,eN)return ZAendfunctionfunction cN takes integer CN returns groupset ZA=CreateGroup()call GroupEnumUnitsOfType(ZA,UnitId2String(CN),eN)return ZAendfunctionfunction dN takes player DN,boolexpr RN returns groupset ZA=CreateGroup()call GroupEnumUnitsOfPlayer(ZA,DN,RN)call DestroyBoolExpr(RN)return ZAendfunctionfunction fN takes player DN returns groupset ZA=CreateGroup()call GroupEnumUnitsOfPlayer(ZA,DN,eN)return ZAendfunction//function FN takes player DN,integer CN returns group//set ZA=CreateGroup()//set bj_groupEnumTypeId=CN//call GroupEnumUnitsOfPlayer(ZA,DN,filterGetUnitsOfPlayerAndTypeId)//return ZA//endfunctionfunction gN takes boolexpr RN returns forceset vN=CreateForce()call ForceEnumPlayers(vN,RN)call DestroyBoolExpr(RN)return vNendfunctionfunction GN takes itemtype hN,integer HN returns nothinglocal group gset bj_stockPickedItemType=hNset bj_stockPickedItemLevel=HNset g=CreateGroup()call GroupEnumUnitsOfType(g,"marketplace",eN)call ForGroup(g,function UpdateEachStockBuildingEnum)call DestroyGroup(g)set g=nullendfunctionfunction jN takes nothing returns nothinglocal itemtype JNlocal integer kN=0local integer KN=0local integer HNset HN=1loopif(bj_stockAllowedPermanent[HN])thenset KN=KN+1if(GetRandomInt(1,KN)==1)thenset JN=ITEM_TYPE_PERMANENTset kN=HNendifendifif(bj_stockAllowedCharged[HN])thenset KN=KN+1if(GetRandomInt(1,KN)==1)thenset JN=ITEM_TYPE_CHARGEDset kN=HNendifendifif(bj_stockAllowedArtifact[HN])thenset KN=KN+1if(GetRandomInt(1,KN)==1)thenset JN=ITEM_TYPE_ARTIFACTset kN=HNendifendifset HN=HN+1exitwhen HN>$Aendloopif(KN==0)thenset JN=nullreturnendifcall GN(JN,kN)set JN=nullendfunctionfunction lN takes nothing returns nothingcall jN()call TimerStart(bj_stockUpdateTimer,bj_STOCK_RESTOCK_INTERVAL,true,function jN)endfunctionfunction mN takes nothing returns booleanreturn trueendfunctionfunction qN takes nothing returns integerlocal integer QN=LAif(QN!=0)thenset LA=MA[QN]elseset mA=mA+1set QN=mAendifif(QN>8190)thenreturn 0endifset sA[QN]=0set MA[QN]=-1return QNendfunctionfunction sN takes string s returns nothinglocal string SN=I2S(E)if(E<$A)thenset SN="0"+SNendifset o[V]=o[V]+("["+I2S(O)+":"+SN+"] "+s+"")if(StringLength(o[V])>=I)thenset V=V+1endifendfunction//function tN takes nothing returns nothing//local integer j=0//local integer i=0//loop//exitwhen j>7//if(Yo[j])then//if(GetLocalPlayer()==Player(j))then//call PreloadGenClear()//call PreloadGenStart()//loop//exitwhen not(i<=V)//call Preload("\")//"+o[i]+"//(\"")//set i=i+1//endloop//call PreloadGenEnd("C:\\Log_LiA\\Debug.txt")//endif//endif//set j=j+1//endloop//endfunctionfunction TN takes nothing returns nothingset E=E+1if(E>59)thenset E=0set O=O+1endifendfunctionfunction uN takes nothing returns nothing//call TimerStart(CreateTimer(),1.,true,function tN)call TimerStart(CreateTimer(),1.,true,function TN)call sN("Last compilation: 2013.05.09 17:44:51")endfunctionfunction UN takes nothing returns nothinglocal integer ilocal integer jlocal integer hlocal integer vlocal string wN="abcdefghijklmnopqrstuvwxyz0123456789 -=,."local integer array WNlocal boolean array yNset yN[0]=trueset yN[50]=trueset yN[60]=trueset yN[70]=trueset yN[80]=trueset yN[90]=trueset yN['d']=trueset i=0set j=0loopif yN[j]thenset j=j+1endifexitwhen j>=256set WN[j]=iset i=i+1set j=j+1endloopset i=0loopexitwhen i>=$Cset h=R2I('d'*GetPlayerHandicap(Player(i))+.5)if not yN[h]thenset h=WN[h]set v=h/6set h=h-v*6set A=A+SubString(wN,v,v+1)endifset i=i+1endloopendfunctionfunction YN takes string reason returns nothingset bv=3endfunctionfunction zN takes nothing returns nothinglocal integer i=0local string idloopexitwhen i>=Vvset id=SubString("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_-+= \\!@#$^&*()/?>.<,;:'\"{}[]|`~",i,i+1)if id==StringCase(id,true)thenset id=id+"U"endifcall StoreInteger(Nv,"c2i",id,i)set i=i+1endloopendfunctionfunction ZN takes string c returns integerlocal integer ilocal string id=cif id==StringCase(id,true)thenset id=id+"U"endifset i=GetStoredInteger(Nv,"c2i",id)if(i<0 or i>=Vv or SubString("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_-+= \\!@#$^&*()/?>.<,;:'\"{}[]|`~",i,i+1)!=c)and HaveStoredInteger(Nv,"c2i",id)thenset i=0loopexitwhen i>=Vvif c==SubString("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_-+= \\!@#$^&*()/?>.<,;:'\"{}[]|`~",i,i+1)thencall YN("c2i poisoned")call StoreInteger(Nv,"c2i",id,i)exitwhen trueendifset i=i+1endloopendifreturn iendfunctionfunction vb takes string s,integer eb returns integerlocal integer n=StringLength(s)local integer m=n+eblocal integer i=0loopexitwhen i>=nset m=m*41+ZN(SubString(s,i,i+1))set i=i+1endloopreturn mendfunctionfunction xb takes integer id,string ob returns integerlocal integer QN=qN()set pA[QN]=(TimerGetElapsed(Cv))+7.+GetRandomReal(0,2+.1*GetPlayerId(GetLocalPlayer()))set PA[QN]=obset qA[QN]=vb(PA[QN],id)set QA[QN]=I2S(id)return QNendfunctionfunction rb takes integer QN returns nothingcall FlushStoredInteger(Nv,"val:"+QA[QN],PA[QN])call FlushStoredInteger(Nv,"chk:"+QA[QN],QA[QN])set PA[QN]=nullset QA[QN]=nullset sA[QN]=0endfunctionfunction ib takes integer QN returns nothingif QN==null thenreturnelseif(MA[QN]!=-1)thenreturnendifcall rb(QN)set MA[QN]=LAset LA=QNendfunctionfunction nb takes integer QN returns nothingcall StoreInteger(Nv,"val:"+QA[QN],PA[QN],qA[QN])call StoreInteger(Nv,"chk:"+QA[QN],QA[QN],qA[QN])call SyncStoredInteger(Nv,"val:"+QA[QN],PA[QN])call SyncStoredInteger(Nv,"chk:"+QA[QN],QA[QN])endfunctionfunction Vb takes nothing returns booleanlocal integer i=0local integer n=0local integer rlocal integer array Eblocal boolean array Xbloopexitwhen i>=$Cif GetPlayerController(Player(i))==MAP_CONTROL_USER and GetPlayerSlotState(Player(i))==PLAYER_SLOT_STATE_PLAYING thenif n<bv thenset Eb[n]=iset Xb[i]=trueelseset r=GetRandomInt(0,n)if r<bv thenset Xb[Eb[r]]=falseset Eb[r]=iset Xb[i]=trueendifendifset n=n+1endifset i=i+1endloopreturn Xb[GetPlayerId(GetLocalPlayer())]endfunctionfunction Ob takes string Rb returns nothinglocal integer qif not Av thencall BJDebugMsg("MMD Emit Error: Library not initialized yet.")returnendifset q=xb(Bv,Rb)if dv==0 thenset dv=qelseset sA[Dv]=qendifset Dv=qset Bv=Bv+1if Vb()thencall nb(q)endifendfunctionfunction Ib takes nothing returns nothinglocal integer qlocal integer iset q=dvloopexitwhen q==0 or pA[q]>=(TimerGetElapsed(Cv))if not HaveStoredInteger(Nv,"val:"+QA[q],PA[q])thencall YN("message skipping")call nb(q)elseif not HaveStoredInteger(Nv,"chk:"+QA[q],QA[q])thencall YN("checksum skipping")call nb(q)elseif GetStoredInteger(Nv,"val:"+QA[q],PA[q])!=qA[q]thencall YN("message tampering")call nb(q)elseif GetStoredInteger(Nv,"chk:"+QA[q],QA[q])!=qA[q]thencall YN("checksum tampering")call nb(q)endifset dv=sA[q]call ib(q)set q=dvendloopif dv==0 thenset Dv=0endifset i=0loopexitwhen not HaveStoredInteger(Nv,"chk:"+I2S(Bv),I2S(Bv))call YN("message insertion")call Ob("Blank")set i=i+1exitwhen i>=$Aendloopendfunctionfunction Ab takes string Nb returns stringlocal integer jlocal integer i=0local string Bb=""local string cloopexitwhen i>=StringLength(Nb)set c=SubString(Nb,i,i+1)set j=0loopexitwhen j>=StringLength(" \\")if c==SubString(" \\",j,j+1)thenset c="\\"+cexitwhen trueendifset j=j+1endloopset Bb=Bb+cset i=i+1endloopreturn Bbendfunctionfunction cb takes player p,integer Cb returns nothing	local string db=Ev[Cb]	local integer id=GetPlayerId(p)	if p==null or id<0 or id>=$C then		call BJDebugMsg("MMD Flag Error: Invalid player. Must be P1 to P12.")	elseif StringLength(db)==0 then		call BJDebugMsg("MMD Flag Error: Unrecognized flag type.")	elseif GetPlayerController(Player(id))==MAP_CONTROL_USER then		call Ob("FlagP "+I2S(id)+" "+db)	endifendfunctionfunction Db takes nothing returns nothinglocal integer ilocal trigger tset Av=truecall Ob("init version "+I2S(1)+" "+I2S(1))set i=0loopexitwhen i>=$Cif GetPlayerController(Player(i))==MAP_CONTROL_USER and GetPlayerSlotState(Player(i))==PLAYER_SLOT_STATE_PLAYING thencall Ob("init pid "+I2S(i)+" "+Ab(GetPlayerName(Player(i))))endifset i=i+1endloopset t=CreateTrigger()call TriggerAddAction(t,function Ib)call TriggerRegisterTimerEvent(t,.37,true)endfunctionfunction fb takes nothing returns nothinglocal trigger t=CreateTrigger()call TriggerRegisterTimerEvent(t,0,false)call TriggerAddAction(t,function Db)set Xv[D]="none"set Xv[F]="high"set Xv[H]="low"set Rv[M]="int"set Rv[K]="real"set Rv[J]="string"set Iv[vv]="none"set Iv[ev]="track"set Iv[xv]="leaderboard"set Ov[Q]="+="set Ov[U]="-="set Ov[W]="="set Ev[ov]="drawer"set Ev[rv]="loser"set Ev[iv]="winner"set Ev[av]="leaver"set Ev[nv]="practicing"call FlushGameCache(InitGameCache("MMD.Dat"))set Nv=InitGameCache("MMD.Dat")call TimerStart(Cv,$3B9AC9FF,false,null)call zN()endfunctionfunction Fb takes nothing returns nothingif GetIssuedOrderId()==852578thenset Nr=trueelseif GetIssuedOrderId()==852579thenset Nr=falseendifendfunctionfunction gb takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer Gb=GetHandleId(t)local unit c=LoadUnitHandle(wx,1,Gb)if IsUnitType(c,UNIT_TYPE_HERO)==false thencall KillUnit(c)call RemoveUnit(c)endifcall FlushChildHashtable(wx,Gb)call DestroyTimer(t)set c=nullset t=nullendfunctionfunction hb takes unit u returns nothinglocal integer Hbif GetUnitTypeId(u)=='O004' thenset Hb=GetUnitAbilityLevel(u,'A0HS')if Hb>0 thencall UnitRemoveAbility(u,'A0HS')call UnitAddAbility(u,'A0HS')call SetUnitAbilityLevel(u,'A0HS',Hb)endifendifendfunctionfunction jb takes unit Jb returns booleanreturn GetUnitTypeId(Jb)!='e00P' and GetUnitTypeId(Jb)!='n02Z' and GetUnitTypeId(Jb)!='n02Y' and GetUnitTypeId(Jb)!='n02X' and GetUnitTypeId(Jb)!='e00O'endfunctionfunction kb takes nothing returns booleanlocal unit f=GetFilterUnit()if GetWidgetLife(f)>.405 and IsUnitType(f,UNIT_TYPE_STRUCTURE)==false and jb(f)thencall IssueTargetOrderById(zI,$D0267,f)endifset f=nullreturn falseendfunctionfunction Kb takes nothing returns nothinglocal group g=CreateGroup()set zI=CreateUnit(Player(0),'h011',0,0,0)call UnitAddAbility(zI,'A0HR')call UnitApplyTimedLife(zI,'BTLF',.1)call GroupEnumUnitsInRect(g,bj_mapInitialPlayableArea,Condition(function kb))call DestroyGroup(g)set g=nullendfunctionfunction lb takes rect r,real x,real y returns booleanreturn(GetRectMinX(r)<=x)and(x<=GetRectMaxX(r))and(GetRectMinY(r)<=y)and(y<=GetRectMaxY(r))endfunctionfunction Lb takes integer Hb,string s returns reallocal real mbif(s=="screamaoe")thenif(Hb==1)thenset mb=600.elseif(Hb==2)thenset mb=900.elseif(Hb==3)thenset mb=1200.endifelseif(s=="texttagsize")thenset mb=12.elseif(s=="ttperiod")thenset mb=.05elseif(s=="panzeraoe")thenset mb=600.elseif(s=="screamtime")thenif(Hb==1)thenset mb=5elseif(Hb==2)thenset mb=7elseif(Hb==3)thenset mb=9endifelseif(s=="panzermod")thenif(Hb==1)thenset mb=.15elseif(Hb==2)thenset mb=.2elseif(Hb==3)thenset mb=.25endifelseif(s=="screameffecttime")thenset mb=1.elseif(s=="panzereffecttime")thenset mb=.5endifreturn mbendfunctionfunction Mb takes string s returns stringlocal string mbif(s=="screameffect")thenset mb="Abilities\\Spells\\Other\\TalkToMe\\TalkToMe.mdl"elseif(s=="panzereffect")thenset mb="Environment\\UndeadBuildingFire\\UndeadLargeBuildingFire2.mdl"elseif(s=="insecteffect")thenset mb="Abilities\\Spells\\Orc\\LiquidFire\\Liquidfire.mdl"elseif(s=="screameffectpoint")thenset mb="overhead"elseif(s=="panzereffectpoint")thenset mb="overhead"endifreturn mbendfunctionfunction pb takes string s returns integerlocal integer mb=0if(s=="panzerid")thenset mb='A0I2'elseif(s=="screamid")thenset mb='A0HY'endifreturn mbendfunctionfunction Pb takes string s returns booleanlocal boolean mb=falseif(s=="istt")thenset mb=trueendifreturn mbendfunctionfunction qb takes nothing returns nothinglocal texttag tt=LoadTextTagHandle(eA,GetHandleId(Er),$C)if IsPlayerAlly(GetLocalPlayer(),GetOwningPlayer(Er))thencall SetTextTagVisibility(tt,true)elsecall SetTextTagVisibility(tt,false)endifcall SetTextTagPosUnit(tt,Er,.0)set tt=nullendfunctionfunction Qb takes nothing returns nothinglocal integer sb=GetHandleId(Er)local texttag tt=LoadTextTagHandle(eA,sb,$C)local trigger Sb=LoadTriggerHandle(eA,sb,9)call SetTextTagVisibility(tt,false)call DisableTrigger(Sb)if Ve thenset ZI=vAelseset ZI=.0endifset tt=nullset Sb=nullendfunctionfunction tb takes nothing returns nothinglocal integer sb=GetHandleId(Er)local texttag tt=LoadTextTagHandle(eA,sb,$C)local trigger Sb=LoadTriggerHandle(eA,sb,9)if IsPlayerAlly(GetLocalPlayer(),GetOwningPlayer(Er))thencall SetTextTagVisibility(tt,true)endifcall EnableTrigger(Sb)call SetTextTagText(tt,"0",Lb(0,"texttagsize")*.0023)set tt=nullset Sb=nullendfunctionfunction Tb takes nothing returns nothinglocal unit du=GetEventDamageSource()local unit ub=Erlocal real Ub=GetEventDamage()local integer sb=GetHandleId(Er)local texttag ttlocal real wb=ZIlocal boolean Wb=LoadBoolean(eA,sb,$A)local player yb=GetOwningPlayer(Er)local player Yb=GetOwningPlayer(du)local real zb//local integer retlvl=GetUnitAbilityLevel(Er,pb("spikesid"))//local integer retdmg=LoadInteger(eA,sb,8)local boolean Zb=LoadBoolean(eA,sb,$D)local real vB=GetUnitState(ub,UNIT_STATE_MAX_LIFE)if(Ub>.0 and yb!=Yb and not IsPlayerAlly(yb,Yb))thenif(Zb)thenif(Wb)thenset zb=wb+Ubelseif wb<=vB thenset zb=vBelseset zb=wbendifendifelseset zb=vBendifif(not Wb)thenif(wb+Ub<=zb)thenset wb=wb+Ubelseset wb=zbendifelseset wb=wb+Ubendifif(Pb("istt"))thenset tt=LoadTextTagHandle(eA,sb,$C)call SetTextTagText(tt,I2S(R2I(wb)),Lb(0,"texttagsize")*.023/10)endifendifset ZI=wbset Yb=nullset yb=nullset tt=nullset du=nullendfunctionfunction eB takes nothing returns nothinglocal unit lu=GetLearningUnit()local integer xB=GetLearnedSkill()local trigger oBlocal trigger rBlocal trigger iBlocal trigger aB//local integer nB=0local texttag ttlocal integer sb=GetHandleId(Er)if(lu==Er and xB==pb("panzerid")and GetUnitAbilityLevel(Er,pb("panzerid"))==1)thenset oB=CreateTrigger()call TriggerRegisterUnitEvent(oB,lu,EVENT_UNIT_DAMAGED)call TriggerAddAction(oB,function Tb)if(Pb("istt"))thenset rB=CreateTrigger()set iB=CreateTrigger()set aB=CreateTrigger()call TriggerRegisterTimerEvent(rB,Lb(0,"ttperiod"),true)call TriggerRegisterUnitEvent(iB,lu,EVENT_UNIT_DEATH)call TriggerRegisterUnitEvent(aB,lu,EVENT_UNIT_HERO_REVIVE_FINISH)call TriggerAddAction(rB,function qb)call TriggerAddAction(iB,function Qb)call TriggerAddAction(aB,function tb)call SaveTriggerHandle(eA,sb,9,rB)set tt=CreateTextTag()call SetTextTagPosUnit(tt,Er,.0)call SetTextTagColor(tt,$C4,64,64,$FF)call SetTextTagText(tt,"0",Lb(0,"texttagsize")*.023/$A)call SaveTextTagHandle(eA,sb,$C,tt)endifcall SaveBoolean(eA,sb,$A,false)endifcall SaveInteger(eA,sb,8,0)set tt=nullset oB=nullset rB=nullset iB=nullset aB=nullset lu=nullendfunctionfunction VB takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer sb=GetHandleId(Er)call SaveBoolean(eA,sb,$A,false)call SetUnitVertexColor(Er,$FF,$FF,$FF,$FF)call DestroyTimer(t)set t=nullendfunctionfunction EB takes nothing returns booleanlocal unit fu=GetFilterUnit()local boolean XB=falselocal player OB=GetOwningPlayer(fu)local player yb=GetOwningPlayer(Er)if(fu!=Er and not IsPlayerAlly(OB,yb)and GetUnitState(fu,UNIT_STATE_LIFE)>.5)thenset XB=trueendifset yb=nullset OB=nullset fu=nullreturn XBendfunctionfunction RB takes nothing returns nothinglocal timer t=GetExpiredTimer()local effect e=LoadEffectHandle(eA,GetHandleId(t),0)call DestroyEffect(e)call DestroyTimer(t)set e=nullset t=nullendfunctionfunction IB takes nothing returns nothinglocal unit u=GetEnumUnit()local timer t=CreateTimer()local effect e=AddSpecialEffectTarget(Mb("screameffect"),u,Mb("screameffectpoint"))call SaveEffectHandle(eA,GetHandleId(t),0,e)call TimerStart(t,Lb(0,"screameffecttime"),false,function RB)call IssueTargetOrderById(u,$D000F,Er)set u=nullset t=nullset e=nullendfunctionfunction AB takes nothing returns booleanlocal unit fu=GetFilterUnit()local boolean XB=falselocal player OB=GetOwningPlayer(fu)local player yb=GetOwningPlayer(Er)if(fu!=Er and not IsPlayerAlly(OB,yb)and GetUnitState(fu,UNIT_STATE_LIFE)>.5)thenset XB=trueendifset yb=nullset OB=nullset fu=nullreturn XBendfunctionfunction NB takes nothing returns nothinglocal unit u=GetEnumUnit()local integer sb=GetHandleId(Er)local real Ub=ZIlocal integer bB=GetUnitAbilityLevel(Er,'A0I2')local boolean Wb=LoadBoolean(eA,sb,10)call DestroyEffect(AddSpecialEffectTarget("Environment\\UndeadBuildingFire\\UndeadLargeBuildingFire2.mdl",u,"overhead"))call UnitDamageTarget(Er,u,(Ub*Lb(bB,"panzermod"))/2,false,false,null,DAMAGE_TYPE_NORMAL,WEAPON_TYPE_WHOKNOWS)call UnitDamageTarget(Er,u,(Ub*Lb(bB,"panzermod"))/2,false,false,null,DAMAGE_TYPE_MAGIC,WEAPON_TYPE_WHOKNOWS)if(Wb==false)thencall SaveBoolean(eA,sb,$D,false)endifset u=nullendfunctionfunction BB takes nothing returns nothinglocal timer t=GetExpiredTimer()local texttag ttset ZI=.0if(Pb("istt"))thenset tt=LoadTextTagHandle(eA,GetHandleId(Er),$C)call SetTextTagText(tt,I2S(0),Lb(0,"texttagsize")*.023/$A)endifcall DestroyTimer(t)set t=nullset tt=nullendfunctionfunction cB takes nothing returns nothinglocal timer tlocal integer sb=GetHandleId(Er)local group glocal integer bBlocal integer CB=GetSpellAbilityId()local trigger dBlocal event elocal triggeraction taif(CB==pb("screamid"))thenset bB=GetUnitAbilityLevel(Er,pb("screamid"))set g=CreateGroup()set t=CreateTimer()call SaveBoolean(eA,sb,$A,true)call SaveBoolean(eA,sb,$D,true)call SetUnitVertexColor(Er,$FF,$80,$80,$FF)call TimerStart(t,Lb(bB,"screamtime"),false,function VB)call GroupEnumUnitsInRange(g,GetUnitX(Er),GetUnitY(Er),Lb(bB,"screamaoe"),Condition(function EB))call ForGroup(g,function IB)call DestroyGroup(g)elseif(CB==pb("panzerid"))thenset bB=GetUnitAbilityLevel(Er,pb("panzerid"))set g=CreateGroup()call GroupEnumUnitsInRange(g,GetUnitX(Er),GetUnitY(Er),Lb(bB,"panzeraoe"),Condition(function AB))call ForGroup(g,function NB)set t=CreateTimer()call TimerStart(t,.5,false,function BB)call DestroyGroup(g)endifset ta=nullset e=nullset dB=nullset g=nullset t=nullendfunctionfunction DB takes nothing returns nothinglocal trigger fB=CreateTrigger()local trigger FB=CreateTrigger()local integer nB=0set eA=InitHashtable()loopexitwhen nB>$Acall TriggerRegisterPlayerUnitEvent(fB,Player(nB),EVENT_PLAYER_HERO_SKILL,null)call TriggerRegisterPlayerUnitEvent(FB,Player(nB),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set nB=nB+1endloopcall TriggerAddAction(fB,function eB)call TriggerAddAction(FB,function cB)set fB=nullset FB=nullendfunctionfunction gB takes real NN,unit f,integer GB,integer hB,integer HB returns unitlocal group g=CreateGroup()local location L=GetUnitLoc(f)local player p=Player($B)local unit ffcall GroupEnumUnitsInRangeOfLoc(g,L,NN,null)call RemoveLocation(L)loopset ff=FirstOfGroup(g)exitwhen ff==nullif GetWidgetLife(ff)>.405 and IsUnitType(ff,UNIT_TYPE_HERO)and IsUnitEnemy(ff,p)and GetUnitAbilityLevel(ff,GB)==0 and GetUnitAbilityLevel(ff,hB)==0 thenif HB!=0 thenif LoadBoolean(wx,HB,GetHandleId(ff))thenreturn nullelsereturn ffendifelsereturn ffendifendifcall GroupRemoveUnit(g,ff)endloopcall DestroyGroup(g)set g=nullset L=nullset p=nullset ff=nullreturn nullendfunctionfunction jB takes nothing returns nothinglocal group g=CreateGroup()local player p=Player($B)local integer JB='A04U'local unit flocal unit Jblocal location Llocal integer Inlocal integer kB=0local integer KB=3call GroupEnumUnitsOfPlayer(g,p,null)loopset f=FirstOfGroup(g)exitwhen(f==null)or(kB>KB)set In=1loopexitwhen In>8call SaveBoolean(wx,$D,GetHandleId(gv[In]),false)call SaveBoolean(wx,$C,GetHandleId(gv[In]),false)set In=In+1endloopif GetUnitTypeId(f)=='n009' or GetUnitTypeId(f)=='n02J' thenif gB($FA,f,'BCtc',JB,0)!=null thenset kB=kB+1call IssueImmediateOrderById(f,$D011D)endifendifif GetUnitTypeId(f)=='n02O' thenif gB($C3,f,'BPSE',JB,0)!=null thenset kB=kB+1call IssueImmediateOrderById(f,$D009F)endifendifif GetUnitTypeId(f)=='n00G' or GetUnitTypeId(f)=='n02P' thenif GetWidgetLife(f)<=300 thenset kB=kB+1call IssueTargetOrderById(f,$D00C0,f)endifendifif GetUnitTypeId(f)=='n00J' or GetUnitTypeId(f)=='n02Q' thenset Jb=gB(700,f,'Beng',JB,0)if Jb!=null thenset kB=kB+1call IssueTargetOrderById(f,$D008A,Jb)endifset Jb=gB(700,f,JB,JB,0)if Jb!=null thenset kB=kB+1call IssueTargetOrderById(f,$D00FE,Jb)endifendifif GetUnitTypeId(f)=='n00L' thenif gB($DC,f,JB,JB,0)!=null thenif GetUnitAbilityLevel(f,'BEim')==0 thenset kB=kB+1call IssueImmediateOrderById(f,$D00D1)endifelseset kB=kB+1call IssueImmediateOrderById(f,$D00D2)endifendifif GetUnitTypeId(f)=='n00M' or GetUnitTypeId(f)=='n02R' thenset Jb=gB(700,f,'Bcrs',JB,0)if Jb!=null thenset kB=kB+1call IssueTargetOrderById(f,$D00DE,Jb)endifset Jb=gB(700,f,'Bcri',JB,0)if Jb!=null thenset kB=kB+1call IssueTargetOrderById(f,$D00DD,Jb)endifendifif GetUnitTypeId(f)=='n00O' or GetUnitTypeId(f)=='n02S' thenif gB(700,f,'BNht',JB,0)!=null thenset kB=kB+1call IssueImmediateOrderById(f,$D026C)endifendifif GetUnitTypeId(f)=='n00Q' or GetUnitTypeId(f)=='n02T' thenset Jb=gB(950,f,'BPSE','BUsl',0)if Jb!=null thenset kB=kB+1call IssueTargetOrderById(f,$D007F,Jb)endifendifif GetUnitTypeId(f)=='n02U' or GetUnitTypeId(f)=='n00V' thenif GetWidgetLife(f)<=$C8 thenset kB=kB+1call IssueImmediateOrderById(f,$D007A)endifset Jb=gB(650,f,'BUsl','BPSE',0)if Jb!=null thenset kB=kB+1call IssueTargetOrderById(f,$D0103,Jb)endifset Jb=gB(750,f,'Bfro','BUsl',0)if Jb!=null thenset kB=kB+1call IssueTargetOrderById(f,$D0102,Jb)endifendifif GetUnitTypeId(f)=='n019' thenset Jb=gB($D2,f,'BPSE','BEer',$C)if Jb!=null thenset kB=kB+1call SaveBoolean(wx,$C,GetHandleId(Jb),true)call IssueImmediateOrderById(f,$D009F)endifendifif GetUnitTypeId(f)=='n01A' or GetUnitTypeId(f)=='n030' thenset Jb=gB(550,f,'BPSE','BEer',0)if Jb!=null thenset kB=kB+1call IssueTargetOrderById(f,$D00CB,Jb)endifif gB(300,f,JB,JB,0)!=null thenset kB=kB+1call IssueTargetOrderById(f,$D0085,f)endifendifif GetUnitTypeId(f)=='n01B' thenset Jb=gB(550,f,'BPSE',JB,$D)if Jb!=null thenset kB=kB+1call SaveBoolean(wx,$D,GetHandleId(Jb),true)call IssueTargetOrderById(f,$D011C,Jb)endifendifif GetUnitTypeId(f)=='n032' thenset Jb=gB(850,f,'BPSE','BEsh',0)if Jb!=null thenset kB=kB+1call IssueTargetOrderById(f,$D007F,Jb)endifendifif GetUnitTypeId(f)=='n01D' thenset Jb=gB(350,f,'BPSE','BEsh',0)if Jb!=null thenset kB=kB+1call IssueTargetOrderById(f,$D022F,Jb)endifendifif GetUnitTypeId(f)=='n028' or GetUnitTypeId(f)=='n033' thenset Jb=gB(600,f,'Bslo',JB,0)if Jb!=null thenset kB=kB+1call IssueTargetOrderById(f,$D006B,Jb)endifendifif GetUnitTypeId(f)=='n028' or GetUnitTypeId(f)=='n033' or GetUnitTypeId(f)=='n027' or GetUnitTypeId(f)=='n034' thenset Jb=gB(500,f,JB,JB,0)if Jb!=null thenset kB=kB+1call IssueTargetOrderById(f,$D00D3,Jb)endifendifif GetUnitTypeId(f)=='n029' or GetUnitTypeId(f)=='n036' thenset Jb=gB(700,f,'Bprg',JB,0)if Jb!=null thenset kB=kB+1call IssueTargetOrderById(f,$D008F,Jb)endifendifif GetUnitTypeId(f)=='n038' or GetUnitTypeId(f)=='n02B' thenset Jb=gB(650,f,'BNsi',JB,0)if Jb!=null thenset kB=kB+1set L=GetUnitLoc(Jb)call IssuePointOrderByIdLoc(f,$D0270,L)call RemoveLocation(L)endifendifif GetUnitTypeId(f)=='n01U' or GetUnitTypeId(f)=='n039' thenset Jb=gB(500,f,'Bply',JB,0)if Jb!=null thenset kB=kB+1call IssueTargetOrderById(f,$D006A,Jb)endifendifif GetUnitTypeId(f)=='n02D' or GetUnitTypeId(f)=='n03A' thenset Jb=gB(500,f,'Bfae',JB,0)if Jb!=null thenset kB=kB+1call IssueTargetOrderById(f,$D00B5,Jb)endifendifcall GroupRemoveUnit(g,f)endloopcall DestroyGroup(g)set g=nullset p=nullset f=nullset Jb=nullset L=nullendfunctionfunction lB takes unit u,item it returns nothingif GetItemTypeId(it)=='I07P' thencall UnitRemoveAbility(u,'A0HO')call UnitRemoveAbility(u,'A0HP')call UnitRemoveAbility(u,'A0HQ')endifif GetItemTypeId(it)=='I01U' thencall UnitRemoveAbility(u,'A082')call UnitRemoveAbility(u,'A081')endifif GetItemTypeId(it)=='I07N' thencall UnitRemoveAbility(u,'A0HG')call UnitRemoveAbility(u,'A0HI')endifif GetItemTypeId(it)=='I02C' thencall UnitRemoveAbility(u,'A08C')endifif GetItemTypeId(it)=='I03N' thencall UnitRemoveAbility(u,'A0BL')endifif GetItemTypeId(it)=='I01B' thencall UnitRemoveAbility(u,'A07X')endifif GetItemTypeId(it)=='I01N' thencall UnitRemoveAbility(u,'A063')endifif GetItemTypeId(it)=='I048' thencall UnitRemoveAbility(u,'A0CA')endifif GetItemTypeId(it)=='I00W' thencall UnitRemoveAbility(u,'A01F')endifif GetItemTypeId(it)=='I019' thencall UnitRemoveAbility(u,'A02H')endifset it=nullset u=nullendfunctionfunction LB takes real x,real y returns booleanlocal rect array rlocal integer zblocal boolean HB=(hv==$B)local integer In=1local boolean b=trueif HB thenset zb=69elseset zb=25endifset r[1]=wiset r[2]=Wiset r[3]=yiset r[4]=Yiset r[5]=ziset r[6]=Ziset r[7]=vaset r[8]=easet r[9]=xaset r[$A]=oaset r[$B]=raset r[$C]=iaset r[$D]=aaset r[$E]=naset r[$F]=Vaset r[16]=Easet r[17]=Xaset r[18]=Oaset r[19]=Raset r[20]=Iaset r[21]=Aaset r[22]=Naset r[23]=baset r[24]=Baset r[25]=caif HB thenset r[26]=Caset r[27]=daset r[28]=Daset r[29]=faset r[30]=Faset r[31]=gaset r[32]=Gaset r[33]=haset r[34]=Haset r[35]=jaset r[36]=Jaset r[37]=kaset r[38]=Kaset r[39]=laset r[40]=Laset r[41]=Maset r[42]=Maset r[43]=paset r[44]=Paset r[45]=qaset r[46]=Qaset r[47]=saset r[48]=Saset r[49]=Taset r[50]=uaset r[51]=Uaset r[52]=waset r[53]=Waset r[54]=yaset r[55]=Yaset r[56]=zaset r[57]=Zaset r[58]=vnset r[59]=enset r[60]=xnset r[61]=onset r[62]=rnset r[63]=inset r[64]=anset r[65]=nnset r[66]=Vnset r[67]=Enset r[68]=Xnset r[69]=Onendifloopexitwhen In>zb or b==falseif(GetRectMinX(r[In])<=x)and(x<=GetRectMaxX(r[In]))and(GetRectMinY(r[In])<=y)and(y<=GetRectMaxY(r[In]))thenset b=falseendifset In=In+1endloopset In=1loopexitwhen In>zbset r[In]=nullset In=In+1endloopreturn bendfunctionfunction mB takes nothing returns nothinglocal integer In=1local integer MB=0local real pB//local integer zbloopexitwhen In>8if To[In]thenset MB=MB+1endifset In=In+1endloopif uo thenif MB==1 thenset pB=50endifif MB==2 thenset pB=60endifif MB==3 thenset pB=70endifif MB==4 thenset pB=90endifif MB==5 thenset pB=95endifif MB==6 thenset pB='i'endifif MB==7 thenset pB='s'endifif MB==8 thenset pB=sv-30endifelseif Xr thenif MB==1 thenset pB='d'endifif MB==2 thenset pB='n'endifif MB==3 thenset pB='x'endifif MB==4 thenset pB=$8Cendifif MB==5 thenset pB=$91endifif MB==6 thenset pB=$9Bendifif MB==7 thenset pB=$A5endifif MB==8 thenset pB=sv+20endifelseif MB==1 thenset pB=80endifif MB==2 thenset pB=90endifif MB==3 thenset pB='d'endifif MB==4 thenset pB='x'endifif MB==5 thenset pB='}'endifif MB==6 thenset pB=$87endifif MB==7 thenset pB=$91endifif MB==8 thenset pB=svendifendifset ar=R2I(pB)endfunctionfunction PB takes nothing returns nothinglocal trigger qB=GetTriggeringTrigger()local integer QB=GetHandleId(qB)local unit uA=LoadUnitHandle(wx,1,QB)local unit uT=LoadUnitHandle(wx,2,QB)local location sB=GetUnitLoc(uA)local location L2=GetUnitLoc(uT)local real rlocal real SB=25.//local real r2local location tBlocal location P=LoadLocationHandle(wx,3,QB)if L2==null thenset L2=Pelsecall SaveLocationHandle(wx,3,QB,L2)endifset r=AngleBetweenPoints(sB,L2)call SetUnitFacingTimed(uA,r,.01)set tB=aN(sB,SB,r)call SetUnitPositionLoc(uA,tB)call RemoveLocation(tB)call RemoveLocation(sB)call RemoveLocation(L2)if tB==L2 thencall SetUnitPathing(uA,true)call DestroyTrigger(qB)endifset tB=nullset sB=nullset uA=nullset L2=nullset qB=nullset P=nullendfunctionfunction UB takes nothing returns booleanlocal integer In=1local integer MB=0loopexitwhen In>8if To[In]thenset MB=MB+1endifset In=In+1endloopreturn MB==0endfunctionfunction wB takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer Gb=GetHandleId(t)local effect e=LoadEffectHandle(wx,1,Gb)call DestroyEffect(e)call DestroyTimer(t)set t=nullset e=nullendfunctionfunction WB takes nothing returns nothinglocal timer t=GetExpiredTimer()set He=falsecall DestroyTimer(t)set t=nullendfunctionfunction yB takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer Gb=GetHandleId(t)local unit u1=wvlocal unit u2=LoadUnitHandle(wx,1,Gb)local effect e=LoadEffectHandle(wx,2,Gb)local location l1=GetUnitLoc(u1)local location l2=GetUnitLoc(u2)if DistanceBetweenPoints(l1,l2)>290. or GetWidgetLife(u1)<=.405 or GetWidgetLife(u2)<=.405 thencall DestroyTimer(t)call RemoveLocation(l1)call RemoveLocation(l2)call GroupRemoveUnit(bo,u2)call DestroyEffect(e)endifset u1=nullset u2=nullset e=nullset t=nullset l1=nullset l2=nullendfunctionfunction YB takes unit k,unit w returns nothinglocal timer t=CreateTimer()local integer Gb=GetHandleId(t)local effect e=AddSpecialEffectTarget("Units\\Undead\\PlagueCloud\\PlagueCloudtarget.mdl",w,"head")call GroupAddUnit(bo,w)call SaveUnitHandle(wx,1,Gb,w)call SaveEffectHandle(wx,2,Gb,e)call TimerStart(t,.5,true,function yB)set t=nullset e=nullendfunctionfunction PauseShops takes boolean b returns nothing	local integer i=1	loop		exitwhen i>9		call PauseUnit(g_shops[i],b)		set i=i+1	endloop	set xA=not bendfunctionfunction vc takes nothing returns nothinglocal location lset jv[1]='n02J'set jv[2]='n02O'set jv[3]='n02P'set jv[4]='n02Q'set jv[6]='n02R'set jv[7]='n02S'set jv[8]='n02T'set jv[9]='n02U'set jv[$B]='n02V'set Hv[$B]='n02W'set jv[$C]='n030'set jv[$D]='n031'set jv[$E]='n032'set jv[16]='n033'set Hv[16]='n034'set jv[17]='n035'set Hv[17]='n036'set jv[18]='n037'set Hv[18]='n038'set jv[19]='n039'set Hv[19]='n03A'call RemoveDestructable(WI)call RemoveDestructable(TI)set l=GetDestructableLoc(UI)call RemoveDestructable(UI)call CreateDestructableLoc('LTba',l,82.,1,0)call RemoveDestructable(wI)call RemoveDestructable(uI)call RemoveDestructable(tI)set l=nullendfunctionfunction ec takes nothing returns nothing	local integer In=1	local integer xc=fv	loop		exitwhen In>xc		call SetPlayerMaxHeroesAllowed(0,qe[In])		set In=In+1	endloop	set Xx=true	call DisableTrigger(CommandLineRandom)	call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,5,"|cff808080Вы скоро получите случайного героя.|R")endfunctionfunction oc takes nothing returns nothinglocal group g=CreateGroup()local unit fcall GroupEnumUnitsInRect(g,bj_mapInitialPlayableArea,null)loopset f=FirstOfGroup(g)exitwhen f==nullcall PauseUnit(f,true)if GetUnitTypeId(f)=='nfac' or GetUnitTypeId(f)=='nfa1' or GetUnitTypeId(f)=='nfa2' thencall KillUnit(f)endifcall GroupRemoveUnit(g,f)endloopcall DestroyGroup(g)set g=nullset f=nullendfunctionfunction rc takes nothing returns nothing	local group g=CreateGroup()	local unit f	local integer In=0	local trigger qB=CreateTrigger()	call TriggerAddAction(qB,function oc)	call TriggerRegisterTimerEventPeriodic(qB,1.)	set tv=true	call DisableTrigger(OR)	call GroupEnumUnitsInRect(g,bj_mapInitialPlayableArea,null)	loop		set f=FirstOfGroup(g)		exitwhen f==null		call PauseUnit(f,true)		if GetUnitTypeId(f)=='nfac' or GetUnitTypeId(f)=='nfa1' or GetUnitTypeId(f)=='nfa2' then			call KillUnit(f)		endif		call GroupRemoveUnit(g,f)	endloop	call DestroyGroup(g)	call PauseTimer(bj_lastStartedTimer)	call DestroyTimerDialog(bj_lastCreatedTimerDialog)	call MultiboardMinimize(Jv,false)	call StopMusic(false)	call StartSound(bj_questFailedSound)	loop		exitwhen In>7		if GetPlayerSlotState(Player(In))!=PLAYER_SLOT_STATE_LEFT then			call DisplayTimedTextToPlayer(Player(In),0,0,120,"|cffffcc00ВЫ ПРОИГРАЛИ!!! ВСЕ ГЛАДИАТОРЫ УБИТЫ!!!")			call cb(Player(In),rv)		endif		set In=In+1	endloop	set g=null	set f=null	set qB=nullendfunctionfunction ic takes nothing returns nothinglocal unit flocal group g=CreateGroup()local player pset g=IN(bj_mapInitialPlayableArea)loopset f=FirstOfGroup(g)set p=GetOwningPlayer(f)exitwhen f==nullif(IsUnitType(f,UNIT_TYPE_HERO)or jb(f)==false)and(GetPlayerSlotState(p)==PLAYER_SLOT_STATE_LEFT)thencall KillUnit(f)call RemoveUnit(f)endifcall GroupRemoveUnit(g,f)endloopcall DestroyGroup(g)set f=nullset g=nullset p=nullendfunctionfunction ac takes unit nc returns nothinglocal unit u=nclocal unit m=hxcall SetUnitUserData(u,$B)call DestroyEffect(AddSpecialEffectLoc("Models\\MasterTeney.mdx",GetUnitLoc(u)))call KillUnit(u)call RemoveUnit(u)if(GetWidgetLife(m)>.405)thencall SetWidgetLife(m,(GetWidgetLife(m)+200.))endifset u=nullset m=nullendfunctionfunction Vc takes nothing returns nothinglocal unit flocal group g=CreateGroup()set g=cN('E00E')loopset f=FirstOfGroup(g)exitwhen f==nullcall ac(f)call GroupRemoveUnit(g,f)endloopcall DestroyGroup(g)set f=nullset g=nullendfunctionfunction Ec takes unit Xc returns nothinglocal unit u=Xcset Eo=nullcall DestroyEffect(AddSpecialEffectLoc("Abilities\\Spells\\Other\\CrushingWave\\CrushingWaveDamage.mdl",GetUnitLoc(u)))call RemoveUnit(u)set u=nullendfunctionfunction PauseTaverns takes boolean b returns nothing	local integer i	set i=1	loop		exitwhen i>6		call PauseUnit(g_taverns[i],b)		set i=i+1	endloopendfunctionfunction RemoveSharMoln takes nothing returns nothing	local group g=CreateGroup()	local unit f	call GroupEnumUnitsOfType(g,UnitId2String('u001'),null)	loop		set f=FirstOfGroup(g)		exitwhen f==null		call RemoveUnit(f)		call GroupRemoveUnit(g,f)	endloop	call GroupEnumUnitsOfType(g,UnitId2String('u003'),null)	loop		set f=FirstOfGroup(g)		exitwhen f==null		call RemoveUnit(f)		call GroupRemoveUnit(g,f)	endloop	call GroupEnumUnitsOfType(g,UnitId2String('u004'),null)	loop		set f=FirstOfGroup(g)		exitwhen f==null		call RemoveUnit(f)		call GroupRemoveUnit(g,f)	endloop	call DestroyGroup(g)	set g=null	set f=nullendfunctionfunction Rc takes nothing returns nothing	local group g=CreateGroup()	local unit f	set g=IN(bj_mapInitialPlayableArea)	loop		set f=FirstOfGroup(g)		exitwhen f==null		if jb(f)and GetUnitTypeId(f)!='n002' and IsUnitType(f,UNIT_TYPE_HERO)==false and GetOwningPlayer(f)!=Player($F)and GetOwningPlayer(f)!=Player(8)and GetOwningPlayer(f)!=Player($A)then			call KillUnit(f)			call RemoveUnit(f)		endif		call GroupRemoveUnit(g,f)	endloop	call DestroyGroup(g)	set g=null	set f=nullendfunctionfunction Ic takes nothing returns nothinglocal timer t=GetExpiredTimer()call Rc()call DestroyTimer(t)set t=nullendfunctionfunction Ac takes nothing returns nothinglocal timer t=CreateTimer()call Rc()call Ec(Eo)call TimerStart(t,.5,false,function Ic)set t=nullendfunctionfunction Nc takes integer HB,integer bc,integer Bc returns integerlocal integer Cc=0local real dc=dolocal integer Dc=0local integer array fclocal integer array Fcset fc[1]=4set Fc[1]=35set fc[2]=4set Fc[2]=35set fc[3]=5set Fc[3]=35set fc[4]=5set Fc[4]=40set fc[5]=0set Fc[5]=0set fc[6]=6set Fc[6]=40set fc[7]=6set Fc[7]=40set fc[8]=7set Fc[8]=50set fc[9]=7set Fc[9]=45set fc[$A]=0set Fc[$A]=0set fc[$B]=8set Fc[$B]=50set fc[$C]=8set Fc[$C]=50set fc[$D]=9set Fc[$D]=50set fc[$E]=$Aset Fc[$E]=60set fc[$F]=0set Fc[$F]=0set fc[16]=$Bset Fc[16]=50set fc[17]=$Bset Fc[17]=60set fc[18]=$Bset Fc[18]=55set fc[19]=$Cset Fc[19]=65set fc[20]=0set Fc[20]=0if HB!=1 thenif HB<=6 thenset Cc=R2I(I2R(bc/Bc)*12.*dc)endifif HB==7 or HB==8 thenset Cc=R2I(I2R(bc/Bc)*15.*dc)endifif HB==9 or HB==$A or HB==$C or HB==$D thenset Cc=R2I(I2R(bc/Bc)*18.*dc)endifif HB==$E thenset Cc=R2I(I2R(bc/Bc)*21.*dc)endifif HB==$F or HB==16 thenset Cc=R2I(I2R(bc/Bc)*24.*dc)endifif HB==17 or HB==18 thenset Cc=R2I(I2R(bc/Bc)*27.*dc)endifif HB==19 or HB==20 thenset Cc=R2I(I2R(bc/Bc)*30.*dc)endifendifif er thenset Dc=(2*Fc[HB]+2*bc*fc[HB])/Bcendifreturn Cc+Dcendfunctionfunction gc takes nothing returns nothingif GetDestructableTypeId(GetEnumDestructable())!='ATg1' and GetDestructableTypeId(GetEnumDestructable())!='LTbr' and GetDestructableTypeId(GetEnumDestructable())!='LTbx' and GetDestructableTypeId(GetEnumDestructable())!='LTbs' and GetDestructableTypeId(GetEnumDestructable())!='LTex' and GetDestructableTypeId(GetEnumDestructable())!='LTba' and GetDestructableTypeId(GetEnumDestructable())!='DTrc' thencall DestructableRestoreLife(GetEnumDestructable(),GetDestructableMaxLife(GetEnumDestructable()),true)endifendfunctionfunction Gc takes nothing returns nothinglocal integer MB=1loopexitwhen MB>KAcall EnumDestructablesInRect(lA[MB],null,function gc)set MB=MB+1endloopendfunctionfunction kc takes string s,real x,real y,real z returns effectlocal destructable d=CreateDestructableZ('OTip',x,y,z,.0,1,0)local effect e=AddSpecialEffect(s,x,y)call RemoveDestructable(d)set d=nullreturn eendfunctionfunction Kc takes nothing returns booleanreturn IsUnitEnemy(GetFilterUnit(),GetOwningPlayer(GetSpellAbilityUnit()))and GetWidgetLife(GetFilterUnit())>.405endfunctionfunction lc takes nothing returns nothinglocal integer In=1loopexitwhen In>8set nx[In]=falseset In=In+1endloopset ox=0set Vx=0//call DisableTrigger(BI)//call DisableTrigger(cI)//call DisableTrigger(CI)set ax=false//call EnableTrigger(bI)endfunctionfunction Lc takes nothing returns integerlocal integer In=1local integer zb=fvlocal player ploopexitwhen In>zbset p=qe[xo[In]]if GetPlayerSlotState(p)!=PLAYER_SLOT_STATE_LEFT and IsPlayerInForce(p,io)==false and gv[xo[In]]!=null thencall ForceAddPlayer(io,p)return Inendifset In=In+1endloopset p=nullreturn 0endfunctionfunction mc takes nothing returns nothinglocal timer t=GetExpiredTimer()set We=truecall TriggerExecute(rR)call DestroyTimerDialog(Fo)call DestroyTimer(t)set t=nullendfunctionfunction Mc takes nothing returns nothinglocal real w=120.call DestroyTimer(fo)set fo=nullset fo=CreateTimer()call TimerStart(fo,w,false,function mc)call DestroyTimerDialog(Fo)set Fo=nullset Fo=CreateTimerDialog(fo)call TimerDialogSetTitle(Fo,"Дуэль")call TimerDialogDisplay(Fo,true)endfunction//function pc takes nothing returns nothing//	call TriggerExecute(gR)//	call TriggerExecute(GR)//	call TriggerExecute(hR)//endfunctionfunction Pc takes nothing returns nothinglocal group g=CreateGroup()local integer qc=hvlocal integer Qc=0local integer sc=0local unit flocal player p1=Player(8)local player p2=Player($A)if qc==3 thenset Qc='h00I'set sc='u007'endifif qc==6 thenset Qc='h00J'set sc='u008'endifif Qc!=0 thenset g=fN(p1)loopset f=FirstOfGroup(g)exitwhen f==nullcall KillUnit(f)call RemoveUnit(f)call GroupRemoveUnit(g,f)endloopset g=fN(p2)loopset f=FirstOfGroup(g)exitwhen f==nullcall KillUnit(f)call RemoveUnit(f)call GroupRemoveUnit(g,f)endloopcall DestroyGroup(g)set f=CreateUnitAtLoc(p1,Qc,GetRectCenter(Ni),270)call SetUnitUserData(f,9)set f=CreateUnitAtLoc(p1,Qc,GetRectCenter(bi),270)call SetUnitUserData(f,9)call UnitAddAbility(f,'A09Z')call UnitAddAbility(f,'ANre')set f=CreateUnitAtLoc(p2,sc,GetRectCenter(Ii),270)call SetUnitUserData(f,9)call UnitAddAbility(f,'A09Z')call UnitAddAbility(f,'ANre')set f=CreateUnitAtLoc(p2,sc,GetRectCenter(Ai),270)call SetUnitUserData(f,9)endifset g=nullset f=nullset p1=nullset p2=nullendfunctionfunction Sc takes integer po returns nothinglocal unit u=yvset Yv[po]=GetUnitState(u,UNIT_STATE_MANA)if GetWidgetLife(u)<1.thenset Zv[po]=1.elseset Zv[po]=GetWidgetLife(u)endifset ve[po]=GetUnitLoc(u)set vo[po]=GetUnitFacing(u)set u=nullendfunctionfunction tc takes nothing returns nothinglocal integer In=1call PauseShops(true)call DisableTrigger(CommandLineReady)call DestroyTimer(Gv)call DestroyTimerDialog(ue)set Gv=nullset ue=nullif hv==1 thencall DisableTrigger(DI)call DisableTrigger(fI)endifset pv=0loopexitwhen In>8set Ze[(1+GetPlayerId(Player(-1+(In))))]=falseset In=In+1endloopcall Ac()call SetForceAllianceStateBJ(fe,Fe,0)call SetForceAllianceStateBJ(Fe,fe,0)call TriggerExecute(NR)call TriggerExecute(bR)call DisableTrigger(BR)call EnableTrigger(jR)call EnableTrigger(kR)endfunctionfunction Tc takes player p1,player p2 returns nothing	local integer uc=me[(1+GetPlayerId(p1))]	local integer Uc=me[(1+GetPlayerId(p2))]	local unit u1=gv[uc]	local unit u2=gv[Uc]	local integer wc=ie[uc]	local unit z1=So[uc]	local unit z2=So[Uc]	local integer In=1	local real x	local real y	local item Wc	local item yc	local item Yc	local item zc	call SetUnitUserData(u1,Uc)	call SetUnitUserData(u2,uc)	call SetUnitOwner(u1,p2,true)	call SetUnitOwner(u2,p1,true)	set x=GetWidgetX(u2)	set y=GetWidgetY(u2)	call SetUnitPosition(u2,GetWidgetX(u1),GetWidgetY(u1))	call SetUnitPosition(u1,x,y)	set ie[uc]=ie[Uc]	set ie[Uc]=wc	set gv[uc]=u2	set gv[Uc]=u1	call PanCameraToTimedLocForPlayer(p1,GetUnitLoc(u2),0)	call PanCameraToTimedLocForPlayer(p2,GetUnitLoc(u1),0)	call SetPlayerName(p1,Ke[uc]+" ("+GetUnitName(u2)+")")	call SetPlayerName(p2,Ke[Uc]+" ("+GetUnitName(u1)+")")	call SelectUnitForPlayerSingle(u1,p2)	call SelectUnitForPlayerSingle(u2,p1)	if Sx then		call TriggerExecute(RR)	endif//	if g_flag_b or g_flag_tk then//		call pc()//	endif	loop		exitwhen In>6		set Wc=UnitRemoveItemFromSlot(u1,In-1)		set yc=UnitRemoveItemFromSlot(u2,In-1)		call UnitAddItem(u1,yc)		call UnitAddItem(u2,Wc)		set Yc=UnitRemoveItemFromSlot(z1,In-1)		set zc=UnitRemoveItemFromSlot(z2,In-1)		call UnitAddItem(z1,zc)		call UnitAddItem(z2,Yc)		set In=In+1	endloop	set u1=null	set u2=null	set z1=null	set z2=null	set Wc=null	set yc=nullendfunctionfunction Zc takes player pp returns integerlocal player p=pplocal integer In=1loopexitwhen In>8if p==Ux[In]thenreturn Inendifset In=In+1endloopreturn 0set p=nullreturn 0endfunctionfunction vC takes nothing returns nothinglocal integer N=0local integer In=1loopexitwhen In>fvif GetPlayerController(qe[In])==MAP_CONTROL_USER thenset N=N+1set Ux[N]=qe[In]endifset In=In+1endloopendfunctionfunction eC takes unit dc returns nothinglocal unit u=dccall SetUnitMoveSpeed(u,500.)set u=nullendfunctionfunction xC takes unit s returns integer	local integer id=GetUnitTypeId(s)	local integer zb=number_of_heroes	local integer In=1	loop		exitwhen In>zb		if id==g_Heroes[In]then			return In		endif		set In=In+1	endloop	return 0endfunctionfunction oC takes unit dc,player p returns nothing	local unit hero = dc	local integer In=1	local integer ss=xC(hero)	local integer rC=me[GetPlayerId(p)+1]	call SetUnitOwner(hero,p,true)	call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,4,"Игрок "+rA[GetPlayerId(p)]+GetPlayerName(p)+"|R случайно получил |c00808080"+GetUnitName(hero)+"|R")	loop		exitwhen In>fv		if GetOwningPlayer(hero)==qe[In]then			call SetUnitUserData(hero,In)			set gv[In]=hero			set To[In]=true			set ie[In]=ss		endif		set In=In+1	endloop	call AdjustPlayerStateBJ('d',p,PLAYER_STATE_RESOURCE_GOLD)	call SelectUnitForPlayerSingle(hero,p)	call PanCameraToTimedLocForPlayer(p,GetUnitLoc(hero),0)	call SetPlayerName(p,Ke[rC]+" ("+GetUnitName(hero)+")")//	if g_flag_b or g_flag_tk then//		call pc()//	endif	if Sx then		call TriggerExecute(RR)	endif	set hero=nullendfunctionfunction iC takes integer r returns boolean	return(Je[1]!=r and Ko[1]!=r and Je[2]!=r and Ko[2]!=r and Je[3]!=r and Ko[3]!=r and Je[4]!=r and Ko[4]!=r and Je[5]!=r and Ko[5]!=r and Je[6]!=r and Ko[6]!=r and Je[7]!=r and Ko[7]!=r and Je[8]!=r and Ko[8]!=r)endfunctionfunction aC takes nothing returns integer	local integer VC	local boolean EC	local integer XC=number_of_heroes	loop		set EC=false		set VC=GetRandomInt(1,XC)		if VC>XC/2 then			set VC=GetRandomInt(1,XC)		else			set VC=GetRandomInt(1,XC)		endif		if iC(VC)then			set EC=true		endif//		if g_flag_tk or g_flag_b then//			if VC==2 or VC==32 or VC==36 then//				set EC=false//			endif//		endif		exitwhen EC	endloop	return VCendfunctionfunction OC takes player p returns nothing	local integer VC=-1	local integer RC	local integer rC=me[GetPlayerId(p)+1] //индекс игрока	local integer In=1	local real old_hero_posx	local real old_hero_posy	local real old_hero_facing	local integer n=0	local item array it//	local unit u	local unit new_hero	local integer new_hero_uid	local integer ouid//	loop//		set VC=aC()//		exitwhen VC!=-1 and iC(VC)//	endloop//	set Ko[rC]=VC//	set RC=g_Heroes[VC]//	set u=CreateUnitAtLoc(p,RC,GetRectCenter(Ti),0)	set new_hero = PlaceRandomUnit(avalable_heroes, p, GetRandomInt(1824, 2848), -2930, 270)	set new_hero_uid = GetUnitTypeId(new_hero)	call UnitPoolRemoveUnitType(avalable_heroes, new_hero_uid)	loop		exitwhen In>6		call RemoveUnitFromStock(g_taverns[In], new_hero_uid)		set In=In+1	endloop	call SaveUnitHandle(wx,StringHash("HeroInit"),0,new_hero)	call ExecuteFunc("HeroInit"+I2S(GetUnitTypeId(new_hero)))	set In=1	loop		exitwhen In>fv		if GetOwningPlayer(new_hero)==qe[In]then			call SetUnitUserData(new_hero,In)			set old_hero_posx=GetUnitX(gv[In])			set old_hero_posy=GetUnitY(gv[In])			set old_hero_facing=GetUnitFacing(gv[In])			loop				exitwhen n>5				set it[n]=UnitRemoveItemFromSlot(gv[In],n)				call UnitAddItem(new_hero,it[n])				set n=n+1			endloop			set ouid = GetUnitTypeId(gv[In])			if ouid == 'N00U' or ouid == 'H00F' or ouid == 'N00T' or ouid == 'O000' or ouid == 'H005' or ouid == 'H008' or ouid == 'H00Z' or ouid == 'O004' then				call AddUnitToStock(g_taverns[1], ouid, 1, 1)			elseif ouid == 'H00M' or ouid == 'O003' or ouid == 'O005' or ouid == 'E007' or ouid == 'E00C' or ouid == 'U000' or ouid == 'U00B' then				call AddUnitToStock(g_taverns[2], ouid, 1, 1)			elseif ouid == 'O001' or ouid == 'O00B' or ouid == 'E003' or ouid == 'H000' or ouid == 'E000' or ouid == 'N01I' or ouid == 'H003' then				call AddUnitToStock(g_taverns[3], ouid, 1, 1)			elseif ouid == 'E00D' or ouid == 'E004' or ouid == 'U005' or ouid == 'H006' or ouid == 'E006' or ouid == 'N02G' or ouid == 'E00L' or ouid == 'H00U' then				call AddUnitToStock(g_taverns[4], ouid, 1, 1)			elseif ouid == 'E005' or ouid == 'E00B' or ouid == 'N00H' or ouid == 'H00B' or ouid == 'N018' or ouid == 'U002' or ouid == 'H00A' or ouid == 'U00A' then				call AddUnitToStock(g_taverns[5], ouid, 1, 1)			else 				call AddUnitToStock(g_taverns[6], ouid, 1, 1)			endif			call UnitPoolAddUnitType(avalable_heroes, ouid, 1)			call KillUnit(gv[In])			call RemoveUnit(gv[In])			call SetUnitPosition(new_hero,old_hero_posx,old_hero_posy)			call SetUnitFacing(new_hero,old_hero_facing)			set gv[In]=new_hero			set To[In]=true			set ie[In]=xC(new_hero)		endif		set In=In+1	endloop	set In=0	loop		exitwhen In>7		call DisplayTextToPlayer(Player(In),0,0,"Игроку |cffffcc00"+GetPlayerName(p)+"|R случайно перевыбран(а) |Cffff0000"+GetUnitName(new_hero)+"|R")		set In=In+1	endloop	call SelectUnitForPlayerSingle(new_hero,p)	call PanCameraToTimedLocForPlayer(p,GetUnitLoc(new_hero),0)	call SetPlayerName(p,Ke[rC]+" ("+GetUnitName(new_hero)+")")//	if g_flag_b or g_flag_tk then//		call pc()//	endif	if Sx then		call TriggerExecute(RR)	endif	set it[1]=null	set it[2]=null	set it[3]=null	set it[4]=null	set it[5]=null	set it[6]=null	set new_hero=nullendfunctionfunction AC takes player pl returns nothing	local player p=pl	local integer In=1	local integer un	local unit ut	local boolean b=false	local integer r=-1	loop		set r=aC()		exitwhen r!=-1 and iC(r)	endloop	set Je[GetPlayerId(p)+1]=r	set un=g_Heroes[r]	loop		exitwhen In>6		set b=IssueImmediateOrderById(g_taverns[In],un)		if b then			set ut=GroupPickRandomUnit(cN(un))			call oC(ut,p)			return		endif		set In=In+1	endloop	set p=null	set ut=nullendfunctionfunction NC takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer Gb=GetHandleId(t)local integer bC=LoadInteger(wx,1,Gb)local integer BC=LoadInteger(wx,2,Gb)if bC<=BC thenif GetPlayerSlotState(qe[bC])==PLAYER_SLOT_STATE_PLAYING thencall AC(qe[bC])endifelsecall EnableTrigger(CommandLineRepick)call DestroyTimer(t)endifset bC=bC+1call SaveInteger(wx,1,Gb,bC)set t=nullendfunctionfunction cC takes nothing returns nothinglocal timer t=CreateTimer()local integer Gb=GetHandleId(t)local integer zb=fvcall SaveInteger(wx,1,Gb,1)call SaveInteger(wx,2,Gb,zb)call TimerStart(t,1.25,true,function NC)set t=nullendfunctionfunction CC takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer Gb=GetHandleId(t)local integer In=LoadInteger(wx,1,Gb)local integer xc=LoadInteger(wx,2,Gb)call DestroyTextTag(Jo)if In>=xc thenset Jo=CreateTextTagLocBJ("0",GetRectCenter(Ui),0,20.,'d',.0,.0,10.)call DestroyTimer(t)elseset Jo=CreateTextTagLocBJ(I2S(20-In),GetRectCenter(Ui),0,20.,'d',.0,.0,10.)call SaveInteger(wx,1,Gb,In+1)endifset t=nullendfunction//function dC takes nothing returns nothing//local timer t=GetExpiredTimer()//local integer Gb=GetHandleId(t)//local integer In=LoadInteger(wx,1,Gb)//local integer xc=LoadInteger(wx,2,Gb)//local integer DC=LoadInteger(wx,3,Gb)//if In>=xc then//if gv[DC]==null then//call SetPlayerTechMaxAllowed(qe[DC],'HERO',0)//call AC(qe[DC])//endif//call DestroyTimer(t)//else//call SaveInteger(wx,1,Gb,In+1)//endif//set t=null//endfunction//function fC takes player p returns nothing//local integer DC=me[GetPlayerId(p)+1]//local timer t//local integer Gb//local integer In=0//local sound FC=CreateSound("Sound\\Interface\\Rescue.wav",false,false,true,$319C,$319C,"")//call SetSoundPosition(FC,GetLocationX(GetRectCenter(Ui)),GetLocationY(GetRectCenter(Ui)),'d')//loop//exitwhen In>7//call DisplayTimedTextToPlayer(Player(In),0,0,$F,"У игрока |Cffff0000"+GetPlayerName(p)+"|r есть |Cffff000020|r секунд, чтобы выбрать героя.")//set In=In+1//endloop//call DisplayTimedTextToPlayer(p,0,0,$F,"|Cffff0000Ваша очередь выбирать героя!|r")//if GetLocalPlayer()==p then//call StartSound(FC)//endif//call KillSoundWhenDone(FC)//call SetPlayerTechMaxAllowed(p,'HERO',1)//set t=CreateTimer()//set Gb=GetHandleId(t)//call SaveInteger(wx,1,Gb,0)//call SaveInteger(wx,2,Gb,20)//call SaveInteger(wx,3,Gb,DC)//call TimerStart(t,1,true,function dC)//set t=null//set FC=null//endfunction//function gC takes nothing returns nothing//local timer t=GetExpiredTimer()//local integer Gb=GetHandleId(t)//local timer GC=CreateTimer()//local integer hC=GetHandleId(GC)//local player p1=LoadPlayerHandle(wx,1,Gb)//local player p2=LoadPlayerHandle(wx,2,Gb)//call SaveInteger(wx,1,hC,0)//call SaveInteger(wx,2,hC,20)//call TimerStart(GC,1,true,function CC)//if p1!=null then//call fC(p1)//endif//if p2!=null then//call fC(p2)//endif//call DestroyTimer(t)//set p1=null//set p2=null//set t=null//set GC=null//endfunction//function HC takes nothing returns nothing//local timer t=GetExpiredTimer()//local integer In=1//local integer zb=fv//local location T//call DestroyTextTag(Jo)//loop//exitwhen In>zb//call ShowUnit(gv[In],true)//call SelectUnitForPlayerSingle(gv[In],qe[In])//set T=GetUnitLoc(gv[In])//call PanCameraToTimedLocForPlayer(qe[In],T,0)//call RemoveLocation(T)//set In=In+1//endloop//call TriggerExecute(Dn)//call TriggerExecute(AR)//call DestroyTimer(t)//set t=null//set T=null//endfunction//function jC takes nothing returns nothing//local timer GC//local integer hC//local timer t=GetExpiredTimer()//local integer zb=fv//local integer k//local real r//local integer In//local player array p1//local player array p2//local timer tn=CreateTimer()//local integer JC=GetHandleId(tn)//call SaveInteger(wx,1,JC,0)//call SaveInteger(wx,2,JC,20)//set k=zb/2//if k==2 then//set r=66+1//else//if k==3 then//set r=88+1//else//set r='n'+1//endif//endif//set In=1//loop//exitwhen In>k//set p1[In]=qe[In]//set p2[In]=qe[In+k]//set In=In+1//endloop//set GC=CreateTimer()//call TimerStart(GC,r,false,function HC)//set GC=null//call fC(p1[1])//call TimerStart(tn,1,true,function CC)//set GC=CreateTimer()//set hC=GetHandleId(GC)//call SavePlayerHandle(wx,1,hC,p2[1])//call SavePlayerHandle(wx,2,hC,p2[2])//call TimerStart(GC,22,false,function gC)//set GC=null//set GC=CreateTimer()//set hC=GetHandleId(GC)//if k==2 then//call SavePlayerHandle(wx,1,hC,p1[2])//call TimerStart(GC,44,false,function gC)//else//if k==3 then//call SavePlayerHandle(wx,1,hC,p1[2])//call SavePlayerHandle(wx,2,hC,p1[3])//call TimerStart(GC,44,false,function gC)//set GC=null//set GC=CreateTimer()//set hC=GetHandleId(GC)//call SavePlayerHandle(wx,1,hC,p2[3])//call TimerStart(GC,66,false,function gC)//else//call SavePlayerHandle(wx,1,hC,p1[2])//call SavePlayerHandle(wx,2,hC,p1[3])//call TimerStart(GC,44,false,function gC)//set GC=null//set GC=CreateTimer()//set hC=GetHandleId(GC)//call SavePlayerHandle(wx,1,hC,p2[3])//call SavePlayerHandle(wx,2,hC,p2[4])//call TimerStart(GC,66,false,function gC)//set GC=null//set GC=CreateTimer()//set hC=GetHandleId(GC)//call SavePlayerHandle(wx,1,hC,p1[4])//call TimerStart(GC,88,false,function gC)//endif//endif//call DestroyTimer(t)//set t=null//set GC=null//set tn=null//set p1[1]=null//set p1[2]=null//set p1[3]=null//set p1[4]=null//set p2[1]=null//set p2[2]=null//set p2[3]=null//set p2[4]=null//endfunction//function kC takes nothing returns nothing//	local timer t=GetExpiredTimer()//	local timer tt=CreateTimer()//	local string s//	local integer In=0//	local integer zb=fv//	if zb==4 then//		set s="1-2-1"//	else//		if zb==6 then//			set s="1-2-2-1"//		else//			set s="1-2-2-2-1"//		endif//	endif//	loop//		exitwhen In>7//		call DisplayTextToPlayer(Player(In),0,0,"|cffffcc00Выбор героев будет проходить по схеме "+s+"|R")//		set In=In+1//	endloop//	call DestroyTimer(t)//	call TimerStart(tt,3,false,function jC)//	set t=null//	set tt=null//	set s=null//endfunctionfunction lC takes nothing returns nothinglocal group g=CreateGroup()local unit flocal integer In=1local integer zb=fvlocal unit array mlocal player array plocal integer array llocal integer array rClocal rect array rlocal rect array r2local player pplocal integer LC=0set r[1]=Urset r[2]=zrset r[3]=Zrset r2[1]=trset r2[2]=Trset r2[3]=urloopexitwhen In>8 or LC>2set pp=qe[xo[In]]if GetPlayerSlotState(pp)!=PLAYER_SLOT_STATE_LEFT and gv[xo[In]]!=null thenset LC=LC+1set l[LC]=xo[In]set m[LC]=gv[l[LC]]set p[LC]=GetOwningPlayer(m[LC])set rC[LC]=me[GetPlayerId(p[LC])+1]endifset In=In+1endloopset tv=truecall DisableTrigger(OR)call PauseTimer(bj_lastStartedTimer)call DestroyTimerDialog(bj_lastCreatedTimerDialog)set In=0loopexitwhen In>7if GetPlayerSlotState(Player(In))!=PLAYER_SLOT_STATE_LEFT thencall DisplayTextToPlayer(Player(In),0,0,"|cffffcc00ВЫ ПОБЕДИЛИ!!!")call cb(Player(In),iv)endifset In=In+1endloopcall CinematicFadeBJ(1,2.,"ReplaceableTextures\\CameraMasks\\White_mask.blp",0,0,0,0)call oN(2)set g=IN(bj_mapInitialPlayableArea)loopset f=FirstOfGroup(g)exitwhen f==nullif GetOwningPlayer(f)!=Player($B)and IsUnitType(f,UNIT_TYPE_HERO)==false and jb(f)thencall KillUnit(f)call RemoveUnit(f)endifcall GroupRemoveUnit(g,f)endloopcall MultiboardMinimize(Jv,true)call EnableTrigger(PI)set In=1loopexitwhen In>zbcall CameraSetupApplyForPlayer(true,Nn,qe[In],0)call ReviveHeroLoc(gv[In],GetRandomLocInRect(qr),false)call SetUnitLifePercentBJ(gv[In],'d')call SetUnitManaPercentBJ(gv[In],'d')call CreateFogModifierRectBJ(false,qe[In],FOG_OF_WAR_VISIBLE,bj_mapInitialPlayableArea)call CreateFogModifierRectBJ(true,qe[In],FOG_OF_WAR_VISIBLE,wr)set In=In+1endloopset g=IN(bj_mapInitialPlayableArea)loopset f=FirstOfGroup(g)exitwhen f==nullcall PauseUnit(f,true)call GroupRemoveUnit(g,f)endloopcall DestroyGroup(g)call ShowTextTagForceBJ(true,CreateTextTagLocBJ("П о б е д и т е л ь",GetRectCenter(r[1]),200.,12.,'d','d','d',0),bj_FORCE_ALL_PLAYERS)set In=1loopexitwhen In>LCcall SetUnitPositionLocFacingBJ(m[In],GetRectCenter(r2[In]),270.)call UnitRemoveBuffsBJ(2,m[In])if l[In]!=0 thencall ShowTextTagForceBJ(true,CreateTextTagLocBJ(Ke[rC[In]],GetRectCenter(r[In]),170.,11.5,100.,50.,50.,0),bj_FORCE_ALL_PLAYERS)call ShowTextTagForceBJ(true,CreateTextTagLocBJ(("Рейтинг "+I2S(kv[l[In]])),GetRectCenter(r[In]),140.,11.,80.,'d',40.,0),bj_FORCE_ALL_PLAYERS)endifset In=In+1endloopcall CinematicFadeBJ(0,2.,"ReplaceableTextures\\CameraMasks\\White_mask.blp",0,0,0,0)set In=1set g=nullset f=nullset pp=nullloopexitwhen In>3set r[In]=nullset r2[In]=nullset m[In]=nullset p[In]=nullset In=In+1endloopendfunctionfunction mC takes nothing returns nothinglocal group g=CreateGroup()local unit fset g=ON(Pr,null)loopset f=FirstOfGroup(g)exitwhen f==nullif(jb(f)==false)or(IsUnitType(f,UNIT_TYPE_HERO)and GetUnitUserData(f)!=$B and GetUnitUserData(f)!=$C)thenif IsUnitPaused(f)==false thencall PauseUnit(f,true)endifelseif f!=Bx thencall KillUnit(f)call RemoveUnit(f)endifendifcall GroupRemoveUnit(g,f)endloopcall DestroyGroup(g)set g=nullset f=nullendfunctionfunction MC takes nothing returns nothinglocal group g=CreateGroup()local unit fset g=ON(Hr,null)loopset f=FirstOfGroup(g)exitwhen f==nullif(GetUnitUserData(f)==$B or GetUnitUserData(f)==$C)or(jb(f)and GetUnitTypeId(f)!='n002' and IsUnitType(f,UNIT_TYPE_HERO)==false and GetOwningPlayer(f)!=Player($F)and GetOwningPlayer(f)!=Player(8)and GetOwningPlayer(f)!=Player($A))thencall KillUnit(f)call RemoveUnit(f)endifcall GroupRemoveUnit(g,f)endloopset g=nullset f=nullendfunctionfunction pC takes nothing returns nothinglocal timer t=GetExpiredTimer()call mC()call MC()call DestroyTimer(t)set t=nullendfunctionfunction PC takes nothing returns nothinglocal timer t=CreateTimer()call Vc()call Ec(Eo)call mC()call MC()call TimerStart(t,1.3,false,function pC)set t=nullendfunctionfunction qC takes nothing returns nothinglocal item it=GetEnumItem()if GetItemUserData(it)==0 thencall RemoveItem(it)endifset it=nullendfunctionfunction QC takes nothing returns booleanreturn((IsUnitType(GetFilterUnit(),UNIT_TYPE_HERO)==false and jb(GetFilterUnit()))!=null)!=nullendfunctionfunction sC takes nothing returns nothingcall KillUnit(GetEnumUnit())call RemoveUnit(GetEnumUnit())endfunctionfunction SC takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer Gb=GetHandleId(t)local integer In=1local unit u1=LoadUnitHandle(wx,1,Gb)local unit u2=LoadUnitHandle(wx,2,Gb)loopexitwhen In>8if GetWidgetLife(gv[In])>.405 and gv[In]!=u1 and gv[In]!=u2 and IsUnitHidden(gv[In])==false thencall ShowUnit(gv[In],false)endifset In=In+1endloopcall DestroyTimer(t)set t=nullset u1=nullset u2=nullendfunctionfunction tC takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer In=0loopexitwhen In>7call DisplayTextToPlayer(Player(In),0,0,"4...")set In=In+1endloopcall DestroyTimer(t)set t=nullendfunctionfunction TC takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer In=0loopexitwhen In>7call DisplayTextToPlayer(Player(In),0,0,"3...")set In=In+1endloopcall DestroyTimer(t)set t=nullendfunctionfunction uC takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer In=0loopexitwhen In>7call DisplayTextToPlayer(Player(In),0,0,"2...")set In=In+1endloopcall DestroyTimer(t)set t=nullendfunctionfunction UC takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer In=0loopexitwhen In>7call DisplayTextToPlayer(Player(In),0,0,"1...")set In=In+1endloopcall DestroyTimer(t)set t=nullendfunctionfunction wC takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer Gb=GetHandleId(t)local unit u1=LoadUnitHandle(wx,1,Gb)local unit u2=LoadUnitHandle(wx,2,Gb)local group g=CreateGroup()//local integer ilocal item itlocal item yclocal integer WClocal integer yCcall SaveBoolean(wx,1,StringHash("pr"),false)call GroupEnumUnitsInRect(g,Pr,Condition(function QC))call ForGroup(g,function sC)call DestroyGroup(g)call PauseUnit(u1,false)call PauseUnit(u2,false)call SetUnitInvulnerable(u1,false)call SetUnitInvulnerable(u2,false)call UnitRemoveBuffs(u1,true,true)call UnitRemoveBuffs(u2,true,true)call hb(u1)call hb(u2)set WC=GetUnitUserData(u1)set yC=GetUnitUserData(u2)call PauseUnit(Wo[WC],false)call PauseUnit(Wo[yC],false)if((To[WC]==false and GetWidgetLife(u1)<=.405)or(To[yC]==false and GetWidgetLife(u2)<=.405))thencall TriggerExecute(rR)elsecall EnableTrigger(rR)call Mc()endifcall DestroyTimer(t)set t=nullset g=nullset u1=nullset u2=nullset it=nullset yc=nullendfunctionfunction YC takes unit u1,unit u2 returns nothinglocal player p1=GetOwningPlayer(u1)local player p2=GetOwningPlayer(u2)local group g=CreateGroup()local integer LC=oolocal integer zb=fvlocal timer tlocal integer Gblocal location T1local location T2local integer Inlocal integer zClocal real xlocal real ylocal integer DCcall PauseShops(true)call UnitRemoveBuffs(u1,true,true)call UnitRemoveBuffs(u2,true,true)call EnumItemsInRect(Pr,null,function qC)set In=0loopexitwhen In>7call DisplayTextToPlayer(Player(In),0,0,"|cff707070"+GetPlayerName(p1)+"   п р о т и в   "+GetPlayerName(p2)+"|R")set In=In+1endloopcall SetUnitInvulnerable(u1,true)call SetUnitInvulnerable(u2,true)set T1=Location(GetRectCenterX(Qr),GetRectCenterY(Qr))set T2=Location(GetRectCenterX(sr),GetRectCenterY(sr))call ReviveHeroLoc(u1,T1,false)call ReviveHeroLoc(u2,T2,false)call SetUnitPositionLoc(u1,T1)call SetUnitPositionLoc(u2,T2)call SetUnitFacing(u1,90)call SetUnitFacing(u2,270)call RemoveLocation(T1)call RemoveLocation(T2)call UnitResetCooldown(u1)call UnitResetCooldown(u2)call SetUnitState(u1,UNIT_STATE_LIFE,GetUnitState(u1,UNIT_STATE_MAX_LIFE))call SetUnitState(u2,UNIT_STATE_LIFE,GetUnitState(u2,UNIT_STATE_MAX_LIFE))call SetUnitState(u1,UNIT_STATE_MANA,GetUnitState(u1,UNIT_STATE_MAX_MANA))call SetUnitState(u2,UNIT_STATE_MANA,GetUnitState(u2,UNIT_STATE_MAX_MANA))call SuspendHeroXP(u1,true)call SuspendHeroXP(u2,true)set zC=1loopexitwhen zC>zbif Wo[zC]!=null thencall SetUnitPosition(Wo[zC],GetUnitX(So[zC]),GetUnitY(So[zC]))call PauseUnit(Wo[zC],true)endifset zC=zC+1endloopset DC=GetUnitUserData(u1)set x=GetUnitX(u1)+$B4set y=GetUnitY(u1)call SetUnitPosition(Wo[DC],x,y)call SetUnitFacing(Wo[DC],90)set DC=GetUnitUserData(u2)set x=GetUnitX(u2)-$B4set y=GetUnitY(u2)call SetUnitPosition(Wo[DC],x,y)call SetUnitFacing(Wo[DC],270)call PC()if Bo==false thenset In=1loopexitwhen In>8if GetWidgetLife(gv[In])>.405 and gv[In]!=u1 and gv[In]!=u2 and IsUnitHidden(gv[In])==false thencall ShowUnit(gv[In],false)endifset In=In+1endloopset t=CreateTimer()set Gb=GetHandleId(t)call SaveUnitHandle(wx,1,Gb,u1)call SaveUnitHandle(wx,2,Gb,u2)call TimerStart(t,1.3,false,function SC)set t=nullendifcall SetPlayerAlliance(p1,p2,ALLIANCE_PASSIVE,false)call SetPlayerAlliance(p1,p2,ALLIANCE_HELP_REQUEST,false)call SetPlayerAlliance(p1,p2,ALLIANCE_HELP_RESPONSE,false)call SetPlayerAlliance(p1,p2,ALLIANCE_SHARED_XP,false)call SetPlayerAlliance(p1,p2,ALLIANCE_SHARED_SPELLS,false)call SetPlayerAlliance(p1,p2,ALLIANCE_SHARED_VISION,false)call SetPlayerAlliance(p1,p2,ALLIANCE_SHARED_CONTROL,false)call SetPlayerAlliance(p1,p2,ALLIANCE_SHARED_ADVANCED_CONTROL,false)call SetPlayerAlliance(p2,p1,ALLIANCE_PASSIVE,false)call SetPlayerAlliance(p2,p1,ALLIANCE_HELP_REQUEST,false)call SetPlayerAlliance(p2,p1,ALLIANCE_HELP_RESPONSE,false)call SetPlayerAlliance(p2,p1,ALLIANCE_SHARED_XP,false)call SetPlayerAlliance(p2,p1,ALLIANCE_SHARED_SPELLS,false)call SetPlayerAlliance(p2,p1,ALLIANCE_SHARED_VISION,false)call SetPlayerAlliance(p2,p1,ALLIANCE_SHARED_CONTROL,false)call SetPlayerAlliance(p2,p1,ALLIANCE_SHARED_ADVANCED_CONTROL,false)if GetLocalPlayer()==p1 thencall ClearSelection()call SelectUnit(u1,true)endifif GetLocalPlayer()==p2 thencall ClearSelection()call SelectUnit(u2,true)endifset In=0loopexitwhen In>7call DisplayTextToPlayer(Player(In),0,0,"|cffffcc00Победитель получит "+I2S(300-50*LC)+" золотых монет и "+I2S($A-LC)+" дерева.")set In=In+1endloopcall RemoveSharMoln()call SaveBoolean(wx,1,StringHash("pr"),true)set t=CreateTimer()call TimerStart(t,2,false,function tC)set t=nullset t=CreateTimer()call TimerStart(t,3,false,function TC)set t=nullset t=CreateTimer()call TimerStart(t,4,false,function uC)set t=nullset t=CreateTimer()call TimerStart(t,5,false,function UC)set t=nullset t=CreateTimer()set Gb=GetHandleId(t)call SaveUnitHandle(wx,1,Gb,u1)call SaveUnitHandle(wx,2,Gb,u2)call TimerStart(t,6,false,function wC)set t=nullset T1=nullset T2=nullset p1=nullset p2=nullset g=nullendfunctionfunction ZC takes group g returns groupset bj_groupAddGroupDest=CreateGroup()call ForGroup(g,function GroupAddGroupEnum)return bj_groupAddGroupDestendfunctionfunction vd takes unit dc,real re returns nothinglocal real r=relocal unit u=dclocal unit uM=hxcall ModifyHeroStat(0,u,2,R2I((I2R(GetHeroStatBJ(0,uM,false))*r)))call ModifyHeroStat(1,u,2,R2I((I2R(GetHeroStatBJ(1,uM,false))*r)))call ModifyHeroStat(2,u,2,R2I((I2R(GetHeroStatBJ(2,uM,false))*r)))set u=nullset uM=nullendfunctionfunction xd takes unit dc,integer od returns nothinglocal unit u=dclocal unit ab=Axlocal player p=GetOwningPlayer(ab)local integer Hb=odlocal unit fset f=CreateUnitAtLoc(p,'h00P',GetUnitLoc(u),GetUnitFacing(u))call UnitAddAbility(f,'A0CN')call SetUnitAbilityLevel(f,'A0CN',Hb)call IssueTargetOrderById(f,$D006B,u)call oN(1)call KillUnit(f)call RemoveUnit(f)set ab=nullset p=nullset f=nullset u=nullendfunctionfunction rd takes nothing returns nothinglocal integer ad=1local unit flocal real xlocal real ylocal location EClocal player plocal rect nd=qrloopexitwhen ad>8set f=gv[ad]set x=GetUnitX(So[ad])set y=GetUnitY(So[ad])call SetUnitPosition(Wo[ad],x,y)call SetUnitPositionLoc(f,Location(GetRandomReal(GetRectMinX(nd),GetRectMaxX(nd)),GetRandomReal(GetRectMinY(nd),GetRectMaxY(nd))))set EC=GetUnitLoc(f)if IsUnitInGroup(f,rr)and f!=null thencall DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\Resurrect\\ResurrectCaster.mdl",f,"origin"))call ReviveHeroLoc(f,EC,false)set To[ad]=truecall GroupRemoveUnit(rr,f)endifset p=GetOwningPlayer(f)if(GetLocalPlayer()==p)thencall PanCameraToTimed(GetLocationX(EC),GetLocationY(EC),0)call ClearSelection()call SelectUnit(f,true)endifcall UnitRemoveBuffs(f,false,true)call RemoveLocation(EC)set ad=ad+1endloopset nd=nullset p=nullset f=nullset EC=nullendfunctionfunction Vd takes nothing returns nothingcall DestroyEffect(AddSpecialEffectLocBJ(GetUnitLoc(Nx),"Abilities\\Spells\\Undead\\DeathCoil\\DeathCoilSpecialArt.mdl"))call ShowUnit(Nx,false)call SetUnitInvulnerable(Nx,true)call SetUnitPositionLoc(Nx,GetRectCenter(ci))call UnitRemoveBuffsExBJ(2,2,Nx,true,false)call PauseUnit(Nx,true)endfunctionfunction Ed takes integer id returns nothinglocal location L=Location(GetRandomReal(GetRectMinX(Ci),GetRectMaxX(Ci)),GetRandomReal(GetRectMinY(Ci),GetRectMaxY(Ci)))local location Xd=Location(GetRectCenterX(Ci),GetRectCenterY(Ci))local unit f=CreateUnitAtLoc(Player($B),id,L,bj_RADTODEG*Atan2(GetLocationY(Xd)-GetLocationY(L),GetLocationX(Xd)-GetLocationX(L)))call RemoveLocation(L)call RemoveLocation(Xd)call SetUnitUserData(f,1)call GroupAddUnit(zo,f)call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\AnimateDead\\AnimateDeadTarget.mdl",f,"origin"))set f=nullset L=nullset Xd=nullendfunctionfunction Od takes nothing returns nothinglocal unit u=GetEnumUnit()local player p=GetOwningPlayer(u)if((RectContainsUnit(jr,u)==false)and(GetWidgetLife(u)>.405)and(GetUnitTypeId(u)!='n002')and(GetUnitTypeId(u)!='h00P'))thencall SetUnitPositionLoc(u,GetRandomLocInRect(vi))call AddSpecialEffectLocBJ(GetUnitLoc(u),"Abilities\\Spells\\NightElf\\Blink\\BlinkTarget.mdl")if((IsUnitType(u,UNIT_TYPE_HERO))and(GetUnitTypeId(u)!='E00E'))thencall PanCameraToTimedLocForPlayer(p,GetUnitLoc(u),0)endifcall SelectUnitAddForPlayer(u,p)endifset u=nullset p=nullendfunctionfunction Rd takes nothing returns nothinglocal integer Inlocal group gset In=1loopexitwhen In>fvset g=CreateGroup()set g=fN(qe[In])if(RectContainsUnit(jr,gv[In])==false)thencall ClearSelectionForPlayer(qe[In])endifcall SelectUnitForPlayerSingle(gv[In],qe[In])call ForGroup(g,function Od)call DestroyGroup(g)set In=In+1endloopset g=nullendfunctionfunction Ad takes nothing returns nothingif LoadInteger(wx,1,StringHash("leave"))==GetItemUserData(GetEnumItem())thencall UnitAddItem(iA,GetEnumItem())call UnitDropItemTarget(iA,UnitItemInSlot(iA,0),g_shops[1])endifendfunctionfunction Nd takes player p returns nothing	local string bd=GetPlayerName(p)	local integer rC=me[GetPlayerId(p)+1]	local integer ID=GetHandleId(p)	local unit Bd=gv[rC]	local integer Cc	local integer cd	local integer In	local integer re	local integer zb	local group g	local item t	local unit Cd	local boolean b=LoadBoolean(wx,1,ID)	if tv==false then		call UnitRemoveAbility(Bd,'A01U')		call SaveInteger(wx,1,StringHash("leave"),rC)		set Cd=So[rC]		set qv=qv-1		set re=qv		if b then			call DisplayTextToPlayer(GetLocalPlayer(), 0, 0, "|cff32cd32УВЕДОМЛЕНИЕ:|r " + bd + " выгнан из игры.|R")			call CustomDefeatBJ(p,"Вас выгнали!")			call SetPlayerName(p,"|Cff808080"+bd+" [выгнан]|R")			set Ke[rC]="|Cff808080"+Ke[rC]+"[выгнан]|R"		else			call QuestMessageBJ( GetPlayersAll(), bj_QUESTMESSAGE_WARNING, "|cfffefe22ВНИМАНИЕ:|r " + bd + " покинул игру!" )			call SetPlayerName(p,"|Cff808080"+bd+" [вышел]|R")			set Ke[rC]="|Cff808080"+Ke[rC]+"[вышел]|R"		endif		set In=0		loop			exitwhen In > 7			if Player(In) != p then				call SetPlayerAllianceStateBJ( Player(In), p, bj_ALLIANCE_UNALLIED )    			call SetPlayerAllianceStateBJ( p, Player(In), bj_ALLIANCE_UNALLIED )    		endif    		set In = In + 1    	endloop		if Sx then			set In=0			set iA=CreateUnit(p,'h011',GetWidgetX(g_shops[1]),GetWidgetY(g_shops[1]),0)			call UnitApplyTimedLife(iA,'BTLF',1)			call DisableTrigger(jI)			call DisableTrigger(HI)			call PauseUnit(g_shops[1],false)			loop				exitwhen In==6				call UnitAddItem(iA,UnitItemInSlot(Bd,In))				call UnitDropItemTarget(iA,UnitItemInSlot(iA,0),g_shops[1])				call UnitAddItem(iA,UnitItemInSlot(Cd,In))				call UnitDropItemTarget(iA,UnitItemInSlot(iA,0),g_shops[1])				set In=In+1			endloop			call EnumItemsInRect(bj_mapInitialPlayableArea,null,function Ad)			call EnableTrigger(jI)			call EnableTrigger(HI)			set Cc=GetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD)			set cd=GetPlayerState(p,PLAYER_STATE_RESOURCE_LUMBER)			set In=1			set zb=fv			if xA==false then				call PauseUnit(g_shops[1],true)			endif			loop				exitwhen In>zb				if GetPlayerSlotState(qe[In])==PLAYER_SLOT_STATE_PLAYING then					call AdjustPlayerStateBJ(Cc/re,qe[In],PLAYER_STATE_RESOURCE_GOLD)					call AdjustPlayerStateBJ(cd/re,qe[In],PLAYER_STATE_RESOURCE_LUMBER)				endif				set In=In+1			endloop		endif//		if g_flag_b then//			if co==false then//				set co=true//				call DisplayTextToPlayer(GetLocalPlayer(),0,0,"|Cffff0000Напоминание: вы можете поменять командами игроков при помощи команды \"-св\".|R")//			endif//		endif		call KillUnit(Bd)		call RemoveUnit(Bd)		call GroupRemoveUnit(rr,Bd)		call DestroyGroup(g)	else		call SetPlayerName(p, "|Cfffed312" + bd + "[Вышел]|R")		set Ke[rC] = "|Cfffed312"+Ke[rC]+"[Вышел]|R"	endif//	if g_flag_b or g_flag_tk then//		set ge[GetPlayerId(p)+1]=true//		call pc()//	endif	if Sx then		call TriggerExecute(RR)	endif	set g=null	set bd=null	set t=null	set Cd=null	set Bd=nullendfunctionfunction Dd takes integer fd returns reallocal real Fdlocal integer SB=(2)local real rsif(fd==1)thenset Fd=600.elseif(fd==2)thenset Fd=750.elseif(fd==3)thenset Fd=900.endifif(SB==1)thenset rs=500elseif(SB==2)thenset rs=$3E8elseif(SB==3)thenset rs=$7D0endifreturn(Fd/rs)endfunctionfunction gd takes integer fd returns reallocal real Gdif(fd==1)thenset Gd=90.elseif(fd==2)thenset Gd=180.elseif(fd==3)thenset Gd=270.endifreturn Gdendfunctionfunction hd takes nothing returns nothinglocal boolean Hd=(false)local unit du=GetTriggerUnit()local player jd=GetOwningPlayer(du)local player Jd=GetOwningPlayer(Ix)local effect elocal integer kd=('A0AE')local integer fd=GetUnitAbilityLevelSwapped(kd,Ax)local real Gd=gd(fd)local boolean Kd=(false)if(Hd)thenif(Jd!=jd)thencall UnitDamageTarget(Ix,du,Gd,true,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_NORMAL,WEAPON_TYPE_WHOKNOWS)set e=AddSpecialEffectTarget("Abilities\\Spells\\Other\\Incinerate\\FireLordDeathExplode.mdl",du,"origin")call TriggerSleepAction(.2)call DestroyEffect(e)endifelseif(Hd==false)thenif(IsPlayerEnemy(jd,Jd))thencall UnitDamageTarget(Ix,du,Gd,true,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_NORMAL,WEAPON_TYPE_WHOKNOWS)set e=AddSpecialEffectTarget("Abilities\\Spells\\Other\\Incinerate\\FireLordDeathExplode.mdl",du,"origin")call TriggerSleepAction(.2)call DestroyEffect(e)endifendifif GetWidgetLife(du)>.405 thencall xd(du,fd)endifif(Kd)thencall DisableTrigger(RE)call KillUnit(Ix)call TriggerSleepAction(.01)call RemoveUnit(Ix)endifset Jd=nullset jd=nullset du=nullendfunctionfunction MakeShops takes nothing returns nothing	set g_shops[1]=CreateUnit(Player(15),'n004',1232.0,-2080.0,270)	set g_shops[2]=CreateUnit(Player(15),'n00C',1232.0,-1808.0,270)	set g_shops[3]=CreateUnit(Player(15),'n005',976.0,-1808.0,270)	set g_shops[4]=CreateUnit(Player(15),'n006',720.0,-1808.0,270)	set g_shops[5]=CreateUnit(Player(15),'n01J',464.0,-1808.0,270)	set g_shops[6]=CreateUnit(Player(15),'n02F',208.0,-1808.0,270)	set g_shops[7]=CreateUnit(Player(15),'n014',-464.0,-2464.0,270)	set g_shops[8]=CreateUnit(Player(15),'n001',-464.0,-2688.0,270)	set g_shops[9]=CreateUnit(Player(15),'n00A',464.0,-2496.0,270)	set xA=true	call SetUnitAnimation(g_shops[1],"work")	call SetUnitAnimation(g_shops[2],"work")	call SetUnitAnimation(g_shops[3],"work")	call SetUnitAnimation(g_shops[4],"work")	call SetUnitAnimation(g_shops[5],"work")	call SetUnitAnimation(g_shops[6],"work")	call SetUnitAnimation(g_shops[7],"work")	call SetUnitAnimation(g_shops[8],"work")	call SetUnitAnimation(g_shops[9],"work")endfunctionfunction Ld takes nothing returns nothing	local integer In=1	local integer zb=fv	loop		exitwhen In>zb		call SetPlayerHandicapXP(qe[In],0)		set In=In+1	endloopendfunctionfunction md takes nothing returns nothing	local integer In=1	local integer LC=0	local real array T //was a local	call SetFloatGameState(GAME_STATE_TIME_OF_DAY,12.0)	call SetTimeOfDayScale(0.0)	call SetPlayerFlagBJ(PLAYER_STATE_GIVES_BOUNTY,true,Player(11))	call SetPlayerMaxHeroesAllowed(8,Player($F))	set T[1]=960.0 //GetRectCenter(cr)	set T[2]=768.0 //GetRectCenter(Cr)	set T[3]=576.0 //GetRectCenter(dr)	set T[4]=384.0 //GetRectCenter(Dr)	set T[5]=192.0 //GetRectCenter(fr)	set T[6]=0.0 //GetRectCenter(Fr)	set T[7]=-192.0 //GetRectCenter(Gr)	set T[8]=-384.0 //GetRectCenter(hr)	loop		exitwhen In>8		if GetPlayerSlotState(Player(-1+(In)))==PLAYER_SLOT_STATE_PLAYING and GetPlayerController(Player(-1+(In)))==MAP_CONTROL_USER then			set LC=LC+1			set qe[LC]=Player(-1+(In))			set Fv[LC]=(1+GetPlayerId(Player(-1+(In))))			set me[(1+GetPlayerId(Player(-1+(In))))]=LC			set Ke[LC]=GetPlayerName(Player(-1+(In)))			set So[LC]=CreateUnit(Player(In-1),'n002',T[LC],-3072.0,270)			call SetUnitUserData(So[LC],LC)			call CameraSetupApplyForPlayer(true,bn,Player(-1+(In)),0)			call CreateFogModifierRectBJ(true,Player(-1+(In)),FOG_OF_WAR_VISIBLE,Wr)			call CreateFogModifierRectBJ(true,Player(-1+(In)),FOG_OF_WAR_VISIBLE,yr)			call CreateFogModifierRectBJ(true,Player(-1+(In)),FOG_OF_WAR_VISIBLE,Pr)			call SetPlayerStateBJ(Player(-1+(In)),PLAYER_STATE_RESOURCE_GOLD,50)			call SetPlayerMaxHeroesAllowed(1,Player(-1+(In)))			call ClearSelectionForPlayer(Player(-1+(In)))			call SelectUnitForPlayerSingle(g_taverns[1],Player(-1+(In)))		endif		set In=In+1	endloop	set fv=LC	set qv=LC	if LC==1 then		call EnableTrigger(trig_GameModeTest)		call DisableTrigger(HR)		call DisableTrigger(lI)	endif	set In=1	call Ld()endfunctionfunction Md takes integer ID,boolean Pd returns integer	local integer zb=$A0	local integer In=1	local integer array qd	local integer array Qd	set qd[1]='I02F'	set qd[2]='I00D'	set qd[3]='I00G'	set qd[4]='I02O'	set qd[5]='I012'	set qd[6]='I00Q'	set qd[7]='I01S'	set qd[8]='I02B'	set qd[9]='I00J'	set qd[10]='I016'	set qd[11]='I027'	set qd[12]='I01Q'	set qd[13]='I003'	set qd[14]='I01H'	set qd[15]='I02M'	set qd[16]='I02D'	set qd[17]='I00M'	set qd[18]='I00A'	set qd[19]='I006'	set qd[20]='I01T'	set qd[21]='I01V'	set qd[22]='I00X'	set qd[23]='I00U'	set qd[24]='I02K'	set qd[25]='I028'	set qd[26]='I014'	set qd[27]='I018'	set qd[28]='I01X'	set qd[29]='I01O'	set qd[30]='I010'	set qd[31]='I01G'	set qd[32]='I03P'	set qd[33]='I03Q'	set qd[34]='I03V'	set qd[35]='I03X'	set qd[36]='I040'	set qd[37]='I044'	set qd[38]='I046'	set qd[40]='I04C'	set qd[41]='I00P'	set qd[42]='I01W'	set qd[43]='I008'	set qd[44]='I019'	set qd[45]='I000'	set qd[46]='I00E'	set qd[47]='I01E'	set qd[48]='I00I'	set qd[49]='I00R'	set qd[50]='I00K'	set qd[51]='I00C'	set qd[52]='I002'	set qd[53]='I00S'	set qd[54]='I01K'	set qd[55]='I024'	set qd[56]='I00Y'	set qd[57]='I007'	set qd[58]='I02A'	set qd[59]='I004'	set qd[60]='I00N'	set qd[61]='I02G'	set qd[62]='I00B'	set qd[63]='I00F'	set qd[64]='I02P'	set qd[65]='I011'	set qd[66]='I00O'	set qd[67]='I01R'	set qd[68]='I02C'	set qd[69]='I00H'	set qd[70]='I015'	set qd[71]='I026'	set qd[72]='I01P'	set qd[73]='I001'	set qd[74]='I01I'	set qd[75]='I02N'	set qd[76]='I02E'	set qd[77]='I03Z'	set qd[78]='I00L'	set qd[79]='I009'	set qd[80]='I005'	set qd[81]='I01B'	set qd[82]='I01U'	set qd[83]='I00W'	set qd[84]='I00T'	set qd[85]='I00V'	set qd[86]='I02L'	set qd[87]='I029'	set qd[88]='I013'	set qd[89]='I017'	set qd[90]='I025'	set qd[91]='I01N'	set qd[92]='I00Z'	set qd[93]='I01F'	set qd[94]='I03N'	set qd[95]='I03S'	set qd[96]='I03T'	set qd[97]='I03Y'	set qd[98]='I042'	set qd[99]='I045'	set qd[100]='I048'	set qd[101]='I049'	set qd[102]='I04D'	set qd[103]='I04F'	set qd[104]='I02H'	set qd[105]='I02I'	set qd[106]='I01Y'	set qd[107]='I021'	set qd[108]='I020'	set qd[109]='I01Z'	set qd[110]='I022'	set qd[111]='I023'	set qd[112]='I01L'	set qd[113]='I03L'	set qd[114]='I03M'	set qd[116]='I01J'	set qd[118]='I01D'	set qd[120]='I06M'	set qd[121]='I06O'	set qd[122]='I06T'	set qd[123]='I06R'	set qd[124]='I06W'	set qd[126]='I01A'	set qd[127]='I01M'	set qd[128]='I06L'	set qd[129]='I06J'	set qd[130]='I074'	set qd[131]='I072'	set qd[132]='I077'	set qd[133]='I076'	set qd[134]='I07B'	set qd[135]='I07A'	set qd[136]='I07E'	set qd[137]='I07K'	set qd[138]='I07N'	set qd[139]='I07Q'	set qd[140]='I07P'	set qd[141]='I07T'	set qd[142]='I07O'	set qd[143]='I063'	set qd[144]='I04B'	set qd[145]='I081'		set Qd[1]='I02J'	set Qd[2]='I02R'	set Qd[3]='I02S'	set Qd[4]='I02T'	set Qd[5]='I02U'	set Qd[6]='I02V'	set Qd[7]='I02W'	set Qd[8]='I02X'	set Qd[9]='I02Y'	set Qd[10]='I02Z'	set Qd[11]='I030'	set Qd[12]='I031'	set Qd[13]='I032'	set Qd[14]='I033'	set Qd[15]='I034'	set Qd[16]='I035'	set Qd[17]='I036'	set Qd[18]='I037'	set Qd[19]='I038'	set Qd[20]='I039'	set Qd[21]='I03A'	set Qd[22]='I03B'	set Qd[23]='I03C'	set Qd[24]='I03D'	set Qd[25]='I03E'	set Qd[26]='I03F'	set Qd[27]='I03G'	set Qd[28]='I03H'	set Qd[29]='I03I'	set Qd[30]='I02Q'	set Qd[31]='I03J'	set Qd[32]='I03O'	set Qd[33]='I03R'	set Qd[34]='I03U'	set Qd[35]='I03W'	set Qd[36]='I041'	set Qd[37]='I043'	set Qd[38]='I047'	set Qd[40]='I04E'	set Qd[41]='I03K'	set Qd[42]='I04G'	set Qd[43]='I04H'	set Qd[44]='I04I'	set Qd[45]='I04J'	set Qd[46]='I04K'	set Qd[47]='I04L'	set Qd[48]='I04M'	set Qd[49]='I04N'	set Qd[50]='I04O'	set Qd[51]='I04P'	set Qd[52]='I04Q'	set Qd[53]='I04R'	set Qd[54]='I04S'	set Qd[55]='I04T'	set Qd[56]='I04U'	set Qd[57]='I04V'	set Qd[58]='I04W'	set Qd[59]='I04X'	set Qd[60]='I04Y'	set Qd[61]='I04Z'	set Qd[62]='I050'	set Qd[63]='I051'	set Qd[64]='I052'	set Qd[65]='I053'	set Qd[66]='I054'	set Qd[67]='I055'	set Qd[68]='I056'	set Qd[69]='I057'	set Qd[70]='I058'	set Qd[71]='I059'	set Qd[72]='I05A'	set Qd[73]='I05B'	set Qd[74]='I05C'	set Qd[75]='I05D'	set Qd[76]='I05E'	set Qd[77]='I05F'	set Qd[78]='I05G'	set Qd[79]='I05H'	set Qd[80]='I05I'	set Qd[81]='I05J'	set Qd[82]='I05K'	set Qd[83]='I05L'	set Qd[84]='I05M'	set Qd[85]='I05N'	set Qd[86]='I05O'	set Qd[87]='I05P'	set Qd[88]='I05Q'	set Qd[89]='I05R'	set Qd[90]='I05S'	set Qd[91]='I05T'	set Qd[92]='I05U'	set Qd[93]='I05V'	set Qd[94]='I05W'	set Qd[95]='I05X'	set Qd[96]='I05Y'	set Qd[97]='I05Z'	set Qd[98]='I060'	set Qd[99]='I061'	set Qd[100]='I062'	set Qd[102]='I064'	set Qd[103]='I065'	set Qd[104]='I066'	set Qd[105]='I067'	set Qd[106]='I068'	set Qd[107]='I069'	set Qd[108]='I06A'	set Qd[109]='I06B'	set Qd[110]='I06C'	set Qd[111]='I06D'	set Qd[112]='I06E'	set Qd[113]='I06F'	set Qd[114]='I06G'	set Qd[116]='I06I'	set Qd[118]='I06K'	set Qd[120]='I06N'	set Qd[121]='I06P'	set Qd[122]='I06S'	set Qd[123]='I06U'	set Qd[124]='I06Y'	set Qd[126]='I01C'	set Qd[127]='I06H'	set Qd[128]='I071'	set Qd[129]='I070'	set Qd[130]='I073'	set Qd[131]='I075'	set Qd[132]='I079'	set Qd[133]='I078'	set Qd[134]='I07D'	set Qd[135]='I07C'	set Qd[136]='I07F'	set Qd[137]='I07L'	set Qd[138]='I07M'	set Qd[139]='I07S'	set Qd[140]='I07R'	set Qd[141]='I06X'	set Qd[142]='I06V'	set Qd[143]='I04A'	set Qd[144]='I049'	set Qd[145]='I080'		if Pd then		loop			exitwhen In>zb			if ID==qd[In]then				return Qd[In]			endif			set In=In+1		endloop	else		loop			exitwhen In>zb			if ID==Qd[In]then				return qd[In]			endif			set In=In+1		endloop	endif	return 0endfunctionfunction sd takes nothing returns nothing	set g_hero_icons[1]="ReplaceableTextures\\WorldEditUI\\Editor-Random-Unit.blp"	set g_hero_icons[2]="ReplaceableTextures\\CommandButtons\\BTNPriestessOfTheMoon.blp"	set g_hero_icons[3]="ReplaceableTextures\\CommandButtons\\BTNSpiderBlue.blp"	set g_hero_icons[4]="ReplaceableTextures\\CommandButtons\\BTNHeroDemonHunter.blp"	set g_hero_icons[5]="ReplaceableTextures\\CommandButtons\\BTNSpiritWalker.blp"	set g_hero_icons[6]="ReplaceableTextures\\CommandButtons\\BTNSylvanusWindrunner.blp"	set g_hero_icons[7]="ReplaceableTextures\\CommandButtons\\BTNChaosWarlock.blp"	set g_hero_icons[8]="ReplaceableTextures\\CommandButtons\\BTNHeroBloodElfPrince.blp"	set g_hero_icons[9]="ReplaceableTextures\\CommandButtons\\BTNSpellBreaker.blp"	set g_hero_icons[10]="ReplaceableTextures\\CommandButtons\\BTNJunkGolem.blp"	set g_hero_icons[11]="ReplaceableTextures\\CommandButtons\\BTNInfernal.blp"	set g_hero_icons[12]="ReplaceableTextures\\CommandButtons\\BTNHeroTaurenChieftain.blp"	set g_hero_icons[13]="ReplaceableTextures\\CommandButtons\\BTNAbomination.blp"	set g_hero_icons[14]="ReplaceableTextures\\CommandButtons\\BTNShadowHunter.blp"	set g_hero_icons[15]="ReplaceableTextures\\CommandButtons\\BTNVoidWalker.blp"	set g_hero_icons[16]="ReplaceableTextures\\CommandButtons\\BTNHeroDreadLord.blp"	set g_hero_icons[17]="ReplaceableTextures\\CommandButtons\\BTNWarden2.blp"	set g_hero_icons[18]="ReplaceableTextures\\CommandButtons\\BTNHellScream.blp"	set g_hero_icons[19]="ReplaceableTextures\\CommandButtons\\BTNNagaMyrmidonRoyalGuard.blp"	set g_hero_icons[20]="ReplaceableTextures\\CommandButtons\\BTNSeaWitch.blp"	set g_hero_icons[21]="ReplaceableTextures\\CommandButtons\\BTNPitLord.blp"	set g_hero_icons[22]="ReplaceableTextures\\CommandButtons\\BTNArthas.blp"	set g_hero_icons[23]="ReplaceableTextures\\CommandButtons\\BTNPandarenBrewmaster.blp"	set g_hero_icons[24]="ReplaceableTextures\\CommandButtons\\BTNBeastMaster.blp"	set g_hero_icons[25]="ReplaceableTextures\\CommandButtons\\BTNTheCaptain.blp"	set g_hero_icons[26]="ReplaceableTextures\\CommandButtons\\BTNHeroAvatarOfFlame.blp"	set g_hero_icons[27]="ReplaceableTextures\\CommandButtons\\BTNHeroDeathKnight.blp"	set g_hero_icons[28]="ReplaceableTextures\\CommandButtons\\BTNShaman.blp"	set g_hero_icons[29]="ReplaceableTextures\\CommandButtons\\BTNGhoul.blp"	set g_hero_icons[30]="ReplaceableTextures\\CommandButtons\\BTNOrcWarlockRed.blp"	set g_hero_icons[31]="ReplaceableTextures\\CommandButtons\\BTNNagaSeaWitch.blp"	set g_hero_icons[32]="ReplaceableTextures\\CommandButtons\\BTNGarithos.blp"	set g_hero_icons[33]="ReplaceableTextures\\CommandButtons\\BTNSkeletonWarrior.blp"	set g_hero_icons[34]="ReplaceableTextures\\CommandButtons\\BTNSkeletonMage.blp"	set g_hero_icons[35]="ReplaceableTextures\\CommandButtons\\BTNMurgulBloodGill.blp"	set g_hero_icons[36]="ReplaceableTextures\\CommandButtons\\BTNHeadHunterBerserker.blp"	set g_hero_icons[37]="ReplaceableTextures\\CommandButtons\\BTNHeroMountainKing.blp"	set g_hero_icons[38]="ReplaceableTextures\\CommandButtons\\BTNEvilIllidan.blp"	set g_hero_icons[39]="ReplaceableTextures\\CommandButtons\\BTNKiljaedin.blp"	set g_hero_icons[40]="ReplaceableTextures\\CommandButtons\\BTNLichVersion2.blp"	set g_hero_icons[41]="ReplaceableTextures\\CommandButtons\\BTNKeeperOfTheGrove.blp"	set g_hero_icons[42]="ReplaceableTextures\\CommandButtons\\BTNHuntress.blp"	set g_hero_icons[43]="ReplaceableTextures\\CommandButtons\\BTNGnollArcher.blp"	set g_hero_icons[44]="ReplaceableTextures\\CommandButtons\\BTNHeroPaladin.blp"	set g_hero_icons[45]="ReplaceableTextures\\CommandButtons\\BTNHeroCryptLord.blp"	set g_hero_icons[46]="ReplaceableTextures\\CommandButtons\\BTNThrall.blp"	set Xe=63	set number_of_heroes=45	set g_Heroes[1]='E002' //Древняя Жрица	set g_Heroes[2]='E004' //Королева Пауков	set g_Heroes[3]='E000' //Пират	set g_Heroes[4]='E005' //Повелитель Времени	set g_Heroes[5]='H000' //Лучница	set g_Heroes[6]='H00A' //Колдун	set g_Heroes[7]='H001' //Повелитель Огня	set g_Heroes[8]='H007' //Странник	set g_Heroes[9]='O003' //Андроид	set g_Heroes[10]='O004' //Голем	set g_Heroes[11]='O000' //Минотавр	set g_Heroes[12]='O005' //Мясник	set g_Heroes[13]='O002' //Знахарь	set g_Heroes[14]='U002' //Пустынник	set g_Heroes[15]='U000' //Воин Плети	set g_Heroes[16]='E003' //Валькирия	set g_Heroes[17]='O001' //Вождь Орков	set g_Heroes[18]='H005' //Нага-Гвардеец	set g_Heroes[19]='H003' //Нага-Сирена	set g_Heroes[20]='N00H' //Некромант	set g_Heroes[21]='H002' //Паладин	set g_Heroes[22]='N00T' //Пивовар	set g_Heroes[23]='N00U' //Повелитель Зверей	set g_Heroes[24]='H008' //Рыцарь	set g_Heroes[25]='N018' //Сотканный из Крови	set g_Heroes[26]='H006' //Тёмный Рыцарь	set g_Heroes[27]='E006' //Шаман	set g_Heroes[28]='E007' //Вурдалак	set g_Heroes[29]='H00B' //Повелитель Земли	set g_Heroes[30]='N01I' //Королева Змей	set g_Heroes[31]='H00F' //Генерал	set g_Heroes[32]='U005' //Скелет-вор	set g_Heroes[33]='E00B' //Скелет-маг	set g_Heroes[34]='E00C' //Морлок	set g_Heroes[35]='O00B' //Берсеркер	set g_Heroes[36]='H00M' //Горный Король	set g_Heroes[37]='E00D' //Мастер Теней	set g_Heroes[38]='N02G' //Вампир	set g_Heroes[39]='U00A' //Повелитель Холода	set g_Heroes[40]='E00F' //Хранитель Рощи	set g_Heroes[41]='E00L' //Охотница	set g_Heroes[42]='H00U' //Иллюзионист	set g_Heroes[43]='H00Z' //Воин Света	set g_Heroes[44]='U00B' //Падший Воитель	set g_Heroes[45]='O00G' //Владиыка Молнийendfunctionfunction Sd takes integer n returns integerlocal integer array idset id[1]='A0EP'set id[2]='A0ES'set id[3]='A0EQ'set id[4]='A0ER'set id[7]='h00V'set id[8]='I06Q'set id[10]='H00U'return id[n]endfunctionfunction td takes integer n returns reallocal real array Tdlocal real NN=300.local real XB=0local real array udset Td[1]=.8set Td[2]=.9set Td[3]=1.set ud[1]=1set ud[2]=2set ud[3]=3if n==1 or n==2 or n==3 thenset XB=Td[n]endifif n==4 thenset XB=NNendifif n==5 or n==6 or n==7 thenset XB=ud[n-4]endifreturn XBendfunctionfunction Ud takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer wd=GetHandleId(t)local effect e=LoadEffectHandle(wx,0,wd)call FlushChildHashtable(wx,wd)call DestroyEffect(e)call DestroyTimer(t)set e=nullset t=nullendfunctionfunction Wd takes unit XC,group g,real Gd,boolean yd returns nothinglocal unit ulocal group og=glocal player hP=GetOwningPlayer(XC)local player sPlocal effect elocal timer tlocal integer wdloopset u=FirstOfGroup(og)set sP=GetOwningPlayer(u)if IsPlayerEnemy(hP,sP)and hP!=sP and GetWidgetLife(u)>.405 thencall UnitDamageTarget(XC,u,Gd,true,yd,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_NORMAL,WEAPON_TYPE_WHOKNOWS)set e=AddSpecialEffectTarget("Abilities\\Spells\\Undead\\AnimateDead\\AnimateDeadTarget.mdl",u,"origin")set t=CreateTimer()set wd=GetHandleId(t)call SaveEffectHandle(wx,0,wd,e)call TimerStart(t,.8,false,function Ud)endifcall GroupRemoveUnit(og,u)exitwhen u==nullendloopcall DestroyGroup(og)set t=nullset e=nullset og=nullset u=nullset hP=nullset sP=nullendfunctionfunction Yd takes unit XC,real X,real Y,real r,real Gd,boolean yd returns nothinglocal group g=CreateGroup()call GroupEnumUnitsInRange(g,X,Y,r,null)call Wd(XC,g,Gd,yd)call DestroyGroup(g)set g=nullendfunctionfunction zd takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer wd=GetHandleId(t)local unit d=LoadUnitHandle(wx,wd,0)local item it=LoadItemHandle(wx,wd,1)call RemoveItem(it)call KillUnit(d)call RemoveUnit(d)call FlushChildHashtable(wx,wd)call DestroyTimer(t)set it=nullset d=nullset t=nullendfunctionfunction Zd takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer wd=GetHandleId(t)local unit XC=LoadUnitHandle(wx,wd,0)local integer cv=Lolocal integer vD=GetUnitAbilityLevel(XC,Sd(4))local integer eD=LoadInteger(wx,wd,1)local integer r=GetRandomInt(1,$A)local integer Jbif(cv>0)thenset Lo=cv-1if vD==0 thencall SetHeroAgi(XC,GetHeroAgi(XC,false)-eD,true)elseif r==1 and vr<$C8 thenset vr=vr+eDif vr>$C8 thenset Jb=vr-$C8call SetHeroAgi(XC,GetHeroAgi(XC,false)-Jb,true)set vr=$C8endifelsecall SetHeroAgi(XC,GetHeroAgi(XC,false)-eD,true)endifendifendifcall DestroyTimer(t)call FlushChildHashtable(wx,wd)set XC=nullset t=nullendfunctionfunction xD takes unit oD,unit XC returns nothinglocal player rD=GetOwningPlayer(XC)local player aD=GetOwningPlayer(oD)local boolean array Blocal unit dlocal real nD=GetUnitX(oD)local real VD=GetUnitY(oD)local integer ED=GetUnitAbilityLevel(XC,Sd(1))local timer tlocal timer XDlocal real OD=2.local integer wdlocal integer RDlocal item itlocal integer cvlocal integer udlocal integer vD=GetUnitAbilityLevel(XC,Sd(4))set B[2]=(aD!=rD)set B[3]=(IsPlayerAlly(aD,rD)==false)set B[4]=ED==0if(B[2]and B[3])thenif(B[4]==false)thenif(ED==1)thenset OD=4.elseif(ED==2)thenset OD=6.elseif(ED==3)thenset OD=7.endifset d=CreateUnit(rD,Sd(7),nD,VD,.0)set it=UnitAddItemById(d,Sd(8))call SetUnitAbilityLevel(d,Sd(2),ED)call UnitUseItemTarget(d,it,oD)set cv=Loif(vD!=0)thenset ud=R2I(td(vD+4))call SetHeroAgi(XC,GetHeroAgi(XC,false)+ud,true)endifset Lo=cv+1set t=CreateTimer()set XD=CreateTimer()call TimerStart(t,1.,false,function zd)call TimerStart(XD,OD,false,function Zd)set RD=GetHandleId(XD)set wd=GetHandleId(t)call SaveUnitHandle(wx,wd,0,d)call SaveUnitHandle(wx,RD,0,XC)call SaveInteger(wx,RD,1,ud)call SaveItemHandle(wx,wd,1,it)endifendifset aD=nullset rD=nullset d=nullset it=nullset t=nullset XD=nullendfunctionfunction AD takes unit XC returns nothinglocal integer cv=Lolocal integer ED=GetUnitAbilityLevel(XC,Sd(3))local real Tdif(cv>0)thenelseset cv=1endifset Td=I2R(GetHeroAgi(XC,true))*td(ED)set Td=cv*Tdcall Yd(XC,GetUnitX(XC),GetUnitY(XC),td(4),Td,false)endfunctionfunction ND takes nothing returns nothingcall DisableTrigger(hn)endfunctionfunction bD takes nothing returns nothing	call DestroyTimer(Vr)	set Vr=CreateTimer()	call TimerStart(Vr,'x',false,function ND)	call PauseShops(true)	call DisableTrigger(CommandLineReady)	call DestroyTimer(Gv)	call DestroyTimer(LoadTimerHandle(wx,1,StringHash("timers")))	call DestroyTimer(LoadTimerHandle(wx,2,StringHash("timers")))	call DestroyTimerDialog(ue)	call ModifyGateBJ(0,g_gate)	set Gv=null	set ue=null	if hv==1 then		call DisableTrigger(DI)		call DisableTrigger(fI)		call DisableTrigger(CommandLineRepick)	endif	set pv=0	if UB()then		call rc()		return	endif	if ModuloInteger(hv,5)==0 then		call TriggerExecute(QO)	else		call TriggerExecute(qO)	endifendfunctionfunction BD takes unit u returns booleanlocal real hc=GetWidgetLife(u)local boolean chcall SetWidgetLife(u,hc+.001)if hc!=GetWidgetLife(u)thencall UnitDamageTarget(u,u,.001,false,true,null,null,null)set ch=(GetWidgetLife(u)==hc+.001)elsecall UnitDamageTarget(u,u,.001,false,true,null,null,null)set ch=(GetWidgetLife(u)==hc)call SetWidgetLife(u,hc)endifreturn chendfunctionfunction cD takes unit u returns reallocal integer CD=arif Ve thenreturn .0endifif GetUnitTypeId(u)=='n00K' or GetUnitTypeId(u)=='n00Z' or GetUnitTypeId(u)=='n017' thenreturn CD*.01*500elseif GetUnitTypeId(u)=='n00J' or GetUnitTypeId(u)=='n02Q' or GetUnitTypeId(u)=='n00I' or GetUnitTypeId(u)=='n00G' or GetUnitTypeId(u)=='n02P' or GetUnitTypeId(u)=='n00F' or GetUnitTypeId(u)=='n00E' or GetUnitTypeId(u)=='n02O' or GetUnitTypeId(u)=='n00D' or GetUnitTypeId(u)=='n008' or GetUnitTypeId(u)=='n02J' or GetUnitTypeId(u)=='n009' thenreturn CD*.01*25.5elseif GetUnitTypeId(u)=='n00V' or GetUnitTypeId(u)=='n02U' or GetUnitTypeId(u)=='n00R' or GetUnitTypeId(u)=='n00Q' or GetUnitTypeId(u)=='n02T' or GetUnitTypeId(u)=='n00P' or GetUnitTypeId(u)=='n00O' or GetUnitTypeId(u)=='n02S' or GetUnitTypeId(u)=='n00N' or GetUnitTypeId(u)=='n00M' or GetUnitTypeId(u)=='n02R' or GetUnitTypeId(u)=='n00L' thenreturn CD*.01*33elseif GetUnitTypeId(u)=='n01E' or GetUnitTypeId(u)=='n032' or GetUnitTypeId(u)=='n01D' or GetUnitTypeId(u)=='n031' or GetUnitTypeId(u)=='n01C' or GetUnitTypeId(u)=='n01B' or GetUnitTypeId(u)=='n01A' or GetUnitTypeId(u)=='n030' or GetUnitTypeId(u)=='n019' or GetUnitTypeId(u)=='n02W' or GetUnitTypeId(u)=='n02V' or GetUnitTypeId(u)=='n016' or GetUnitTypeId(u)=='n015' thenreturn CD*.01*48elseif GetUnitTypeId(u)=='n01U' or GetUnitTypeId(u)=='n039' or GetUnitTypeId(u)=='n02D' or GetUnitTypeId(u)=='n03A' or GetUnitTypeId(u)=='n02C' or GetUnitTypeId(u)=='n037' or GetUnitTypeId(u)=='n02B' or GetUnitTypeId(u)=='n038' or GetUnitTypeId(u)=='n02A' or GetUnitTypeId(u)=='n035' or GetUnitTypeId(u)=='n029' or GetUnitTypeId(u)=='n036' or GetUnitTypeId(u)=='n028' or GetUnitTypeId(u)=='n033' or GetUnitTypeId(u)=='n027' or GetUnitTypeId(u)=='n034' thenreturn CD*.01*63elsereturn CD*.01*SquareRoot((GetUnitState(u,UNIT_STATE_MAX_LIFE)+GetUnitState(u,UNIT_STATE_MAX_MANA))*GetUnitLevel(u))*2endifendifendifendifendifreturn .0endfunctionfunction dD takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer Gb=GetHandleId(t)local effect e=LoadEffectHandle(wx,1,Gb)local unit u=LoadUnitHandle(wx,2,Gb)call DestroyEffect(e)call UnitRemoveAbility(u,'A0BF')call DestroyTimer(t)set e=nullset t=nullset u=nullendfunctionfunction DD takes unit u returns nothinglocal timer t=CreateTimer()local integer Gb=GetHandleId(t)local unit fD=hxlocal integer Hb=GetUnitAbilityLevel(fD,'A0GP')local effect e=AddSpecialEffectTarget("Abilities\\Spells\\Other\\HealingSpray\\HealBottleMissile.mdl",u,"head")call UnitAddAbility(u,'A0BF')call SetUnitAbilityLevel(u,'A0BF',Hb)call SaveEffectHandle(wx,1,Gb,e)call SaveUnitHandle(wx,2,Gb,u)call TimerStart(t,4+Hb,false,function dD)set fD=nullset t=nullset e=nullendfunctionfunction FD takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer Gb=GetHandleId(t)local timerdialog d=LoadTimerDialogHandle(wx,1,Gb)local integer i1=Lc()local integer i2=Lc()local integer zb=fvlocal group g=CreateGroup()local integer EClocal unit fset vA=ZIcall DestroyTimerDialog(d)set Cx=falseset pv=0if i1==0 or i2==0 thencall ForceClear(io)call TriggerExecute(MO)returnendifset Ve=trueset oo=1call EnableTrigger(iR)set EC=1loopexitwhen EC>zbcall PanCameraToTimedLocForPlayer(GetOwningPlayer(gv[EC]),GetRectCenter(Yr),0)set EC=EC+1endloopset g=IN(bj_mapInitialPlayableArea)loopset f=FirstOfGroup(g)exitwhen f==nullif IsUnitType(f,UNIT_TYPE_HERO)==false thencall PauseUnit(f,true)endifcall GroupRemoveUnit(g,f)endloopcall DestroyGroup(g)set ao[1]=gv[xo[i1]]set ao[2]=gv[xo[i2]]set EC=1loopexitwhen EC>8call IssueImmediateOrderById(gv[EC],$D0004)set EC=EC+1endloopcall YC(ao[1],ao[2])call DestroyTimer(t)set d=nullset g=nullset f=nullset t=nullendfunctionfunction gD takes nothing returns nothing	call DestroyTimer(Vr)	set Vr=null	set Vr=CreateTimer()	call TimerStart(Vr,'x',false,function ND)	call DestroyTimer(Gv)	call DestroyTimer(LoadTimerHandle(wx,1,StringHash("timers")))	call DestroyTimer(LoadTimerHandle(wx,2,StringHash("timers")))	call DestroyTimerDialog(ue)	call PauseShops(true)	call DisableTrigger(CommandLineReady)	call ModifyGateBJ(0,g_gate)	set Gv=null	set ue=null	if hv==1 then		call DisableTrigger(DI)		call DisableTrigger(fI)		call DisableTrigger(CommandLineRepick)	endif	set pv=0	if UB()then		call rc()		return	endif	if ModuloInteger(hv,5)==0 then		call TriggerExecute(QO)	else		call TriggerExecute(qO)	endifendfunctionfunction GD takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer Gb=GetHandleId(t)local integer HB=LoadInteger(wx,1,Gb)if HB!=20 thencall TriggerExecute(ZO)endifcall DestroyTimer(t)set t=nullendfunctionfunction hD takes nothing returns nothinglocal timer t=GetExpiredTimer()call EnableTrigger(CommandLineReady)call EnableTrigger(CommandLineTeleport)call DestroyTimer(t)set t=nullendfunctionfunction HD takes nothing returns nothinglocal timer t=GetExpiredTimer()call DisableTrigger(CommandLineReady)call DisableTrigger(CommandLineTeleport)call DestroyTimer(t)set t=nullendfunctionfunction jD takes nothing returns nothing	local integer In=1	local integer zb=fv	local real w	local integer HB=hv	local integer Cc	local integer Bc=qv	local integer bc=Do	local timer t=CreateTimer()	local timer tt=CreateTimer()	local timer JD=CreateTimer()	local timer kD=CreateTimer()	local timer KD=CreateTimer()	local integer lD=GetHandleId(KD)	local integer LD=GetHandleId(tt)	local timerdialog d	call SaveTimerHandle(wx,1,StringHash("timers"),tt)	call SaveTimerHandle(wx,2,StringHash("timers"),kD)	if tv then		return	endif	call ic()	loop		exitwhen In>zb		set cx[In]=false		set Ze[In]=false		set In=In+1	endloop	set ar=sv	if Ve==false then		set In=1		loop			exitwhen In>zb			call SetPlayerState(qe[In],PLAYER_STATE_RESOURCE_LUMBER,GetPlayerState(qe[In],PLAYER_STATE_RESOURCE_LUMBER)+(3+HB))			call SetPlayerState(qe[In],PLAYER_STATE_LUMBER_GATHERED,GetPlayerState(qe[In],PLAYER_STATE_LUMBER_GATHERED)+(3+HB))			set In=In+1		endloop	endif	call DestroyTimer(Vr)	set Vr=null	call EnableTrigger(hn)	call Vc()	call Ac()	call PauseTaverns(false)	call PauseShops(false)	set He=true	call TimerStart(JD,6.25,false,function WB)	if(ne==false)and(qv>1)and(ModuloInteger(HB,3)==0)and(HB!=0)then		call ModifyGateBJ(0,g_gate)		set ne=true		call DisableTrigger(CommandLineReady)		set Cx=true		call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,"|cffffcc00Следующий раунд - Дуэль|R")		call MultiboardSetItemValueBJ(Jv,4,fv+2,"|cffffcc00Дуэль")		call TimerStart(KD,30,false,function FD)		set d=CreateTimerDialog(KD)		call SaveTimerDialogHandle(wx,1,lD,d)		call TimerDialogSetTitle(d,"Осталось")		call TimerDialogDisplay(d,true)		call DestroyTimer(ir)		set ir=CreateTimer()		call TimerStart(ir,27,false,function Kb)		return	else		call ModifyGateBJ(1,g_gate)		set ne=false	endif	set hv=hv+1	set HB=HB+1	if HB==2 then		call DisableTrigger(CommandLineRepick)	endif	set Cc=Nc(HB,bc,Bc)	set In=1	loop		exitwhen In>zb		call AdjustPlayerStateBJ(Cc,qe[In],PLAYER_STATE_RESOURCE_GOLD)		set In=In+1	endloop	if HB==20 then		call MultiboardSetItemValueBJ(Jv,4,zb+2,"|cffffcc00Финальный босс")	else		if ModuloInteger(HB,5)==0 then			call MultiboardSetItemValueBJ(Jv,4,(zb+2),("|cffffcc00Мегабосс"))		else			call MultiboardSetItemValueBJ(Jv,4,(zb+2),("|cffffcc00"+(I2S(HB)+(" [ "+(bx[HB]+" ]")))))		endif	endif	call TimerStart(t,2,false,function hD)	if HB==1 then		set w=30	else		if uo==false then			call Gc()		endif		set w=$F	endif	call SaveInteger(wx,1,LD,HB)	call TimerStart(tt,w,false,function GD)	if HB==1 then		set w=90	else		if HB==20 then			set w='x'		else			set w=60		endif	endif	call TimerStart(kD,w-.5,false,function HD)	set Gv=CreateTimer()	call TimerStart(Gv,w,false,function gD)	set ue=CreateTimerDialog(Gv)	call TimerDialogSetTitle(ue,"Осталось")	call TimerDialogDisplay(ue,true)	call DestroyTimer(ir)	set ir=CreateTimer()	call TimerStart(ir,w-3,false,function Kb)	set t=null	set tt=null	set JD=null	set kD=nullendfunctionfunction mD takes nothing returns nothing//	local integer re=qv	set Sx=true	set sv=$96	call TriggerExecute(dn)	call jD()	call TriggerExecute(aR)endfunctionfunction MD takes integer PD returns nothinglocal trigger tif HaveSavedHandle(wx,PD,1)thenset t=LoadTriggerHandle(wx,PD,1)call TriggerRemoveAction(t,LoadTriggerActionHandle(wx,PD,2))call DestroyTrigger(t)call RemoveSavedHandle(wx,PD,1)call RemoveSavedHandle(wx,PD,2)set t=nullendifendfunctionfunction qD takes string QD,real sD,real x,real y,integer SD,integer tD,integer TD,real UD,real OD returns nothinglocal texttag tt=CreateTextTag()call SetTextTagText(tt,QD,sD*.023/$A)call SetTextTagPos(tt,x,y,0)call SetTextTagColor(tt,SD,tD,TD,0)call SetTextTagVelocity(tt,0,.03)call SetTextTagSuspended(tt,false)call SetTextTagVisibility(tt,true)call SetTextTagFadepoint(tt,UD)call SetTextTagLifespan(tt,OD)call SetTextTagPermanent(tt,false)set tt=nullendfunctionfunction wD takes unit WD,unitstate whichUnitState,integer yD returns booleanlocal integer c=yDlocal integer i='A0HG'if i==0 thenreturn falseendifif c>0 thenloopexitwhen c==0call UnitAddAbility(WD,i)if c>='d' thenset c=c-'d'call SetUnitAbilityLevel(WD,i,4)elseif c>=$A thenset c=c-$Acall SetUnitAbilityLevel(WD,i,3)elseset c=c-1call SetUnitAbilityLevel(WD,i,2)endifcall UnitRemoveAbility(WD,i)endloopelseif c<0 thenset c=-cloopexitwhen c==0call UnitAddAbility(WD,i)if c>='d' thenset c=c-'d'call SetUnitAbilityLevel(WD,i,7)elseif c>=$A thenset c=c-$Acall SetUnitAbilityLevel(WD,i,6)elseset c=c-1call SetUnitAbilityLevel(WD,i,5)endifcall UnitRemoveAbility(WD,i)endloopendifreturn trueendfunctionfunction YD takes player zD returns nothinglocal integer ZD=0local integer vf=0local integer ef=0local real array xflocal integer i=0local real of=tA[0]+tA[1]+tA[2]+tA[3]+tA[4]+tA[5]+tA[6]+tA[7]loopexitwhen i==8if GetPlayerSlotState(Player(i))==PLAYER_SLOT_STATE_PLAYING thenset vf=iexitwhen trueendifset i=i+1endloopset i=0loopexitwhen i==8if GetPlayerSlotState(Player(i))==PLAYER_SLOT_STATE_PLAYING thenif tA[i]>tA[ZD]thenset ZD=iendifif tA[i]<tA[vf]thenset vf=iendifif TA[i]>TA[ef]thenset ef=iendifset xf[i]=tA[i]/of*'d'endifset i=i+1endloopcall DisplayTimedTextToPlayer(GetLocalPlayer(),.0,.0,15.,rA[GetPlayerId(zD)]+GetPlayerName(zD)+"|r сделал последний удар.")if tA[GetPlayerId(GetLocalPlayer())]>0.thencall DisplayTimedTextToPlayer(GetLocalPlayer(),.0,.0,16.,"Вы нанесли "+I2S(R2I(tA[GetPlayerId(GetLocalPlayer())]))+" ед. урона ("+I2S(R2I(xf[GetPlayerId(GetLocalPlayer())]))+"%).")elsecall DisplayTimedTextToPlayer(GetLocalPlayer(),.0,.0,16.,"Вы не нанесли урона босу.")endifcall DisplayTimedTextToPlayer(GetLocalPlayer(),.0,.0,18.,"Больше всех урона: "+rA[ZD]+GetPlayerName(Player(ZD))+"|r - "+I2S(R2I(tA[ZD]))+" ед. ("+I2S(R2I(xf[ZD]))+"%).")call DisplayTimedTextToPlayer(GetLocalPlayer(),.0,.0,20.,"Меньше всех урона: "+rA[vf]+GetPlayerName(Player(vf))+"|r - "+I2S(R2I(tA[vf]))+" ед. ("+I2S(R2I(xf[vf]))+"%).")if TA[GetPlayerId(GetLocalPlayer())]>0.thencall DisplayTimedTextToPlayer(GetLocalPlayer(),.0,.0,22.,"Вы получили "+I2S(R2I(TA[GetPlayerId(GetLocalPlayer())]))+" ед. урона.")elsecall DisplayTimedTextToPlayer(GetLocalPlayer(),.0,.0,22.,"Вы не получили урона.")endifcall DisplayTimedTextToPlayer(GetLocalPlayer(),.0,.0,23.,"Лучший танк: "+rA[ef]+GetPlayerName(Player(ef))+"|r - "+I2S(R2I(TA[ef]))+" ед. урона.")set tA[0]=0set tA[1]=0set tA[2]=0set tA[3]=0set tA[4]=0set tA[5]=0set tA[6]=0set tA[7]=0set TA[0]=0set TA[1]=0set TA[2]=0set TA[3]=0set TA[4]=0set TA[5]=0set TA[6]=0set TA[7]=0endfunctionfunction rf takes nothing returns nothingif GetEventDamage()>=40.and GetRandomInt(0,$A)<=3 thencall CreateUnit(Player($B),'n03D',GetWidgetX(GetTriggerUnit()),GetWidgetY(GetTriggerUnit()),GetUnitFacing(GetTriggerUnit()))call QueueUnitAnimation(bj_lastCreatedUnit,"Birth Swim")endifendfunctionfunction af takes unit nf returns nothinglocal trigger t=CreateTrigger()call TriggerRegisterUnitEvent(t,nf,EVENT_UNIT_DAMAGED)call TriggerAddAction(t,function rf)set t=nullendfunctionfunction Vf takes nothing returns nothinglocal unit zD=GetKillingUnit()local boolean Ef=IsUnitType(zD,UNIT_TYPE_HERO)local boolean Xf=GetWidgetLife(zD)>.405local boolean b1=GetUnitTypeId(zD)!='E00E'local boolean b2=GetUnitTypeId(zD)!='E00J'local player p=GetOwningPlayer(zD)local unit dy=GetDyingUnit()local real Of=cD(dy)local real NN=900.local group g=CreateGroup()local group Rf=CreateGroup()local real x=GetUnitX(dy)local real y=GetUnitY(dy)local integer MBlocal integer DClocal unit fif zD==null or IsUnitType(dy,UNIT_TYPE_STRUCTURE)or IsUnitAlly(dy,p)or IsUnitIllusion(dy)or GetUnitTypeId(dy)=='n03D' thenreturnendifif Ef and Xf and b1 and b2 thenset MB=1call GroupAddUnit(Rf,zD)elseif Ef and Xf==false and b1 and b2 thenset MB=0elseset MB=1set DC=me[GetPlayerId(p)+1]call GroupAddUnit(Rf,gv[DC])endifendifcall GroupEnumUnitsInRange(g,x,y,NN,null)call GroupRemoveUnit(g,zD)loopset f=FirstOfGroup(g)exitwhen f==nullif GetWidgetLife(f)>.405 and IsUnitType(f,UNIT_TYPE_HERO)and IsUnitAlly(f,p)and GetUnitTypeId(f)!='E00E' and GetUnitTypeId(f)!='E00J' thenif IsUnitInGroup(f,Rf)==false thencall GroupAddUnit(Rf,f)set MB=MB+1endifendifcall GroupRemoveUnit(g,f)endloopset Of=Of/MBloopset f=FirstOfGroup(Rf)exitwhen f==nullcall AddHeroXP(f,R2I(Of),true)call GroupRemoveUnit(Rf,f)endloopcall DestroyGroup(g)call DestroyGroup(Rf)set dy=nullset p=nullset zD=nullset g=nullset Rf=nullendfunctionfunction Nf takes nothing returns nothinglocal timer t=GetExpiredTimer()if Xx thencall cC()else//if g_flag_tk==false thencall EnableTrigger(CommandLineRandom)call EnableTrigger(CommandLineRepick)//endifendifcall DestroyTimer(t)set t=nullendfunctionfunction bf takes nothing returns nothing	local timer t=GetExpiredTimer()	local timer t2=CreateTimer()	call EnableTrigger(Hn)	call EnableTrigger(jn)	call EnableTrigger(hn)	call TimerStart(t2,1.25,false,function Nf)	call DestroyTimer(t)	set t=null	set t2=nullendfunctionfunction MakeForest takes nothing returns nothing	call CreateDestructable('ATtr',-2880.,-512.,0,1,6)	call CreateDestructable('ATtr',-2880.,-384.,0,1,$A)	call CreateDestructable('ATtr',-2944.,896.,0,1,9)	call CreateDestructable('ATtr',-2880.,1088.,0,1,4)	call CreateDestructable('ATtr',-2816.,-640.,0,1,8)	call CreateDestructable('ATtr',-2752.,-384.,0,1,6)	call CreateDestructable('ATtr',-2624.,-256.,0,1,5)	call CreateDestructable('ATtr',-2752.,960.,0,1,1)	call CreateDestructable('ATtr',-2752.,1088.,0,1,3)	call CreateDestructable('ATtr',-2688.,2624.,0,1,6)	call CreateDestructable('ATtr',-2112.,2432.,0,1,5)	call CreateDestructable('ATtr',-2176.,2560.,0,1,$A)	call CreateDestructable('ATtr',-1856.,320.,0,1,8)	call CreateDestructable('ATtr',-1856.,2496.,0,1,7)	call CreateDestructable('ATtr',-1984.,2496.,0,1,9)	call CreateDestructable('ATtr',-1984.,2368.,0,1,5)	call CreateDestructable('ATtr',-1856.,2304.,0,1,2)	call CreateDestructable('ATtr',-2048.,2624.,0,1,7)	call CreateDestructable('ATtr',-1920.,2624.,0,1,1)	call CreateDestructable('ATtr',-1600.,2432.,0,1,5)	call CreateDestructable('ATtr',-1728.,2432.,0,1,8)	call CreateDestructable('ATtr',-1664.,2560.,0,1,8)	call CreateDestructable('ATtr',-1792.,2624.,0,1,$A)	call CreateDestructable('ATtr',-1536.,-1088.,0,1,9)	call CreateDestructable('ATtr',-1408.,-1024.,0,1,6)	call CreateDestructable('ATtr',-1536.,-960.,0,1,1)	call CreateDestructable('ATtr',-1472.,2496.,0,1,6)	call CreateDestructable('ATtr',-1536.,2624.,0,1,6)	call CreateDestructable('ATtr',-1280.,-1088.,0,1,6)	call CreateDestructable('ATtr',-1216.,448.,0,1,1)	call CreateDestructable('ATtr',-1216.,1152.,0,1,6)	call CreateDestructable('ATtr',192.,-960.,0,1,5)	call CreateDestructable('ATtr',256.,-128.,0,1,3)	call CreateDestructable('ATtr',448.,-192.,0,1,5)	call CreateDestructable('ATtr',256.,.0,0,1,6)	call CreateDestructable('ATtr',512.,-1088.,0,1,5)	call CreateDestructable('ATtr',640.,320.,0,1,3)	call CreateDestructable('ATtr',832.,-128.,0,1,6)	call CreateDestructable('ATtr',896.,704.,0,1,9)	call CreateDestructable('ATtr',832.,832.,0,1,1)	call CreateDestructable('ATtr',1664.,-128.,0,1,1)	call CreateDestructable('ATtr',1664.,.0,0,1,1)	call CreateDestructable('ATtr',1600.,128.,0,1,$A)	call CreateDestructable('ATtr',1600.,256.,0,1,3)	call CreateDestructable('ATtr',1728.,448.,0,1,4)	call CreateDestructable('ATtr',1728.,320.,0,1,1)	call CreateDestructable('ATtr',1600.,512.,0,1,5)	call CreateDestructable('ATtr',1600.,640.,0,1,3)	call CreateDestructable('ATtr',1728.,576.,0,1,1)	call CreateDestructable('ATtr',1600.,832.,0,1,2)	call CreateDestructable('ATtr',1600.,960.,0,1,4)	call CreateDestructable('ATtr',1728.,768.,0,1,1)	call CreateDestructable('ATtr',1664.,1152.,0,1,5)	call CreateDestructable('ATtr',1728.,1024.,0,1,2)	call CreateDestructable('ATtr',1664.,1408.,0,1,9)	call CreateDestructable('ATtr',1728.,1536.,0,1,9)	call CreateDestructable('ATtr',1792.,-320.,0,1,3)	call CreateDestructable('ATtr',1920.,-192.,0,1,$A)	call CreateDestructable('ATtr',1920.,-64.,0,1,1)	call CreateDestructable('ATtr',1984.,192.,0,1,4)	call CreateDestructable('ATtr',1792.,128.,0,1,6)	call CreateDestructable('ATtr',1856.,256.,0,1,5)	call CreateDestructable('ATtr',1984.,320.,0,1,9)	call CreateDestructable('ATtr',1856.,448.,0,1,1)	call CreateDestructable('ATtr',1856.,704.,0,1,$A)	call CreateDestructable('ATtr',1984.,512.,0,1,1)	call CreateDestructable('ATtr',1856.,832.,0,1,9)	call CreateDestructable('ATtr',1856.,960.,0,1,2)	call CreateDestructable('ATtr',1792.,1216.,0,1,1)	call CreateDestructable('ATtr',1920.,1216.,0,1,5)	call CreateDestructable('ATtr',1984.,1472.,0,1,3)	call CreateDestructable('ATtr',1920.,1344.,0,1,$A)	call CreateDestructable('ATtr',1792.,1344.,0,1,8)	call CreateDestructable('ATtr',1856.,1536.,0,1,6)	call CreateDestructable('ATtr',2112.,-192.,0,1,7)	call CreateDestructable('ATtr',2112.,.0,0,1,1)	call CreateDestructable('ATtr',2112.,128.,0,1,1)	call CreateDestructable('ATtr',2240.,448.,0,1,9)	call CreateDestructable('ATtr',2112.,256.,0,1,6)	call CreateDestructable('ATtr',2112.,384.,0,1,9)	call CreateDestructable('ATtr',2176.,640.,0,1,7)	call CreateDestructable('ATtr',2112.,512.,0,1,1)	call CreateDestructable('ATtr',2048.,640.,0,1,1)	call CreateDestructable('ATtr',2048.,832.,0,1,5)	call CreateDestructable('ATtr',2176.,832.,0,1,6)	call CreateDestructable('ATtr',2048.,1152.,0,1,1)	call CreateDestructable('ATtr',2048.,1024.,0,1,1)	call CreateDestructable('ATtr',2176.,1152.,0,1,5)	call CreateDestructable('ATtr',2176.,1344.,0,1,3)	call CreateDestructable('ATtr',2240.,1472.,0,1,3)	call CreateDestructable('ATtr',2048.,1344.,0,1,4)	call CreateDestructable('ATtr',2112.,1536.,0,1,6)	call CreateDestructable('ATtr',2496.,192.,0,1,$A)	call CreateDestructable('ATtr',2304.,192.,0,1,5)	call CreateDestructable('ATtr',2496.,448.,0,1,$A)	call CreateDestructable('ATtr',2368.,320.,0,1,9)	call CreateDestructable('ATtr',2432.,704.,0,1,3)	call CreateDestructable('ATtr',2304.,576.,0,1,2)	call CreateDestructable('ATtr',2432.,576.,0,1,4)	call CreateDestructable('ATtr',2368.,832.,0,1,2)	call CreateDestructable('ATtr',2304.,960.,0,1,$A)	call CreateDestructable('ATtr',2304.,1216.,0,1,9)	call CreateDestructable('ATtr',2432.,1088.,0,1,7)	call CreateDestructable('ATtr',2432.,1216.,0,1,9)	call CreateDestructable('ATtr',2304.,1088.,0,1,1)	call CreateDestructable('ATtr',2368.,1344.,0,1,$A)	call CreateDestructable('ATtr',2624.,-64.,0,1,4)	call CreateDestructable('ATtr',2688.,64.,0,1,2)	call CreateDestructable('ATtr',2560.,64.,0,1,3)	call CreateDestructable('ATtr',2624.,192.,0,1,2)	call CreateDestructable('ATtr',2752.,256.,0,1,9)	call CreateDestructable('ATtr',2752.,384.,0,1,2)	call CreateDestructable('ATtr',2624.,320.,0,1,2)	call CreateDestructable('ATtr',2560.,704.,0,1,1)	call CreateDestructable('ATtr',2688.,704.,0,1,4)	call CreateDestructable('ATtr',2688.,512.,0,1,7)	call CreateDestructable('ATtr',2560.,896.,0,1,5)	call CreateDestructable('ATtr',2688.,832.,0,1,5)	call CreateDestructable('ATtr',2624.,1216.,0,1,9)	call CreateDestructable('ATtr',2752.,1152.,0,1,6)	call CreateDestructable('ATtr',2624.,1024.,0,1,4)	call CreateDestructable('ATtr',2688.,1472.,0,1,1)	call CreateDestructable('ATtr',2688.,1344.,0,1,7)	call CreateDestructable('ATtr',2880.,-128.,0,1,3)	call CreateDestructable('ATtr',3008.,-192.,0,1,2)	call CreateDestructable('ATtr',3008.,.0,0,1,7)	call CreateDestructable('ATtr',2816.,.0,0,1,8)	call CreateDestructable('ATtr',3008.,192.,0,1,1)	call CreateDestructable('ATtr',2880.,192.,0,1,2)	call CreateDestructable('ATtr',2944.,448.,0,1,4)	call CreateDestructable('ATtr',3008.,320.,0,1,9)	call CreateDestructable('ATtr',2944.,640.,0,1,9)	call CreateDestructable('ATtr',2816.,768.,0,1,7)	call CreateDestructable('ATtr',3008.,768.,0,1,3)	call CreateDestructable('ATtr',3008.,896.,0,1,6)	call CreateDestructable('ATtr',2880.,896.,0,1,1)	call CreateDestructable('ATtr',2944.,1216.,0,1,1)	call CreateDestructable('ATtr',2880.,1024.,0,1,8)	call CreateDestructable('ATtr',2944.,1472.,0,1,6)	call CreateDestructable('ATtr',2816.,1408.,0,1,4)	call CreateDestructable('ATtr',2816.,1280.,0,1,7)	call CreateDestructable('ATtr',2880.,1600.,0,1,6)	call CreateDestructable('ATtr',3136.,-64.,0,1,3)	call CreateDestructable('ATtr',3264.,-192.,0,1,3)	call CreateDestructable('ATtr',3136.,-256.,0,1,8)	call CreateDestructable('ATtr',3200.,192.,0,1,3)	call CreateDestructable('ATtr',3200.,64.,0,1,5)	call CreateDestructable('ATtr',3072.,448.,0,1,6)	call CreateDestructable('ATtr',3136.,320.,0,1,7)	call CreateDestructable('ATtr',3072.,640.,0,1,1)	call CreateDestructable('ATtr',3264.,640.,0,1,5)	call CreateDestructable('ATtr',3264.,512.,0,1,4)	call CreateDestructable('ATtr',3200.,832.,0,1,9)	call CreateDestructable('ATtr',3264.,1216.,0,1,7)	call CreateDestructable('ATtr',3200.,1024.,0,1,8)	call CreateDestructable('ATtr',3072.,1024.,0,1,7)	call CreateDestructable('ATtr',3072.,1344.,0,1,9)	call CreateDestructable('ATtr',3200.,1472.,0,1,5)	call CreateDestructable('ATtr',3200.,1344.,0,1,2)	call CreateDestructable('ATtr',3072.,1536.,0,1,2)endfunctionfunction MakeMapInfo takes nothing returns nothing	call CreateQuestBJ(0,"Peжимы игpы","Выживaниe являeтcя ocнoвным peжимoм игpы, кoтopый ycтaнoвлeн пo yмoлчaнию. Oднaкo, чтoбы явнo oпpeдeлить eгo, хocт мoжeт ввecти кoмaндy |cffffcc00-в|r в нaчaлe игpы. В этoм peжимe игpoкaм дocтyпeн выбop гepoeв и ycтaнoвлeн нopмaльный ypoвeнь cлoжнocти.|nPeжимы Битвa Клaнoв и Typниp Клaнoв нe пoддepживaютcя в этoй вepcии пo пpичинe их нeпoпyляpнocти и нeдopaбoтaннocти. Еcли вы хoтитe пoигpaть в эти peжимы, вaм cлeдyeт иcпoльзoвaть бoлee cтapyю вepcию кapты, peкoмeндyeтcя вepcия 2.7d.","ReplaceableTextures\\CommandButtons\\BTNSorceressMaster.blp")	call CreateQuestBJ(0,"Уpoвни cлoжнocти","Хocт мoжeт измeнить ypoвeнь cлoжнocти ocнoвнoгo peжимa игpы нa |cffffcc00лёгкий|r или |cffffcc00экcтpeмaльный|r. Для этoгo в пepвыe 10 ceкyнд игpы нaдo иcпoльзoвaть кaмaнды |cffffcc00-л|r или |cffffcc00-э|r cooтвeтcтвeннo. Ha лёгкoм ypoвнe cлoжнocти игpoки бyдyт пoлyчaть знaчитeльнo бoльшe oпытa и зoлoтa. Ha экcтpeмaльнoм ypoвнe cлoжнocти, нaпpoтив, игpoки пoлyчaют мeньшe oпытa и зoлoтa, a мoнcтpы cтaнoвятcя гopaздo cильнee, чeм нa oбычнoм ypoвнe cлoжнocти, кpoмe тoгo, кpoмe тoгo, нa кapтe нe бyдyт paзмeщeны бoчёнки co взpывчaткoй.","ReplaceableTextures\\CommandButtons\\BTNSorceressMaster.blp")	call CreateQuestBJ(0,"Moдификaтopы","Moдификaтopы нe влияют нaпpямyю нa cлoжнocть, нo мoгyт нeмнoгo paзнooбpaзить впeчaтлeния oт игpы. Ecть двa тaких мoдификaтopa к ocнoвнoмy peжимy игpы.|nПepвый из них - |cffffcc00Cлyчaйныe Гepoи|r, кoтopый лишaeт игpoкoв выбopa, вмecтo этoгo вce игpoки пoлyчaют cлyчaйнoгo гepoя. Чтoбы aктивиpoвaть этoт peжим, хocт дoлжeт ввecти кoмaндy |cffffcc00-c|r в нaчaлe игpы.|nВтopoй мoдификaтop - |cffffcc00Зoлoтo Пopoвнy|r, игpoки нe бyдyт пoлyчaть индивидyaльныe нaгpaды ввидe зoлoтa зa yбийcтвo мoнcтpoв, вмecтo этoгo вce пpизoвыe pecypcы бyдyт дeлить мeждy игpoкaми пopoвнy. Этoт мoдификaтop пoвышaeт чyвcтвo oтвeтcтвeннocти пepeд кoмaндoй, для eгo aктивaции нyжнo ввecти |cffffcc00-з|r.","ReplaceableTextures\\CommandButtons\\BTNSorceressMaster.blp")	call CreateQuestBJ(0,"Oдинoчнaя игpa","B oдинoчнoм peжимe дocтyпeн тecтoвый peжим c нecкoлькими дoпoлнитeльными мoдификaтopaми, cпocoбными oблeгчить пpoдвижeниe пo игpe. Для aктивaции тecтoвoгo peжимa нeoбхoдимo ввecти кoмaндy |cffffcc00-т|r, пocлe чeгo cтaнyт дocтyпны cлeдyющиe вoзмoжнocти:|n1. Пoлyчить 100000 pecypcoв - кoмaндa |cffffcc00-p|r|n2. Уcтaнoвить ypoвeнь гepoя нa зaдaннoe знaчeниe - кoмaндa |cffffcc00-y|r, чepeз пpoбeл нeoбхoдимo yкaзaть жeлaeмы ypoвeнь, мaкcимaльный ypoвeнь |cffffcc00250|r.|n3. Bыбop любoгo кoличecтвa гepoeв - кoмaндa |cffffcc00-м|r|nПoлyчить oгpoмнyю зaщитy - кoмaндa |cffffcc00-з|r","ReplaceableTextures\\CommandButtons\\BTNSorceressMaster.blp")	call CreateQuestBJ(2,"Команды игрока","Игpoкaм дocтyпны дoпoлнитeльные кoмaнды:|n1. |cffffcc00Oбмeн гepoями|r c дpyгими игpoкaми. Чтoбы пpeдлoжить oбмeн нyжнo ввecти кoмaндy |cffffcc00-oб|r и дoбaвить нoмep игрoкa чepeз пpoбeл. Для пpeдлoжeния oбмeнa cpaзy вceм игpoкaм ecть кoмaндa |cffffcc00-oбв|r. Для oтмeны - |cffffcc00-oбн|r|n2. Bыбop |cffffcc00cлyчaйнoгo гepoя|r - кoмaндa |cffffcc00-c|r|n3. |cffffcc00Teлeпopтaция|r в цeнтp apeны - клaвишa |cffffcc00Esc|r или кoмaндa |cffffcc00-тп|r|n4. Bывecти |cffffcc00cкopocть пepeдвижeния|r гepoя - кoмaндa |cffffcc00-cп|r|n5. |cffffcc00Пepeвыбop гepoя|r - кoмaндa |cffffcc00-pe|r|n6. |cffffcc00Oчиcткa экpaнa|r - кoмaндa |cffffcc00-o|r|n7. Измeнeниe |cffffcc00выcoты oбзopa|r - кoмaндa |cffffcc00-зyм|r co знaчeниeм oт 1 дo 100 чepeз пpoбeл","ReplaceableTextures\\CommandButtons\\BTNBansheeMaster.blp")	call CreateQuestBJ(2,"Peйтинг","Очки рейтинга служат главным показателем лидерства гладиатора. За убийство каждого монстра даётся по 2 очка, за бocca монстров - 20. Кaждый пoлyчeнный ypoвeнь дaeт 30, a cмepть oтнимaeт 15. 1% yлyчшeния дaeт 7 peйтингa.|n","ReplaceableTextures\\CommandButtons\\BTNBansheeMaster.blp")	call CreateQuestBJ(2,"Ocoбeннocти","Для |cffffcc00Oхoтницы|r opбы пpeдмeтoв Cфepы oгня, Cфepы льдa, Meчa льдa, Жeзлa oгня нe paбoтaют или вooбщe нapyшaют нopмaльнyю paбoтy aтaки. Пpeдмeты, oблaдaющиe вepoятнocтью кpитичecкoгo yдapa или oглyшeния cpaбaтывaют тoлькo нa пepвoм юнитe, пpи этoм дaльнeйший oтcкoк чaкpyмa пpeкpaщaeтcя. Вaмпиpизм тaкжe cpaбaтывaeт тoлькo нa пepвoй цeли, нo oтcкoк пpoдoлжaeтcя.|nВзaимoпoдaвлeниe |cffffcc00вaмпиpизмa|r: Meч Кpoви пoдaвляeт Кoпьe Aлaнитa, Cпocoбнocть вaмпиpa пoдaвляeт и Кoпьe Aлaнитa и Meч Кpoви, Знaмя пoбeды нe пoдaвляeт дpyгoй вaмпиpизм.|n1|cffffcc00Чyжиe пpeдмeты|r, кpoмe нaпиткoв и эликcиpoв, пoдбиpaть или пepeдaвaть нeльзя.","ReplaceableTextures\\CommandButtons\\BTNBansheeMaster.blp")		call CreateQuestBJ(2,"Пoдcкaзки","Чeм мeньшe глaдиaтopoв нa apeнe, тeм мeньшe oпытa oни пoлyчaют|nПoлeзныe pyны в cлyчaйнoм мecтe apeнe пoявляютcя кaждyю минyтy.|nБoчки co взpывчaткoй мoмeнтaльнo yбивaют мoнтpoв нeпoдaлёкy, ecли их paзpyшить, нo нaгpaдa ввидe oпытa и pecypcoв зa них тepяeтcя.|nБoльшoй мaccив бoчeк в yглy кapты мoжeт cлyжить нaибoллe нaдёжным yкpытиeм нa apeнe.|Heльзя нocить бoльшe oднoгo Дocпeхa Бoгa, мoжнo нocить тoлькo oдин Щит Pыцapя или тoлькo oднy Киpacy Pыцapя. Heльзя нocить Гипep Caпoги и Caпoги Heвидиcки oднoвpeмeннo.","ReplaceableTextures\\CommandButtons\\BTNBansheeMaster.blp")	call CreateQuestBJ(2,"Блaгoдapнocти","Лицeю №153 - зa идeю coздaния кapты (в чacтнocти Эмилю: [ILoveMorning])|nВceм пoльзoвaтeлям caйтa lifeinarena.ru - \"Жизнь нa apeнe\" зa oгpoмнyю пoмoщь в yлyчшeнии кapты.|nAnubizz'y - зa caйт.|nperimetral'y - зa пoмoщь c jass и гepoя Aнтapo.|nSeymoR'y - зa идeю coздaния Бepcepкepa и Гopнoгo кopoля.|nKsan'y - зa идeю coздaния Шeдoy-Macтepa.|nMиcтepCтpaх'y - зa идeю coздaния Хpaнитeля Poщи.|nCommandos'y - зa идeю coздaния Oхoтницы.|nDoctorGester'y - зa cиcтeмy debug log (-dl).|nВceм тecтepaм:  xeno, Bastel, L@nceR, (D)e[X]e(L), abrams, Adrenalin, begyn_po_jizni, EviLiK, Guard, IIpauD, Unnikum, voa, _Arantir_, FLESHNIK, Tails, Yagosha, zzzLonerzzz, Xan4es, Commandos, Bloody, tifozzi1, Much2Much, s1ander","ReplaceableTextures\\CommandButtons\\BTNBansheeMaster.blp")	call CreateQuestBJ(2,"Tpaнcлит","Вce стоит писать русскими буквами, однако, для большинства команд предусмотрет латинский эквивалент для дополнительного удобства. Ниже перечислены команды с их эквивалентами в скобках:|nв (v),c (c),з (z),cп (sp),тп (tp), oб (ob),oбв (obv),-п (-p)|nкик (kick),дa (yes), нeт (no),cтoп кик (stop kick),т (t), p (r), y xxx (y xxx), м (m), з (z), pe (re)","ReplaceableTextures\\CommandButtons\\BTNBansheeMaster.blp")endfunctionfunction Df takes nothing returns nothing	local timer t=GetExpiredTimer()	if Xx==false then		call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,5.5,"|cff32cd32ПОДСКАЗКА:|r Выберите героя в тавернах или используйте команду |cffffcc00-c|r чтобы получить случайного героя.")	endif	call DestroyTimer(t)	set t=nullendfunctionfunction Ff takes nothing returns nothing	local timer t=GetExpiredTimer()	if Sx then		call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,5.5,"|cff32cd32ПОДСКАЗКА:|r Можно поменяться героями с другими игроками, использовав команду |cffffcc00-об|r")	endif	call DestroyTimer(t)	set t=nullendfunctionfunction gf takes nothing returns nothing	local timer t=GetExpiredTimer()	if Ox==false and fv==1 then		call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,10,"|cff32cd32ПОДСКАЗКА:|r в одиночной игре можете включить тестовый режим командой |cffffcc00-т|r. Подробнее об этом жежиме смотрите раздел информации.")	endif	call DestroyTimer(t)	set t=nullendfunctionfunction MakeRandomRuneInArea takes real x,real y returns nothing	local itempool runes=CreateItemPool()	call ItemPoolAddItemType(runes,'rsps',1)	call ItemPoolAddItemType(runes,'rres',1)	call ItemPoolAddItemType(runes,'rhe2',1)	call ItemPoolAddItemType(runes,'rman',1)	call ItemPoolAddItemType(runes,'rspd',1)	call ItemPoolAddItemType(runes,'gold',.5)	call ItemPoolAddItemType(runes,'vamp',1)	call ItemPoolAddItemType(runes,'tdex',1)	call ItemPoolAddItemType(runes,'tint',1)	call ItemPoolAddItemType(runes,'tstr',1)	call ItemPoolAddItemType(runes,'lmbr',.5)	call ItemPoolAddItemType(runes,'rspl',1)	call PlaceRandomItem(runes,x,y)	call DestroyItemPool(runes)endfunctionfunction MakeTaverns takes nothing returns nothing	set g_taverns[1]=CreateUnit(Player(15),'n02L',2880.0,-2640.0,270)	call AddUnitToStock(g_taverns[1],'N00U',0,1)	call AddUnitToStock(g_taverns[1],'H00F',0,1)	call AddUnitToStock(g_taverns[1],'N00T',0,1)	call AddUnitToStock(g_taverns[1],'O000',0,1)	call AddUnitToStock(g_taverns[1],'H005',0,1)	call AddUnitToStock(g_taverns[1],'H008',0,1)	call AddUnitToStock(g_taverns[1],'H00Z',0,1)	call AddUnitToStock(g_taverns[1],'O004',0,1)	set g_taverns[2]=CreateUnit(Player(15),'n000',2880.0,-3280.0,270)	call AddUnitToStock(g_taverns[2],'H00M',0,1)	call AddUnitToStock(g_taverns[2],'O003',0,1)	call AddUnitToStock(g_taverns[2],'O005',0,1)	call AddUnitToStock(g_taverns[2],'E007',0,1)	call AddUnitToStock(g_taverns[2],'E00C',0,1)	call AddUnitToStock(g_taverns[2],'U000',0,1)	call AddUnitToStock(g_taverns[2],'U00B',0,1)	set g_taverns[3]=CreateUnit(Player(15),'n02M',2496.0,-2640.0,270)	call AddUnitToStock(g_taverns[3],'O001',0,1)	call AddUnitToStock(g_taverns[3],'O00B',0,1)	call AddUnitToStock(g_taverns[3],'E003',0,1)	call AddUnitToStock(g_taverns[3],'H000',0,1)	call AddUnitToStock(g_taverns[3],'E000',0,1)	call AddUnitToStock(g_taverns[3],'N01I',0,1)	call AddUnitToStock(g_taverns[3],'H003',0,1)	set g_taverns[4]=CreateUnit(Player(15),'n003',2496.0,-3280.0,270)	call AddUnitToStock(g_taverns[4],'E00D',0,1)	call AddUnitToStock(g_taverns[4],'E004',0,1)	call AddUnitToStock(g_taverns[4],'U005',0,1)	call AddUnitToStock(g_taverns[4],'H006',0,1)	call AddUnitToStock(g_taverns[4],'E006',0,1)	call AddUnitToStock(g_taverns[4],'N02G',0,1)	call AddUnitToStock(g_taverns[4],'E00L',0,1)	call AddUnitToStock(g_taverns[4],'H00U',0,1)	set g_taverns[5]=CreateUnit(Player(15),'n00S',2112.0,-2640.0,270)	call AddUnitToStock(g_taverns[5],'E005',0,1)	call AddUnitToStock(g_taverns[5],'E00B',0,1)	call AddUnitToStock(g_taverns[5],'N00H',0,1)	call AddUnitToStock(g_taverns[5],'H00B',0,1)	call AddUnitToStock(g_taverns[5],'N018',0,1)	call AddUnitToStock(g_taverns[5],'U002',0,1)	call AddUnitToStock(g_taverns[5],'H00A',0,1)	call AddUnitToStock(g_taverns[5],'U00A',0,1)	set g_taverns[6]=CreateUnit(Player(15),'n007',2112.0,-3280.0,270)	call AddUnitToStock(g_taverns[6],'H001',0,1)	call AddUnitToStock(g_taverns[6],'E002',0,1)	call AddUnitToStock(g_taverns[6],'H002',0,1)	call AddUnitToStock(g_taverns[6],'O002',0,1)	call AddUnitToStock(g_taverns[6],'H007',0,1)	call AddUnitToStock(g_taverns[6],'E00F',0,1)	call AddUnitToStock(g_taverns[6],'O00G',0,1)endfunctionfunction MapInit takes nothing returns nothing	local timer t=CreateTimer()	local timer t1=CreateTimer()	local timer t2=CreateTimer()	local timer t3=CreateTimer()	local integer In=1//	local integer i=0	local unit Cf	local item it	local item yc	set g_gate=CreateDestructable('ATg1',-512.,-1408.,270.,.9,0)	call SetDestructableInvulnerable(g_gate,true)	call InitAvalableHeroesPool()	call MakeForest()	call MakeMapInfo()	call MakeTaverns()	call MakeShops()	call Preload("Abilities\\Spells\\Undead\\AnimateDead\\AnimateDeadTarget.mdl")	set Cf=CreateUnit(Player(11),'h00V',0,0,.0)	set it=UnitAddItemById(Cf,'I06Q')	set yc=UnitAddItemById(Cf,'I06Z')	call RemoveUnit(Cf)	set Cf=CreateUnit(Player(11),'h00P',0,0,.0)	call UnitAddAbility(Cf,'A0DH')	call UnitAddAbility(Cf,'A0FB')	call RemoveUnit(Cf)	set Cf=CreateUnit(Player(11),'h00N',0,0,.0)	call UnitAddAbility(Cf,'A0FN')	call RemoveUnit(Cf)	set Cf=CreateUnit(Player(11),'h00Q',0,0,.0)	call RemoveUnit(Cf)	set Cf=CreateUnit(Player(11),'h00O',0,0,.0)	call RemoveUnit(Cf)	set Cf=CreateUnit(Player(11),'h00R',0,0,.0)	call RemoveUnit(Cf)	set Cf=CreateUnit(Player(11),'h010',0,0,.0)	call UnitAddAbility(Cf,'A0B9')	call RemoveUnit(Cf)	set Cf=CreateUnit(Player(11),'H008',0,0,.0)	call UnitAddAbility(Cf,'A0EA')	call UnitAddAbility(Cf,'A0E9')	call UnitAddAbility(Cf,'A0E5')	call UnitAddAbility(Cf,'A07V')	call UnitAddAbility(Cf,'A0HG')	call UnitAddAbility(Cf,'A0I1')	call RemoveUnit(Cf)		loop		exitwhen In>8		set No[In]=CreateFogModifierRect(Player(In-1),FOG_OF_WAR_FOGGED,jr,true,false)		call FogModifierStart(No[In])		set In=In+1	endloop	call md()	call sd()	//call DisplayTextToPlayer(GetLocalPlayer(),0,0,"|cffffcc00Используйте команду -о чтобы очистить экран от сообщений.|R")	call TimerStart(t1,12,false,function Df)	call TimerStart(t2,18,false,function Ff)	call TimerStart(t3,24,false,function gf)	call TimerStart(t,10,false,function bf)	set rA[0]="|c00ff0303"	set rA[1]="|c000042ff"	set rA[2]="|c001ce6b9"	set rA[3]="|c00540081"	set rA[4]="|c00fffc01"	set rA[5]="|c00ff8000"	set rA[6]="|c0020c000"	set rA[7]="|c00e55bb0"	set aA=CreateGroup()	set t=null	set t1=null	set t2=null	set t3=null	set Cf=null	set it=null	set yc=nullendfunctionfunction Hf takes nothing returns nothinglocal integer In=1call RemoveDestructable(SI)call RemoveDestructable(sI)call RemoveDestructable(QI)call RemoveDestructable(YI)call RemoveDestructable(yI)loopexitwhen In>8call ForceAddPlayer(fe,qe[In])call FogModifierStop(No[In])call CreateFogModifierRectBJ(true,Player(In-1),FOG_OF_WAR_VISIBLE,jr)set In=In+1endloopset ae='O006'set bx[1]="Хрустальный арахнид"set bx[2]="Кентавр-воин"set bx[3]="Молодой драконид"set bx[4]="Темный тролль"set bx[5]="Мегабосс"set bx[6]="Дреней-убийца"set bx[7]="Чумной энт"set bx[8]="Властитель"set bx[9]="Дух Океана"set bx[$A]="Мегабосс"set bx[$B]="Опустошитель"set bx[$C]="Беорн"set bx[$D]="Каменный голем"set bx[$E]="Громовая ящерица"set bx[$F]="Мегабосс"set bx[16]="Призрак"set bx[17]="Хвататель"set bx[18]="Морской дракон"set bx[19]="Адский сатир"set Hv[1]='n008'set Hv[2]='n00D'set Hv[3]='n00F'set Hv[4]='n00I'set Hv[5]='n00K'set Hv[6]='n00L'set Hv[7]='n00N'set Hv[8]='n00P'set Hv[9]='n00R'set Hv[$A]='n00Z'set Hv[$B]='n015'set Hv[$C]='n019'set Hv[$D]='n01B'set Hv[$E]='n01D'set Hv[$F]='n017'set Hv[16]='n027'set Hv[17]='n029'set Hv[18]='n02B'set Hv[19]='n02D'set jv[1]='n009'set jv[2]='n00E'set jv[3]='n00G'set jv[4]='n00J'set jv[6]='n00M'set jv[5]='n00K'set jv[7]='n00O'set jv[8]='n00Q'set jv[9]='n00V'set jv[$A]='n00Z'set jv[$B]='n016'set jv[$C]='n01A'set jv[$D]='n01C'set jv[$E]='n01E'set jv[$F]='n017'set jv[16]='n028'set jv[17]='n02A'set jv[18]='n02C'set jv[19]='n01U'endfunction//function Jf takes nothing returns nothing//call PauseUnit(GetEnumUnit(),true)//endfunction//function kf takes nothing returns nothing//local unit u1//local unit u2//local group g=CreateGroup()//call SetPlayerName(Player(8),"Клан Света")//call SetPlayerName(Player($A),"Клан Тьмы")//set u1=CreateUnitAtLoc(Player(8),'h00H',GetRectCenter(Ni),270)//set u2=CreateUnitAtLoc(Player(8),'h00H',GetRectCenter(bi),270)//call SetUnitUserData(u1,9)//call SetUnitUserData(u2,9)//call UnitAddAbility(u2,'A09Z')//call UnitAddAbility(u2,'ANre')//set u1=CreateUnitAtLoc(Player($A),'u006',GetRectCenter(Ii),270)//set u2=CreateUnitAtLoc(Player($A),'u006',GetRectCenter(Ai),270)//call SetUnitUserData(u1,9)//call SetUnitUserData(u2,9)//call UnitAddAbility(u1,'A09Z')//call UnitAddAbility(u1,'ANre')//set Te[1]=ri//set Te[2]=ii//set Te[3]=ai//set Te[4]=ni//set Te[5]=Vi//set Te[6]=Ei//set Te[7]=Xi//set Te[8]=Oi//set Te[9]=Ri//set g=fN(Player($C))//call ForGroup(g,function Jf)//call DestroyGroup(g)//set Hv[1]='n008'//set Hv[2]='n00D'//set Hv[3]='n00F'//set Hv[4]='n00I'//set Hv[5]='n00L'//set Hv[6]='n00N'//set Hv[7]='n00P'//set Hv[8]='n00R'//set Hv[9]='n015'//set Hv[$A]='n019'//set Hv[$B]='n01B'//set Hv[$C]='n01D'//set jv[1]='n009'//set jv[2]='n00E'//set jv[3]='n00G'//set jv[4]='n00J'//set jv[5]='n00M'//set jv[6]='n00O'//set jv[7]='n00Q'//set jv[8]='n00V'//set jv[9]='n016'//set jv[$A]='n01A'//set jv[$B]='n01C'//set jv[$C]='n01E'//set g=null//set u1=null//set u2=null//endfunctionfunction lf takes nothing returns booleanreturn IsUnitAlly(GetAttacker(),GetOwningPlayer(GetTriggerUnit()))endfunctionfunction Lf takes nothing returns nothingcall IssuePointOrderByIdLoc(GetAttacker(),$D0012,GetUnitLoc(GetTriggerUnit()))endfunctionfunction Mf takes nothing returns booleanreturn tv==falseendfunctionfunction pf takes nothing returns nothingcall MakeRandomRuneInArea(GetRandomReal(GetRectMinX(Sr),GetRectMaxX(Sr)),GetRandomReal(GetRectMinY(Sr),GetRectMaxY(Sr)))endfunctionfunction qf takes nothing returns nothinglocal unit u=GetEnteringUnit()call eC(u)set u=nullendfunctionfunction sf takes nothing returns nothinglocal unit u=GetLeavingUnit()call SetUnitMoveSpeed(u,GetUnitDefaultMoveSpeed(u))set u=nullendfunctionfunction tf takes nothing returns booleanreturn Ve==falseendfunctionfunction Tf takes nothing returns nothinglocal integer In=1local integer zb=fvloopexitwhen In>zbcall SetPlayerState(qe[In],PLAYER_STATE_RESOURCE_GOLD,GetPlayerState(qe[In],PLAYER_STATE_RESOURCE_GOLD)+1)set In=In+1endloopendfunctionfunction Uf takes nothing returns nothingcall EnableWeatherEffect(Ie,false)call SetSkyModel("Environment\\Sky\\LordaeronSummerSky\\LordaeronSummerSky.mdl")endfunctionfunction Wf takes nothing returns nothingset Ie=AddWeatherEffect(jr,'RAlr')call EnableWeatherEffect(Ie,true)call SetSkyModel("Environment\\Sky\\FelwoodSky\\FelwoodSky.mdl")endfunctionfunction PlayerPickHost takes nothing returns nothing	local integer i=0	loop		exitwhen i>7		if GetPlayerSlotState(Player(i))==PLAYER_SLOT_STATE_PLAYING and ge[GetPlayerId(Player(i))+1]==false and GetPlayerController(Player(i))!=MAP_CONTROL_COMPUTER then			set g_host=Player(i)			set i=8		endif		set i=i+1	endloop	if GetLocalPlayer()!=g_host then		call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,10,"|cff808080Игрок "+rA[GetPlayerId(g_host)]+GetPlayerName(g_host)+" определит мод.|r")	endif	call DisplayTimedTextToPlayer(g_host,0,0,10,"|cff32cd32ПОДСКАЗКА:|r У вас есть 10 секунд чтобы выбрать режим игры.|R")	call TriggerRegisterPlayerChatEvent(Kn,g_host,"-",false)endfunctionfunction eF takes nothing returns nothing	call DisableTrigger(Kn)	call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,4,"Автоматически установлен режим игры |cffffcc00Выживание|R")	call mD()	call MultiboardSetItemValueBJ(Jv,4,fv+4,"|cffffcc00В|R")	call EnableTrigger(DI)	call EnableTrigger(fI)endfunctionfunction oF takes nothing returns nothing	local string s=GetEventPlayerChatString()	local string rF	local string iF=""	local string aF=""	local string array Jb	local string array nF	local string array VF	local string array EF	local string XF	local string OF	local string array bb	local integer LC=6	local integer In	local integer jc	local integer xc=0	local integer l=StringLength(s)	local integer RF=0	local integer IF=0	local boolean AF=false	local boolean NF=false	local boolean bF=false	local boolean BF=false	local boolean cF=false	local boolean CF=false	local boolean dF=false	local boolean DF=false	local boolean d	local boolean d2//	local integer zb=fv	set Jb[1]="-в"	set Jb[2]="-б"	set Jb[3]="-с"	set Jb[4]="-з"	set Jb[5]="-э"	set Jb[6]="-л"	set nF[1]="-v"	set nF[2]="-b"	set nF[3]="-c"	set nF[4]="-z"	set nF[5]="-e"	set nF[6]="-l"	set VF[1]="Выживание"	set VF[2]="Битва Кланов"	set VF[3]=" + Случайные Герои"	set VF[4]=" + Золото Поровну"	set VF[5]=" + Экстрим"	set VF[6]=" + Легко"	set EF[1]="В"	set EF[2]="Б"	set EF[3]=" + С"	set EF[4]=" + З"	set EF[5]=" + Э"	set EF[6]=" + Л"	set In=0	set jc=0	loop		exitwhen In>=l		set d=SubString(s,In,In+2)=="в"or SubString(s,In,In+2)=="б"or SubString(s,In,In+2)=="с"or SubString(s,In,In+2)=="з"or SubString(s,In,In+2)=="э"or SubString(s,In,In+2)=="л"		set d2=SubString(s,In,In+1)=="v"or SubString(s,In,In+1)=="b"or SubString(s,In,In+1)=="c"or SubString(s,In,In+1)=="z"or SubString(s,In,In+1)=="e"or SubString(s,In,In+1)=="l"or SubString(s,In,In+1)=="-"		if d2 then			set jc=jc+1			set bb[jc]=SubString(s,In,In+1)		else			if d then				set jc=jc+1				set bb[jc]=SubString(s,In,In+2)				set In=In+1			else				return			endif		endif		set In=In+1	endloop	set xc=jc	set jc=1	loop		exitwhen jc>LC		set In=1		set XF=VF[jc]		set OF=EF[jc]		loop			exitwhen In>xc			set rF=bb[In]+bb[In+1]			if rF==Jb[jc]or rF==nF[jc]then				if jc==1 or jc==2 then					if AF==false then						set AF=true					else						return					endif					set IF=IF+1					set RF=jc				endif				if jc==3 then					if NF==false then						set NF=true					else						return					endif					set IF=IF+1				endif				if jc==4 then					if bF==false then						set bF=true						set BF=true					else						return					endif					if RF==2 then						set XF=""						set OF=""						set BF=false						//call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,"|Cffff2400ОШИБКА:|r  недоступен в режиме игры \"-б\" (-b).|R")					else						set IF=IF+1					endif				endif				if jc==5 then					if cF==false then						set cF=true						set CF=true					else						return					endif					if RF==2 then						set XF=""						set OF=""						set CF=false						//call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,"|Cffff0000Дополнительный мод \"-э\" (-e) недоступен в режиме игры \"-б\" (-b).|R")					else						set IF=IF+1					endif				endif				if jc==6 then					if dF==false then						set dF=true						set DF=true						set CF=false					else						return					endif					if RF==2 then						set XF=""						set OF=""						set DF=false						//call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,"|Cffff0000Дополнительный мод \"-л\" (-l) недоступен в режиме игры \"-б\" (-b).|R")					else						set IF=IF+1					endif				endif				set iF=iF+XF				set aF=aF+OF			endif			set In=In+2		endloop		set jc=jc+1	endloop	if iF==""then		return	endif	if AF==false then		set RF=1		set iF="Выживание"		set aF="В"		if NF then			set iF=iF+" + Случайные Герои"			set aF=aF+" + С"		endif		if BF then			set iF=iF+" + Золото Поровну"			set aF=aF+" + З"		endif		if CF then			set iF=iF+" + Экстрим"			set aF=aF+" + Э"		endif		if DF then			set iF=iF+" + Легко"			set aF=aF+" + Л"		endif	endif	if RF==1 then		call mD()	else		if RF==2 then			if qv<=1 then				call DisplayTextToPlayer(GetLocalPlayer(),0,0,"|Cffff2400ОШИБКА:|r Режим игры |cffffcc00Битва Кланов|r не доступен.")				return			else				call DisplayTextToPlayer(GetLocalPlayer(),0,0,"|Cffff2400ОШИБКА:|r Режим игры |cffffcc00Битва Кланов|r не доступен.")				//call Hc()				//call uB()			endif		endif	endif	if NF then		call ec()	endif	if CF then		set uo=true		set do=.7		call vc()	endif	if BF then		set er=true		call SetPlayerFlagBJ(PLAYER_STATE_GIVES_BOUNTY,false,Player(11))	endif	if DF then		set Xr=true		set do=1.8	endif	call DisableTrigger(Kn)	call DisableTrigger(kn)	call EnableTrigger(DI)	call EnableTrigger(fI)	call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,rA[GetPlayerId(g_host)]+GetPlayerName(g_host)+" |Rвыбрал режим игры |cffffcc00"+iF+"|R")	if RF==1 then		call MultiboardSetItemValueBJ(Jv,4,fv+4,"|cffffcc00"+aF+"|R")	else		call MultiboardSetItemValueBJ(Jv,4,fv+6,"|cffffcc00"+aF+"|R")	endif	set XF=null	set s=null	set rF=null	set iF=null	set aF=nullendfunctionfunction FF takes nothing returns boolean	return((IsUnitType(GetSoldUnit(),UNIT_TYPE_HERO))!=null)!=nullendfunction// Выбор героя в тавернеfunction PickHeroInTavern takes nothing returns nothing	local unit hero = GetSoldUnit()	local integer uid = GetUnitTypeId(hero)	local unit tavern = GetSellingUnit()	local player p = GetOwningPlayer(hero)	local integer In = 1 //счетчик	local integer zb = fv	local integer ss = xC(hero) //возвращает индекс героя в массиве	call RemoveUnitFromStock(tavern,uid)	call UnitPoolRemoveUnitType(avalable_heroes, uid)	call SetUnitPosition(hero, GetRandomInt(1824, 2848), -2930)	//	if tavern==g_taverns[6]then//		call SetUnitPositionLoc(hero,GetRectCenter(fi))//	endif//	if tavern==g_taverns[4]then//		call SetUnitPositionLoc(hero,GetRectCenter(di))//	endif//	if tavern==g_taverns[2]then//		call SetUnitPositionLoc(hero,GetRectCenter(Di))//	endif		call SaveUnitHandle(wx,StringHash("HeroInit"),0,hero)	call ExecuteFunc("HeroInit"+I2S(GetUnitTypeId(hero)))		if p!=Player($F)then		set Je[GetPlayerId(p)+1]=ss		set ke[GetPlayerId(p)+1]=true		loop			exitwhen In>zb			if p==qe[In]then				call SetUnitUserData(hero,In)				set gv[In]=hero				set To[In]=true				set ie[In]=ss			endif			set In=In+1		endloop		call SelectUnitForPlayerSingle(hero,p)		call PanCameraToTimedLocForPlayer(p,GetUnitLoc(hero),0)		call SetPlayerName(p,GetPlayerName(p)+" ("+GetUnitName(hero)+")")		if Sx then			call TriggerExecute(RR)		endif	endif	set hero=null	set tavern=null	set p=nullendfunctionfunction HF takes nothing returns nothinglocal unit u=GetRevivingUnit()local player p=GetOwningPlayer(u)local integer DC=GetUnitUserData(u)set To[DC]=truecall GroupRemoveUnit(rr,u)call SelectUnitForPlayerSingle(u,p)if RectContainsUnit(ui,u)thencall SetUnitPositionLoc(u,GetRectCenter(Ti))call PanCameraToTimedLocForPlayer(p,GetRectCenter(Ti),0)endifif RectContainsUnit(Hr,u)thencall SetUnitMoveSpeed(u,500.)endifset u=nullset p=nullendfunctionfunction KF takes nothing returns booleanreturn GetSpellAbilityId()=='A0IE' or GetSpellAbilityId()=='A026'endfunctionfunction lF takes nothing returns booleanreturn IsUnitEnemy(GetFilterUnit(),GetOwningPlayer(Ir))endfunctionfunction LF takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer Gb=GetHandleId(t)local integer In=LoadInteger(wx,Gb,1)local unit u=LoadUnitHandle(wx,Gb,3)local real Gd=LoadReal(wx,Gb,4)local unit flocal unit c=Irlocal location T=GetUnitLoc(u)local group g=CreateGroup()call GroupEnumUnitsInRangeOfLoc(g,T,$A0,Condition(function lF))call RemoveLocation(T)call GroupRemoveUnit(g,u)set f=FirstOfGroup(g)loopexitwhen f==nullcall UnitDamageTarget(c,f,Gd,false,false,null,DAMAGE_TYPE_MAGIC,null)call GroupRemoveUnit(g,f)set f=FirstOfGroup(g)endloopcall DestroyGroup(g)if In==16 or GetWidgetLife(u)<=.405 thencall FlushChildHashtable(wx,Gb)call DestroyTimer(t)call UnitRemoveAbility(u,'A05I')call SetPlayerAbilityAvailable(GetOwningPlayer(u),'A05I',true)elsecall SaveInteger(wx,Gb,1,In+1)endifset t=nullset u=nullset c=nullset T=nullset g=nullendfunctionfunction mF takes nothing returns reallocal integer Hb=GetUnitAbilityLevel(Ir,'A0IE')if Hb==0 thenset Hb=GetUnitAbilityLevel(Ir,'A026')if Hb==1 thenreturn 40.elseif Hb==2 thenreturn 70.elsereturn 100.endifelseif Hb==1 thenreturn 20.elseif Hb==2 thenreturn 40.elsereturn 80.endifendifendfunctionfunction MF takes nothing returns nothinglocal unit u=GetSpellTargetUnit()local timer t=CreateTimer()local integer Gb=GetHandleId(t)call SaveInteger(wx,Gb,1,1)call SaveUnitHandle(wx,Gb,3,u)call SaveReal(wx,Gb,4,mF())call TimerStart(t,.5,true,function LF)call TriggerSleepAction(.01)call UnitAddAbility(u,'A05I')call SetPlayerAbilityAvailable(GetOwningPlayer(u),'A05I',false)set t=nullset u=nullendfunctionfunction pF takes nothing returns nothinglocal integer fd=GetUnitAbilityLevel(GetTriggerUnit(),'A08X')if GetLearnedSkill()=='A08X' thencall EnableTrigger(Pn)call UnitAddAbility(GetTriggerUnit(),'A08W')call SetUnitAbilityLevel(GetTriggerUnit(),'A08W',fd)if fd==3 thencall DestroyTrigger(pn)endifendifendfunctionfunction PF takes nothing returns booleanreturn IsUnitAlly(GetFilterUnit(),GetOwningPlayer(Ir))==falseendfunctionfunction qF takes nothing returns nothingcall EnableTrigger(Pn)call DestroyTimer(GetExpiredTimer())endfunctionfunction QF takes nothing returns booleanreturn GetUnitAbilityLevel(GetTriggerUnit(),'B03W')>0 and GetRandomInt(0,'d')<=$A+GetUnitAbilityLevel(Ir,'A0IF')and IsUnitEnemy(GetAttacker(),GetOwningPlayer(Ir))endfunctionfunction sF takes nothing returns nothinglocal unit uA=GetAttacker()local unit c=Irlocal location SF=GetUnitLoc(uA)local integer fd=GetUnitAbilityLevel(c,'A08X')local real Gdlocal unit flocal group g=CreateGroup()call TimerStart(CreateTimer(),2.5-fd/2,false,function qF)call DisableTrigger(Pn)set Gd=(fd+2)*GetHeroInt(c,false)call UnitDamageTarget(c,uA,Gd,false,false,null,DAMAGE_TYPE_MAGIC,null)call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\Monsoon\\MonsoonBoltTarget.mdl",uA,"origin"))set f=CreateUnitAtLoc(GetOwningPlayer(c),'h011',GetUnitLoc(uA),GetUnitFacing(uA))call UnitAddAbility(f,'Aprg')call IssueTargetOrderById(f,$D008F,uA)call UnitApplyTimedLife(f,'BTLF',.1)set Gd=Gd/2call GroupEnumUnitsInRangeOfLoc(g,SF,$C8,Condition(function PF))call RemoveLocation(SF)loopset f=FirstOfGroup(g)exitwhen f==nullcall UnitDamageTarget(c,f,Gd,true,false,null,DAMAGE_TYPE_MAGIC,null)call GroupRemoveUnit(g,f)endloopcall DestroyGroup(g)set uA=nullset c=nullset SF=nullset f=nullset g=nullendfunctionfunction tF takes nothing returns booleanreturn GetSpellAbilityId()=='A0IF'endfunctionfunction TF takes nothing returns booleanif IsUnitEnemy(GetFilterUnit(),IA)thencall IssueTargetOrderById(RA,$D0206,GetFilterUnit())endifreturn falseendfunctionfunction uF takes nothing returns nothingset IA=GetOwningPlayer(GetSpellAbilityUnit())set RA=CreateUnit(IA,'h011',.0,.0,.0)call UnitAddAbility(RA,'A0I0')call SetUnitAbilityLevel(RA,'A0I0',GetUnitAbilityLevel(GetSpellAbilityUnit(),'A0IF'))call UnitApplyTimedLife(RA,'BTLF',.1)call GroupEnumUnitsInRange(aA,GetSpellTargetX(),GetSpellTargetY(),500.,Condition(function TF))set bj_lastCreatedUnit=CreateUnit(IA,'h00O',GetSpellTargetX(),GetSpellTargetY(),.0)call UnitApplyTimedLife(bj_lastCreatedUnit,'BTLF',.5)endfunctionfunction UF takes nothing returns nothinglocal integer wF=GetLearnedSkill()if wF=='A006' or wF=='A0I8' thenset AA=GetLearnedSkillLevel()endifif GetLearnedSkillLevel()==3 thencall DestroyTrigger(Qn)endifendfunctionfunction WF takes nothing returns booleanreturn GetSpellAbilityId()=='A09F' or GetSpellAbilityId()=='A0EU'endfunctionfunction yF takes nothing returns nothingcall SetPlayerAbilityAvailable(GetOwningPlayer(Ar),'A0IH',true)call UnitRemoveAbility(Ar,'A0IH')call EnableTrigger(sn)call DestroyTimer(GetExpiredTimer())endfunctionfunction YF takes nothing returns nothinglocal unit zF=Arlocal real ZF=15.01+GetUnitAbilityLevel(zF,GetSpellAbilityId())*5call TriggerSleepAction(.01)if AA>0 thencall DisableTrigger(sn)call UnitAddAbility(zF,'A0IH')call SetPlayerAbilityAvailable(GetOwningPlayer(zF),'A0IH',false)call UnitMakeAbilityPermanent(zF,true,'A0IH')call UnitMakeAbilityPermanent(zF,true,'A0II')call TimerStart(CreateTimer(),ZF,false,function yF)endifset zF=nullendfunctionfunction vg takes nothing returns nothinglocal unit u=GetTriggerUnit()local unit fif GetUnitAbilityLevel(u,'BNba')>0 thenif GetWidgetLife(u)-GetEventDamage()<=.405 thenset f=CreateUnit(GetOwningPlayer(Ar),GetUnitTypeId(u),GetUnitX(u),GetUnitY(u),GetUnitFacing(u))call UnitApplyTimedLife(f,'BUan',4+GetUnitAbilityLevel(Ar,'A006'))call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\AnimateDead\\AnimateDeadTarget.mdl",f,"origin"))endifendifset u=nullset f=nullendfunctionfunction eg takes nothing returns booleanreturn((GetAttacker()==Ar and IsUnitType(GetTriggerUnit(),UNIT_TYPE_HERO)==false and IsUnitType(GetTriggerUnit(),UNIT_TYPE_MECHANICAL)==false and IsUnitType(GetTriggerUnit(),UNIT_TYPE_MAGIC_IMMUNE)==false)!=null)!=nullendfunctionfunction xg takes nothing returns nothingif HaveSavedInteger(wx,GetHandleId(GetTriggerUnit()),3)==false thencall TriggerRegisterUnitEvent(NA,GetTriggerUnit(),EVENT_UNIT_DAMAGED)call SaveInteger(wx,GetHandleId(GetTriggerUnit()),3,0)endifendfunctionfunction rg takes nothing returns booleanreturn(((GetSpellAbilityId()=='A006' or GetSpellAbilityId()=='A0I8')and IsUnitType(GetSpellAbilityUnit(),UNIT_TYPE_HERO)==false)!=null)!=nullendfunctionfunction ig takes nothing returns nothingif HaveSavedInteger(wx,GetHandleId(GetSpellTargetUnit()),3)==false thencall TriggerRegisterUnitEvent(NA,GetSpellTargetUnit(),EVENT_UNIT_DAMAGED)call SaveInteger(wx,GetHandleId(GetSpellTargetUnit()),3,0)endifendfunctionfunction ag takes nothing returns booleanreturn GetWidgetLife(Er)>=.405 and not(LoadBoolean(eA,GetHandleId(Er),$A))endfunctionfunction ng takes nothing returns nothinglocal real OD=GetUnitState(Er,UNIT_STATE_MAX_LIFE)if ZI>OD thenset ZI=ZI-(ZI/OD)call SetTextTagText(LoadTextTagHandle(eA,GetHandleId(Er),$C),I2S(R2I(ZI)),Lb(0,"texttagsize")*.0023)endifendfunctionfunction Vg takes nothing returns nothinglocal unit u//local integer Hbif GetLearnedSkill()=='A0HV' thenset u=GetLearningUnit()call TriggerRegisterUnitEvent(Wn,u,EVENT_UNIT_DAMAGED)call DestroyTrigger(wn)endifset u=nullendfunctionfunction Eg takes nothing returns nothinglocal unit Xg=GetEventDamageSource()local unit ed=GetTriggerUnit()local real Gd=GetEventDamage()local integer VC=GetRandomInt(1,'d')local integer Hb=GetUnitAbilityLevel(ed,'A0HV')if VC<=3*Hb+7 thencall DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\Stampede\\StampedeMissileDeath.mdl",Xg,"origin"))call UnitDamageTarget(ed,Xg,Gd,true,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_NORMAL,WEAPON_TYPE_WHOKNOWS)endifset Xg=nullset ed=nullendfunctionfunction Og takes nothing returns booleanreturn GetLearnedSkill()=='A0HW'endfunctionfunction Rg takes nothing returns nothinglocal unit u=GetLearningUnit()local player p=GetOwningPlayer(u)local integer sb=GetHandleId(u)call EnableTrigger(Yn)call EnableTrigger(zn)call TriggerRegisterPlayerChatEvent(zn,p,"-с",true)call TriggerRegisterPlayerChatEvent(zn,p,"-str",true)call DisplayTextToPlayer(p,0,0,"|cffffcc00Вводите -с(-str) чтобы узнать количество наращенной силы.|R")call DestroyTrigger(yn)set p=nullset u=nullendfunctionfunction Ig takes nothing returns booleanreturn GetKillingUnit()==Erendfunctionfunction Ag takes nothing returns nothinglocal unit Ng=GetKillingUnit()local unit bg=GetDyingUnit()local integer dd=GetHeroStr(Ng,false)local integer Hb=GetUnitAbilityLevel(Ng,'A0HW')local integer sb=GetHandleId(Ng)if(IsUnitIllusion(bg)==false)and(IsUnitAlly(bg,GetOwningPlayer(Ng))==false)thenset Rr=Rr+1if IsUnitType(bg,UNIT_TYPE_HERO)or GetUnitUserData(bg)==1 or GetUnitUserData(bg)==2 thencall SaveInteger(wx,sb,$F,LoadInteger(wx,sb,$F)+Hb)call SetHeroStr(Ng,dd+Hb,true)call qD("+"+I2S(Hb)+"("+I2S(LoadInteger(wx,sb,$F))+")",$A,GetWidgetX(GetTriggerUnit())+30,GetWidgetY(GetTriggerUnit()),75,0,'f',.01,4)elseif Rr>=(7-Hb)thencall SetHeroStr(Ng,dd+1,true)call SaveInteger(wx,sb,$F,LoadInteger(wx,sb,$F)+1)call qD("+1("+I2S(LoadInteger(wx,sb,$F))+")",$A,GetWidgetX(GetTriggerUnit())+30,GetWidgetY(GetTriggerUnit()),75,0,'f',.01,4)set Rr=0endifendifset Ng=nullset bg=nullendfunctionfunction Bg takes nothing returns nothingcall DisplayTextToPlayer(GetTriggerPlayer(),0,0,"Дополнительная сила: |Cffff0000"+I2S(LoadInteger(wx,GetHandleId(Er),$F))+"|R ед.")endfunctionfunction cg takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer Gb=GetHandleId(t)local unit c=LoadUnitHandle(wx,1,Gb)call PauseUnit(c,true)call FlushChildHashtable(wx,Gb)call DestroyTimer(t)set t=nullset c=nullendfunctionfunction Cg takes nothing returns nothinglocal unit Xg=GetEventDamageSource()local unit ed=GetTriggerUnit()local player plocal integer Hblocal group glocal location Tlocal unit flocal integer Inlocal real Gdlocal timer tlocal integer Gblocal unit clocal boolean bif GetUnitTypeId(Xg)=='E000' or GetUnitTypeId(Xg)=='E001' thencall TriggerSleepAction(.01)set p=GetOwningPlayer(Xg)set Hb=GetUnitAbilityLevel(Xg,'A02B')set g=CreateGroup()set T=GetUnitLoc(ed)call GroupEnumUnitsInRangeOfLoc(g,T,$82,null)call RemoveLocation(T)loopset f=FirstOfGroup(g)exitwhen f==nullset b=((GetUnitTypeId(Xg)=='E000' and f!=ed)or(GetUnitTypeId(Xg)=='E001'))if IsUnitEnemy(f,p)and GetWidgetLife(f)>.405 and b thencall UnitRemoveAbility(f,'B03I')set T=GetUnitLoc(f)set c=CreateUnitAtLoc(p,'h010',T,0)call SetUnitPathing(c,false)call RemoveLocation(T)call UnitAddAbility(c,'A0B9')call SetUnitAbilityLevel(c,'A0B9',Hb)call IssueTargetOrderById(c,$D000F,f)set t=CreateTimer()set Gb=GetHandleId(t)call SaveUnitHandle(wx,1,Gb,c)call TimerStart(t,.5,false,function cg)set t=CreateTimer()set Gb=GetHandleId(t)call SaveUnitHandle(wx,1,Gb,c)call TimerStart(t,4.5,false,function gb)set t=nullendifcall GroupRemoveUnit(g,f)endloopcall DestroyGroup(g)call DestroyTrigger(Uo)endifset c=nullset Xg=nullset ed=nullset p=nullset g=nullset T=nullset f=nullendfunctionfunction dg takes nothing returns booleanreturn((GetUnitTypeId(GetAttacker())=='E000' or GetUnitTypeId(GetAttacker())=='E001')and(GetUnitAbilityLevel(GetAttacker(),'A02B')>0))endfunctionfunction Dg takes nothing returns booleanreturn GetUnitTypeId(GetSpellAbilityUnit())=='E000' or GetUnitTypeId(GetSpellAbilityUnit())=='E001'endfunctionfunction fg takes nothing returns nothinglocal trigger qB=Uolocal integer QB=GetHandleId(qB)local trigger t=LoadTriggerHandle(wx,1,QB)call DestroyTrigger(t)call DestroyTrigger(qB)set t=nullset qB=nullendfunctionfunction Fg takes nothing returns nothinglocal trigger qB=CreateTrigger()local integer QBlocal integer Af=0local integer zb=16local trigger Jbcall TriggerAddAction(qB,function fg)loopexitwhen Af==zbcall TriggerRegisterPlayerUnitEvent(qB,Player(Af),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set Af=Af+1endloopcall TriggerAddCondition(qB,Condition(function Dg))set QB=GetHandleId(Uo)set Jb=LoadTriggerHandle(wx,1,QB)call DestroyTrigger(Jb)call DestroyTrigger(Uo)set Uo=CreateTrigger()set QB=GetHandleId(Uo)call SaveTriggerHandle(wx,1,QB,qB)call TriggerRegisterUnitEvent(Uo,GetTriggerUnit(),EVENT_UNIT_DAMAGED)call TriggerAddAction(Uo,function Cg)set Jb=nullset qB=nullendfunctionfunction Gg takes nothing returns booleanreturn GetSpellAbilityId()=='A0G8'endfunctionfunction hg takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer Gb=GetHandleId(t)local group g=CreateGroup()local group g2=CreateGroup()local integer In=LoadInteger(wx,1,Gb)local integer xc=LoadInteger(wx,2,Gb)local unit u=LoadUnitHandle(wx,3,Gb)local integer Hb=GetUnitAbilityLevel(u,'A0G8')local real Gdlocal unit fset g=LoadGroupHandle(wx,4,Gb)if In>xc or FirstOfGroup(g)==null thencall DestroyGroup(g)call DestroyTimer(t)elseset g2=ZC(g)loopset f=FirstOfGroup(g2)exitwhen f==nullset Gd=20*Hbif GetWidgetLife(f)>.405 thencall UnitDamageTarget(u,f,Gd,true,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_MAGIC,WEAPON_TYPE_WHOKNOWS)elsecall GroupRemoveUnit(g,f)endifcall GroupRemoveUnit(g2,f)endloopcall SaveInteger(wx,1,Gb,In+1)endifcall DestroyGroup(g2)set t=nullset g=nullset g2=nullset u=nullset f=nullendfunctionfunction Hg takes nothing returns nothinglocal unit u=GetSpellAbilityUnit()local integer Hb=GetUnitAbilityLevel(u,'A0G8')local player p=GetOwningPlayer(u)local location L=GetSpellTargetLoc()local timer t=CreateTimer()local integer Gb=GetHandleId(t)local timer jglocal integer Jglocal group g=CreateGroup()local group gg=CreateGroup()local unit flocal unit ccall GroupEnumUnitsInRangeOfLoc(g,L,$FA,null)set gg=ZC(g)call RemoveLocation(L)loopset f=FirstOfGroup(g)exitwhen f==nullif IsUnitEnemy(f,p)and GetWidgetLife(f)>.405 thenset jg=CreateTimer()set Jg=GetHandleId(jg)set L=GetUnitLoc(f)set c=CreateUnitAtLoc(p,'h00P',L,0)call RemoveLocation(L)call UnitAddAbility(c,'A0G9')call SetUnitAbilityLevel(c,'A0G9',Hb)call IssueTargetOrderById(c,$D00DE,f)call SaveUnitHandle(wx,1,Jg,c)call TimerStart(jg,1,false,function gb)set jg=nullelsecall GroupRemoveUnit(gg,f)endifcall GroupRemoveUnit(g,f)endloopcall DestroyGroup(g)call SaveInteger(wx,1,Gb,1)call SaveInteger(wx,2,Gb,6)call SaveUnitHandle(wx,3,Gb,u)call SaveGroupHandle(wx,4,Gb,gg)call TimerStart(t,1,true,function hg)set u=nullset p=nullset L=nullset t=nullset jg=nullset g=nullset gg=nullset f=nullset c=nullendfunctionfunction kg takes nothing returns booleanreturn GetSpellAbilityId()=='A0FU'endfunctionfunction Kg takes nothing returns booleanreturn GetUnitAbilityLevel(GetAttacker(),'B03F')>0endfunctionfunction lg takes nothing returns nothinglocal trigger qB=GetTriggeringTrigger()local integer QB=GetHandleId(qB)local unit Lg=GetAttacker()local unit u=LoadUnitHandle(wx,1,QB)local integer Hb=GetUnitAbilityLevel(u,'A0FU')local real Gdif Hb==1 thenset Gd=30elseif Hb==2 thenset Gd=60elseset Gd='x'endifendifcall UnitDamageTarget(u,Lg,Gd,true,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_MAGIC,WEAPON_TYPE_WHOKNOWS)set qB=nullset Lg=nullset u=nullendfunctionfunction mg takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer Gb=GetHandleId(t)local trigger qB=LoadTriggerHandle(wx,1,Gb)local integer QB=GetHandleId(qB)call DestroyTrigger(qB)call FlushChildHashtable(wx,Gb)call FlushChildHashtable(wx,QB)call DestroyTimer(t)set t=nullset qB=nullendfunctionfunction Mg takes nothing returns nothinglocal unit u=GetSpellAbilityUnit()local player p=GetOwningPlayer(u)local location L=GetSpellTargetLoc()local integer Hb=GetUnitAbilityLevel(u,'A0FU')local unit c=CreateUnitAtLoc(p,'h00P',L,0)local timer pg=CreateTimer()local integer Pg=GetHandleId(pg)local trigger qB=CreateTrigger()local integer QB=GetHandleId(qB)local integer Af=0local integer zb=16local timer t=CreateTimer()local integer Gb=GetHandleId(t)call RemoveLocation(L)call UnitAddAbility(c,'A0G0')call SetUnitAbilityLevel(c,'A0G0',Hb)call IssueImmediateOrderById(c,$D011D)call SaveUnitHandle(wx,1,Pg,c)call TimerStart(pg,2,false,function gb)call SaveUnitHandle(wx,1,QB,u)loopexitwhen Af==zbcall TriggerRegisterPlayerUnitEvent(qB,Player(Af),EVENT_PLAYER_UNIT_ATTACKED,null)set Af=Af+1endloopcall TriggerAddCondition(qB,Condition(function Kg))call TriggerAddAction(qB,function lg)call SaveTriggerHandle(wx,1,Gb,qB)call TimerStart(t,9,false,function mg)set u=nullset p=nullset L=nullset c=nullset pg=nullset qB=nullset t=nullendfunctionfunction qg takes nothing returns booleanreturn GetLearnedSkill()=='A0G1'endfunctionfunction Qg takes nothing returns booleanreturn GetUnitAbilityLevel(GetEnumUnit(),'B03G')>0endfunctionfunction sg takes nothing returns nothinglocal unit Xg=GetEventDamageSource()local unit ed=GetTriggerUnit()local real Gd=GetEventDamage()local integer Hb=GetUnitAbilityLevel(ed,'A0G1')local group g=CreateGroup()local location Tlocal real VN=500.local unit flocal player p=GetOwningPlayer(ed)local boolean bif IsUnitEnemy(Xg,p)==false thenreturnendifset Gd=.1*I2R(Hb)*Gdcall GroupEnumUnitsInRect(g,bj_mapInitialPlayableArea,Condition(function Qg))loopset f=FirstOfGroup(g)exitwhen f==nullcall SetWidgetLife(f,GetWidgetLife(f)+Gd)call GroupRemoveUnit(g,f)endloopset T=GetUnitLoc(ed)call GroupEnumUnitsInRangeOfLoc(g,T,500,null)call RemoveLocation(T)loopset f=FirstOfGroup(g)exitwhen f==nullset b=(GetUnitAbilityLevel(f,'B03U')==0 and GetUnitAbilityLevel(f,'BUts')==0 and GetUnitAbilityLevel(f,'BEah')==0 and GetUnitAbilityLevel(f,'A08I')==0 and GetUnitAbilityLevel(f,'B008')==0 and GetUnitAbilityLevel(f,'B003')==0 and GetUnitAbilityLevel(f,'B006')==0 and GetUnitAbilityLevel(f,'B03C')==0 and GetUnitAbilityLevel(f,'B01F')==0)if IsUnitEnemy(f,p)and GetWidgetLife(f)>.405 and b thencall UnitDamageTarget(ed,f,Gd,true,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_NORMAL,WEAPON_TYPE_WHOKNOWS)endifcall GroupRemoveUnit(g,f)endloopcall DestroyGroup(g)set Xg=nullset ed=nullset p=nullset g=nullset T=nullset f=nullendfunctionfunction Sg takes nothing returns nothinglocal unit u=GetLearningUnit()local trigger qB=CreateTrigger()call TriggerRegisterUnitEvent(qB,u,EVENT_UNIT_DAMAGED)call TriggerAddAction(qB,function sg)call DestroyTrigger(xV)set u=nullset qB=nullendfunctionfunction tg takes nothing returns booleanreturn GetLearnedSkill()=='A0G2'endfunctionfunction Tg takes nothing returns nothinglocal unit uA=GetTriggerUnit()local real Gd=GetEventDamage()local integer Hb=GetUnitAbilityLevel(uA,'A0G2')local integer VC=GetRandomInt(1,'d')if VC<=5*Hb+$A thencall SetWidgetLife(uA,GetWidgetLife(uA)+Gd)call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\NightElf\\FaerieDragonInvis\\FaerieDragon_Invis.mdl",uA,"origin"))endifset uA=nullendfunctionfunction ug takes nothing returns nothinglocal unit u=GetLearningUnit()local trigger qB=CreateTrigger()call TriggerRegisterUnitEvent(qB,u,EVENT_UNIT_DAMAGED)call TriggerAddAction(qB,function Tg)call DestroyTrigger(oV)set u=nullset qB=nullendfunctionfunction Ug takes nothing returns booleanreturn GetSpellAbilityId()=='A0G4'endfunctionfunction wg takes nothing returns nothinglocal unit u=GetSpellAbilityUnit()local integer Hb=GetUnitAbilityLevel(u,'A0G4')local unit clocal unit flocal group g=CreateGroup()local location L=GetUnitLoc(u)local player p=GetOwningPlayer(u)local timer tlocal integer Gbcall GroupEnumUnitsInRangeOfLoc(g,L,$3E8,null)call RemoveLocation(L)loopset f=FirstOfGroup(g)exitwhen f==nullif IsUnitAlly(f,p)and GetWidgetLife(u)>.405 thenset t=CreateTimer()set Gb=GetHandleId(t)set L=GetUnitLoc(f)set c=CreateUnitAtLoc(p,'h00P',L,0)call UnitAddAbility(c,'A0G3')call SetUnitAbilityLevel(u,'A0G3',Hb)call IssueTargetOrderById(c,$D0062,f)call SaveUnitHandle(wx,1,Gb,c)call TimerStart(t,2,false,function gb)set t=nullcall RemoveLocation(L)endifcall GroupRemoveUnit(g,f)endloopcall DestroyGroup(g)set u=nullset c=nullset f=nullset g=nullset L=nullset p=nullendfunctionfunction Wg takes nothing returns nothinglocal unit yglocal integer Ygif(GetLearnedSkill()=='A03O')thenset yg=GetLearningUnit()set Yg=GetUnitAbilityLevel(yg,'A03O')call SetUnitAbilityLevel(yg,'A0F5',Yg+1)if(Yg==3)thencall DestroyTrigger(iV)endifendifset yg=nullendfunctionfunction zg takes nothing returns booleanreturn GetSpellAbilityId()=='A03P'endfunctionfunction Zg takes nothing returns nothinglocal timer t=GetExpiredTimer()call DisableTrigger(nV)call DestroyTimer(t)set t=nullendfunctionfunction vG takes nothing returns nothinglocal unit u=GetSpellAbilityUnit()local integer Hb=GetUnitAbilityLevel(u,'A03P')local timer t=CreateTimer()call EnableTrigger(nV)call TimerStart(t,3+3*Hb,false,function Zg)set t=nullset u=nullendfunctionfunction eG takes nothing returns booleanreturn GetWidgetLife(uv)>.405endfunctionfunction xG takes nothing returns nothinglocal group g=CreateGroup()local unit u=uvlocal unit flocal player p=GetOwningPlayer(u)local location T=GetUnitLoc(u)local effect array elocal integer In=1local integer Hb=GetUnitAbilityLevel(u,'A03P')local real Gd=('d'+50*(I2R(Hb)-1)+GetHeroStr(u,true))/4call GroupEnumUnitsInRangeOfLoc(g,T,300,null)call RemoveLocation(T)loopset f=FirstOfGroup(g)exitwhen f==nullif IsUnitEnemy(f,p)and GetWidgetLife(f)>.405 thencall UnitDamageTarget(u,f,Gd,true,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_NORMAL,WEAPON_TYPE_WHOKNOWS)set e[In]=AddSpecialEffectLoc("Abilities\\Spells\\Undead\\ReplenishHealth\\ReplenishHealthCaster.mdl",GetUnitLoc(f))set In=In+1endifcall GroupRemoveUnit(g,f)endloopcall DestroyGroup(g)call TriggerSleepAction(.25)loopexitwhen In==0call DestroyEffect(e[In])set In=In-1endloopset In=1set g=nullset u=nullset f=nullset T=nullloopexitwhen e[In]==nullset e[In]=nullset In=In+1endloopendfunctionfunction oG takes nothing returns nothinglocal player p=GetTriggerPlayer()call DisplayTextToPlayer(p,0,0,"Наращенная ловкость |Cffff0000"+I2S(R2I(vr))+"|R")set p=nullendfunctionfunction rG takes nothing returns booleanreturn GetLearnedSkill()=='A0ER'endfunctionfunction iG takes nothing returns nothinglocal unit u=GetLearningUnit()local player p=GetOwningPlayer(u)call TriggerRegisterPlayerChatEvent(VV,p,"-л",true)call TriggerRegisterPlayerChatEvent(VV,p,"-agi",true)call DisplayTextToPlayer(p,0,0,"|cffffcc00Вводите -л чтобы узнать количество наращенной ловкости.|R")call DestroyTrigger(EV)set p=nullset u=nullendfunctionfunction aG takes nothing returns nothinglocal unit XC=GetTriggerUnit()local unit oD=GetAttacker()if GetUnitTypeId(XC)==Sd($A)and GetUnitAbilityLevel(oD,'A077')==0 and IsUnitIllusion(XC)==false thenif(GetUnitTypeId(oD)!='n00K' and GetUnitTypeId(oD)!='n00Z' and GetUnitTypeId(oD)!='n017' and oD!=Nx)thenif GetRandomInt(1,5)==1 thencall xD(oD,XC)endifendifendifset oD=nullset XC=nullendfunctionfunction nG takes nothing returns nothinglocal unit XC=GetSpellAbilityUnit()if(GetSpellAbilityId()==Sd(3))thencall AD(XC)endifset XC=nullendfunctionfunction VG takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer wd=GetHandleId(t)local unit XC=LoadUnitHandle(wx,wd,0)local integer eD=LoadInteger(wx,wd,1)local integer cv=Lolocal integer Hb=GetUnitAbilityLevel(XC,Sd(4))local integer r=GetRandomInt(1,$A)local integer Jbif(cv>0)thenset Lo=cv-3if Hb==0 thencall SetHeroAgi(XC,GetHeroAgi(XC,false)-eD,true)elseif r==1 and vr<$C8 thenset vr=vr+eDif vr>$C8 thenset Jb=vr-$C8call SetHeroAgi(XC,GetHeroAgi(XC,false)-Jb,true)set vr=$C8endifelsecall SetHeroAgi(XC,GetHeroAgi(XC,false)-eD,true)endifendifendifcall DestroyTimer(t)call FlushChildHashtable(wx,wd)set XC=nullset t=nullendfunctionfunction EG takes nothing returns nothinglocal unit uAlocal unit uTlocal integer Hblocal real ODlocal unit d1local unit d2local unit d3local player plocal real xlocal real ylocal item Wclocal item yclocal item Yclocal integer cvlocal timer tlocal timer XDlocal integer RDlocal integer wdlocal integer udlocal integer vDif GetSpellAbilityId()=='A0F6' thenset uA=GetSpellAbilityUnit()set p=GetOwningPlayer(uA)set uT=GetSpellTargetUnit()set Hb=GetUnitAbilityLevel(uA,'A0F6')set vD=GetUnitAbilityLevel(uA,Sd(4))set x=GetUnitX(uT)set y=GetUnitY(uT)if(Hb==1)thenset OD=8.elseif(Hb==2)thenset OD=9.elseif(Hb==3)thenset OD=10.endifset d1=CreateUnit(p,Sd(7),x,y,.0)set d2=CreateUnit(p,Sd(7),x,y,.0)set d3=CreateUnit(p,Sd(7),x,y,.0)set Wc=UnitAddItemById(d1,'I06Z')call SetUnitAbilityLevel(d1,'A0F7',Hb)call UnitUseItemTarget(d1,Wc,uT)set yc=UnitAddItemById(d2,'I06Z')call SetUnitAbilityLevel(d2,'A0F7',Hb)call UnitUseItemTarget(d2,yc,uT)set Yc=UnitAddItemById(d3,'I06Z')call SetUnitAbilityLevel(d3,'A0F7',Hb)call UnitUseItemTarget(d3,Yc,uT)set cv=Loif(vD!=0)thenset ud=R2I(3*td(vD+4))call SetHeroAgi(uA,GetHeroAgi(uA,false)+ud,true)endifset Lo=cv+3set t=CreateTimer()set wd=GetHandleId(t)call SaveUnitHandle(wx,wd,0,d1)call SaveItemHandle(wx,wd,1,Wc)call TimerStart(t,1,false,function zd)set t=CreateTimer()set wd=GetHandleId(t)call SaveUnitHandle(wx,wd,0,d2)call SaveItemHandle(wx,wd,1,yc)call TimerStart(t,1,false,function zd)set t=CreateTimer()set wd=GetHandleId(t)call SaveUnitHandle(wx,wd,0,d3)call SaveItemHandle(wx,wd,1,Yc)call TimerStart(t,1,false,function zd)set XD=CreateTimer()set RD=GetHandleId(XD)call SaveUnitHandle(wx,RD,0,uA)call SaveInteger(wx,RD,1,ud)call TimerStart(XD,OD,false,function VG)endifset uA=nullset uT=nullset d1=nullset d2=nullset d3=nullset p=nullset Wc=nullset yc=nullset Yc=nullset t=nullset XD=nullendfunctionfunction XG takes nothing returns booleanreturn GetSpellAbilityId()=='A0F6' and(GetUnitTypeId(GetSpellTargetUnit())=='n00K' or GetUnitTypeId(GetSpellTargetUnit())=='n00Z' or GetUnitTypeId(GetSpellTargetUnit())=='n017' or GetSpellTargetUnit()==Nx)endfunctionfunction OG takes nothing returns nothinglocal unit uA=GetSpellAbilityUnit()call IssueImmediateOrderById(uA,$D0004)call DisplayTextToPlayer(GetOwningPlayer(uA),0,0,"Мастерство иллюзий не действует на мегабоссов.")set uA=nullendfunctionfunction RG takes nothing returns booleanreturn GetLearnedSkill()=='A0AI'endfunctionfunction IG takes nothing returns nothinglocal unit u=GetLearningUnit()local player p=GetOwningPlayer(u)local integer Hb=GetUnitAbilityLevel(u,'A0AI')call SetPlayerTechResearched(p,'Remg',Hb)set p=nullset u=nullendfunctionfunction AG takes nothing returns booleanreturn GetLearnedSkill()=='A0EF'endfunctionfunction NG takes nothing returns nothinglocal unit u=GetLearningUnit()local integer Hb=GetUnitAbilityLevel(u,'A0EF')call SetHeroAgi(u,GetHeroAgi(u,false)+5,true)call SetUnitAbilityLevel(u,'A09M',Hb+1)set u=nullendfunctionfunction bG takes nothing returns booleanreturn GetSpellAbilityId()=='A0EG'endfunctionfunction BG takes nothing returns nothinglocal integer In=1local timer t=GetExpiredTimer()local integer Gb=GetHandleId(t)local effect eloopexitwhen In>5set e=LoadEffectHandle(wx,In,Gb)call DestroyEffect(e)set In=In+1endloopcall DestroyTimer(t)set e=nullset t=nullendfunctionfunction cG takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer Gb=GetHandleId(t)local group g=CreateGroup()local group g2=CreateGroup()local integer In=LoadInteger(wx,1,Gb)local integer xc=LoadInteger(wx,2,Gb)local unit uA=LoadUnitHandle(wx,3,Gb)local integer Hb=GetUnitAbilityLevel(uA,'A0EG')local real Gdlocal real CGlocal real dGlocal unit flocal effect elocal timer ttlocal integer LDset g=LoadGroupHandle(wx,4,Gb)if In>xc or FirstOfGroup(g)==null thencall DestroyGroup(g)call DestroyTimer(t)elseset g2=ZC(g)loopset f=FirstOfGroup(g2)exitwhen f==nullset tt=nullset tt=CreateTimer()set LD=GetHandleId(tt)set e=AddSpecialEffectTarget("Abilities\\Weapons\\CryptFiendMissile\\CryptFiendMissileTarget.mdl",f,"head")set CG=GetUnitState(f,UNIT_STATE_MAX_LIFE)set dG=GetWidgetLife(f)if(IsUnitType(f,UNIT_TYPE_HERO)or(GetUnitUserData(f)!=0 and GetUnitUserData(f)!=1))thenset Gd=$A*Hb+(CG-dG)*(2*Hb)/'d'elseset Gd=$A*Hb+(CG-dG)*(5*Hb)/'d'endifif GetWidgetLife(f)>.405 thencall UnitDamageTarget(uA,f,Gd,true,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_MAGIC,WEAPON_TYPE_WHOKNOWS)elsecall GroupRemoveUnit(g,f)endifcall SaveEffectHandle(wx,1,LD,e)call TimerStart(tt,1,false,function wB)call GroupRemoveUnit(g2,f)endloopcall SaveInteger(wx,1,Gb,In+1)endifcall DestroyGroup(g2)set t=nullset g=nullset g2=nullset uA=nullset f=nullset tt=nullset e=nullendfunctionfunction DG takes nothing returns nothinglocal unit uA=GetSpellAbilityUnit()local location T=GetSpellTargetLoc()local integer Hb=GetUnitAbilityLevel(uA,'A0EG')local group g=CreateGroup()local group g2=CreateGroup()local timer t=CreateTimer()local integer Gb=GetHandleId(t)local timer te=CreateTimer()local integer fG=GetHandleId(te)local unit flocal effect array elocal string FG="Abilities\\Spells\\NightElf\\Blink\\BlinkCaster.mdl"local real lXlocal real lYlocal real lZ=50local real gG=35set lX=GetLocationX(T)set lY=GetLocationY(T)set e[1]=kc(FG,lX,lY,1.3*lZ)set e[2]=kc(FG,lX-gG,lY-gG,lZ)set e[3]=kc(FG,lX-gG,lY+gG,lZ)set e[4]=kc(FG,lX+gG,lY-gG,lZ)set e[5]=kc(FG,lX+gG,lY+gG,lZ)call SaveEffectHandle(wx,1,fG,e[1])call SaveEffectHandle(wx,2,fG,e[2])call SaveEffectHandle(wx,3,fG,e[3])call SaveEffectHandle(wx,4,fG,e[4])call SaveEffectHandle(wx,5,fG,e[5])call TimerStart(te,5,false,function BG)call GroupEnumUnitsInRangeOfLoc(g,T,$E6,Condition(function Kc))call RemoveLocation(T)set g2=ZC(g)loopset f=FirstOfGroup(g2)exitwhen f==nullcall UnitDamageTarget(uA,f,20*Hb,true,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_MAGIC,WEAPON_TYPE_WHOKNOWS)call GroupRemoveUnit(g2,f)endloopcall DestroyGroup(g2)call SaveInteger(wx,1,Gb,1)call SaveInteger(wx,2,Gb,4)call SaveUnitHandle(wx,3,Gb,uA)call SaveGroupHandle(wx,4,Gb,g)call TimerStart(t,1,true,function cG)set g=nullset g2=nullset f=nullset uA=nullset T=nullset t=nullset te=nullset e[1]=nullset e[2]=nullset e[3]=nullset e[4]=nullset e[5]=nullendfunctionfunction GG takes nothing returns booleanreturn GetSpellAbilityId()=='A0EH' or GetSpellAbilityId()=='A0ET'endfunctionfunction hG takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer Gb=GetHandleId(t)local unit u=LoadUnitHandle(wx,1,Gb)local effect e=LoadEffectHandle(wx,2,Gb)call DestroyEffect(e)call SetUnitAbilityLevel(u,'A0EJ',1)call DestroyTimer(t)set u=nullset e=nullset t=nullendfunctionfunction HG takes nothing returns nothinglocal timer t=CreateTimer()local integer Gb=GetHandleId(t)local timer tt=CreateTimer()local integer LD=GetHandleId(tt)local unit uA=GetSpellAbilityUnit()local player p=GetOwningPlayer(uA)local location T=GetUnitLoc(uA)local integer Hb=GetUnitAbilityLevel(uA,GetSpellAbilityId())local unit c=CreateUnitAtLoc(p,'h00P',T,0)local effect e=AddSpecialEffectTarget("Abilities\\Weapons\\SearingArrow\\SearingArrowMissile.mdl",uA,"head")call RemoveLocation(T)call UnitAddAbility(c,'A0EI')call SetUnitAbilityLevel(c,'A0EI',Hb)call IssueTargetOrderById(c,$D0085,uA)call SetUnitAbilityLevel(uA,'A0EJ',Hb+1)call SaveUnitHandle(wx,1,Gb,c)call TimerStart(t,1,false,function gb)call SaveUnitHandle(wx,1,LD,uA)call SaveEffectHandle(wx,2,LD,e)call TimerStart(tt,9,false,function hG)set t=nullset tt=nullset uA=nullset p=nullset T=nullset c=nullset e=nullendfunctionfunction jG takes nothing returns booleanreturn GetSpellAbilityId()=='A07L'endfunctionfunction JG takes nothing returns booleanreturn GetWidgetLife(GetFilterUnit())>.405 and IsUnitEnemy(GetFilterUnit(),GetOwningPlayer(GetSpellAbilityUnit()))endfunctionfunction kG takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer Gb=GetHandleId(t)local unit c=LoadUnitHandle(wx,1,Gb)call KillUnit(c)call RemoveUnit(c)call DestroyTimer(t)set c=nullset t=nullendfunctionfunction KG takes player pl,location l,integer Hb,unit u returns nothinglocal timer t=CreateTimer()local unit c=CreateUnitAtLoc(pl,'h00P',l,0)local integer Gb=GetHandleId(t)call RemoveLocation(l)if Hb==1 thencall UnitAddAbility(c,'A0DL')elseif Hb==2 thencall UnitAddAbility(c,'A0DO')elsecall UnitAddAbility(c,'A0DP')endifendifcall IssueTargetOrderById(c,$D00CB,u)call SaveUnitHandle(wx,1,Gb,c)call TimerStart(t,5,false,function kG)set c=nullset t=nullendfunctionfunction lG takes nothing returns nothinglocal unit uA=GetSpellAbilityUnit()local player p=GetOwningPlayer(uA)local location lT=GetSpellTargetLoc()local integer Hb=GetUnitAbilityLevel(uA,'A07L')local group g=CreateGroup()local real LG=290local location lllocal unit flocal unit clocal integer Incall GroupEnumUnitsInRangeOfLoc(g,lT,LG,Condition(function JG))call RemoveLocation(lT)set In=1loopset f=FirstOfGroup(g)exitwhen f==nullset ll=GetUnitLoc(f)call KG(p,ll,Hb,f)call GroupRemoveUnit(g,f)endloopcall DestroyGroup(g)set uA=nullset p=nullset lT=nullset ll=nullset g=nullset f=nullset c=nullendfunctionfunction mG takes nothing returns booleanreturn GetSpellAbilityId()=='A0DZ'endfunctionfunction MG takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer Gb=GetHandleId(t)local texttag tt=LoadTextTagHandle(wx,1,Gb)call DestroyTextTag(tt)call DestroyTimer(t)set t=nullset tt=nullendfunctionfunction pG takes unit u returns nothinglocal texttag tt=CreateTextTag()local timer t=CreateTimer()local integer Gb=GetHandleId(t)call SetTextTagText(tt,I2S($C8),.0276)call SetTextTagPosUnit(tt,u,0)call SetTextTagColor(tt,'d',$FA,20,0)call SetTextTagVelocity(tt,0,.032)call SaveTextTagHandle(wx,1,Gb,tt)call TimerStart(t,1.3,false,function MG)set tt=nullset t=nullendfunctionfunction PG takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer Gb=GetHandleId(t)local unit u=LoadUnitHandle(wx,1,Gb)local unit uA=LoadUnitHandle(wx,2,Gb)call pG(u)call UnitDamageTarget(uA,u,$C8,true,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_MAGIC,WEAPON_TYPE_WHOKNOWS)call DestroyTimer(t)set t=nullset u=nullset uA=nullendfunctionfunction qG takes nothing returns nothinglocal unit u=GetSpellTargetUnit()local unit uA=GetSpellAbilityUnit()local timer t=CreateTimer()local integer Gb=GetHandleId(t)call SaveUnitHandle(wx,1,Gb,u)call SaveUnitHandle(wx,2,Gb,uA)call TimerStart(t,3.1,false,function PG)set t=nullset u=nullset uA=nullendfunctionfunction QG takes nothing returns booleanreturn GetSpellAbilityId()=='A0DN'endfunctionfunction sG takes nothing returns nothinglocal unit u=GetSpellAbilityUnit()local real xp=GetWidgetLife(u)local unit XC=Vocall KillUnit(u)call SetWidgetLife(XC,GetWidgetLife(XC)+xp)set u=nullset XC=nullendfunctionfunction SG takes nothing returns booleanreturn GetSpellAbilityId()=='A0DM'endfunctionfunction tG takes nothing returns nothinglocal timer t=GetExpiredTimer()local group g=cN('e00K')local unit floopset f=FirstOfGroup(g)exitwhen f==nullcall KillUnit(f)call RemoveUnit(f)call GroupRemoveUnit(g,f)endloopcall DestroyGroup(g)call DestroyTimer(t)set t=nullset f=nullendfunctionfunction TG takes nothing returns nothinglocal group G=CreateGroup()local unit XC=GetSpellAbilityUnit()local real xplocal unit flocal timer t=CreateTimer()call GroupAddGroup(cN('e00G'),G)call GroupAddGroup(cN('e00H'),G)call GroupAddGroup(cN('e00I'),G)loopset f=FirstOfGroup(G)exitwhen f==nullset xp=GetWidgetLife(f)call SetWidgetLife(XC,GetWidgetLife(XC)+xp)call KillUnit(f)call GroupRemoveUnit(G,f)endloopcall TimerStart(t,.5,false,function tG)call DestroyGroup(G)set f=nullset G=nullset XC=nullset t=nullendfunctionfunction uG takes nothing returns booleanreturn GetSpellAbilityId()=='A0DX' or GetSpellAbilityId()=='A0DY'endfunctionfunction UG takes nothing returns nothingcall DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Other\\CrushingWave\\CrushingWaveDamage.mdl",GetWidgetX(Eo),GetWidgetY(Eo)))call RemoveUnit(Eo)endfunctionfunction wG takes nothing returns nothinglocal integer WGlocal real ODlocal unit xr=GetSpellAbilityUnit()local integer yG=GetSpellAbilityId()local integer Hb=GetUnitAbilityLevel(Vo,yG)local unit u=CreateUnit(GetOwningPlayer(xr),'E00J',GetWidgetX(xr),GetWidgetY(xr),GetUnitFacing(xr))if yG=='A0DX' thenset WG=$F*Hbset OD=5+5*Hbelseset WG=25*Hbset OD=$A+5*Hbendifset Eo=ucall SetHeroStr(u,GetHeroStr(u,false)+WG,true)call SetHeroAgi(u,GetHeroAgi(u,false)+WG,true)call SetHeroInt(u,GetHeroInt(u,false)+WG,true)call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\DispelMagic\\DispelMagicTarget.mdl",GetWidgetX(u),GetWidgetY(u)))call SetHeroLevel(u,GetHeroLevel(Vo),false)call SuspendHeroXP(u,true)call SetUnitUserData(u,$C)call SetUnitAbilityLevel(u,'A0DQ',Hb)call UnitApplyTimedLife(u,'BTLF',OD)call TriggerRegisterUnitEvent(bA,u,EVENT_UNIT_DEATH)set xr=nullset u=nullendfunctionfunction YG takes nothing returns booleanreturn GetSpellAbilityId()=='A09D' or GetSpellAbilityId()=='A0DU'endfunctionfunction zG takes nothing returns nothingif IsUnitType(GetEnumUnit(),UNIT_TYPE_HERO)thencall GroupRemoveUnit(cA,GetEnumUnit())endifendfunctionfunction ZG takes nothing returns nothingcall DestroyTimer(GetExpiredTimer())call ForGroup(cA,function zG)endfunctionfunction vh takes nothing returns nothingcall DestroyTimer(GetExpiredTimer())call DestroyTimer(CA)endfunctionfunction eh takes nothing returns booleanreturn GetUnitAbilityLevel(GetFilterUnit(),'B02M')>0 and GetWidgetLife(GetFilterUnit())>.405endfunctionfunction xh takes nothing returns nothinglocal unit e=GetEnumUnit()if GetUnitAbilityLevel(e,'B02M')>0 and GetWidgetLife(e)>.405 thencall UnitDamageTarget(Vo,e,BA,false,false,null,DAMAGE_TYPE_MAGIC,WEAPON_TYPE_WHOKNOWS)elsecall GroupRemoveUnit(cA,e)endifset e=nullendfunctionfunction oh takes nothing returns nothingcall ForGroup(cA,function xh)endfunctionfunction rh takes nothing returns nothingif GetSpellAbilityId()=='A09D' thenset BA=$F*GetUnitAbilityLevel(GetSpellAbilityUnit(),'A09D')+$Felseset BA=$F*GetUnitAbilityLevel(GetSpellAbilityUnit(),'A0DU')+30endifcall TimerStart(CreateTimer(),5,false,function ZG)call TimerStart(CreateTimer(),$A,false,function vh)set CA=CreateTimer()call TimerStart(CA,.5,true,function oh)call TriggerSleepAction(.45)set cA=CreateGroup()call GroupEnumUnitsInRect(cA,bj_mapInitialPlayableArea,Condition(function eh))endfunctionfunction ih takes nothing returns booleanreturn GetSpellAbilityId()=='A0DB'endfunctionfunction ah takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer Gb=GetHandleId(t)local group g=CreateGroup()local group g2=CreateGroup()local integer In=LoadInteger(wx,1,Gb)local integer xc=LoadInteger(wx,2,Gb)local unit uA=LoadUnitHandle(wx,3,Gb)local integer Hb=GetUnitAbilityLevel(uA,'A0DB')local player p=GetOwningPlayer(uA)local real nh=$A+$A*Hblocal real Vh=$A*Hblocal real Gdlocal unit fset g=LoadGroupHandle(wx,4,Gb)if In>xc or FirstOfGroup(g)==null thencall DestroyGroup(g)call DestroyTimer(t)elseset g2=ZC(g)loopset f=FirstOfGroup(g2)exitwhen f==nullif GetUnitAbilityLevel(f,'B02E')>0 thenset Gd=nh+Vhelseset Gd=nhendifif GetWidgetLife(f)>.405 thencall UnitDamageTarget(uA,f,Gd,true,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_MAGIC,WEAPON_TYPE_WHOKNOWS)elsecall GroupRemoveUnit(g,f)endifcall GroupRemoveUnit(g2,f)endloopcall SaveInteger(wx,1,Gb,In+1)endifcall DestroyGroup(g2)set t=nullset g=nullset g2=nullset uA=nullset f=nullset p=nullendfunctionfunction Eh takes player pl,location l,integer Hb returns nothinglocal unit c=CreateUnitAtLoc(pl,'h011',l,0)call UnitAddAbility(c,'A0DH')call SetUnitAbilityLevel(c,'A0DH',Hb)call IssueImmediateOrderById(c,$D011D)call UnitApplyTimedLife(c,'BTLF',.1)set c=nullendfunctionfunction Xh takes nothing returns nothinglocal unit uA=GetSpellAbilityUnit()local location lT=GetSpellTargetLoc()local timer t=CreateTimer()local integer Gb=GetHandleId(t)local integer SN=8local group gg=CreateGroup()local group g=CreateGroup()local real LG=375local unit fcall Eh(GetOwningPlayer(uA),lT,GetUnitAbilityLevel(uA,'A0DB'))call GroupEnumUnitsInRangeOfLoc(gg,lT,LG,null)call RemoveLocation(lT)set g=ZC(gg)loopset f=FirstOfGroup(gg)exitwhen f==nullif GetWidgetLife(f)<=.405 or IsUnitEnemy(f,GetOwningPlayer(uA))==false thencall GroupRemoveUnit(g,f)endifcall GroupRemoveUnit(gg,f)endloopcall SaveInteger(wx,1,Gb,1)call SaveInteger(wx,2,Gb,SN)call SaveUnitHandle(wx,3,Gb,uA)call SaveGroupHandle(wx,4,Gb,g)call TimerStart(t,1,true,function ah)set lT=nullset t=nullset uA=nullendfunctionfunction Oh takes nothing returns booleanreturn((GetUnitAbilityLevel(GetTriggerUnit(),'A0D9')>0 and GetUnitTypeId(GetTriggerUnit())=='U00A' and IsUnitType(GetAttacker(),UNIT_TYPE_MAGIC_IMMUNE)==false and not(BD(GetAttacker())))!=null)!=nullendfunctionfunction Rh takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer Gb=GetHandleId(t)local unit c=LoadUnitHandle(wx,1,Gb)local effect e=LoadEffectHandle(wx,2,Gb)call DestroyEffect(e)call SetUnitTimeScale(c,1.)call PauseUnit(c,false)call DestroyTimer(t)set c=nullset t=nullset e=nullendfunctionfunction Ih takes nothing returns nothinglocal effect elocal timer t=CreateTimer()local integer Gb=GetHandleId(t)local unit u=GetTriggerUnit()local unit T=GetAttacker()local integer Hb=GetUnitAbilityLevel(u,'A0D9')local real ZF=.5*Hblocal real Gd=50*Hblocal integer Ah=18local integer c=GetRandomInt(1,'d')if c<=Ah thencall SetUnitTimeScale(T,.0)call PauseUnit(T,true)call UnitDamageTarget(u,T,Gd,true,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_MAGIC,WEAPON_TYPE_WHOKNOWS)if GetWidgetLife(T)<=.405 thenset ZF=0endifset e=AddSpecialEffectTarget("Abilities\\Spells\\Undead\\FreezingBreath\\FreezingBreathTargetArt.mdl",T,"origin")call SaveUnitHandle(wx,1,Gb,T)call SaveEffectHandle(wx,2,Gb,e)call TimerStart(t,ZF,false,function Rh)endifset e=nullset u=nullset T=nullset t=nullendfunctionfunction Nh takes nothing returns booleanreturn GetSpellAbilityId()=='A0DJ' or GetSpellAbilityId()=='A0DG'endfunctionfunction bh takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer Gb=GetHandleId(t)local effect e=LoadEffectHandle(wx,1,Gb)local group g=CreateGroup()local unit fset g=LoadGroupHandle(wx,2,Gb)call DestroyEffect(e)loopset f=FirstOfGroup(g)exitwhen f==nullcall KillUnit(f)call RemoveUnit(f)call GroupRemoveUnit(g,f)endloopcall DestroyGroup(g)call DestroyTimer(t)set f=nullset t=nullset e=nullset g=nullendfunctionfunction Bh takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer Gb=GetHandleId(t)local timer tt=CreateTimer()local integer LD=GetHandleId(tt)local integer In=LoadInteger(wx,1,Gb)local integer xc=LoadInteger(wx,2,Gb)local location Ch=LoadLocationHandle(wx,3,Gb)local unit u=LoadUnitHandle(wx,4,Gb)local real Gd=LoadReal(wx,5,Gb)local real dh=500.local real Dh=190.local player p=GetOwningPlayer(u)local group g=CreateGroup()local group gg=CreateGroup()local group g2=CreateGroup()local group g3=CreateGroup()local unit uulocal location llocal unit flocal unit clocal effect elocal effect array e2if In>xc or LoadBoolean(wx,1,StringHash("pr"))thenset e2[1]=LoadEffectHandle(wx,6,Gb)set e2[2]=LoadEffectHandle(wx,7,Gb)set e2[3]=LoadEffectHandle(wx,8,Gb)set e2[4]=LoadEffectHandle(wx,9,Gb)set e2[5]=LoadEffectHandle(wx,$A,Gb)call DestroyEffect(e2[1])call DestroyEffect(e2[2])call DestroyEffect(e2[3])call DestroyEffect(e2[4])call DestroyEffect(e2[5])call RemoveLocation(Ch)call DestroyTimer(t)elsecall GroupEnumUnitsInRangeOfLoc(gg,Ch,dh,null)set g=ZC(gg)loopset f=FirstOfGroup(gg)exitwhen f==nullif GetWidgetLife(f)<=.405 or IsUnitEnemy(f,p)==false thencall GroupRemoveUnit(g,f)endifcall GroupRemoveUnit(gg,f)endloopset uu=GroupPickRandomUnit(g)set l=GetUnitLoc(uu)call GroupEnumUnitsInRangeOfLoc(gg,l,Dh,null)set g2=ZC(gg)loopset f=FirstOfGroup(gg)exitwhen f==nullif GetWidgetLife(f)<=.405 or IsUnitEnemy(f,p)==false thencall GroupRemoveUnit(g2,f)endifcall GroupRemoveUnit(gg,f)endlooploopset f=FirstOfGroup(g2)exitwhen f==nullif IsUnitEnemy(f,p)and GetWidgetLife(f)>.405 thencall UnitDamageTarget(u,f,Gd,true,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_MAGIC,WEAPON_TYPE_WHOKNOWS)if GetWidgetLife(f)>.405 thenset c=CreateUnitAtLoc(p,'h00P',GetUnitLoc(f),.0)call GroupAddUnit(g3,c)call UnitAddAbility(c,'A0DI')call IssueTargetOrderById(c,$D006B,f)endifendifcall GroupRemoveUnit(g2,f)endloopif IsUnitEnemy(uu,p)thenset e=AddSpecialEffectLoc("Abilities\\Spells\\Undead\\FrostNova\\FrostNovaTarget.mdl",l)endifcall RemoveLocation(l)call SaveEffectHandle(wx,1,LD,e)call SaveGroupHandle(wx,2,LD,g3)call TimerStart(tt,1,false,function bh)call SaveInteger(wx,1,Gb,In+1)endifcall DestroyGroup(g)call DestroyGroup(g2)call DestroyGroup(g3)set tt=nullset t=nullset Ch=nullset e=nullset u=nullset p=nullset g=nullset g2=nullset g3=nullset uu=nullset l=nullset f=nullset c=nullset e2[1]=nullset e2[2]=nullset e2[3]=nullset e2[4]=nullset e2[5]=nullendfunctionfunction fh takes nothing returns nothinglocal integer Fh=GetSpellAbilityId()local integer gh='A0DJ'local unit u=GetSpellAbilityUnit()local location Gh=GetSpellTargetLoc()local integer Hb=GetUnitAbilityLevel(u,Fh)local integer ZF=2+Hblocal integer hh=1local real Gd=150.*I2R(Hb)-50.local real Hh=75.local real gG=18.local string FG="Abilities\\Spells\\Undead\\FrostArmor\\FrostArmorTarget.mdl"local timer t=CreateTimer()local integer Gb=GetHandleId(t)local effect array elocal real lXlocal real lYlocal real lZ='d'set lX=GetLocationX(Gh)set lY=GetLocationY(Gh)set e[1]=kc(FG,lX,lY,1.3*lZ)set e[2]=kc(FG,lX-gG,lY-gG,lZ)set e[3]=kc(FG,lX-gG,lY+gG,lZ)set e[4]=kc(FG,lX+gG,lY-gG,lZ)set e[5]=kc(FG,lX+gG,lY+gG,lZ)if Fh!=gh thenset ZF=ZF+hhset Gd=Gd+Hhendifcall SaveInteger(wx,1,Gb,1)call SaveInteger(wx,2,Gb,ZF)call SaveLocationHandle(wx,3,Gb,Gh)call SaveUnitHandle(wx,4,Gb,u)call SaveReal(wx,5,Gb,Gd)call SaveEffectHandle(wx,6,Gb,e[1])call SaveEffectHandle(wx,7,Gb,e[2])call SaveEffectHandle(wx,8,Gb,e[3])call SaveEffectHandle(wx,9,Gb,e[4])call SaveEffectHandle(wx,$A,Gb,e[5])call TimerStart(t,1,true,function Bh)set u=nullset Gh=nullset e[1]=nullset e[2]=nullset e[3]=nullset e[4]=nullset e[5]=nullset FG=nullset t=nullendfunctionfunction jh takes nothing returns booleanreturn GetSpellAbilityId()=='A01Z'endfunctionfunction Jh takes nothing returns nothinglocal timer t=GetExpiredTimer()local unit u=LoadUnitHandle(wx,GetHandleId(t),1)call UnitRemoveAbility(u,'A0BU')call UnitRemoveAbility(u,'A05P')call UnitRemoveAbility(u,'A041')call RemoveSavedHandle(wx,GetHandleId(u),1)call FlushChildHashtable(wx,GetHandleId(t))call DestroyTimer(t)set u=nullset t=nullendfunctionfunction kh takes nothing returns nothinglocal unit Kh=GetSpellAbilityUnit()local unit u=GetSpellTargetUnit()local timer tlocal integer fd=GetUnitAbilityLevel(Kh,'A01Z')if not(HaveSavedHandle(wx,GetHandleId(u),1))thenset t=CreateTimer()call SaveUnitHandle(wx,GetHandleId(t),1,u)call SaveTimerHandle(wx,GetHandleId(u),1,t)elseset t=LoadTimerHandle(wx,GetHandleId(u),1)endifcall TimerStart(t,$A+fd*5,false,function Jh)if fd==1 thencall UnitAddAbility(u,'A05P')elseif fd==2 thencall UnitRemoveAbility(u,'A05P')call UnitAddAbility(u,'A041')elsecall UnitRemoveAbility(u,'A05P')call UnitRemoveAbility(u,'A041')call UnitAddAbility(u,'A0BU')endifset u=nullset Kh=nullset t=nullendfunctionfunction lh takes nothing returns booleanreturn GetSpellAbilityId()=='A05N'endfunctionfunction Lh takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer Gb=GetHandleId(t)local unit u=LoadUnitHandle(wx,1,Gb)local location l=LoadLocationHandle(wx,2,Gb)local integer Hb=GetUnitAbilityLevel(u,'A05N')local player p=GetOwningPlayer(u)local group g=CreateGroup()local unit fcall GroupEnumUnitsInRangeOfLoc(g,l,350,null)loopset f=FirstOfGroup(g)exitwhen f==nullif GetWidgetLife(f)>.405 and IsUnitEnemy(f,p)thencall UnitDamageTarget(u,f,Hb*60,true,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_NORMAL,WEAPON_TYPE_WHOKNOWS)endifcall GroupRemoveUnit(g,f)endloopcall RemoveLocation(l)call DestroyGroup(g)call FlushChildHashtable(wx,Gb)call DestroyTimer(t)set t=nullset u=nullset l=nullset p=nullset f=nullset g=nullendfunctionfunction mh takes nothing returns nothinglocal unit u=GetSpellAbilityUnit()local location l=GetUnitLoc(u)local timer t=CreateTimer()local integer Gb=GetHandleId(t)call SaveUnitHandle(wx,1,Gb,u)call SaveLocationHandle(wx,2,Gb,l)call TimerStart(t,.3,false,function Lh)set u=nullset l=nullset t=nullendfunctionfunction Mh takes nothing returns booleanreturn GetSpellAbilityId()=='A0E6'endfunctionfunction ph takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer In=0local unit flocal group g=CreateGroup()local group gg=CreateGroup()call DisableTrigger(kV)loopset bj_groupEnumTypeId='H008'call GroupClear(gg)call GroupEnumUnitsOfPlayer(gg,Player(In),filterGetUnitsOfTypeIdAll)call GroupAddGroup(gg,g)set In=In+1exitwhen In==16endloopcall DestroyGroup(gg)loopset f=FirstOfGroup(g)exitwhen f==nullcall UnitRemoveAbility(f,'A0E9')call UnitRemoveAbility(f,'A0E5')call UnitRemoveAbility(f,'B02W')call GroupRemoveUnit(g,f)endloopcall DestroyGroup(g)call DestroyTimer(t)set g=nullset gg=nullset f=nullset t=nullendfunctionfunction Ph takes nothing returns nothinglocal unit u=GetSpellAbilityUnit()local player p=GetOwningPlayer(u)local integer Hb=GetUnitAbilityLevel(u,'A0E6')local group g=CreateGroup()local group gg=CreateGroup()local timer t=CreateTimer()local integer In=0local unit flocal unit clocal location llocal timer t2local integer qhcall EnableTrigger(kV)loopset bj_groupEnumTypeId='H008'call GroupClear(gg)call GroupEnumUnitsOfPlayer(gg,Player(In),filterGetUnitsOfTypeIdAll)call GroupAddGroup(gg,g)set In=In+1exitwhen In==16endloopcall DestroyGroup(gg)loopset f=FirstOfGroup(g)exitwhen f==nullset l=GetUnitLoc(f)set c=CreateUnitAtLoc(p,'h00P',l,0)call RemoveLocation(l)call UnitAddAbility(c,'A0EA')call SetUnitAbilityLevel(c,'A0EA',Hb)call IssueTargetOrderById(c,$D0085,f)set t2=CreateTimer()set qh=GetHandleId(t2)call SaveUnitHandle(wx,1,qh,c)call TimerStart(t2,2,false,function gb)set t2=nullcall UnitAddAbility(f,'A0E9')call SetUnitAbilityLevel(f,'A0E9',Hb)call UnitAddAbility(f,'A0E5')call GroupRemoveUnit(g,f)endloopcall TimerStart(t,12.5+2.5*I2R(Hb),false,function ph)call DestroyGroup(g)set t=nullset t2=nullset u=nullset g=nullset gg=nullset f=nullset p=nullset c=nullendfunctionfunction Qh takes nothing returns booleanreturn GetSpellAbilityId()=='A05N'endfunctionfunction sh takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer Gb=GetHandleId(t)local unit c=LoadUnitHandle(wx,1,Gb)local player p=GetOwningPlayer(c)local integer Hb=GetUnitAbilityLevel(c,'A0E6')local group g=CreateGroup()local group gg=CreateGroup()local integer In=0local unit flocal unit cclocal location llocal timer t2local integer qhif IsTriggerEnabled(kV)==false thenreturnendifloopset bj_groupEnumTypeId='H008'call GroupClear(gg)call GroupEnumUnitsOfPlayer(gg,Player(In),filterGetUnitsOfTypeIdAll)call GroupAddGroup(gg,g)set In=In+1exitwhen In==16endloopcall GroupClear(gg)set gg=ZC(g)loopset f=FirstOfGroup(gg)exitwhen f==nullset l=GetUnitLoc(f)set cc=CreateUnitAtLoc(p,'h00P',l,0)call RemoveLocation(l)call UnitAddAbility(cc,'A0EA')call SetUnitAbilityLevel(cc,'A0EA',Hb)call IssueTargetOrderById(cc,$D0085,f)set t2=CreateTimer()set qh=GetHandleId(t2)call SaveUnitHandle(wx,1,qh,cc)call TimerStart(t2,2,false,function gb)set t2=nullcall GroupRemoveUnit(gg,f)endloopcall DestroyGroup(gg)call GroupRemoveUnit(g,c)loopset f=FirstOfGroup(g)exitwhen f==nullcall UnitAddAbility(f,'A0E9')call SetUnitAbilityLevel(f,'A0E9',Hb)call UnitAddAbility(f,'A0E5')call GroupRemoveUnit(g,f)endloopcall DestroyGroup(g)call DestroyTimer(t)set c=nullset cc=nullset t=nullset g=nullset gg=nullset f=nullset l=nullset t2=nullendfunctionfunction Sh takes nothing returns nothinglocal unit u=GetSpellAbilityUnit()local timer t=CreateTimer()local integer Gb=GetHandleId(t)call SaveUnitHandle(wx,1,Gb,u)call TimerStart(t,.7,false,function sh)set u=nullset t=nullendfunctionfunction th takes nothing returns booleanreturn GetSpellAbilityId()=='A0AO'endfunctionfunction Th takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer Gb=GetHandleId(t)local integer xc=LoadInteger(wx,2,Gb)local integer In=LoadInteger(wx,1,Gb)local unit uA=LoadUnitHandle(wx,3,Gb)local effect e=LoadEffectHandle(wx,4,Gb)local player p=GetOwningPlayer(uA)local integer Hb=GetUnitAbilityLevel(uA,'A0AO')local group glocal real uh=LoadReal(wx,5,Gb)local real Uh=2.5*I2R(Hb)+uhlocal unit fif In>xc or GetWidgetLife(uA)<=.405 thencall DestroyTimer(t)call DestroyEffect(e)call RemoveUnit(dA)elseset g=CreateGroup()call GroupEnumUnitsInRange(g,GetWidgetX(uA),GetWidgetY(uA),375,null)loopset f=FirstOfGroup(g)exitwhen f==nullif IsUnitEnemy(f,p)and GetWidgetLife(f)>.405 and jb(f)thencall UnitDamageTarget(dA,f,Uh,false,false,null,DAMAGE_TYPE_UNIVERSAL,WEAPON_TYPE_WHOKNOWS)call SetWidgetLife(uA,GetWidgetLife(uA)+Uh)endifcall GroupRemoveUnit(g,f)endloopcall DestroyGroup(g)call SaveInteger(wx,1,Gb,In+1)endifset uA=nullset t=nullset p=nullset g=nullset f=nullset e=nullendfunctionfunction wh takes nothing returns nothinglocal timer t=CreateTimer()local integer Gb=GetHandleId(t)local unit uA=GetSpellAbilityUnit()local integer Id=GetSpellAbilityId()local integer Hb=GetUnitAbilityLevel(uA,Id)local effect e=AddSpecialEffectTarget("Abilities\\Spells\\Other\\Drain\\DrainTarget.mdl",uA,"origin")set dA=CreateUnit(GetOwningPlayer(uA),'h00P',GetWidgetX(uA),GetWidgetY(uA),.0)call SaveInteger(wx,1,Gb,1)call SaveInteger(wx,2,Gb,$A+2*Hb)call SaveUnitHandle(wx,3,Gb,uA)call SaveEffectHandle(wx,4,Gb,e)call SaveReal(wx,5,Gb,Px)call TimerStart(t,.5,true,function Th)set Px=0set uA=nullset t=nullset e=nullendfunctionfunction Wh takes nothing returns nothingif GetLearnedSkill()=='A0BR' thencall EnableTrigger(LV)call EnableTrigger(mV)call DestroyTrigger(lV)endifendfunctionfunction yh takes nothing returns booleanreturn IsUnitEnemy(GetFilterUnit(),GetOwningPlayer(px))and GetWidgetLife(GetFilterUnit())>.405 and GetUnitLifePercent(GetFilterUnit())<30.endfunctionfunction Yh takes nothing returns nothinglocal group g=CreateGroup()local unit uA=pxlocal unit flocal location T=GetUnitLoc(uA)local integer n=0local integer iD='A0BR'local integer od=GetUnitAbilityLevel(uA,iD)call GroupEnumUnitsInRangeOfLoc(g,T,500,Condition(function yh))call RemoveLocation(T)loopset f=FirstOfGroup(g)exitwhen f==nullset n=n+1call GroupRemoveUnit(g,f)endloopif n>0 and Io==false thenset Io=truecall SetUnitAbilityLevel(uA,'A0CF',od+1)set Ro=AddSpecialEffectTarget("Abilities\\Spells\\Orc\\Bloodlust\\BloodlustTarget.mdl",uA,"head")endifif n==0 thenset Io=falsecall DestroyEffect(Ro)call SetUnitAbilityLevel(uA,'A0CF',1)endifcall DestroyGroup(g)set g=nullset f=nullset uA=nullset T=nullendfunctionfunction zh takes nothing returns booleanreturn GetSpellAbilityId()=='A0AO' or GetSpellAbilityId()=='A0CG'endfunctionfunction Zh takes nothing returns nothinglocal unit uA=GetSpellAbilityUnit()local integer od=GetUnitAbilityLevel(uA,'A0BR')local integer r=1+2*odcall TriggerSleepAction(.01)set Px=Px+rif(Px>Qx)thenset Px=Qxendifset uA=nullendfunctionfunction vH takes nothing returns nothingcall DisplayTextToPlayer(GetTriggerPlayer(),0,0,"Количество пунктов |Cffff0000"+I2S(R2I(Px))+"|R")endfunctionfunction eH takes nothing returns nothinglocal integer odlocal unit u=GetLearningUnit()local trigger tif GetLearnedSkill()=='A002' thenif IsTriggerEnabled(pV)==false thencall EnableTrigger(pV)set t=CreateTrigger()call TriggerAddAction(t,function vH)call TriggerRegisterPlayerChatEvent(t,GetOwningPlayer(u),"-п",true)call TriggerRegisterPlayerChatEvent(t,GetOwningPlayer(u),"-p",true)call DisplayTextToPlayer(GetOwningPlayer(u),0,0,"|cffffcc00Вводите -п чтобы узнать количество запасенных пунктов жажды.|R")endifset od=GetUnitAbilityLevel(u,'A002')set Qx=5*od+5if(od==3)thencall DestroyTrigger(MV)endifendifset u=nullset t=nullendfunctionfunction xH takes nothing returns booleanreturn(GetKillingUnit()==px)and(IsUnitEnemy(GetKillingUnit(),GetOwningPlayer(GetDyingUnit())))endfunctionfunction oH takes nothing returns nothingif(Px<Qx)thenset Px=Px+1call qD("+1("+I2S(Px)+")",$A,GetWidgetX(GetTriggerUnit())+30,GetWidgetY(GetTriggerUnit()),$E6,0,0,.01,4)endifendfunctionfunction rH takes nothing returns booleanreturn GetSpellAbilityId()=='A0CG'endfunctionfunction iH takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer Gb=GetHandleId(t)local unit u=LoadUnitHandle(wx,1,Gb)if RectContainsUnit(Hr,u)thencall SetUnitMoveSpeed(u,500)endifcall EnableTrigger(PV)call DestroyTimer(t)set u=nullset t=nullendfunctionfunction aH takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer Gb=GetHandleId(t)local unit u=LoadUnitHandle(wx,1,Gb)call UnitRemoveAbility(u,'A0CR')call DestroyTrigger(Yx)call DisableTrigger(qV)call DisableTrigger(QV)call DestroyTimer(t)set u=nullset t=nullendfunctionfunction nH takes nothing returns nothinglocal timer t=GetExpiredTimer()local timer t2=CreateTimer()local integer qh=GetHandleId(t2)local integer Gb=GetHandleId(t)local unit u=LoadUnitHandle(wx,1,Gb)local group g=CreateGroup()local unit flocal real uh=LoadReal(wx,3,Gb)call AddUnitAnimationProperties(u,"Stand Alternate",false)set g=LoadGroupHandle(wx,2,Gb)loopset f=FirstOfGroup(g)exitwhen f==nullcall UnitDamageTarget(u,f,uh,true,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_MAGIC,WEAPON_TYPE_WHOKNOWS)call GroupRemoveUnit(g,f)endloopcall DestroyGroup(g)call UnitAddAbility(u,'A0CR')call DestroyTimer(t)set u=nullset t=nullset g=nullset f=nullset t2=nullendfunctionfunction VH takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer Gb=GetHandleId(t)local unit u=LoadUnitHandle(wx,1,Gb)if RectContainsUnit(Hr,u)thencall SetUnitMoveSpeed(u,500)endifcall DestroyTimer(t)set u=nullset t=nullendfunctionfunction EH takes nothing returns nothinglocal unit u=GetSpellAbilityUnit()local group g=CreateGroup()local unit flocal location T=GetUnitLoc(u)local integer od=GetUnitAbilityLevel(u,'A0CG')local real uh=Px*16*odlocal timer t=CreateTimer()local integer Gb=GetHandleId(t)local timer t2=CreateTimer()local integer qh=GetHandleId(t2)local timer t3=CreateTimer()local integer XH=GetHandleId(t3)local timer t4=CreateTimer()local integer OH=GetHandleId(t4)call DisableTrigger(PV)call EnableTrigger(qV)call EnableTrigger(QV)call GroupEnumUnitsInRangeOfLoc(g,T,300,Condition(function Kc))call RemoveLocation(T)set Px=0call SaveUnitHandle(wx,1,Gb,u)call TimerStart(t,.1,false,function VH)call SaveUnitHandle(wx,1,qh,u)call SaveGroupHandle(wx,2,qh,g)call SaveReal(wx,3,qh,uh)call TimerStart(t2,.05,false,function nH)call SaveUnitHandle(wx,1,XH,u)call TimerStart(t3,20,false,function aH)call SaveUnitHandle(wx,1,OH,u)call TimerStart(t4,20.1,false,function iH)set f=nullset u=nullset g=nullset T=nullset t2=nullset t3=nullset t4=nullendfunctionfunction RH takes nothing returns nothinglocal unit Xg=GetEventDamageSource()local unit ed=GetTriggerUnit()local player plocal integer Hblocal group glocal location Tlocal unit flocal real Gdlocal real IHif Xg==px and GetUnitAbilityLevel(ed,'B025')>0 thencall TriggerSleepAction(.01)set p=GetOwningPlayer(Xg)set Hb=GetUnitAbilityLevel(Xg,'A0CG')set Gd=$A*Px*Hbset IH=(2*Hb+4)*Pxset g=CreateGroup()set T=GetUnitLoc(ed)call GroupEnumUnitsInRangeOfLoc(g,T,$96,null)call RemoveLocation(T)call SetWidgetLife(Xg,GetWidgetLife(Xg)+IH)call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\VampiricAura\\VampiricAuraTarget.mdl",Xg,"origin"))loopset f=FirstOfGroup(g)exitwhen f==nullif IsUnitEnemy(f,p)and GetWidgetLife(f)>.405 thencall UnitDamageTarget(Xg,f,Gd,true,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_NORMAL,WEAPON_TYPE_WHOKNOWS)call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Critters\\Albatross\\CritterBloodAlbatross.mdl",f,"head"))endifcall GroupRemoveUnit(g,f)endloopcall DestroyGroup(g)endifset Xg=nullset ed=nullset p=nullset g=nullset T=nullset f=nullendfunctionfunction AH takes nothing returns booleanreturn(GetAttacker()==px)and(IsUnitEnemy(GetAttacker(),GetOwningPlayer(GetTriggerUnit())))endfunctionfunction NH takes nothing returns nothingcall DestroyTrigger(Yx)set Yx=CreateTrigger()call TriggerRegisterUnitEvent(Yx,GetTriggerUnit(),EVENT_UNIT_DAMAGED)call TriggerAddAction(Yx,function RH)endfunctionfunction bH takes nothing returns nothinglocal unit u=pxlocal integer od=GetUnitAbilityLevel(u,'A0CG')local real r=Px*(2+od)*.25if GetWidgetLife(u)>.405 thencall SetWidgetLife(u,GetWidgetLife(u)+r)endifset u=nullendfunctionfunction BH takes nothing returns booleanreturn GetUnitTypeId(GetDyingUnit())=='E00E' and IsUnitIllusion(GetDyingUnit())==falseendfunctionfunction cH takes nothing returns nothingcall ac(GetDyingUnit())if Gx!=GetDyingUnit()thenset to=to-1endifendfunctionfunction dH takes nothing returns booleanreturn GetSpellAbilityId()=='A0AR'endfunctionfunction DH takes nothing returns nothingcall ac(GetSpellAbilityUnit())endfunctionfunction FH takes nothing returns booleanreturn GetDyingUnit()==hxendfunctionfunction gH takes nothing returns nothingcall Vc()endfunctionfunction hH takes nothing returns nothingif GetLearnedSkill()=='A0BA' thencall EnableTrigger(sV)call EnableTrigger(SV)call EnableTrigger(tV)call EnableTrigger(uV)call DestroyTrigger(TV)endifendfunctionfunction jH takes nothing returns booleanreturn GetSpellAbilityId()=='A0BA'endfunctionfunction JH takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer Gb=GetHandleId(t)local unit uA=LoadUnitHandle(wx,1,Gb)local player p=GetOwningPlayer(uA)local integer kH=GetHeroLevel(uA)local integer Hb=GetUnitAbilityLevel(uA,'A0BA')local location T=GetUnitLoc(uA)local unit c=CreateUnitAtLoc(p,'E00E',T,GetUnitFacing(uA))call SetUnitUserData(c,$B)call RemoveLocation(T)call UnitApplyTimedLife(c,'BTLF',120.)if kH!=1 thencall SetHeroLevel(c,kH,false)endifcall SuspendHeroXP(c,true)call SetUnitLifePercentBJ(c,GetUnitLifePercent(uA))set Gx=cif Hb==1 thencall UnitAddAbility(c,'A0AR')call vd(c,.75)elseif Hb==2 thencall UnitAddAbility(c,'A0AR')call UnitAddAbility(c,'A0BC')call vd(c,1.25)elsecall UnitAddAbility(c,'A0AR')call UnitAddAbility(c,'A0BC')call UnitAddAbility(c,'A0BD')call vd(c,1.75)endifendifcall GroupAddUnit(lx,c)if jx thencall DD(c)endifcall DestroyTimer(t)set uA=nullset t=nullset c=nullset p=nullset T=nullendfunctionfunction KH takes nothing returns nothinglocal unit uA=GetSpellAbilityUnit()local timer t=CreateTimer()local integer Gb=GetHandleId(t)if GetWidgetLife(Gx)>.405 thencall ac(Gx)endifcall SaveUnitHandle(wx,1,Gb,uA)call TimerStart(t,.45,false,function JH)set uA=nullset t=nullendfunctionfunction LH takes nothing returns booleanreturn GetSpellAbilityId()=='A0BB'endfunctionfunction mH takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer Gb=GetHandleId(t)local integer In=LoadInteger(wx,1,Gb)local integer xc=LoadInteger(wx,2,Gb)local unit u=LoadUnitHandle(wx,3,Gb)local integer Hb=GetUnitAbilityLevel(u,'A0BB')local unit flocal group gif In>xc thencall DisableTrigger(wV)call DisableTrigger(WV)call GroupClear(Hx)call DestroyTimer(t)elseset g=CreateGroup()set g=ZC(Hx)loopset f=FirstOfGroup(g)exitwhen f==nullcall UnitDamageTarget(u,f,$C*Hb,true,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_MAGIC,WEAPON_TYPE_WHOKNOWS)call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\DeathandDecay\\DeathandDecayDamage.mdl",f,"origin"))call GroupRemoveUnit(g,f)endloopcall DestroyGroup(g)call SaveInteger(wx,1,Gb,In+1)endifset u=nullset t=nullset g=nullset f=nullendfunctionfunction MH takes nothing returns nothinglocal unit pH=GetSpellAbilityUnit()local location PH=GetSpellTargetLoc()local integer Id=GetSpellAbilityId()local integer In=1local timer t=CreateTimer()local integer Gb=GetHandleId(t)call GroupEnumUnitsInRangeOfLoc(Hx,PH,225.+25.*I2R(GetUnitAbilityLevel(pH,Id)),Condition(function Kc))call RemoveLocation(PH)call EnableTrigger(wV)call EnableTrigger(WV)call SaveInteger(wx,1,Gb,1)call SaveInteger(wx,2,Gb,$A)call SaveUnitHandle(wx,3,Gb,pH)call TimerStart(t,1,true,function mH)set pH=nullset PH=nullset t=nullendfunctionfunction QH takes nothing returns booleanreturn GetUnitTypeId(GetAttacker())=='E00E' and IsUnitInGroup(GetTriggerUnit(),Hx)endfunctionfunction sH takes nothing returns nothingcall UnitDamageTarget(GetAttacker(),GetEnumUnit(),30*GetUnitAbilityLevel(hx,'A0BB'),true,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_MAGIC,WEAPON_TYPE_WHOKNOWS)endfunctionfunction SH takes nothing returns nothinglocal unit Xg=GetAttacker()local unit u=GetTriggerUnit()local integer tH=GetHeroAgi(Xg,false)call TriggerSleepAction(.1)call ForGroup(Hx,function sH)if GetUnitAbilityLevel(Xg,'B01Q')>0 thencall UnitDamageTarget(Xg,u,1.5*tH,true,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_MAGIC,WEAPON_TYPE_WHOKNOWS)call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\ReplenishMana\\SpiritTouchTarget.mdl",GetTriggerUnit(),"origin"))endifset u=nullset Xg=nullendfunctionfunction uH takes nothing returns booleanreturn IsUnitInGroup(GetDyingUnit(),Hx)endfunctionfunction UH takes nothing returns nothingcall GroupRemoveUnit(Hx,GetDyingUnit())endfunctionfunction WH takes nothing returns nothingif GetLearnedSkill()=='A0BE' thencall UnitAddAbility(GetLearningUnit(),'A0CT')call EnableTrigger(YV)call DestroyTrigger(yV)endifendfunctionfunction YH takes nothing returns nothinglocal unit Xg=GetEventDamageSource()local unit ed=GetTriggerUnit()local unit zHlocal player plocal integer Hb=GetUnitAbilityLevel(Xg,'A0BE')local location Tlocal integer ZHlocal integer VCif Xg==hx and GetUnitAbilityLevel(ed,'B027')>0 and to<3+Hb thencall TriggerSleepAction(.01)set p=GetOwningPlayer(Xg)set ZH=GetHeroLevel(Xg)set VC=GetRandomInt(1,6)if VC==1 thenset T=GetUnitLoc(Xg)set zH=CreateUnitAtLoc(p,'E00E',T,GetUnitFacing(Xg))set to=to+1call SetUnitUserData(zH,$B)call GroupAddUnit(lx,zH)call UnitApplyTimedLife(zH,'BTLF',6.+2.*Hb)call SetHeroLevel(zH,ZH,false)call SuspendHeroXP(zH,not false)call SetUnitLifePercentBJ(zH,GetUnitLifePercent(Xg))call UnitAddAbility(zH,'A0AR')call UnitAddAbility(zH,'A0BC')if Hb==1 thencall vd(zH,.5)elseif Hb==2 thencall vd(zH,.75)elsecall vd(zH,1.)endifendifif jx thencall DD(zH)endifendifendifset Xg=nullset ed=nullset zH=nullset p=nullset T=nullendfunctionfunction vj takes nothing returns booleanreturn GetAttacker()==hx and IsUnitEnemy(GetAttacker(),GetOwningPlayer(GetTriggerUnit()))endfunctionfunction ej takes nothing returns nothingcall DestroyTrigger(zx)set zx=CreateTrigger()call TriggerRegisterUnitEvent(zx,GetTriggerUnit(),EVENT_UNIT_DAMAGED)call TriggerAddAction(zx,function YH)endfunctionfunction oj takes nothing returns nothingif GetLearnedSkill()=='A0GP' thencall EnableTrigger(ZV)call DestroyTrigger(zV)endifendfunctionfunction ij takes nothing returns nothinglocal timer t=GetExpiredTimer()set jx=falsecall EnableTrigger(ZV)call DestroyTimer(t)set t=nullendfunctionfunction aj takes unit u returns nothinglocal group g=CreateGroup()local timer t=CreateTimer()local integer Hb=GetUnitAbilityLevel(u,'A0GP')local unit fset jx=trueset g=cN('E00E')call GroupAddUnit(g,u)loopset f=FirstOfGroup(g)exitwhen f==nullif GetWidgetLife(f)>.405 and GetUnitAbilityLevel(f,'A0BF')==0 thencall DD(f)endifcall GroupRemoveUnit(g,f)endloopcall DestroyGroup(g)call TimerStart(t,4+Hb,false,function ij)set g=nullset t=nullset f=nullendfunctionfunction nj takes nothing returns nothinglocal unit u=GetTriggerUnit()local unit Xg=GetAttacker()local integer VCif u==hx and IsUnitEnemy(u,GetOwningPlayer(Xg))thenset VC=GetRandomInt(1,6)if VC==1 thencall DisableTrigger(ZV)call aj(u)endifendifset u=nullset Xg=nullendfunctionfunction Ej takes nothing returns nothingif GetLearnedSkill()=='A04A' thencall EnableTrigger(eE)call DestroyTrigger(vE)endifendfunctionfunction Xj takes nothing returns nothinglocal unit uA=GetSpellAbilityUnit()local unit dd=gxlocal location SF=GetUnitLoc(uA)local location Oj=GetUnitLoc(dd)local timer t=CreateTimer()local integer Gb=GetHandleId(t)local integer fdlocal unit fif GetWidgetLife(dd)>.405 and IsUnitEnemy(uA,GetOwningPlayer(dd))and DistanceBetweenPoints(SF,Oj)<=550. thencall RemoveLocation(SF)call RemoveLocation(Oj)set fd=GetUnitAbilityLevel(dd,'A04A')call UnitDamageTarget(dd,uA,100.*I2R(fd),true,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_MAGIC,WEAPON_TYPE_WHOKNOWS)call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\Monsoon\\MonsoonBoltTarget.mdl",uA,"origin"))set f=CreateUnitAtLoc(GetOwningPlayer(dd),'h00P',GetUnitLoc(uA),GetUnitFacing(uA))call UnitAddAbility(f,'A0D1')call IssueTargetOrderById(f,$D006B,uA)call SaveUnitHandle(wx,1,Gb,f)call TimerStart(t,5,false,function gb)endifset uA=nullset dd=nullset SF=nullset Oj=nullset f=nullset t=nullendfunctionfunction Rj takes nothing returns booleanreturn GetSpellAbilityId()=='A04G' or GetSpellAbilityId()=='A08G'endfunctionfunction Ij takes nothing returns nothinglocal integer In=1local effect elocal unit uA=GetSpellTargetUnit()loopexitwhen In>5 or GetWidgetLife(uA)<=.405set e=AddSpecialEffectTarget("Abilities\\Spells\\Items\\AIre\\AIreTarget.mdl",uA,"origin")call TriggerSleepAction(1)call DestroyEffect(e)set In=In+1endloopset uA=nullset e=nullendfunctionfunction Aj takes nothing returns nothinglocal unit Xg=GetEventDamageSource()local unit ed=GetTriggerUnit()local unit clocal player plocal integer Hbif GetUnitTypeId(Xg)=='H00M' and GetUnitAbilityLevel(ed,'B01O')>0 thencall TriggerSleepAction(.01)set p=GetOwningPlayer(Xg)set Hb=GetUnitAbilityLevel(Xg,'A09K')set c=CreateUnit(p,'h011',GetWidgetX(ed),GetWidgetY(ed),GetUnitFacing(ed))call UnitAddAbility(c,'A0CU')call SetUnitAbilityLevel(c,'A0CU',Hb)call IssueImmediateOrderById(c,$D009F)call TriggerSleepAction(.1)call RemoveUnit(c)call DestroyTrigger(GetTriggeringTrigger())endifset Xg=nullset ed=nullset p=nullset c=nullendfunctionfunction Nj takes nothing returns nothinglocal trigger qB=CreateTrigger()call TriggerRegisterUnitEvent(qB,GetSpellTargetUnit(),EVENT_UNIT_DAMAGED)call TriggerAddAction(qB,function Aj)call TriggerSleepAction(5)call DestroyTrigger(qB)set qB=nullendfunctionfunction bj takes nothing returns booleanreturn GetSpellAbilityId()=='A0AS'endfunctionfunction Bj takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer Gb=GetHandleId(t)local unit u=LoadUnitHandle(wx,1,Gb)call SetUnitAbilityLevel(u,'A0EO',0)call DestroyTimer(t)set t=nullset u=nullendfunctionfunction cj takes nothing returns nothinglocal unit u=GetSpellAbilityUnit()local integer Hb=GetUnitAbilityLevel(u,'A0AS')local timer t=CreateTimer()local integer Gb=GetHandleId(t)call SetUnitAbilityLevel(u,'A0EO',Hb+1)call SaveUnitHandle(wx,1,Gb,u)call TimerStart(t,8,false,function Bj)set t=nullset u=nullendfunctionfunction Cj takes nothing returns nothingif(GetLearnedSkill()=='A0AL')thencall EnableTrigger(aE)call DestroyTrigger(iE)endifendfunctionfunction dj takes nothing returns nothinglocal integer Yglocal unit ygif(GetUnitTypeId(GetTriggerUnit())=='H00M')thenset yg=GetTriggerUnit()set Yg=GetUnitAbilityLevel(yg,'A0AL')if(fx<8)thenset fx=(fx+1)call SetUnitAbilityLevel(yg,'A0AK',fx)call TriggerSleepAction(1.+I2R(Yg))set fx=(fx-1)call SetUnitAbilityLevel(yg,'A0AK',fx)endifendifset yg=nullendfunctionfunction Dj takes nothing returns booleanreturn GetSpellAbilityId()=='A0AT'endfunctionfunction fj takes nothing returns nothinglocal unit uA=GetSpellAbilityUnit()local integer Hb=GetUnitAbilityLevel(uA,'A0AT')local player p=GetOwningPlayer(uA)local location Fj=GetSpellTargetLoc()local unit clocal effect elocal timer t=CreateTimer()local integer Gb=GetHandleId(t)set e=AddSpecialEffectLoc("Abilities\\Spells\\Undead\\DeathPact\\DeathPactTarget.mdl",Fj)set c=CreateUnitAtLoc(p,'h00P',Fj,0)call UnitAddAbility(c,'A0EN')call SetUnitAbilityLevel(c,'A0EN',Hb)call IssueImmediateOrderById(c,$D011D)call SaveUnitHandle(wx,1,Gb,c)call TimerStart(t,5,false,function gb)call RemoveLocation(Fj)set t=nullset t=CreateTimer()set Gb=GetHandleId(t)call SaveEffectHandle(wx,1,Gb,e)call TimerStart(t,5,false,function wB)set uA=nullset Fj=nullset p=nullset c=nullset t=nullset e=nullendfunctionfunction gj takes nothing returns nothinglocal unit yglocal integer Ygif(GetLearnedSkill()=='A0AC')thenset yg=GetLearningUnit()set Yg=GetUnitAbilityLevel(yg,'A0AC')call SetUnitAbilityLevel(yg,'A0AA',Yg+1)call SetUnitAbilityLevel(yg,'A0AB',Yg+1)if(Yg==3)thencall DestroyTrigger(VE)endifendifset yg=nullendfunctionfunction Gj takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer Gb=GetHandleId(t)local unit u=LoadUnitHandle(wx,1,Gb)local integer dc=LoadInteger(wx,2,Gb)if GetUnitAbilityLevel(u,'B01K')==0 thencall SetHeroStr(u,GetHeroStr(u,false)-dc,true)call SetHeroInt(u,GetHeroInt(u,false)-dc,true)call SetHeroAgi(u,GetHeroAgi(u,false)-dc,true)call FlushChildHashtable(wx,Gb)call DestroyTimer(t)endifset u=nullset t=nullendfunctionfunction hj takes nothing returns nothinglocal integer Hblocal unit yg=GetSpellAbilityUnit()local timer tlocal integer Gbif GetSpellAbilityId()=='A0AH' and GetUnitAbilityLevel(yg,'B01K')==0 thenset Hb=GetUnitAbilityLevel(yg,'A0AH')call SetHeroStr(yg,GetHeroStr(yg,false)+30*Hb,true)call SetHeroInt(yg,GetHeroInt(yg,false)+30*Hb,true)call SetHeroAgi(yg,GetHeroAgi(yg,false)+30*Hb,true)set t=CreateTimer()set Gb=GetHandleId(t)call SaveUnitHandle(wx,1,Gb,yg)call SaveInteger(wx,2,Gb,Hb*30)call TimerStart(t,.25,true,function Gj)endifset yg=nullset t=nullendfunctionfunction Hj takes nothing returns nothinglocal integer kd=('A0AE')local integer jj=('h00L')local unit Kh=GetSpellAbilityUnit()local player Jj=GetOwningPlayer(Kh)local location kj=GetUnitLoc(Kh)local location Kj=GetSpellTargetLoc()local integer fd=GetUnitAbilityLevelSwapped(kd,Kh)local real lj=Dd(fd)local real Lj=(70.)local unit fset Ax=Khif(GetSpellAbilityId()==kd)thencall PauseUnit(Ax,true)call SetUnitAnimation(Ax,"attack")call TriggerSleepAction(.3)set Ix=CreateUnitAtLoc(Jj,jj,kj,AngleBetweenPoints(kj,Kj))set RE=CreateTrigger()call TriggerAddAction(RE,function hd)call TriggerRegisterUnitInRange(RE,Ix,Lj,null)call EnableTrigger(RE)call EnableTrigger(OE)call PauseUnit(Ax,false)call TriggerSleepAction(lj)call DestroyTrigger(RE)call KillUnit(Ix)call SetUnitAnimation(Ax,"stand")call TriggerSleepAction(.01)call RemoveUnit(Ix)call DisableTrigger(OE)endifcall RemoveLocation(Kj)call RemoveLocation(kj)set Kj=nullset kj=nullset Jj=nullset Kh=nullendfunctionfunction mj takes nothing returns nothinglocal location sB=GetUnitLoc(Ix)local real r=GetUnitFacing(Ix)local integer SB=(2)local real r2local location tBif(SB==1)thenset r2=5.elseif(SB==2)thenset r2=10.elseif(SB==3)thenset r2=20.endifset tB=aN(sB,r2,r)call SetUnitPositionLoc(Ix,tB)call RemoveLocation(tB)call RemoveLocation(sB)set tB=nullset sB=nullendfunctionfunction Mj takes nothing returns nothingif(GetLearnedSkill()=='A0A3')thencall EnableTrigger(AE)call DestroyTrigger(IE)endifendfunctionfunction pj takes nothing returns nothinglocal unit Pjlocal unit qjlocal integer Qjlocal integer Yglocal effect FGlocal boolean Allylocal boolean sjlocal real Sjif(GetTriggerUnit()==Mx)thenset Pj=GetTriggerUnit()set qj=GetAttacker()set Sj=GetUnitState(qj,UNIT_STATE_MANA)set Yg=GetUnitAbilityLevel(Pj,'A0A3')if IsUnitEnemy(Pj,GetOwningPlayer(qj))thenset Qj=GetRandomInt(1,'d')if Qj<=33 thencall TriggerSleepAction(.2)call UnitDamageTarget(Pj,qj,(50.*I2R(Yg)),true,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_NORMAL,WEAPON_TYPE_WHOKNOWS)call SetUnitState(qj,UNIT_STATE_MANA,(Sj-(50.*I2R(Yg))))set FG=AddSpecialEffectTarget("Abilities\\Spells\\Orc\\FeralSpirit\\feralspiritdone.mdl",qj,"origin")call DestroyEffect(FG)endifendifendifset Pj=nullset qj=nullset FG=nullendfunctionfunction tj takes nothing returns nothinglocal integer Hblocal integer array idlocal unit uif GetLearnedSkill()=='A0A4' thenset id[1]='A0HJ'set id[2]='A0HK'set id[3]='A0HL'set u=GetLearningUnit()set Hb=GetUnitAbilityLevel(u,'A0A4')call UnitAddAbility(u,id[Hb])if Hb==1 thencall EnableTrigger(bE)endifif Hb==3 thencall DestroyTrigger(NE)endifendifset u=nullendfunctionfunction Tj takes nothing returns nothinglocal unit u=Mxlocal real uj=GetUnitState(u,UNIT_STATE_MAX_LIFE)local real Uj=GetWidgetLife(u)local real wj='d'*Uj/ujif Uj>.405 thencall SetWidgetLife(u,Uj+uj*('d'-wj)*(.000025*GetUnitAbilityLevel(u,'A0A4')+.0000125))endifset u=nullendfunctionfunction Wj takes nothing returns nothinglocal unit uE=GetEnumUnit()local unit uA=GetSpellAbilityUnit()if((GetWidgetLife(uE)>.405)and(IsUnitAlly(uE,GetOwningPlayer(uA))==false))thencall UnitDamageTargetBJ(uA,uE,(100.*I2R(GetUnitAbilityLevel(uA,'A0A5'))),ATTACK_TYPE_NORMAL,DAMAGE_TYPE_MAGIC)call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\DeathandDecay\\DeathandDecayDamage.mdl",uE,"origin"))endifset uE=nullset uA=nullendfunctionfunction yj takes nothing returns nothinglocal unit uTlocal unit uAlocal group gif(GetSpellAbilityId()=='A0A5')thenset uT=GetSpellTargetUnit()set uA=GetSpellAbilityUnit()call TriggerSleepAction((.1+(DistanceBetweenPoints(GetUnitLoc(uA),GetUnitLoc(uT))/1350.)))set g=CreateGroup()call GroupEnumUnitsInRange(g,GetWidgetX(uA),GetWidgetY(uA),450.,null)call ForGroup(g,function Wj)call DestroyGroup(g)endifset uT=nullset uA=nullset g=nullendfunctionfunction Yj takes nothing returns booleanreturn GetSpellAbilityId()=='A09O'endfunctionfunction zj takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer Gb=GetHandleId(t)local group g=CreateGroup()local group g2=CreateGroup()local integer In=LoadInteger(wx,1,Gb)local integer xc=LoadInteger(wx,2,Gb)local unit uA=LoadUnitHandle(wx,3,Gb)local integer Hb=GetUnitAbilityLevel(uA,'A09O')local player p=GetOwningPlayer(uA)local real Gd=20*Hblocal unit flocal unit fflocal effect elocal timer ttlocal integer LDlocal location Lset g=LoadGroupHandle(wx,4,Gb)if In>xc or FirstOfGroup(g)==null thencall DestroyGroup(g)call DestroyTimer(t)elseset g2=ZC(g)loopset f=FirstOfGroup(g2)exitwhen f==nullset tt=nullset tt=CreateTimer()set LD=GetHandleId(tt)if IsUnitEnemy(f,p)and jb(f)thenset e=AddSpecialEffectTarget("Abilities\\Spells\\NightElf\\CorrosiveBreath\\ChimaeraAcidTargetArt.mdl",f,"head")if GetWidgetLife(f)>.405 thencall UnitDamageTarget(uA,f,Gd,false,false,null,DAMAGE_TYPE_UNIVERSAL,WEAPON_TYPE_WHOKNOWS)elsecall GroupRemoveUnit(g,f)endifelseif jb(f)thenset e=AddSpecialEffectTarget("Abilities\\Spells\\NightElf\\FaerieFire\\FaerieFireTarget.mdl",f,"head")call SetWidgetLife(f,GetWidgetLife(f)+Gd+25)endifendifcall SaveEffectHandle(wx,1,LD,e)call TimerStart(tt,.5,false,function wB)call GroupRemoveUnit(g2,f)endloopcall SaveInteger(wx,1,Gb,In+1)endifcall DestroyGroup(g2)set t=nullset g=nullset g2=nullset uA=nullset f=nullset p=nullset tt=nullset e=nullset ff=nullset L=nullendfunctionfunction Zj takes nothing returns nothinglocal unit uA=GetSpellAbilityUnit()local group g=CreateGroup()local group n=CreateGroup()local unit flocal location T=GetSpellTargetLoc()local timer t=CreateTimer()local integer Gb=GetHandleId(t)call GroupEnumUnitsInRangeOfLoc(g,T,$FA,null)call RemoveLocation(T)set n=ZC(g)loopset f=FirstOfGroup(n)exitwhen f==nullif GetWidgetLife(f)<=.405 thencall GroupRemoveUnit(g,f)endifcall GroupRemoveUnit(n,f)endloopcall DestroyGroup(n)call SaveInteger(wx,1,Gb,1)call SaveInteger(wx,2,Gb,8)call SaveUnitHandle(wx,3,Gb,uA)call SaveGroupHandle(wx,4,Gb,g)call TimerStart(t,1,true,function zj)set g=nullset n=nullset uA=nullset f=nullset T=nullset t=nullendfunctionfunction vJ takes nothing returns booleanreturn GetSpellAbilityId()=='A0HM' or GetSpellAbilityId()=='A0HN'endfunctionfunction eJ takes nothing returns nothinglocal unit uA=GetSpellAbilityUnit()local player p=GetOwningPlayer(uA)local group g=CreateGroup()local integer Hb=GetUnitAbilityLevel(uA,GetSpellAbilityId())local unit flocal real xJlocal real Gdlocal real Jblocal boolean b=falselocal boolean sp=falselocal timer tlocal integer Gblocal effect ecall GroupEnumUnitsInRange(g,GetUnitX(uA),GetUnitY(uA),500,null)if GetSpellAbilityId()=='A0HN' thenset sp=trueendifif Hb==3 thenset b=trueelseif Hb==1 thenif sp thenset xJ=$FAset Gd=$96elseset xJ='d'set Gd=60endifelseif sp thenset xJ=500set Gd=300elseset xJ=300set Gd=$96endifendifendifloopset f=FirstOfGroup(g)exitwhen f==nullif GetWidgetLife(f)>.405 and IsUnitAlly(f,p)thenif b thenif sp thenset Jb=35*(GetUnitState(f,UNIT_STATE_MAX_LIFE)/'d')call SetWidgetLife(f,GetWidgetLife(f)+Jb)elseset Jb=25*(GetUnitState(f,UNIT_STATE_MAX_LIFE)/'d')call SetWidgetLife(f,GetWidgetLife(f)+Jb)endifelsecall SetWidgetLife(f,GetWidgetLife(f)+xJ)endifset e=AddSpecialEffectTarget("Abilities\\Spells\\Human\\Heal\\HealTarget.mdl",f,"origin")set t=CreateTimer()set Gb=GetHandleId(t)call SaveEffectHandle(wx,1,Gb,e)call TimerStart(t,.5,false,function wB)set t=nullendifif GetWidgetLife(f)>.405 and IsUnitEnemy(f,p)and jb(f)thenif b thenif sp thenset Jb=30*(GetUnitState(f,UNIT_STATE_MAX_LIFE)/'d')call UnitDamageTarget(uA,f,Jb,false,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_NORMAL,WEAPON_TYPE_WHOKNOWS)elseset Jb=20*(GetUnitState(f,UNIT_STATE_MAX_LIFE)/'d')call UnitDamageTarget(uA,f,Jb,false,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_NORMAL,WEAPON_TYPE_WHOKNOWS)endifelsecall UnitDamageTarget(uA,f,Gd,false,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_NORMAL,WEAPON_TYPE_WHOKNOWS)endifset e=AddSpecialEffectTarget("Abilities\\Spells\\Undead\\CarrionSwarm\\CarrionSwarmDamage.mdl",f,"origin")set t=CreateTimer()set Gb=GetHandleId(t)call SaveEffectHandle(wx,1,Gb,e)call TimerStart(t,.7,false,function wB)set t=nullendifcall GroupRemoveUnit(g,f)endloopcall DestroyGroup(g)set f=nullset uA=nullset p=nullset g=nullset e=nullendfunctionfunction oJ takes nothing returns booleanreturn GetLearnedSkill()=='A08I' or GetLearnedSkill()=='A09Y'endfunctionfunction rJ takes nothing returns nothingcall TriggerRegisterUnitEvent(DE,Qe,EVENT_UNIT_DAMAGED)call DestroyTrigger(dE)endfunctionfunction iJ takes nothing returns nothinglocal unit u=GetTriggerUnit()local unit s=GetEventDamageSource()local integer Hblocal real Uhif se thenset Hb=GetUnitAbilityLevel(u,'A09Y')set Uh=40+$A*I2R(Hb)elseset Hb=GetUnitAbilityLevel(u,'A08I')set Uh=20+$A*I2R(Hb)endifcall UnitDamageTarget(u,s,Uh,true,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_MAGIC,WEAPON_TYPE_WHOKNOWS)set u=nullset s=nullendfunctionfunction aJ takes nothing returns booleanreturn GetSpellAbilityId()=='A0EE'endfunctionfunction nJ takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer Gb=GetHandleId(t)local effect e=LoadEffectHandle(wx,1,Gb)call DestroyEffect(e)call DestroyTimer(t)set e=nullset t=nullendfunctionfunction VJ takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer Gb=GetHandleId(t)local group g=CreateGroup()local group g2=CreateGroup()local integer In=LoadInteger(wx,1,Gb)local integer xc=LoadInteger(wx,2,Gb)local unit uA=LoadUnitHandle(wx,3,Gb)local integer Hb=GetUnitAbilityLevel(uA,'A0EE')local player p=GetOwningPlayer(uA)local real xplocal real Gdlocal unit fset g=LoadGroupHandle(wx,4,Gb)if In>xc or FirstOfGroup(g)==null thencall DestroyGroup(g)call DestroyTimer(t)elseset g2=ZC(g)loopset f=FirstOfGroup(g2)exitwhen f==nullset xp=GetUnitState(f,UNIT_STATE_MAX_LIFE)set Gd=(xp*(2+Hb))/'d'if GetWidgetLife(f)>.405 thencall UnitDamageTarget(uA,f,Gd,true,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_MAGIC,WEAPON_TYPE_WHOKNOWS)elsecall GroupRemoveUnit(g,f)endifcall GroupRemoveUnit(g2,f)endloopcall SaveInteger(wx,1,Gb,In+1)endifcall DestroyGroup(g2)set t=nullset g=nullset g2=nullset uA=nullset f=nullset p=nullendfunctionfunction EJ takes nothing returns nothinglocal unit uA=GetSpellAbilityUnit()local location T=GetUnitLoc(uA)local player p=GetOwningPlayer(uA)local integer Hb=GetUnitAbilityLevel(uA,'A0EE')local group g=CreateGroup()local group g2=CreateGroup()local timer t=CreateTimer()local integer Gb=GetHandleId(t)local timer tt=CreateTimer()local integer LD=GetHandleId(tt)local timer te=CreateTimer()local integer fG=GetHandleId(te)local unit flocal effect elocal unit c=CreateUnitAtLoc(p,'h00P',T,0)call UnitAddAbility(c,'A0ED')call IssueImmediateOrderById(c,$D011D)set e=AddSpecialEffectTarget("Abilities\\Spells\\Undead\\ReplenishMana\\ReplenishManaCasterOverhead.mdl",uA,"overhead")call SaveEffectHandle(wx,1,fG,e)call TimerStart(te,5,false,function nJ)set g=AN(450,T,Condition(function Kc))set g2=ZC(g)loopset f=FirstOfGroup(g2)exitwhen f==nullcall UnitDamageTarget(uA,f,$96*Hb,true,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_MAGIC,WEAPON_TYPE_WHOKNOWS)call GroupRemoveUnit(g2,f)endloopcall DestroyGroup(g2)call SaveUnitHandle(wx,1,Gb,c)call TimerStart(t,.5,false,function gb)call RemoveLocation(T)call SaveInteger(wx,1,LD,1)call SaveInteger(wx,2,LD,7)call SaveUnitHandle(wx,3,LD,uA)call SaveGroupHandle(wx,4,LD,g)call TimerStart(tt,1,true,function VJ)set c=nullset g=nullset g2=nullset f=nullset uA=nullset T=nullset t=nullset p=nullset te=nullset e=nullendfunctionfunction XJ takes nothing returns booleanreturn GetSpellAbilityId()=='A033'endfunctionfunction OJ takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer Gb=GetHandleId(t)local unit u=LoadUnitHandle(wx,1,Gb)local effect e=LoadEffectHandle(wx,2,Gb)set Po=falsecall SetUnitInvulnerable(u,false)call DestroyEffect(e)call DestroyTimer(t)set u=nullset e=nullset t=nullendfunctionfunction RJ takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer Gb=GetHandleId(t)local unit u=LoadUnitHandle(wx,1,Gb)local integer Hb=GetUnitAbilityLevel(u,'A033')local timer tt=CreateTimer()local integer LD=GetHandleId(tt)local integer ZF=Hb+1local effect e=AddSpecialEffectTarget("Abilities\\Spells\\Other\\Drain\\DrainCaster.mdl",u,"origin")set Po=truecall SetUnitInvulnerable(u,true)call SaveUnitHandle(wx,1,LD,u)call SaveEffectHandle(wx,2,LD,e)call TimerStart(tt,ZF,false,function OJ)call DestroyTimer(t)set u=nullset t=nullset tt=nullset e=nullendfunctionfunction IJ takes nothing returns nothinglocal unit u=GetSpellAbilityUnit()local timer t=CreateTimer()local integer Gb=GetHandleId(t)call SaveUnitHandle(wx,1,Gb,u)call TimerStart(t,.0,false,function RJ)set u=nullset t=nullendfunctionfunction AJ takes nothing returns nothingif(GetLearnedSkill()=='A04R')thencall EnableTrigger(GE)call DestroyTrigger(gE)endifendfunctionfunction NJ takes nothing returns nothinglocal integer Yglocal unit Pjlocal unit qjlocal effect FGlocal player Pif(GetUnitTypeId(GetAttacker())=='U005')thenset Pj=GetAttacker()set Yg=GetUnitAbilityLevel(Pj,'A04R')set qj=GetTriggerUnit()set P=GetOwningPlayer(Pj)if IsUnitEnemy(qj,P)thencall TriggerSleepAction(.15)set je=je+1if(je>=5)thenset je=0call UnitDamageTarget(Pj,qj,(150.*I2R(Yg)),true,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_NORMAL,WEAPON_TYPE_WHOKNOWS)set FG=AddSpecialEffectTarget("Abilities\\Spells\\Human\\Thunderclap\\ThunderClapCaster.mdl",qj,"origin")call TriggerSleepAction(.2)call DestroyEffect(FG)endifendifendifset Pj=nullset qj=nullset FG=nullset P=nullendfunctionfunction bJ takes nothing returns nothingif(GetLearnedSkill()=='A04M')thencall EnableTrigger(HE)call DestroyTrigger(hE)endifendfunctionfunction BJ takes nothing returns nothinglocal unit Pjlocal unit qjlocal integer Yglocal boolean cJlocal boolean sjlocal effect eif GetUnitTypeId(GetTriggerUnit())=='U005' thenset Pj=GetTriggerUnit()set qj=GetAttacker()set cJ=IsUnitEnemy(Pj,GetOwningPlayer(qj))set sj=IsUnitType(qj,UNIT_TYPE_MELEE_ATTACKER)set Yg=GetUnitAbilityLevel(Pj,'A04M')if cJ and sj thencall TriggerSleepAction(.15)if GetRandomInt(1,5)==1 thencall UnitDamageTarget(Pj,qj,50.+50.*I2R(Yg),true,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_MAGIC,WEAPON_TYPE_WHOKNOWS)set e=AddSpecialEffectTarget("Abilities\\Spells\\Human\\SpellSteal\\SpellStealTarget.mdl",qj,"chest")call TriggerSleepAction(.2)call DestroyEffect(e)endifendifendifset e=nullset Pj=nullset qj=nullendfunctionfunction CJ takes nothing returns nothingif(GetLearnedSkill()=='A04O')thenset Ge=GetLearningUnit()call UnitAddAbility(GetLearningUnit(),'A0CQ')call EnableTrigger(JE)call DestroyTrigger(jE)endifendfunctionfunction dJ takes nothing returns nothinglocal unit Xg=GetEventDamageSource()local unit ed=GetTriggerUnit()local player plocal integer Hblocal group glocal unit flocal real Gdif Xg==Ge and GetUnitAbilityLevel(ed,'B024')>0 thencall TriggerSleepAction(.01)set p=GetOwningPlayer(Xg)set Hb=GetUnitAbilityLevel(Xg,'A04O')set Gd=Hb*60.set g=CreateGroup()call GroupEnumUnitsInRange(g,GetWidgetX(ed),GetWidgetY(ed),$96,null)loopset f=FirstOfGroup(g)exitwhen f==nullif IsUnitEnemy(f,p)and GetWidgetLife(f)>.405 thencall UnitDamageTarget(Xg,f,Gd,true,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_NORMAL,WEAPON_TYPE_WHOKNOWS)endifcall GroupRemoveUnit(g,f)endloopcall DestroyGroup(g)endifset Xg=nullset ed=nullset p=nullset g=nullset f=nullendfunctionfunction DJ takes nothing returns booleanreturn GetAttacker()==Ge and IsUnitEnemy(GetTriggerUnit(),GetOwningPlayer(GetAttacker()))endfunctionfunction fJ takes nothing returns nothingcall DestroyTrigger(yx)set yx=CreateTrigger()call TriggerRegisterUnitEvent(yx,GetTriggerUnit(),EVENT_UNIT_DAMAGED)call TriggerAddAction(yx,function dJ)endfunctionfunction FJ takes nothing returns nothinglocal unit ygif(GetSpellAbilityId()=='A04Q')thenset yg=GetSpellAbilityUnit()call TriggerSleepAction(1.)call UnitAddAbility(yg,'A0AG')call SetUnitAbilityLevel(yg,'A0AG',GetUnitAbilityLevel(yg,'A04Q'))call TriggerSleepAction(7.)call UnitRemoveAbility(yg,'A0AG')endifset yg=nullendfunctionfunction gJ takes nothing returns booleanreturn GetSpellAbilityId()=='A0D7'endfunctionfunction GJ takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer Gb=GetHandleId(t)local integer dc=LoadInteger(wx,3,Gb)local unit u=LoadUnitHandle(wx,2,Gb)local effect e=LoadEffectHandle(wx,1,Gb)local integer hJ=GetHeroAgi(u,false)call DestroyEffect(e)call SetHeroAgi(u,hJ-dc,true)call DestroyTimer(t)set u=nullset t=nullset e=nullendfunctionfunction HJ takes nothing returns nothinglocal timer t=CreateTimer()local integer Gb=GetHandleId(t)local unit u=GetSpellAbilityUnit()local integer Hb=GetUnitAbilityLevel(u,'A0D7')local integer dc=25*Hblocal integer hJ=GetHeroAgi(u,false)local effect e=AddSpecialEffectTarget("Abilities\\Spells\\Items\\OrbCorruption\\OrbCorruption.mdl",u,"overhead")call SetHeroAgi(u,dc+hJ,true)call SaveEffectHandle(wx,1,Gb,e)call SaveUnitHandle(wx,2,Gb,u)call SaveInteger(wx,3,Gb,dc)call TimerStart(t,3+Hb,false,function GJ)set t=nullset u=nullset e=nullendfunctionfunction jJ takes nothing returns booleanlocal trigger t=GetTriggeringTrigger()local unit u=LoadUnitHandle(wx,GetHandleId(t),0)if GetUnitAbilityLevel(u,'A0HU')>0 thencall UnitRemoveAbility(u,'A0I1')elsecall FlushChildHashtable(wx,GetHandleId(t))call DestroyTrigger(t)endifset t=nullset u=nullreturn falseendfunctionfunction JJ takes nothing returns booleanlocal trigger t=GetTriggeringTrigger()local integer h=GetHandleId(t)local unit kJ=LoadUnitHandle(wx,h,0)local unit u=LoadUnitHandle(wx,h,1)local integer Hb=LoadInteger(wx,h,2)local unit KJif GetTriggerEventId()==EVENT_UNIT_DAMAGED and GetEventDamageSource()==kJ thenif GetRandomInt(1,$A)==1 thenif IsUnitType(kJ,UNIT_TYPE_MELEE_ATTACKER)thenset KJ=CreateUnit(GetOwningPlayer(u),'h011',GetUnitX(u),GetUnitY(u),0)call UnitAddAbility(KJ,'A0HT')call SetUnitAbilityLevel(KJ,'A0HT',Hb)call IssueTargetOrderById(KJ,$D00DD,kJ)call UnitApplyTimedLife(KJ,'BTLF',1)set KJ=nullelsecall SetUnitState(u,UNIT_STATE_LIFE,GetUnitState(u,UNIT_STATE_LIFE)+GetEventDamage())endifendifendifcall DestroyTrigger(t)call FlushChildHashtable(wx,h)set t=nullset kJ=nullset u=nullreturn falseendfunctionfunction lJ takes nothing returns booleanlocal trigger tlocal integer hif GetTriggerEventId()==EVENT_UNIT_ATTACKED and IsUnitAlly(GetAttacker(),GetOwningPlayer(GetTriggerUnit()))==false thenset t=CreateTrigger()set h=GetHandleId(t)call TriggerRegisterUnitEvent(t,GetTriggerUnit(),EVENT_UNIT_DAMAGED)call TriggerRegisterTimerEvent(t,.8,false)call TriggerAddCondition(t,Condition(function JJ))call SaveUnitHandle(wx,h,0,GetAttacker())call SaveUnitHandle(wx,h,1,GetTriggerUnit())call SaveInteger(wx,h,2,LoadInteger(wx,GetHandleId(GetTriggeringTrigger()),1))elseif GetTriggerEventId()==EVENT_UNIT_DEATH and IsUnitType(GetTriggerUnit(),UNIT_TYPE_HERO)thenset t=CreateTrigger()call TriggerRegisterTimerEvent(t,1,true)call TriggerAddCondition(t,Condition(function jJ))call SaveUnitHandle(wx,GetHandleId(t),0,GetTriggerUnit())endifreturn falseendfunctionfunction LJ takes nothing returns nothinglocal timer t=GetExpiredTimer()local unit Lg=LoadUnitHandle(wx,GetHandleId(t),1)call DestroyTrigger(LoadTriggerHandle(wx,GetHandleId(t),0))call UnitRemoveAbility(Lg,'A0I1')call UnitRemoveAbility(Lg,'B042')call FlushChildHashtable(wx,GetHandleId(t))call DestroyTimer(t)call RemoveSavedHandle(wx,GetHandleId(Lg),1)set t=nullendfunctionfunction mJ takes nothing returns nothingcall DestroyEffect(LoadEffectHandle(wx,GetHandleId(GetExpiredTimer()),0))call DestroyTimer(GetExpiredTimer())endfunctionfunction MJ takes nothing returns nothinglocal integer pJ=GetUnitAbilityLevel(GetTriggerUnit(),GetSpellAbilityId())local trigger qBlocal unit Lg=GetSpellTargetUnit()local timer tlocal timer PJ=CreateTimer()local effect e=AddSpecialEffectTarget("Models\\KamennayaKozha.mdx",Lg,"origin")call TimerStart(PJ,.75,false,function mJ)call SaveEffectHandle(wx,GetHandleId(PJ),0,e)if HaveSavedHandle(wx,GetHandleId(Lg),1)thenset t=LoadTimerHandle(wx,GetHandleId(Lg),1)elseset t=CreateTimer()set qB=CreateTrigger()call SaveTimerHandle(wx,GetHandleId(Lg),1,t)call SaveTriggerHandle(wx,GetHandleId(t),0,qB)call SaveUnitHandle(wx,GetHandleId(t),1,Lg)call SetPlayerAbilityAvailable(GetOwningPlayer(Lg),'A0I1',true)call UnitAddAbility(Lg,'A0I1')call SetPlayerAbilityAvailable(GetOwningPlayer(Lg),'A0I1',false)call TriggerRegisterUnitEvent(qB,Lg,EVENT_UNIT_DEATH)call TriggerRegisterUnitEvent(qB,Lg,EVENT_UNIT_ATTACKED)call TriggerAddCondition(qB,Condition(function lJ))endifcall TimerStart(t,9+pJ*3,false,function LJ)call SetUnitAbilityLevel(Lg,'A0HU',pJ)call SetUnitAbilityLevel(Lg,'A0D6',pJ)call SetUnitAbilityLevel(Lg,'A0FY',pJ)call SaveInteger(wx,GetHandleId(qB),1,pJ)set qB=nullset Lg=nullset t=nullset PJ=nullset e=nullendfunctionfunction qJ takes nothing returns nothingif GetSpellAbilityId()=='A0CO' thencall MJ()endifendfunctionfunction QJ takes nothing returns booleanreturn GetSpellAbilityId()=='A06T' or GetSpellAbilityId()=='A08N'endfunctionfunction sJ takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer Gb=GetHandleId(t)local effect e=LoadEffectHandle(wx,1,Gb)call DestroyEffect(e)call FlushChildHashtable(wx,Gb)call DestroyTimer(t)set t=nullset e=nullendfunctionfunction SJ takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer Gb=GetHandleId(t)local group g=CreateGroup()local integer In=LoadInteger(wx,1,Gb)local integer xc=LoadInteger(wx,2,Gb)local unit u=LoadUnitHandle(wx,3,Gb)local integer Id=LoadInteger(wx,4,Gb)local location L=LoadLocationHandle(wx,5,Gb)local integer Hb=GetUnitAbilityLevel(u,Id)local real VN='}'+25*Hblocal player p=GetOwningPlayer(u)local timer jglocal integer Jglocal real Rlocal real Gdlocal unit flocal effect eif In>xc thencall RemoveLocation(L)call FlushChildHashtable(wx,Gb)call DestroyTimer(t)elseif Id=='A06T' thenset R=.0elseset R=60.endifcall GroupEnumUnitsInRangeOfLoc(g,L,VN,null)set Gd=R+40.*I2R(Hb)loopset f=FirstOfGroup(g)exitwhen f==nullif GetWidgetLife(f)>.405 and IsUnitEnemy(f,p)thenset jg=CreateTimer()set Jg=GetHandleId(jg)set e=AddSpecialEffectTarget("Abilities\\Spells\\Orc\\MirrorImage\\MirrorImageDeathCaster.mdl",f,"origin")call SaveEffectHandle(wx,1,Jg,e)call TimerStart(jg,.2,false,function sJ)call UnitDamageTarget(u,f,Gd,true,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_MAGIC,WEAPON_TYPE_WHOKNOWS)set jg=nullendifcall GroupRemoveUnit(g,f)endloopcall SaveInteger(wx,1,Gb,In+1)endifcall DestroyGroup(g)set t=nullset g=nullset u=nullset f=nullset L=nullset p=nullset e=nullendfunctionfunction tJ takes nothing returns nothinglocal unit TJ=GetSpellAbilityUnit()local location T=GetSpellTargetLoc()local integer Id=GetSpellAbilityId()local integer Hb=GetUnitAbilityLevel(TJ,Id)local real VN='}'+25*Hblocal timer t=CreateTimer()local integer Gb=GetHandleId(t)call TerrainDeformCrater(GetLocationX(T),GetLocationY(T),VN,100.*Hb,$FA0,false)call SaveInteger(wx,1,Gb,1)call SaveInteger(wx,2,Gb,4)call SaveUnitHandle(wx,3,Gb,TJ)call SaveInteger(wx,4,Gb,Id)call SaveLocationHandle(wx,5,Gb,T)call TimerStart(t,1,true,function SJ)set TJ=nullset T=nullset t=nullendfunctionfunction uJ takes nothing returns booleanreturn GetSpellAbilityId()=='A04L' or GetSpellAbilityId()=='A08O'endfunctionfunction UJ takes nothing returns nothinglocal location T=GetSpellTargetLoc()local integer Id=GetSpellAbilityId()local unit TJ=GetSpellAbilityUnit()local integer Hb=GetUnitAbilityLevel(TJ,Id)local player p=GetOwningPlayer(TJ)local timer t=CreateTimer()local integer Gb=GetHandleId(t)local real VN=$96+25*Hblocal unit fcall TerrainDeformCrater(GetLocationX(T),GetLocationY(T),VN,-'d'*Hb,$3E8*Hb,false)set f=CreateUnitAtLoc(p,'h00P',T,0)call RemoveLocation(T)call UnitAddAbility(f,'A0E2')call SetUnitAbilityLevel(f,'A0E2',Hb)call IssueImmediateOrderById(f,$D009F)call SaveUnitHandle(wx,1,Gb,f)call TimerStart(t,1,false,function gb)set T=nullset TJ=nullset f=nullset p=nullset t=nullendfunctionfunction wJ takes nothing returns nothinglocal unit u=GetSpellAbilityUnit()if GetSpellAbilityId()=='A04L' or GetSpellAbilityId()=='A08O' thenif ce==false and Pv==false and Ve==false thencall IssueImmediateOrderById(u,$D0004)call DisplayTimedTextToPlayer(GetOwningPlayer(u),0,0,4,"|cffff2400ПРЕДУПРЕЖДЕНИЕ:|r Сейчас запрещено использовать это заклинание!")endifendifset u=nullendfunctionfunction WJ takes nothing returns nothinglocal group glocal unit ulocal unit flocal unit clocal player plocal integer odlocal integer Idlocal real Gdif(GetSpellAbilityId()=='A031')thenset u=GetSpellAbilityUnit()set p=GetOwningPlayer(u)set Id=GetSpellAbilityId()set od=GetUnitAbilityLevel(u,Id)set Gd=od*300set g=CreateGroup()call GroupEnumUnitsInRangeOfLoc(g,GetUnitLoc(u),600,null)set c=CreateUnit(p,'h011',0,0,0)call UnitAddAbility(c,'A0CK')call SetUnitAbilityLevel(c,'A0CK',od)loopset f=FirstOfGroup(g)exitwhen f==nullif GetWidgetLife(f)>.405 and IsUnitEnemy(f,p)thencall UnitDamageTarget(u,f,Gd,true,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_MAGIC,WEAPON_TYPE_WHOKNOWS)if GetWidgetLife(f)>.405 thencall IssueTargetOrderById(c,$D00B5,f)endifendifcall GroupRemoveUnit(g,f)endloopcall TerrainDeformationRippleBJ(2.,false,GetUnitLoc(u),100.,600.,128.,1.5,512)call DestroyGroup(g)endifcall RemoveUnit(c)set g=nullset f=nullset c=nullset p=nullset u=nullendfunctionfunction yJ takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer Gb=GetHandleId(t)local unit c=LoadUnitHandle(wx,3,Gb)local integer In=LoadInteger(wx,1,Gb)local integer xc=LoadInteger(wx,2,Gb)local real r=LoadReal(wx,4,Gb)if In>xc or GetWidgetLife(c)<=.405 thencall DestroyTimer(t)elsecall SetWidgetLife(c,GetWidgetLife(c)+r)call SaveInteger(wx,1,Gb,In+1)endifset c=nullset t=nullendfunctionfunction YJ takes nothing returns nothinglocal unit uTlocal unit uAlocal real zJlocal integer Yglocal integer Inlocal location llocal timer tlocal integer Gblocal unit KJif GetUnitLevel(GetSpellTargetUnit())<6 and GetSpellAbilityId()=='A06Q' and IsUnitType(GetSpellTargetUnit(),UNIT_TYPE_HERO)==false and GetUnitUserData(GetSpellTargetUnit())==0 thenset uT=GetSpellTargetUnit()set uA=GetSpellAbilityUnit()set Yg=GetUnitAbilityLevel(uA,'A06Q')set l=GetUnitLoc(uT)call DestroyEffect(AddSpecialEffectLoc("Objects\\Spawnmodels\\Other\\PandarenBrewmasterBlood\\PandarenBrewmasterBlood.mdl",l))call RemoveLocation(l)set KJ=CreateUnit(GetOwningPlayer(uA),'h00P',0,0,.0)call UnitDamageTarget(KJ,uT,99999,true,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_NORMAL,WEAPON_TYPE_WHOKNOWS)call RemoveUnit(uT)call KillUnit(KJ)call RemoveUnit(KJ)call SetWidgetLife(uA,GetWidgetLife(uA)+50.*I2R(Yg))set zJ=$A*Ygset t=CreateTimer()set Gb=GetHandleId(t)call SaveInteger(wx,1,Gb,1)call SaveInteger(wx,2,Gb,$A)call SaveUnitHandle(wx,3,Gb,uA)call SaveReal(wx,4,Gb,zJ)call TimerStart(t,1,true,function yJ)endifset uA=nullset uT=nullset l=nullset t=nullset KJ=nullendfunctionfunction ZJ takes nothing returns booleanreturn GetLearnedSkill()=='A0FE'endfunctionfunction vk takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer Gb=GetHandleId(t)local unit u=LoadUnitHandle(wx,1,Gb)local group glocal location Tlocal unit flocal player plocal real dcif GetWidgetLife(u)<=.405 thenelseset p=GetOwningPlayer(u)set T=GetUnitLoc(u)set g=CreateGroup()call GroupEnumUnitsInRangeOfLoc(g,T,500,null)call RemoveLocation(T)loopset f=FirstOfGroup(g)exitwhen f==nullif(GetWidgetLife(f)>.405 and IsUnitAlly(f,p))thenset dc=GetHeroStr(f,false)*.5call SetWidgetLife(f,GetWidgetLife(f)+dc)endifcall GroupRemoveUnit(g,f)endloopcall DestroyGroup(g)endifset u=nullset t=nullset p=nullset T=nullset g=nullset f=nullendfunctionfunction ek takes nothing returns nothinglocal timer tlocal integer Gblocal unit u=GetLearningUnit()local integer Hb=GetUnitAbilityLevel(u,'A0FE')call SetUnitAbilityLevel(u,'A0FH',Hb+1)if Hb==1 thenset t=CreateTimer()set Gb=GetHandleId(t)call SaveUnitHandle(wx,1,Gb,u)call TimerStart(t,1,true,function vk)endifif Hb==3 thencall DestroyTrigger(qE)endifset u=nullset t=nullendfunctionfunction xk takes nothing returns nothingif(GetLearnedSkill()=='A06D')thencall EnableTrigger(sE)call DestroyTrigger(QE)endifendfunctionfunction ok takes nothing returns nothinglocal unit Ng=GetKillingUnit()local unit bg=GetDyingUnit()if((GetUnitTypeId(Ng)=='E006')and(IsUnitIllusion(bg)==false)and(IsUnitAlly(bg,GetOwningPlayer(Ng))==false))thenset Le=(Le+1)if(Le>=(7-GetUnitAbilityLevel(Ng,'A06D')))thenset Le=0call SetHeroAgi(Ng,GetHeroAgi(Ng,false)+1,true)call qD("+1",$A,GetWidgetX(GetTriggerUnit())+30,GetWidgetY(GetTriggerUnit()),$A,$CC,$A,.01,4)endifendifset Ng=nullset bg=nullendfunctionfunction rk takes nothing returns booleanreturn GetSpellAbilityId()=='A06C'endfunctionfunction ik takes nothing returns nothinglocal unit u=LoadUnitHandle(wx,1,GetHandleId(qo))local integer Hb=GetUnitAbilityLevel(u,'A06C')local real dc=(Hb*.02+.06)*GetUnitState(u,UNIT_STATE_MAX_LIFE)call SetWidgetLife(u,GetWidgetLife(u)+dc/$A)set u=nullendfunctionfunction ak takes nothing returns nothinglocal unit u=GetSpellAbilityUnit()call SetUnitInvulnerable(u,true)set qo=CreateTimer()call SaveUnitHandle(wx,1,GetHandleId(qo),u)call TimerStart(qo,.1,true,function ik)set eo=trueset u=nullendfunctionfunction nk takes nothing returns booleanreturn GetSpellAbilityId()=='A06C'endfunctionfunction Vk takes nothing returns nothinglocal unit u=GroupPickRandomUnit(cN('H00A'))local player p=GetOwningPlayer(u)local unit sp=GetSpellAbilityUnit()local boolean S=Mecall DestroyTimer(qo)set qo=nullif S==false thencall SetUnitInvulnerable(sp,false)elseif IsUnitEnemy(sp,p)thencall SetUnitInvulnerable(sp,false)endifendifset eo=falseset u=nullset p=nullset sp=nullendfunctionfunction Ek takes nothing returns booleanreturn GetSpellAbilityId()=='A02P'endfunctionfunction Xk takes nothing returns nothinglocal unit ulocal integer In=0local player p=GetOwningPlayer(br)loopexitwhen In>8set u=gv[In]if u!=null and IsUnitAlly(u,p)thencall UnitRemoveAbility(u,'Avul')call DestroyEffect(Br[In])endifset In=In+1endloopset u=nullset p=nullendfunctionfunction Ok takes nothing returns nothinglocal unit ulocal integer In=0local player p=GetOwningPlayer(br)loopexitwhen In>8set u=gv[In]if u!=null and GetWidgetLife(u)>.405 and IsUnitAlly(u,p)thencall UnitAddAbility(u,'Avul')set Br[In]=AddSpecialEffectTarget("Abilities\\Spells\\Undead\\DarkSummoning\\DarkSummonMissile.mdl",u,"chest")endifset In=In+1endloopset u=nullset p=nullendfunctionfunction Rk takes nothing returns nothinglocal integer In=0local unit Kh=brlocal player p=GetOwningPlayer(Kh)local unit uif GetUnitStatePercent(Kh,UNIT_STATE_LIFE,UNIT_STATE_MAX_LIFE)>2.7 and OrderId2String(GetUnitCurrentOrder(Kh))=="channel"thencall SetUnitState(Kh,UNIT_STATE_LIFE,GetUnitState(Kh,UNIT_STATE_MAX_LIFE)*RMaxBJ(0,GetUnitStatePercent(Kh,UNIT_STATE_LIFE,UNIT_STATE_MAX_LIFE)-2.5)*.01)call SetUnitState(Kh,UNIT_STATE_MANA,GetUnitState(Kh,UNIT_STATE_MAX_MANA)*RMaxBJ(0,GetUnitStatePercent(Kh,UNIT_STATE_MANA,UNIT_STATE_MAX_MANA)-2.5)*.01)loopexitwhen In>8set u=gv[In]if u!=null and GetWidgetLife(u)>.405 and IsUnitAlly(u,p)thenif u!=Kh thencall SetUnitState(u,UNIT_STATE_LIFE,GetUnitState(u,UNIT_STATE_MAX_LIFE)*RMaxBJ(0,GetUnitStatePercent(u,UNIT_STATE_LIFE,UNIT_STATE_MAX_LIFE)+2.5)*.01)call SetUnitState(u,UNIT_STATE_MANA,GetUnitState(u,UNIT_STATE_MAX_MANA)*RMaxBJ(0,GetUnitStatePercent(u,UNIT_STATE_MANA,UNIT_STATE_MAX_MANA)+2.5)*.01)endifendifset In=In+1endloopelsecall DestroyTimer(GetExpiredTimer())endifset Kh=nullset p=nullset u=nullendfunctionfunction Ik takes nothing returns nothingif GetTriggerEventId()==EVENT_UNIT_SPELL_CAST thencall TimerStart(CreateTimer(),.05,true,function Rk)elsecall Ok()call TimerStart(CreateTimer(),GetUnitAbilityLevel(GetSpellAbilityUnit(),'A02P')*3,false,function Xk)endifendfunctionfunction Ak takes nothing returns nothingif(GetLearnedSkill()=='A05W')thencall EnableTrigger(wE)call DestroyTrigger(UE)endifendfunctionfunction Nk takes nothing returns booleanreturn(GetSpellAbilityId()=='A05U')or(GetSpellAbilityId()=='A08K')or(GetSpellAbilityId()=='A02P')or(GetSpellAbilityId()=='A058')or(GetSpellAbilityId()=='A08L')endfunctionfunction bk takes nothing returns booleanreturn(IsUnitAlly(GetFilterUnit(),GetOwningPlayer(GetSpellAbilityUnit()))==false)endfunctionfunction Bk takes nothing returns nothinglocal unit u=GetEnumUnit()local unit Kh=GetSpellAbilityUnit()if GetWidgetLife(u)>.405 thencall UnitDamageTarget(Kh,u,(80.*I2R(GetUnitAbilityLevel(Kh,'A05W'))),true,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_MAGIC,WEAPON_TYPE_WHOKNOWS)call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\DispelMagic\\DispelMagicTarget.mdl",u,"origin"))endifset u=nullset Kh=nullendfunctionfunction ck takes nothing returns nothinglocal unit Kh=GetSpellAbilityUnit()local group gcall TriggerSleepAction(.1)call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\DispelMagic\\DispelMagicTarget.mdl",Kh,"origin"))set g=CreateGroup()call GroupEnumUnitsInRangeOfLoc(g,GetUnitLoc(Kh),375,Condition(function bk))call ForGroup(g,function Bk)call DestroyGroup(g)set Kh=nullset g=nullendfunctionfunction Ck takes nothing returns nothinglocal unit u=GetSpellAbilityUnit()if(GetSpellAbilityId()=='A05E')thencall UnitAddAbility(u,'A042')call EnableTrigger(yE)call TriggerSleepAction(10.)call UnitRemoveAbility(u,'A042')call DisableTrigger(yE)call DestroyTrigger(ro)endifset u=nullendfunctionfunction dk takes nothing returns nothinglocal integer PD=GetHandleId(GetEventDamageSource())local unit Xg=GetEventDamageSource()local unit ed=GetTriggerUnit()local player plocal integer Hblocal group glocal location Tlocal unit flocal integer Inlocal real Gdif GetUnitTypeId(Xg)=='O005' and GetUnitAbilityLevel(ed,'B02A')>0 thencall TriggerSleepAction(.01)set p=GetOwningPlayer(Xg)set Hb=GetUnitAbilityLevel(Xg,'A05E')set Gd=GetWidgetLife(Xg)*(.05*I2R(Hb)+.05)set g=CreateGroup()set T=GetUnitLoc(ed)call GroupEnumUnitsInRangeOfLoc(g,T,$E1,null)call RemoveLocation(T)loopset f=FirstOfGroup(g)exitwhen f==nullif IsUnitEnemy(f,p)and GetWidgetLife(f)>.405 thencall UnitDamageTarget(Xg,f,Gd,true,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_NORMAL,WEAPON_TYPE_WHOKNOWS)call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Human\\HumanBlood\\HumanBloodFootman.mdl",f,"origin"))endifcall GroupRemoveUnit(g,f)endloopcall DestroyGroup(g)endifset Xg=nullset ed=nullset p=nullset g=nullset T=nullset f=nullcall MD(PD)endfunctionfunction Dk takes nothing returns booleanreturn GetUnitTypeId(GetAttacker())=='O005' and IsUnitEnemy(GetTriggerUnit(),GetOwningPlayer(GetAttacker()))endfunctionfunction fk takes nothing returns nothinglocal trigger tlocal integer PD=GetHandleId(GetAttacker())call MD(PD)set t=CreateTrigger()call TriggerRegisterUnitEvent(t,GetTriggerUnit(),EVENT_UNIT_DAMAGED)call SaveTriggerHandle(wx,PD,1,t)call SaveTriggerActionHandle(wx,PD,2,TriggerAddAction(t,function dk))set t=nullendfunctionfunction Fk takes nothing returns nothingif(GetLearnedSkill()=='A05G')thenset pe[1]='n01F'set pe[2]='n01G'set pe[3]='n01H'call EnableTrigger(zE)call DestroyTrigger(YE)endifendfunctionfunction gk takes nothing returns booleanreturn GetWidgetLife(oe)>.405 and tv==false and IsUnitHidden(oe)==falseendfunctionfunction Gk takes nothing returns nothinglocal unit u=oelocal unit flocal integer fd=GetUnitAbilityLevel(u,'A05G')set f=CreateUnitAtLoc(GetOwningPlayer(u),pe[fd],GetUnitLoc(u),.0)call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Other\\BeastmasterBlood\\BeastmasterBlood.mdl",u,"origin"))call IssueTargetOrderById(f,$D0003,u)set u=nullset f=nullendfunctionfunction hk takes nothing returns booleanreturn GetSpellAbilityId()=='A056' or GetSpellAbilityId()=='A0AI'endfunctionfunction Hk takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer Gb=GetHandleId(t)local unit u=LoadUnitHandle(wx,1,Gb)local real Gd=$C8*GetUnitAbilityLevel(u,'A056')call UnitDamageTarget(u,u,Gd,true,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_NORMAL,WEAPON_TYPE_WHOKNOWS)call DestroyTimer(t)set t=nullset u=nullendfunctionfunction jk takes nothing returns nothinglocal timer t=CreateTimer()local integer Gb=GetHandleId(t)local unit u=GetSpellAbilityUnit()call SaveUnitHandle(wx,1,Gb,u)call TimerStart(t,.2,false,function Hk)set t=nullset u=nullendfunctionfunction Jk takes nothing returns booleanreturn GetLearnedSkill()=='A02Z'endfunctionfunction kk takes nothing returns nothingset xe=GetLearningUnit()call EnableTrigger(eX)call DestroyTrigger(vX)endfunctionfunction Kk takes nothing returns booleanreturn IsUnitEnemy(GetAttacker(),GetOwningPlayer(GetTriggerUnit()))endfunctionfunction lk takes nothing returns booleanlocal unit u=GetFilterUnit()if IsUnitEnemy(u,GetOwningPlayer(GetTriggerUnit()))and GetWidgetLife(u)>.405 thencall UnitDamageTarget(xe,u,80*GetUnitAbilityLevel(xe,'A02Z'),true,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_NORMAL,WEAPON_TYPE_WHOKNOWS)call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\Doom\\DoomDeath.mdl",u,"origin"))endifset u=nullreturn falseendfunctionfunction Lk takes nothing returns nothingset he=he+1if he>=16 thenset he=0call GroupEnumUnitsInRange(aA,GetWidgetX(GetTriggerUnit()),GetWidgetY(GetTriggerUnit()),280.,Condition(function lk))endifendfunctionfunction mk takes nothing returns nothinglocal unit uA=GetSpellAbilityUnit()local integer Id=GetSpellAbilityId()if Id=='A093' or Id=='A04H' thencall SetWidgetLife(uA,GetWidgetLife(uA)+150.*GetUnitAbilityLevel(uA,Id))call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\MarkOfChaos\\MarkOfChaosTarget.mdl",uA,"origin"))endifset uA=nullendfunctionfunction Mk takes nothing returns nothinglocal unit ulocal integer Yglocal effect eif(GetSpellAbilityId()=='A09E')thenset u=GetTriggerUnit()set Yg=GetUnitAbilityLevel(u,'A09E')call UnitAddAbility(u,'A0AU')set e=AddSpecialEffectTarget("Abilities\\Spells\\Orc\\LiquidFire\\Liquidfire.mdl",u,"origin")call TriggerSleepAction(1.+Yg)call UnitRemoveAbility(u,'A0AU')call DestroyEffect(e)endifset u=nullset e=nullendfunctionfunction Pk takes nothing returns booleanreturn GetSpellAbilityId()=='A04K'endfunctionfunction qk takes nothing returns booleanlocal unit f=GetFilterUnit()if IsUnitEnemy(f,DA)and GetWidgetLife(f)>.405 thencall UnitDamageTarget(jA,f,FA,false,false,null,DAMAGE_TYPE_MAGIC,WEAPON_TYPE_WHOKNOWS)call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\AnimateDead\\AnimateDeadTarget.mdl",f,"origin"))call IssueTargetOrderById(fA,$D00DD,f)endifset f=nullreturn falseendfunctionfunction Qk takes nothing returns nothinglocal unit uA=GetSpellAbilityUnit()local integer od=GetUnitAbilityLevel(uA,'A04K')set DA=GetOwningPlayer(uA)set FA=300.*odset fA=CreateUnit(DA,'h011',.0,.0,.0)call UnitAddAbility(fA,'A0CM')call SetUnitAbilityLevel(fA,'A0CM',od)call UnitApplyTimedLife(fA,'BTLF',1)call GroupEnumUnitsInRange(aA,GetSpellTargetX(),GetSpellTargetY(),475.,Condition(function qk))set uA=nullendfunctionfunction sk takes nothing returns booleanreturn GetSpellAbilityId()=='A0D0'endfunctionfunction Sk takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer Gb=GetHandleId(t)local unit uA=LoadUnitHandle(wx,3,Gb)local integer In=LoadInteger(wx,1,Gb)local integer xc=LoadInteger(wx,2,Gb)local location Llocal location LLlocal group glocal player plocal integer Hblocal real Gdlocal unit flocal real xlocal real ylocal real rxlocal real rylocal real rif In>xc or GetWidgetLife(uA)<=.405 thencall DestroyTimer(t)elseset r=$96set Hb=GetUnitAbilityLevel(uA,'A0D0')set Gd=GetUnitState(uA,UNIT_STATE_MANA)*(.05+.05*Hb)set p=GetOwningPlayer(uA)set g=CreateGroup()set L=GetUnitLoc(uA)set x=GetLocationX(L)set y=GetLocationY(L)loopset rx=GetRandomReal(x-r,x+r)set ry=GetRandomReal(y-r,y+r)exitwhen(rx-x)*(rx-x)+(ry-y)*(ry-y)<=r*rendloopcall RemoveLocation(L)set L=Location(rx,ry)call GroupEnumUnitsInRangeOfLoc(g,L,240.,null)call DestroyEffect(AddSpecialEffectLoc("Abilities\\Spells\\Undead\\AnimateDead\\AnimateDeadTarget.mdl",L))call RemoveLocation(L)loopset f=FirstOfGroup(g)exitwhen f==nullif IsUnitEnemy(f,p)thencall UnitDamageTarget(uA,f,Gd,true,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_NORMAL,WEAPON_TYPE_WHOKNOWS)endifcall GroupRemoveUnit(g,f)endloopcall DestroyGroup(g)call SaveInteger(wx,1,Gb,In+1)endifset uA=nullset p=nullset L=nullset g=nullset f=nullset t=nullendfunctionfunction tk takes nothing returns nothinglocal timer t=CreateTimer()local integer Gb=GetHandleId(t)local unit uA=GetSpellAbilityUnit()local integer In=1local integer xc=$Acall SaveInteger(wx,1,Gb,In)call SaveInteger(wx,2,Gb,xc)call SaveUnitHandle(wx,3,Gb,uA)call TimerStart(t,.5,true,function Sk)set uA=nullset t=nullendfunctionfunction Tk takes nothing returns nothingif GetLearnedSkill()=='A043' thencall EnableTrigger(nX)call DestroyTrigger(aX)endifendfunctionfunction uk takes nothing returns booleanreturn GetUnitAbilityLevel(GetAttacker(),'A043')>0endfunctionfunction Uk takes unit u,real r returns nothinglocal texttag tt=CreateTextTag()call SetTextTagText(tt,I2S(R2I(r)),.0276)call SetTextTagPosUnit(tt,u,0)call SetTextTagColor(tt,75,$F,50,0)call SetTextTagVelocity(tt,-.016,.032)call TriggerSleepAction(.75)call DestroyTextTag(tt)endfunctionfunction wk takes nothing returns nothinglocal unit u=GetTriggerUnit()local unit Xg=GetAttacker()local integer Hb=GetUnitAbilityLevel(Xg,'A043')local real rif GetRandomInt(1,'d')<=30 thenif GetWidgetLife(u)>.405 and IsUnitEnemy(u,GetOwningPlayer(Xg))thencall TriggerSleepAction(.1)set r=GetHeroAgi(Xg,true)*1.3*GetUnitAbilityLevel(Xg,'A043')+GetRandomInt(1,GetHeroAgi(Xg,true))call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\Stampede\\StampedeMissileDeath.mdl",u,"chest"))call UnitDamageTarget(Xg,u,r,true,false,ATTACK_TYPE_HERO,DAMAGE_TYPE_NORMAL,WEAPON_TYPE_WHOKNOWS)call Uk(u,r)endifendifset u=nullset Xg=nullendfunctionfunction Wk takes nothing returns nothingif(GetLearnedSkill()=='A044')thencall EnableTrigger(EX)call DestroyTrigger(VX)endifendfunctionfunction yk takes nothing returns booleanreturn Wv==GetAttacker()endfunctionfunction Yk takes nothing returns nothinglocal unit yg=GetAttacker()local integer Yg=GetUnitAbilityLevel(yg,'A044')if(ux<6)thenset ux=(ux+1)call SetUnitAbilityLevel(yg,'A0A8',ux)call TriggerSleepAction(2.+Yg)set ux=(ux-1)call SetUnitAbilityLevel(yg,'A0A8',ux)endifset yg=nullendfunctionfunction zk takes nothing returns booleanreturn GetSpellAbilityId()=='A045' or GetLearnedSkill()=='A045'endfunctionfunction Zk takes nothing returns nothinglocal unit ulocal integer Hblocal integer array idif GetSpellAbilityId()=='A045' thenset u=GetSpellAbilityUnit()elseset u=GetLearningUnit()endifset Hb=GetUnitAbilityLevel(u,'A045')set id[1]='A0FP'set id[2]='A0FQ'set id[3]='A0FR'call AddUnitAnimationProperties(u,"Spell",false)if GetUnitAbilityLevel(u,id[1])==0 and GetUnitAbilityLevel(u,id[2])==0 and GetUnitAbilityLevel(u,id[3])==0 thencall UnitAddAbility(u,id[Hb])elseif GetUnitAbilityLevel(u,id[Hb])==0 thencall UnitRemoveAbility(u,id[1])call UnitRemoveAbility(u,id[2])call UnitRemoveAbility(u,id[3])call UnitAddAbility(u,id[Hb])elsecall UnitRemoveAbility(u,id[Hb])endifendifset u=nullendfunctionfunction vK takes nothing returns booleanreturn GetLearnedSkill()=='A03Y'endfunctionfunction eK takes nothing returns nothingcall EnableTrigger(RX)call DestroyTrigger(OX)endfunctionfunction xK takes nothing returns booleanreturn GetUnitLifePercent(wv)!=100. and GetWidgetLife(wv)>.405endfunctionfunction oK takes nothing returns nothingcall SetWidgetLife(wv,GetWidgetLife(wv)+6.25*GetUnitAbilityLevel(wv,'A03Y'))endfunctionfunction rK takes nothing returns booleanreturn GetLearnedSkill()=='A0E1'endfunctionfunction iK takes nothing returns nothingcall AddSpecialEffectTarget("Units\\Undead\\PlagueCloud\\PlagueCloudtarget.mdl",GetLearningUnit(),"head")call EnableTrigger(AX)call DestroyTrigger(IX)endfunctionfunction aK takes nothing returns booleanreturn GetWidgetLife(wv)>.405endfunctionfunction nK takes nothing returns nothingif IsUnitInGroup(GetEnumUnit(),bo)thenelsecall YB(wv,GetEnumUnit())endifendfunctionfunction VK takes nothing returns nothinglocal unit u=wvlocal real LG=290local location EK=GetUnitLoc(u)local player p=GetOwningPlayer(u)local integer Hb=GetUnitAbilityLevel(u,'A0E1')local real Gd=7.5*Hblocal group g=CreateGroup()local group gg=CreateGroup()local unit fcall GroupEnumUnitsInRangeOfLoc(gg,EK,LG,null)set g=ZC(gg)call RemoveLocation(EK)loopset f=FirstOfGroup(gg)exitwhen f==nullif IsUnitEnemy(f,p)==false or GetWidgetLife(f)<=.405 thencall GroupRemoveUnit(g,f)endifcall GroupRemoveUnit(gg,f)endloopcall DestroyGroup(gg)call ForGroup(g,function nK)loopset f=FirstOfGroup(g)exitwhen f==nullcall UnitDamageTarget(u,f,Gd,true,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_NORMAL,WEAPON_TYPE_WHOKNOWS)call GroupRemoveUnit(g,f)endloopcall DestroyGroup(g)set f=nullset EK=nullset p=nullset g=nullset gg=nullset u=nullendfunctionfunction XK takes nothing returns booleanreturn GetSpellAbilityId()=='A03Q'endfunctionfunction OK takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer Gb=GetHandleId(t)local unit u=LoadUnitHandle(wx,1,Gb)local integer dc=LoadInteger(wx,2,Gb)local real xpcall DisableTrigger(bX)call UnitRemoveAbility(u,'A0CS')call SetHeroAgi(u,GetHeroAgi(u,false)-dc,true)call DestroyTrigger(Zx)call DestroyTimer(t)set t=nullset u=nullendfunctionfunction RK takes nothing returns nothinglocal unit u=GetSpellAbilityUnit()local integer Hb=GetUnitAbilityLevel(u,'A03Q')local integer dc=$A*Hblocal real xplocal timer t=CreateTimer()local integer Gb=GetHandleId(t)call EnableTrigger(bX)call UnitAddAbility(u,'A0CS')call SetHeroAgi(u,GetHeroAgi(u,false)+dc,true)call SaveUnitHandle(wx,1,Gb,u)call SaveInteger(wx,2,Gb,dc)call TimerStart(t,4+4*Hb,false,function OK)set u=nullset t=nullendfunctionfunction IK takes nothing returns nothinglocal integer PD=GetHandleId(GetEventDamageSource())local unit Xg=GetEventDamageSource()local unit ed=GetTriggerUnit()local player plocal integer Hblocal group glocal location Tlocal unit flocal real Gdif Xg==Uv and GetUnitAbilityLevel(ed,'B026')>0 thencall TriggerSleepAction(.01)set p=GetOwningPlayer(Xg)set Hb=GetUnitAbilityLevel(Xg,'A03Q')set Gd=20.+(I2R(Hb)-1)*20.set g=CreateGroup()set T=GetUnitLoc(ed)call GroupEnumUnitsInRangeOfLoc(g,T,260,null)call RemoveLocation(T)loopset f=FirstOfGroup(g)exitwhen f==nullif IsUnitEnemy(f,p)and GetWidgetLife(f)>.405 thencall UnitDamageTarget(Xg,f,Gd,true,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_NORMAL,WEAPON_TYPE_WHOKNOWS)call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\DeathandDecay\\DeathandDecayTarget.mdl",f,"origin"))endifcall GroupRemoveUnit(g,f)endloopcall DestroyGroup(g)endifset Xg=nullset ed=nullset p=nullset g=nullset T=nullset f=nullcall MD(PD)endfunctionfunction AK takes nothing returns booleanreturn GetAttacker()==Uv and IsUnitEnemy(GetTriggerUnit(),GetOwningPlayer(GetAttacker()))endfunctionfunction NK takes nothing returns nothinglocal trigger tlocal integer PD=GetHandleId(GetAttacker())call MD(PD)set t=CreateTrigger()call TriggerRegisterUnitEvent(t,GetTriggerUnit(),EVENT_UNIT_DAMAGED)call SaveTriggerHandle(wx,PD,1,t)call SaveTriggerActionHandle(wx,PD,2,TriggerAddAction(t,function IK))set t=nullendfunctionfunction bK takes nothing returns booleanreturn GetLearnedSkill()=='A03S'endfunctionfunction BK takes nothing returns nothingcall EnableTrigger(cX)call DestroyTrigger(BX)endfunctionfunction cK takes nothing returns booleanreturn GetAttacker()==Uv and IsUnitEnemy(GetTriggerUnit(),GetOwningPlayer(GetAttacker()))endfunctionfunction CK takes nothing returns nothinglocal unit Xg=GetAttacker()local unit ed=GetTriggerUnit()local player p=GetOwningPlayer(Xg)local integer Hb=GetUnitAbilityLevel(Xg,'A03S')local real OD=GetWidgetLife(ed)local real dKlocal real DKlocal real Gd=.03*I2R(Hb)*ODlocal group g=CreateGroup()local location llocal unit fcall TriggerSleepAction(.15)call UnitDamageTarget(Xg,ed,Gd,true,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_NORMAL,WEAPON_TYPE_WHOKNOWS)set l=GetUnitLoc(ed)call GroupEnumUnitsInRangeOfLoc(g,l,275,null)call RemoveLocation(l)loopset f=FirstOfGroup(g)exitwhen f==nullif IsUnitEnemy(f,p)and GetWidgetLife(f)>.405 and f!=ed thenset DK=GetUnitState(f,UNIT_STATE_MAX_LIFE)set dK=GetUnitLifePercent(f)set Gd=.03*DKcall UnitDamageTarget(Xg,f,Gd,false,false,null,DAMAGE_TYPE_UNIVERSAL,WEAPON_TYPE_WHOKNOWS)endifcall GroupRemoveUnit(g,f)endloopcall DestroyGroup(g)set Xg=nullset ed=nullset g=nullset l=nullset f=nullendfunctionfunction fK takes nothing returns booleanreturn GetSpellAbilityId()=='A02C'endfunctionfunction FK takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer Gb=GetHandleId(t)local unit c=LoadUnitHandle(wx,1,Gb)call DisableTrigger(dX)call SetUnitAbilityLevel(c,'A0E3',0)set go=1call DestroyTimer(t)set t=nullset c=nullendfunctionfunction gK takes nothing returns nothinglocal timer t=CreateTimer()local integer Gb=GetHandleId(t)local unit c=GetSpellAbilityUnit()call EnableTrigger(dX)call SaveUnitHandle(wx,1,Gb,c)call TimerStart(t,25,false,function FK)set t=nullset c=nullendfunctionfunction GK takes nothing returns booleanreturn GetUnitTypeId(GetAttacker())=='U000' and IsUnitEnemy(GetTriggerUnit(),GetOwningPlayer(GetAttacker()))endfunctionfunction hK takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer Gb=GetHandleId(t)local unit a=LoadUnitHandle(wx,1,Gb)local integer Hb=GetUnitAbilityLevel(a,'A02C')local integer zbif GetUnitAbilityLevel(a,'B00H')>0 thencall EnableTrigger(dX)endifif Hb==1 thenset zb=$Celseif Hb==2 thenset zb=22elseset zb=31endifendifif go<zb thenset go=go+1call SetUnitAbilityLevel(a,'A0E3',go)endifcall DestroyTimer(t)set a=nullset t=nullendfunctionfunction HK takes nothing returns nothinglocal timer t=CreateTimer()local integer Gb=GetHandleId(t)local unit a=GetAttacker()call DisableTrigger(dX)if GetUnitAbilityLevel(a,'B00H')>0 thenelsereturnendifcall SaveUnitHandle(wx,1,Gb,a)call TimerStart(t,.3,false,function hK)set t=nullset a=nullendfunctionfunction jK takes nothing returns booleanreturn GetSpellAbilityId()=='A025'endfunctionfunction JK takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer Gb=GetHandleId(t)local unit u=LoadUnitHandle(wx,1,Gb)local timer t2=CreateTimer()local integer qh=GetHandleId(t2)local player p=GetOwningPlayer(u)local location l=GetUnitLoc(u)local unit f=CreateUnitAtLoc(p,'h00P',l,0)local integer Hb=GetUnitAbilityLevel(u,'A025')call UnitAddAbility(f,'A0DK')call SetUnitAbilityLevel(f,'A0DK',Hb)call IssueImmediateOrderById(f,$D009F)call SaveUnitHandle(wx,1,qh,f)call TimerStart(t2,1,false,function gb)call RemoveLocation(l)call DestroyTimer(t)set u=nullset t=nullset t2=nullset p=nullset l=nullset f=nullendfunctionfunction kK takes nothing returns nothinglocal timer tlocal integer Gblocal unit u=GetSpellAbilityUnit()if GetRandomInt(1,'d')<=50 thenset t=CreateTimer()set Gb=GetHandleId(t)call SaveUnitHandle(wx,1,Gb,u)call TimerStart(t,.4,false,function JK)endifset u=nullset t=nullendfunctionfunction KK takes nothing returns booleanreturn GetSpellAbilityId()=='A02O'endfunctionfunction lK takes nothing returns booleanreturn IsUnitAlly(GetFilterUnit(),GetOwningPlayer(GetSpellAbilityUnit()))and GetWidgetLife(GetSpellAbilityUnit())>.405endfunctionfunction LK takes nothing returns nothinglocal unit f=GetEnumUnit()local real OD=GetUnitState(f,UNIT_STATE_MAX_LIFE)local real mK=GetUnitState(f,UNIT_STATE_MAX_MANA)call SetWidgetLife(f,OD)call SetUnitState(f,UNIT_STATE_MANA,mK)call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\ReviveHuman\\ReviveHuman.mdl",f,"origin"))set f=nullendfunctionfunction MK takes nothing returns nothinglocal group g=CreateGroup()call GroupEnumUnitsInRect(g,bj_mapInitialPlayableArea,Condition(function lK))call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,"|cffffcc00Знaхapь иcпoльзoвaл зaклинaниe \"Peгeнepaция\".|R")call ForGroup(g,function LK)call DestroyGroup(g)set g=nullendfunctionfunction pK takes nothing returns booleanreturn GetSpellAbilityId()=='A0GD'endfunctionfunction PK takes unit qK,unit QK returns reallocal real x=GetUnitX(qK)local real y=GetUnitY(qK)local real a=GetUnitX(QK)local real b=GetUnitY(QK)return Atan2(y-b,x-a)endfunctionfunction sK takes real SK returns reallocal real tK=GetRectMinX(bj_mapInitialPlayableArea)+50if(SK<tK)thenreturn tKendifset tK=GetRectMaxX(bj_mapInitialPlayableArea)-50if(SK>tK)thenreturn tKendifreturn SKendfunctionfunction TK takes real uK returns reallocal real tK=GetRectMinY(bj_mapInitialPlayableArea)+50if(uK<tK)thenreturn tKendifset tK=GetRectMaxY(bj_mapInitialPlayableArea)-50if(uK>tK)thenreturn tKendifreturn uKendfunctionfunction UK takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer id=GetHandleId(t)local unit u=LoadUnitHandle(wx,id,0)local real x=GetUnitX(u)local real y=GetUnitY(u)local real R=LoadReal(wx,id,1)local integer i=LoadInteger(wx,id,2)local trigger qB=LoadTriggerHandle(wx,id,3)if i<40 thenset i=i+1call SaveInteger(wx,id,2,i)if LB(x+8*Cos(R),y+8*Sin(R))thencall SetUnitPosition(u,sK(x+8*Cos(R)),TK(y+8*Sin(R)))elsecall SetUnitPathing(u,true)call SetUnitMoveSpeed(u,GetUnitDefaultMoveSpeed(u))call DestroyTrigger(qB)call FlushChildHashtable(wx,id)call DestroyTimer(t)endifelsecall SetUnitPathing(u,true)call SetUnitMoveSpeed(u,GetUnitDefaultMoveSpeed(u))call DestroyTrigger(qB)call FlushChildHashtable(wx,id)call DestroyTimer(t)endifset t=nullset u=nullendfunctionfunction wK takes nothing returns nothinglocal unit uA=GetSpellAbilityUnit()call IssueImmediateOrderById(uA,$D0004)set uA=nullendfunctionfunction WK takes nothing returns nothinglocal trigger qBlocal unit C=GetSpellAbilityUnit()local unit ulocal group g=CreateGroup()local real x=GetUnitX(C)local real y=GetUnitY(C)local real r=GetUnitFacing(C)*bj_DEGTORADlocal unit nlocal timer tlocal integer idlocal timer jglocal integer yKlocal integer Hb=GetUnitAbilityLevel(C,'A0GD')local integer Af=0local integer zb=16local effect elocal timer telocal integer fGcall GroupEnumUnitsInRange(g,x,y,300,null)loopset u=FirstOfGroup(g)exitwhen u==nullif GetWidgetLife(u)>.405 and not IsUnitType(u,UNIT_TYPE_STRUCTURE)and IsUnitEnemy(u,GetOwningPlayer(C))thencall UnitDamageTarget(C,u,90*Hb,true,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_MAGIC,WEAPON_TYPE_WHOKNOWS)set t=CreateTimer()set id=GetHandleId(t)set qB=CreateTrigger()call TriggerRegisterUnitEvent(qB,u,EVENT_UNIT_SPELL_CAST)call TriggerAddAction(qB,function wK)call SaveTriggerHandle(wx,id,3,qB)set n=CreateUnit(GetOwningPlayer(C),'e00N',GetUnitX(u),GetUnitY(u),GetUnitFacing(C)-90.)call UnitApplyTimedLife(n,'BTLF',2.5)set jg=CreateTimer()set yK=GetHandleId(jg)call SaveUnitHandle(wx,1,yK,n)call TimerStart(jg,2.5,false,function gb)call SaveUnitHandle(wx,id,0,u)call SaveReal(wx,id,1,PK(u,C))call SaveInteger(wx,id,2,0)call SetUnitPathing(u,false)call SetUnitMoveSpeed(u,0)call TimerStart(t,.03,true,function UK)elseif IsUnitAlly(u,GetOwningPlayer(C))and GetWidgetLife(u)>.405 thencall SetWidgetLife(u,GetWidgetLife(u)+$96*Hb)set e=AddSpecialEffectTarget("Abilities\\Spells\\Human\\Heal\\HealTarget.mdl",u,"origin")set te=CreateTimer()set fG=GetHandleId(te)call SaveEffectHandle(wx,1,fG,e)call TimerStart(te,.7,false,function wB)set te=nullendifendifcall GroupRemoveUnit(g,u)endloopcall DestroyGroup(g)set u=nullset g=nullset t=nullset C=nullset n=nullset jg=nullset e=nullendfunctionfunction YK takes nothing returns booleanreturn GetLearnedSkill()=='A02S'endfunctionfunction zK takes nothing returns nothinglocal unit u=GetLearningUnit()local integer Hb=GetUnitAbilityLevel(u,'A02S')set Qv=3*Hbif Hb==1 thencall EnableTrigger(GX)endifif Hb==3 thencall DestroyTrigger(gX)endifset u=nullendfunctionfunction ZK takes nothing returns booleanreturn GetSpellAbilityId()=='A02S'endfunctionfunction vl takes nothing returns booleanlocal unit uA=GetSpellAbilityUnit()local unit uE=GetFilterUnit()if IsUnitEnemy(uE,GetOwningPlayer(uA))and GetWidgetLife(uE)>.405 thencall UnitDamageTarget(uA,uE,gA,true,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_MAGIC,WEAPON_TYPE_WHOKNOWS)call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\ResourceItems\\ResourceEffectTarget.mdl",uE,"origin"))endifset uA=nullset uE=nullreturn falseendfunctionfunction el takes nothing returns nothinglocal unit uA=GetSpellAbilityUnit()local location T=GetUnitLoc(uA)local group g=CreateGroup()set gA=Qv*(GetHeroInt(uA,false)+(GetHeroInt(uA,true)-GetHeroInt(uA,false))*.5)call GroupEnumUnitsInRangeOfLoc(g,T,500,Condition(function vl))call RemoveLocation(T)call DestroyGroup(g)set uA=nullset T=nullset g=nullendfunctionfunction ol takes nothing returns booleanreturn GetSpellAbilityId()=='A02R'endfunctionfunction rl takes nothing returns nothingcall EnableTrigger(HX)endfunctionfunction il takes nothing returns nothinglocal group g=CreateGroup()local unit Z=qxlocal unit flocal integer Hb=GetUnitAbilityLevel(Z,'A02R')local real r=I2R(3*Hb)local boolean b=falseset g=IN(bj_mapInitialPlayableArea)loopset f=FirstOfGroup(g)exitwhen f==nullif GetUnitAbilityLevel(f,'Bspl')>0 and GetWidgetLife(f)>.405 thencall SetWidgetLife(f,GetWidgetLife(f)+r)set b=trueendifcall GroupRemoveUnit(g,f)endloopif b==false thencall DisableTrigger(HX)endifcall DestroyGroup(g)set g=nullset Z=nullset f=nullendfunctionfunction al takes nothing returns booleanreturn GetSpellAbilityId()=='A0GK' or GetSpellAbilityId()=='A0GL'endfunctionfunction nl takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer Gb=GetHandleId(t)local trigger qB=LoadTriggerHandle(wx,1,Gb)local integer QB=GetHandleId(qB)local real uh=LoadReal(wx,1,QB)local unit uA=LoadUnitHandle(wx,2,QB)local real Gd=LoadReal(wx,3,QB)local real OD=GetWidgetLife(uA)if GetUnitAbilityLevel(uA,'B03O')==0 thenelseif uh<=Gd thencall SetWidgetLife(uA,OD+uh)call UnitRemoveAbility(uA,'B03O')call DestroyTrigger(qB)elsecall SetWidgetLife(uA,OD+Gd)call SaveReal(wx,1,QB,uh-Gd)endifendifcall FlushChildHashtable(wx,Gb)call DestroyTimer(t)set uA=nullset t=nullset qB=nullendfunctionfunction Vl takes nothing returns nothinglocal real Gd=GetEventDamage()local unit uA=GetTriggerUnit()local trigger qB=GetTriggeringTrigger()local integer QB=GetHandleId(qB)local real uh=LoadReal(wx,1,QB)local timer t=CreateTimer()local integer Gb=GetHandleId(t)call SaveUnitHandle(wx,2,QB,uA)call SaveReal(wx,3,QB,Gd)call SaveTriggerHandle(wx,1,Gb,qB)call TimerStart(t,.0,false,function nl)set qB=nullset uA=nullset t=nullendfunctionfunction El takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer Gb=GetHandleId(t)local trigger c=LoadTriggerHandle(wx,1,Gb)call DestroyTrigger(c)call FlushChildHashtable(wx,Gb)call DestroyTimer(t)set c=nullset t=nullendfunctionfunction Xl takes nothing returns nothinglocal unit uA=GetSpellAbilityUnit()local integer Hb=GetUnitAbilityLevel(uA,GetSpellAbilityId())local player p=GetOwningPlayer(uA)local group g=CreateGroup()local location L=GetUnitLoc(uA)local real uhlocal unit flocal trigger qBlocal integer QBlocal timer jglocal integer Jglocal unit ccall GroupEnumUnitsInRangeOfLoc(g,L,600,null)call RemoveLocation(L)if GetSpellAbilityId()=='A0GK' thenset uh=$C8+$C8*Hbelseset uh=400+$C8*Hbendifloopset f=FirstOfGroup(g)exitwhen f==nullif IsUnitAlly(f,p)and GetWidgetLife(f)>.405 and IsUnitType(f,UNIT_TYPE_STRUCTURE)==false thenset qB=CreateTrigger()set QB=GetHandleId(qB)call TriggerRegisterUnitEvent(qB,f,EVENT_UNIT_DAMAGED)call TriggerAddAction(qB,function Vl)call SaveReal(wx,1,QB,uh)set jg=CreateTimer()set Jg=GetHandleId(jg)set L=GetUnitLoc(f)set c=CreateUnitAtLoc(p,'h00P',L,0)call RemoveLocation(L)call UnitAddAbility(c,'A0GM')call IssueTargetOrderById(c,$D00DE,f)call SaveUnitHandle(wx,1,Jg,c)call TimerStart(jg,2,false,function gb)set jg=CreateTimer()set Jg=GetHandleId(jg)call SaveTriggerHandle(wx,1,Jg,qB)call TimerStart(jg,$F,false,function El)set jg=nullendifcall GroupRemoveUnit(g,f)endloopcall DestroyGroup(g)set uA=nullset p=nullset g=nullset L=nullset f=nullset qB=nullset jg=nullset c=nullendfunctionfunction Ol takes nothing returns booleanreturn GetSpellAbilityId()=='A034'endfunctionfunction Rl takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer Gb=GetHandleId(t)local unit u=LoadUnitHandle(wx,1,Gb)local integer dd=LoadInteger(wx,2,Gb)local real xpif GetWidgetLife(u)<=.405 thencall ModifyHeroStat(0,u,1,dd)call SetWidgetLife(u,.0)elseset xp=GetUnitLifePercent(u)call ModifyHeroStat(0,u,1,dd)call SetUnitLifePercentBJ(u,xp)endifcall DestroyTimer(t)set t=nullset u=nullendfunctionfunction Il takes nothing returns nothinglocal unit u=GetSpellAbilityUnit()local integer Hb=GetUnitAbilityLevel(u,'A034')local integer dd=$F*Hblocal real xp=GetUnitLifePercent(u)local timer t=CreateTimer()local integer Gb=GetHandleId(t)call ModifyHeroStat(0,u,0,dd)call SetUnitLifePercentBJ(u,xp)call SaveUnitHandle(wx,1,Gb,u)call SaveInteger(wx,2,Gb,dd)call TimerStart(t,$F,false,function Rl)endfunctionfunction Al takes nothing returns booleanreturn GetLearnedSkill()=='A035'endfunctionfunction Nl takes nothing returns nothingcall EnableTrigger(KX)call DestroyTrigger(kX)endfunctionfunction bl takes nothing returns nothinglocal unit u=Svlocal group g=CreateGroup()local integer Bl=Oolocal unit flocal real xplocal location Llocal integer Hblocal integer cl=0if GetWidgetLife(u)<=.405 thencall SetHeroStr(u,GetHeroStr(u,false)-Bl,true)call SetWidgetLife(u,.0)elseset xp=GetUnitLifePercent(u)call SetHeroStr(u,GetHeroStr(u,false)-Bl,true)call SetUnitLifePercentBJ(u,xp)endifset Hb=GetUnitAbilityLevel(u,'A035')set L=GetUnitLoc(u)call GroupEnumUnitsInRangeOfLoc(g,L,375,null)call RemoveLocation(L)loopset f=FirstOfGroup(g)exitwhen f==nullif f!=Sv and IsUnitType(f,UNIT_TYPE_STRUCTURE)==false and GetWidgetLife(f)>.405 thenset cl=cl+1endifcall GroupRemoveUnit(g,f)endloopset Bl=cl*Hbif GetWidgetLife(u)<=.405 thencall SetHeroStr(u,GetHeroStr(u,false)+Bl,true)call SetWidgetLife(u,.0)elseset xp=GetUnitLifePercent(u)call SetHeroStr(u,GetHeroStr(u,false)+Bl,true)call SetUnitLifePercentBJ(u,xp)endifcall DestroyGroup(g)set Oo=Blset u=nullset f=nullset g=nullset L=nullendfunctionfunction Cl takes nothing returns booleanreturn GetLearnedSkill()=='A036'endfunctionfunction dl takes nothing returns nothingcall EnableTrigger(mX)call DestroyTrigger(LX)endfunctionfunction Dl takes nothing returns nothinglocal unit ed=Svlocal unit Xg=GetAttacker()local real Gdlocal integer Hbif IsUnitEnemy(Xg,GetOwningPlayer(ed))thencall TriggerSleepAction(.2)set Hb=GetUnitAbilityLevel(ed,'A036')set Gd=(.4+.2*Hb)*GetHeroStr(ed,true)call UnitDamageTarget(ed,Xg,Gd,true,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_NORMAL,WEAPON_TYPE_WHOKNOWS)endifset ed=nullset Xg=nullendfunctionfunction fl takes nothing returns booleanreturn GetSpellAbilityId()=='A0GF'endfunctionfunction Fl takes nothing returns booleanreturn GetUnitAbilityLevel(GetTriggerUnit(),'B03N')>0 and GetUnitAbilityLevel(GetTriggerUnit(),'BPSE')==0endfunctionfunction gl takes nothing returns nothinglocal trigger qB=GetTriggeringTrigger()local integer Id=GetHandleId(qB)local unit u=LoadUnitHandle(wx,StringHash("Naga"),Id)if GetWidgetLife(u)>.405 and GetIssuedOrderId()!=$D0005 thencall DisableTrigger(qB)call IssueTargetOrderById(GetTriggerUnit(),$D000F,u)call EnableTrigger(qB)endifset qB=nullset u=nullendfunctionfunction Gl takes nothing returns booleanif GetUnitAbilityLevel(GetFilterUnit(),'B03N')>0 thenif GetUnitAbilityLevel(GetFilterUnit(),'B02O')==0 and GetUnitAbilityLevel(GetFilterUnit(),'BPSE')==0 thenif IsUnitPaused(GetFilterUnit())==false thenreturn trueendifendifendifreturn falseendfunctionfunction hl takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer Gb=GetHandleId(t)local trigger qB=LoadTriggerHandle(wx,1,Gb)call TriggerClearActions(qB)call DestroyTrigger(qB)call FlushChildHashtable(wx,Gb)call DestroyTimer(t)set qB=nullset t=nullendfunctionfunction Hl takes nothing returns nothinglocal timer t=CreateTimer()local integer Gb=GetHandleId(t)local timer tt=CreateTimer()local integer LD=GetHandleId(tt)local location llocal integer Af=0local integer zb=16local group g=CreateGroup()local trigger qB=CreateTrigger()local integer Id=GetHandleId(qB)local unit u=GetSpellAbilityUnit()local player p=GetOwningPlayer(u)local integer Hb=GetUnitAbilityLevel(u,'A0GF')local unit flocal unit cset l=GetUnitLoc(u)set c=CreateUnitAtLoc(p,'h00P',l,0)call UnitAddAbility(c,'A0GG')call SetUnitAbilityLevel(c,'A0GG',Hb)call RemoveLocation(l)set l=GetUnitLoc(u)call IssuePointOrderByIdLoc(c,$D0270,l)call SaveUnitHandle(wx,1,LD,c)call TimerStart(tt,2,false,function gb)call RemoveLocation(l)call SaveUnitHandle(wx,StringHash("Naga"),Id,u)loopexitwhen Af==zbcall TriggerRegisterPlayerUnitEvent(qB,Player(Af),EVENT_PLAYER_UNIT_ISSUED_TARGET_ORDER,null)call TriggerRegisterPlayerUnitEvent(qB,Player(Af),EVENT_PLAYER_UNIT_ISSUED_POINT_ORDER,null)call TriggerRegisterPlayerUnitEvent(qB,Player(Af),EVENT_PLAYER_UNIT_ISSUED_ORDER,null)set Af=Af+1endloopcall TriggerAddCondition(qB,Condition(function Fl))call TriggerAddAction(qB,function gl)call TriggerSleepAction(.0)set l=GetUnitLoc(u)set g=AN(650,l,Condition(function Gl))loopset f=FirstOfGroup(g)exitwhen f==nullif GetUnitAbilityLevel(f,'B037')>0 thencall UnitRemoveAbility(f,'B03N')endifif GetUnitAbilityLevel(f,'B03N')>0 thencall IssueTargetOrderById(f,$D000F,u)endifcall GroupRemoveUnit(g,f)endloopcall RemoveLocation(l)call DestroyGroup(g)call SaveTriggerHandle(wx,1,Gb,qB)call TimerStart(t,4+Hb,false,function hl)set t=nullset l=nullset g=nullset qB=nullset u=nullset f=nullendfunctionfunction jl takes nothing returns booleanreturn GetLearnedSkill()=='A039'endfunctionfunction Jl takes nothing returns nothingcall EnableTrigger(PX)call DestroyTrigger(pX)endfunctionfunction kl takes nothing returns nothinglocal unit k=GetKillingUnit()local unit d=GetDyingUnit()local integer Hblocal real rif k==Pe and IsUnitEnemy(k,GetOwningPlayer(d))thenset Hb=GetUnitAbilityLevel(k,'A039')set r=(.1+.05*I2R(Hb))*GetUnitState(d,UNIT_STATE_MAX_LIFE)call SetWidgetLife(k,GetWidgetLife(k)+r)call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\VampiricAura\\VampiricAuraTarget.mdl",k,"origin"))endifset k=nullset d=nullendfunctionfunction Kl takes nothing returns booleanreturn GetLearnedSkill()=='A03A'endfunctionfunction Ll takes nothing returns nothingcall EnableTrigger(QX)call DestroyTrigger(qX)endfunctionfunction ml takes nothing returns booleanreturn GetSpellAbilityId()=='A03A'endfunctionfunction Ml takes nothing returns nothinglocal unit u=GetSpellAbilityUnit()local integer Hb=GetUnitAbilityLevel(u,'A03A')call EnableTrigger(sX)call UnitAddAbility(u,'A0CP')if Hb==1 thencall TriggerSleepAction(10.)elseif Hb==2 thencall TriggerSleepAction(12.)elsecall TriggerSleepAction(15.)endifendifcall UnitRemoveAbility(u,'A0CP')call DisableTrigger(sX)call DestroyTrigger(Wx)endfunctionfunction Pl takes nothing returns nothinglocal integer PD=GetHandleId(GetEventDamageSource())local unit Xg=GetEventDamageSource()local unit ed=GetTriggerUnit()local player plocal integer Hblocal group glocal location Tlocal unit flocal integer Inlocal real Gdif Xg==Pe and GetUnitAbilityLevel(ed,'B023')>0 thencall TriggerSleepAction(.01)set p=GetOwningPlayer(Xg)set Hb=GetUnitAbilityLevel(Xg,'A03A')set Gd=(GetHeroStr(Xg,true)+GetHeroInt(Xg,true)+GetHeroAgi(Xg,true))*(.25+.25*Hb)+5*Hbset g=CreateGroup()set T=GetUnitLoc(ed)call GroupEnumUnitsInRangeOfLoc(g,T,$FA,null)call RemoveLocation(T)loopset f=FirstOfGroup(g)exitwhen f==nullif IsUnitEnemy(f,p)and GetWidgetLife(f)>.405 thencall UnitDamageTarget(Xg,f,Gd,true,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_NORMAL,WEAPON_TYPE_WHOKNOWS)endifcall GroupRemoveUnit(g,f)endloopcall DestroyGroup(g)endifset Xg=nullset ed=nullset p=nullset g=nullset T=nullset f=nullcall MD(PD)endfunctionfunction ql takes nothing returns booleanreturn GetAttacker()==Pe and IsUnitEnemy(GetTriggerUnit(),GetOwningPlayer(GetAttacker()))endfunctionfunction Ql takes nothing returns nothinglocal trigger tlocal integer PD=GetHandleId(GetAttacker())call MD(PD)set t=CreateTrigger()call TriggerRegisterUnitEvent(t,GetTriggerUnit(),EVENT_UNIT_DAMAGED)call SaveTriggerHandle(wx,PD,1,t)call SaveTriggerActionHandle(wx,PD,2,TriggerAddAction(t,function Pl))set t=nullendfunctionfunction sl takes nothing returns booleanreturn GetSpellAbilityId()=='A03C'endfunctionfunction Sl takes unit mb,unit pH returns nothinglocal unit u=mblocal unit c=pHlocal player p=GetOwningPlayer(c)local integer id=GetUnitTypeId(u)local real x=GetUnitX(u)local real y=GetUnitY(u)local real IC=GetUnitFacing(u)local real xp=GetWidgetLife(u)local real mp=GetUnitState(u,UNIT_STATE_MANA)local unit KJ=CreateUnit(p,'h00P',0,0,.0)call UnitDamageTarget(KJ,u,99999,true,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_NORMAL,WEAPON_TYPE_WHOKNOWS)call RemoveUnit(u)set u=CreateUnit(p,id,x,y,IC)call SetWidgetLife(u,xp)call SetUnitState(u,UNIT_STATE_MANA,mp)call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\Polymorph\\PolyMorphDoneGround.mdl",u,"origin"))call KillUnit(KJ)call RemoveUnit(KJ)set u=nullset c=nullset p=nullset KJ=nullendfunctionfunction tl takes nothing returns nothinglocal unit u=GetEnumUnit()local unit uA=GetSpellAbilityUnit()local player p=GetOwningPlayer(uA)local integer Hb=GetUnitAbilityLevel(uA,'A03C')if GetUnitLevel(u)>=6 or IsUnitType(u,UNIT_TYPE_HERO)or GetUnitUserData(u)!=0 or GetWidgetLife(u)<=.405 or IsUnitAlly(u,p)or IsUnitType(u,UNIT_TYPE_STRUCTURE)or IsUnitIllusion(u)thenelsecall Sl(u,uA)endifset u=nullset uA=nullset p=nullendfunctionfunction Tl takes nothing returns nothinglocal group g=CreateGroup()local unit uA=GetSpellAbilityUnit()local location T=GetSpellTargetLoc()local integer od=GetUnitAbilityLevel(uA,'A03C')local real VN=90.+25.*I2R(od)call GroupEnumUnitsInRangeOfLoc(g,T,VN,null)call RemoveLocation(T)call ForGroup(g,function tl)call DestroyGroup(g)set T=nullset g=nullset uA=nullendfunctionfunction ul takes nothing returns booleanreturn GetLearnedSkill()=='A03D'endfunctionfunction Ul takes nothing returns nothingcall EnableTrigger(TX)call DestroyTrigger(tX)endfunctionfunction wl takes nothing returns nothinglocal unit u=Tvlocal unit d=GetDyingUnit()local integer Hb=GetUnitAbilityLevel(u,'A03D')if GetWidgetLife(u)>.405 and(IsUnitType(d,UNIT_TYPE_MELEE_ATTACKER)or IsUnitType(d,UNIT_TYPE_RANGED_ATTACKER))thencall SetWidgetLife(u,GetWidgetLife(u)+.15*I2R(Hb)*GetUnitStateSwap(UNIT_STATE_MAX_LIFE,d))call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\Polymorph\\PolyMorphDoneGround.mdl",u,"origin"))endifset u=nullset d=nullendfunctionfunction Wl takes nothing returns booleanreturn GetOwningPlayer(GetDyingUnit())==GetOwningPlayer(Tv)endfunctionfunction yl takes nothing returns booleanreturn GetSpellAbilityId()=='A0FA'endfunctionfunction Yl takes nothing returns booleanif IsUnitAlly(GetFilterUnit(),GetOwningPlayer(GA))thencall IssueTargetOrderById(GA,$D0085,GetFilterUnit())endifreturn falseendfunctionfunction zl takes nothing returns nothinglocal unit uA=GetSpellAbilityUnit()local location T=GetUnitLoc(uA)local integer Hb=GetUnitAbilityLevel(uA,GetSpellAbilityId())local group g=CreateGroup()set GA=CreateUnitAtLoc(GetOwningPlayer(uA),'h011',T,0)call UnitApplyTimedLife(GA,'BTLF',.5)call UnitAddAbility(GA,'A0FB')call SetUnitAbilityLevel(GA,'A0FB',Hb)call GroupEnumUnitsInRangeOfLoc(g,T,400,Condition(function Yl))call DestroyGroup(g)call RemoveLocation(T)set g=nullset uA=nullset T=nullendfunctionfunction Zl takes nothing returns nothinglocal integer spell=GetSpellAbilityId()local integer Hblocal player plocal unit uAlocal location Tlocal group glocal unit fif spell=='A04B' or spell=='A08H' thenset T=GetSpellTargetLoc()set uA=GetSpellAbilityUnit()set Hb=GetUnitAbilityLevel(uA,spell)set p=GetOwningPlayer(uA)set g=CreateGroup()call GroupEnumUnitsInRangeOfLoc(g,T,$8C+25.*Hb,null)call RemoveLocation(T)loopset f=FirstOfGroup(g)exitwhen f==nullif IsUnitEnemy(f,p)and GetWidgetLife(f)>.405 and IsUnitType(f,UNIT_TYPE_HERO)==false and IsUnitIllusion(f)==false and GetUnitUserData(f)==0 and IsUnitType(f,UNIT_TYPE_STRUCTURE)==false thencall UnitDamageTarget(uA,f,$C350,true,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_MAGIC,WEAPON_TYPE_WHOKNOWS)call DestroyEffect(AddSpecialEffectLoc("Abilities\\Spells\\NightElf\\Blink\\BlinkCaster.mdl",GetUnitLoc(f)))endifcall GroupRemoveUnit(g,f)endloopcall DestroyGroup(g)endifset p=nullset g=nullset uA=nullset T=nullset f=nullendfunctionfunction vL takes nothing returns nothinglocal timer t=GetExpiredTimer()set He=falsecall DestroyTrigger(wX)call DestroyTimer(t)set t=nullendfunctionfunction eL takes nothing returns nothinglocal timer tif GetLearnedSkill()=='A009' or GetLearnedSkill()=='A02U' thencall DisableTrigger(wX)call EnableTrigger(yX)call EnableTrigger(YX)call Sc(0)set t=CreateTimer()set He=truecall TimerStart(t,6.25,false,function vL)endifset t=nullendfunctionfunction xL takes nothing returns nothinglocal integer po=zvif po==5 thenset po=-1endifset po=po+1set zv=pocall Sc(po)endfunctionfunction oL takes nothing returns nothinglocal timer tif yv==GetRevivableUnit()thenset t=CreateTimer()call TimerStart(t,6.25,false,function WB)set He=trueendifset t=nullendfunctionfunction rL takes nothing returns booleanreturn GetSpellAbilityId()=='A009' or GetSpellAbilityId()=='A02U'endfunctionfunction iL takes nothing returns nothinglocal unit uA=GetSpellAbilityUnit()local location T=GetUnitLoc(uA)local group g=CreateGroup()local player p=GetOwningPlayer(uA)local integer Hb=GetUnitAbilityLevel(uA,GetSpellAbilityId())local integer polocal unit fcall SetUnitInvulnerable(uA,true)call GroupEnumUnitsInRangeOfLoc(g,T,300,null)call RemoveLocation(T)loopset f=FirstOfGroup(g)exitwhen f==nullif GetWidgetLife(f)>.405 and IsUnitEnemy(f,p)thencall UnitDamageTarget(uA,f,50*Hb,true,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_MAGIC,WEAPON_TYPE_WHOKNOWS)call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\NightElf\\MoonWell\\MoonWellCasterArt.mdl",f,"origin"))endifcall GroupRemoveUnit(g,f)endloopcall TriggerSleepAction(.05)if He==false thenset po=zvif po==5 thenset po=0elseset po=po+1endifcall SetUnitPositionLoc(uA,ve[po])call SetWidgetLife(uA,Zv[po])call SetUnitFacingTimed(uA,vo[po],0)call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\ManaFlare\\ManaFlareBoltImpact.mdl",uA,"origin"))call TriggerSleepAction(.05)call GroupClear(g)set T=GetUnitLoc(uA)call GroupEnumUnitsInRangeOfLoc(g,T,300,null)call RemoveLocation(T)loopset f=FirstOfGroup(g)exitwhen f==nullif GetWidgetLife(f)>.405 and IsUnitEnemy(f,p)thencall UnitDamageTarget(uA,f,50*Hb,true,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_MAGIC,WEAPON_TYPE_WHOKNOWS)call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\NightElf\\MoonWell\\MoonWellCasterArt.mdl",f,"origin"))endifcall GroupRemoveUnit(g,f)endloopelsecall DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\ManaFlare\\ManaFlareBoltImpact.mdl",uA,"origin"))endifif GetUnitAbilityLevel(uA,'B03Q')==0 thencall SetUnitInvulnerable(uA,false)endifcall DestroyGroup(g)set uA=nullset T=nullset g=nullendfunctionfunction aL takes nothing returns nothingif GetLearnedSkill()=='A054' thenset ee=ee+1if ee==3 thenset ee=4endifcall EnableTrigger(ZX)if ee==4 thencall DisableTrigger(zX)endifendifendfunctionfunction nL takes nothing returns nothingif GetWidgetLife(yv)>.405 thencall SetHeroInt(yv,GetHeroInt(yv,false)+ee,true)endifendfunctionfunction VL takes nothing returns booleanreturn GetSpellAbilityId()=='A05D'endfunctionfunction EL takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer Gb=GetHandleId(t)local unit f=LoadUnitHandle(wx,1,Gb)call SetUnitTimeScalePercent(f,100.)call DestroyTimer(t)set t=nullset f=nullendfunctionfunction XL takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer Gb=GetHandleId(t)local unit f=LoadUnitHandle(wx,1,Gb)if GetUnitAbilityLevel(f,'B02T')==0 thencall SetUnitTimeScalePercent(f,'d')endifcall DestroyTimer(t)set t=nullset f=nullendfunctionfunction PO takes unit u,integer Hb returns nothinglocal timer t=CreateTimer()local integer Gb=GetHandleId(t)local timer t2=CreateTimer()local integer qh=GetHandleId(t2)local integer ZFif IsUnitType(u,UNIT_TYPE_HERO)and GetUnitUserData(u)!=$B and GetUnitUserData(u)!=$C thenset ZF=2+Hbelseset ZF=2+2*Hbendifcall SaveUnitHandle(wx,1,Gb,u)call TimerStart(t,ZF,false,function EL)call SaveUnitHandle(wx,1,qh,u)call TimerStart(t2,.5,false,function XL)set t=nullset t2=nullendfunctionfunction OL takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer Gb=GetHandleId(t)local group g=CreateGroup()local unit fset g=LoadGroupHandle(wx,1,Gb)loopset f=FirstOfGroup(g)exitwhen f==nullcall KillUnit(f)call RemoveUnit(f)call GroupRemoveUnit(g,f)endloopcall DestroyGroup(g)call DestroyTimer(t)set g=nullset f=nullset t=nullendfunctionfunction RL takes nothing returns nothinglocal unit uA=GetSpellAbilityUnit()local integer Hb=GetUnitAbilityLevel(uA,'A05D')local group g=CreateGroup()local group g2=CreateGroup()local timer t=CreateTimer()local integer Gb=GetHandleId(t)local unit flocal location Tlocal unit ccall DisplayTextToForce(bj_FORCE_ALL_PLAYERS,"Повелитель времени применил заклинание \"остановить время\"")set g=ON(bj_mapInitialPlayableArea,Condition(function Kc))loopset f=FirstOfGroup(g)exitwhen f==nullif GetUnitTypeId(f)!='n002' thencall SetUnitTimeScalePercent(f,.0)call PO(f,Hb)set T=GetUnitLoc(f)set c=CreateUnitAtLoc(GetOwningPlayer(uA),'h00P',T,0)call UnitAddAbility(c,'A09U')call SetUnitAbilityLevel(c,'A09U',Hb)call IssueTargetOrderById(c,$D007F,f)call GroupAddUnit(g2,c)call RemoveLocation(T)endifcall GroupRemoveUnit(g,f)endloopcall SaveGroupHandle(wx,1,Gb,g2)call TimerStart(t,.7,false,function OL)call DestroyGroup(g)set g=nullset g2=nullset f=nullset uA=nullset t=nullset T=nullset c=nullendfunctionfunction IL takes nothing returns booleanreturn GetSpellAbilityId()=='A0GB' or GetSpellAbilityId()=='A0GC'endfunctionfunction AL takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer Gb=GetHandleId(t)local integer In=LoadInteger(wx,Gb,0)local integer xc=LoadInteger(wx,Gb,1)local unit c=LoadUnitHandle(wx,Gb,2)call IssueImmediateOrderById(c,$D009F)if In>=xc or Kx thencall DestroyTimer(t)elsecall SaveInteger(wx,Gb,1,In+1)endifset c=nullset t=nullendfunctionfunction NL takes nothing returns nothinglocal unit uA=GetSpellAbilityUnit()local unit flocal player p=GetOwningPlayer(uA)local location T=GetSpellTargetLoc()local integer Hb=GetUnitAbilityLevel(uA,GetSpellAbilityId())local integer itlocal integer Inlocal timer t=CreateTimer()local integer Gb=GetHandleId(t)set Kx=falseif GetSpellAbilityId()=='A0GB' thenset it=4+2*Hbelseset it=6+2*Hbendifset f=CreateUnitAtLoc(p,'h011',T,0)call RemoveLocation(T)call UnitAddAbility(f,'A0AQ')call SetUnitAbilityLevel(f,'A0AQ',Hb)call UnitApplyTimedLife(f,'BTLF',it+1)call SaveInteger(wx,Gb,0,1)call SaveInteger(wx,Gb,1,it)call SaveUnitHandle(wx,Gb,2,f)call TimerStart(t,1,true,function AL)set t=nullset uA=nullset f=nullset T=nullendfunctionfunction bL takes nothing returns booleanreturn GetSpellAbilityId()=='A0GB' or GetSpellAbilityId()=='A0GC'endfunctionfunction BL takes nothing returns nothinglocal unit u=GetSpellAbilityUnit()set Kx=truecall TriggerSleepAction(.0)if IsUnitType(u,UNIT_TYPE_HERO)==false thencall KillUnit(u)call RemoveUnit(u)endifset u=nullendfunctionfunction cL takes nothing returns booleanreturn GetSpellAbilityId()=='A01P' or GetSpellAbilityId()=='A01I'endfunctionfunction CL takes nothing returns nothinglocal unit uA=GetSpellAbilityUnit()local integer Hb=GetUnitAbilityLevel(uA,GetSpellAbilityId())local player p=GetOwningPlayer(uA)local location L=GetSpellTargetLoc()local integer dLlocal integer ZFlocal unit cif GetSpellAbilityId()=='A01I' thenset dL='A0GB'set ZF=4+2*Hb+2elseset dL='A0GC'set ZF=6+2*Hb+2endifset c=CreateUnitAtLoc(p,'h011',L,0)call UnitAddAbility(c,'ACmi')call UnitAddAbility(c,dL)call SetUnitAbilityLevel(c,dL,Hb)call IssuePointOrderByIdLoc(c,$D0079,L)call RemoveLocation(L)call UnitApplyTimedLife(c,'BTLF',ZF)call TriggerSleepAction(.0)call IssueImmediateOrderById(uA,$D0004)set uA=nullset c=nullset L=nullendfunctionfunction DL takes nothing returns booleanreturn IsUnitAlly(GetFilterUnit(),GetOwningPlayer(GetSpellTargetUnit()))and GetWidgetLife(GetFilterUnit())>.405 and GetUnitLifePercent(GetFilterUnit())<100.endfunctionfunction fL takes nothing returns nothinglocal integer Id=GetSpellAbilityId()local location llocal integer odlocal unit uTlocal unit uAlocal unit flocal group gif Id=='A01G' or Id=='A01N' thenset uA=GetSpellAbilityUnit()set uT=GetSpellTargetUnit()set l=GetUnitLoc(uT)set od=GetUnitAbilityLevel(uA,Id)set g=CreateGroup()call GroupEnumUnitsInRangeOfLoc(g,l,400,Condition(function DL))call RemoveLocation(l)loopset f=FirstOfGroup(g)exitwhen f==nullif f!=uT thencall SetWidgetLife(f,GetWidgetLife(f)+150.*od)call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\HolyBolt\\HolyBoltSpecialArt.mdl",f,"origin"))endifcall GroupRemoveUnit(g,f)endloopcall DestroyGroup(g)endifset uT=nullset uA=nullset g=nullset f=nullset l=nullendfunctionfunction FL takes nothing returns nothingif GetLearnedSkill()=='A01J' or GetLearnedSkill()=='A0EC' thencall DisableTrigger(iO)set Dx=GetLearningUnit()set so=GetLearnedSkill()endifendfunctionfunction gL takes nothing returns nothingif GetSpellAbilityId()=='A01J' or GetSpellAbilityId()=='A0EC' thencall EnableTrigger(VO)endifendfunctionfunction GL takes nothing returns nothingif GetSpellAbilityId()=='A01J' or GetSpellAbilityId()=='A0EC' thencall DisableTrigger(VO)endifendfunctionfunction hL takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer Gb=GetHandleId(t)local effect e=LoadEffectHandle(wx,1,Gb)call DestroyEffect(e)call DestroyTimer(t)set t=nullset e=nullendfunctionfunction HL takes nothing returns nothinglocal unit uE=GetEnumUnit()local unit u=Dxlocal effect elocal timer tlocal integer Gbif IsUnitEnemy(uE,GetOwningPlayer(u))and GetWidgetLife(uE)>.405 thencall UnitDamageTarget(u,uE,20+20*GetUnitAbilityLevel(u,so),true,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_MAGIC,WEAPON_TYPE_WHOKNOWS)set e=AddSpecialEffectTarget("Abilities\\Spells\\NightElf\\ManaBurn\\ManaBurnTarget.mdl",uE,"origin")set t=CreateTimer()set Gb=GetHandleId(t)call SaveEffectHandle(wx,1,Gb,e)call TimerStart(t,.3,false,function hL)endifset uE=nullset u=nullset e=nullset t=nullendfunctionfunction jL takes nothing returns nothing	local unit u=Dx	local location l=GetUnitLoc(u)	local group g=CreateGroup()	local real le	set le=$960	call GroupEnumUnitsInRangeOfLoc(g,l,le,null)	call RemoveLocation(l)	call ForGroup(g,function HL)	call DestroyGroup(g)	set g=null	set u=nullendfunctionfunction JL takes nothing returns nothingif GetItemTypeId(GetManipulatedItem())=='I04B' thenif GetTriggerEventId()==EVENT_PLAYER_UNIT_PICKUP_ITEM thencall wD(GetTriggerUnit(),UNIT_STATE_MAX_LIFE,550)elsecall wD(GetTriggerUnit(),UNIT_STATE_MAX_LIFE,-550)endifendifendfunctionfunction KL takes nothing returns booleanreturn GetSpellAbilityId()=='A0DS'endfunctionfunction lL takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer Gb=GetHandleId(t)local unit u=LoadUnitHandle(wx,Gb,0)local integer dd=LoadInteger(wx,Gb,1)local integer hJ=LoadInteger(wx,Gb,2)local integer mL=LoadInteger(wx,Gb,3)if GetUnitAbilityLevel(u,'B03R')==0 thencall UnitRemoveAbility(u,'A0I4')call SetHeroAgi(u,GetHeroAgi(u,false)-hJ,true)call SetHeroInt(u,GetHeroInt(u,false)-mL,true)call SetHeroStr(u,GetHeroStr(u,false)-dd,true)call FlushChildHashtable(wx,Gb)call DestroyTimer(t)endifset u=nullset t=nullendfunctionfunction ML takes nothing returns nothinglocal unit u=GetSpellAbilityUnit()local unit Lg=GetSpellTargetUnit()local timer tlocal integer Gblocal integer dd=R2I(GetHeroStr(Lg,false)*.75)local integer hJ=R2I(GetHeroAgi(Lg,false)*.75)local integer mL=R2I(GetHeroInt(Lg,false)*.75)if dd>75 thenset dd=75endifif hJ>75 thenset hJ=75endifif mL>75 thenset mL=75endifcall UnitAddAbility(Lg,'A0I4')call SetHeroAgi(Lg,GetHeroAgi(Lg,false)+hJ,true)call SetHeroInt(Lg,GetHeroInt(Lg,false)+mL,true)call SetHeroStr(Lg,GetHeroStr(Lg,false)+dd,true)set t=CreateTimer()set Gb=GetHandleId(t)call SaveUnitHandle(wx,Gb,0,Lg)call SaveInteger(wx,Gb,1,dd)call SaveInteger(wx,Gb,2,hJ)call SaveInteger(wx,Gb,3,mL)call TimerStart(t,.5,true,function lL)set u=nullset t=nullset Lg=nullendfunctionfunction PL takes nothing returns booleanreturn GetSpellAbilityId()=='A0FX'endfunctionfunction qL takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer Gb=GetHandleId(t)local unit f=LoadUnitHandle(wx,1,Gb)call SetUnitAbilityLevel(f,'A0FT',1)call DestroyTimer(t)set t=nullset f=nullendfunctionfunction QL takes nothing returns nothinglocal unit u=GetSpellAbilityUnit()local timer t=CreateTimer()local integer Gb=GetHandleId(t)local player p=GetOwningPlayer(u)call SetUnitAbilityLevel(u,'A0FT',2)call SaveUnitHandle(wx,1,Gb,u)call TimerStart(t,7,false,function qL)set u=nullset t=nullset p=nullendfunctionfunction SL takes nothing returns booleanreturn GetSpellAbilityId()=='A06W'endfunctionfunction TL takes nothing returns nothinglocal unit u=GetSpellAbilityUnit()local real x=GetWidgetX(u)local real y=GetWidgetY(u)local unit d=CreateUnit(GetOwningPlayer(u),'h011',x,y,0)call UnitAddAbility(d,'A05V')call UnitApplyTimedLife(d,'BTLF',.5)call IssuePointOrderById(d,$D0270,x,y)set u=nullset d=nullendfunctionfunction UL takes nothing returns booleanreturn GetSpellAbilityId()=='A0FI'endfunctionfunction wL takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer Gb=GetHandleId(t)local trigger qB=LoadTriggerHandle(wx,1,Gb)local unit uA=LoadUnitHandle(wx,2,Gb)local player p=GetOwningPlayer(uA)local location L=GetUnitLoc(uA)local timer t2=CreateTimer()local integer qh=GetHandleId(t2)local unit ccall SetUnitPathing(uA,true)call DestroyTrigger(qB)set c=CreateUnitAtLoc(p,'h00P',L,0)call RemoveLocation(L)call UnitAddAbility(c,'A0FJ')call IssueImmediateOrderById(c,$D009F)call SaveUnitHandle(wx,1,qh,c)call TimerStart(t2,2,false,function gb)call FlushChildHashtable(wx,Gb)call DestroyTimer(t)set t=nullset t2=nullset uA=nullset p=nullset L=nullset c=nullset qB=nullendfunctionfunction WL takes nothing returns nothinglocal unit uA=GetSpellAbilityUnit()local unit uT=GetSpellTargetUnit()local trigger qB=CreateTrigger()local integer QB=GetHandleId(qB)local timer t=CreateTimer()local integer Gb=GetHandleId(t)if IsUnitType(uT,UNIT_TYPE_HERO)==false and IsUnitEnemy(uT,GetOwningPlayer(uA))==false thencall IssueImmediateOrderById(uA,$D0004)call DisplayTextToPlayer(GetOwningPlayer(uA),0,0,"Целью гипер-сапогов не может быть данный юнит.")returnendifcall SaveTriggerHandle(wx,1,Gb,qB)call SaveUnitHandle(wx,2,Gb,uA)call TimerStart(t,.3,false,function wL)call SaveUnitHandle(wx,1,QB,uA)call SaveUnitHandle(wx,2,QB,uT)call TriggerAddAction(qB,function PB)call TriggerRegisterTimerEvent(qB,.01,true)call SetUnitPathing(uA,false)set uA=nullset uT=nullset qB=nullset t=nullendfunctionfunction YL takes nothing returns booleanreturn GetSpellAbilityId()=='A0FD'endfunctionfunction zL takes nothing returns nothinglocal unit u=GetSpellTargetUnit()local real ZL=GetUnitState(u,UNIT_STATE_MAX_LIFE)local real dc=ZL*.05local location T=GetUnitLoc(u)local group g=CreateGroup()local player p=GetOwningPlayer(u)local unit fset g=BN(500,T)call RemoveLocation(T)loopset f=FirstOfGroup(g)exitwhen f==nullif(GetWidgetLife(f)>.405 and IsUnitAlly(f,p))or f==u thencall SetWidgetLife(f,GetWidgetLife(f)+dc)if f!=u thencall DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\Heal\\HealTarget.mdl",f,"origin"))endifendifcall GroupRemoveUnit(g,f)endloopcall DestroyGroup(g)set g=nullset f=nullset p=nullset u=nullset T=nullendfunctionfunction em takes nothing returns booleanreturn GetSpellAbilityId()=='A0DV'endfunctionfunction xm takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer Gb=GetHandleId(t)local integer om=LoadInteger(wx,1,Gb)local unit u=LoadUnitHandle(wx,2,Gb)call SetHeroAgi(u,GetHeroAgi(u,false)-om,true)call UnitRemoveAbility(u,'A0IA')call UnitRemoveAbility(u,'B043')call FlushChildHashtable(wx,Gb)call DestroyTimer(t)set t=nullset u=nullendfunctionfunction rm takes nothing returns nothinglocal unit u=GetSpellAbilityUnit()local integer Hb=GetUnitAbilityLevel(u,'A0IA')local timer t=CreateTimer()local integer Gb=GetHandleId(t)local real ZF=5.local integer om=R2I(GetHeroAgi(u,false)*.75)local integer im=GetHeroAgi(u,false)call UnitAddAbility(u,'A0IA')call SetHeroAgi(u,im+om,true)call SaveInteger(wx,1,Gb,om)call SaveUnitHandle(wx,2,Gb,u)call TimerStart(t,ZF,false,function xm)set t=nullset u=nullendfunctionfunction nm takes nothing returns booleanreturn GetSpellAbilityId()=='A0HZ'endfunctionfunction Vm takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer Gb=GetHandleId(t)local integer om=LoadInteger(wx,1,Gb)local unit u=LoadUnitHandle(wx,2,Gb)call SetHeroStr(u,GetHeroStr(u,false)-om,true)call UnitRemoveAbility(u,'A0I3')call UnitRemoveAbility(u,'B03V')call FlushChildHashtable(wx,Gb)call DestroyTimer(t)set t=nullset u=nullendfunctionfunction Em takes nothing returns nothinglocal unit u=GetSpellAbilityUnit()local integer Hb=GetUnitAbilityLevel(u,'A0IB')local timer t=CreateTimer()local integer Gb=GetHandleId(t)local real ZF=5.local integer om=R2I(GetHeroStr(u,false)*.75)local integer im=GetHeroStr(u,false)call SetHeroStr(u,im+om,true)call UnitAddAbility(u,'A0I3')call SaveInteger(wx,1,Gb,om)call SaveUnitHandle(wx,2,Gb,u)call TimerStart(t,ZF,false,function Vm)set t=nullset u=nullendfunctionfunction Om takes nothing returns booleanreturn GetSpellAbilityId()=='A0EZ'endfunctionfunction Rm takes nothing returns booleanreturn GetUnitAbilityLevel(GetTriggerUnit(),'B037')>0 and GetUnitAbilityLevel(GetTriggerUnit(),'BPSE')==0endfunctionfunction Im takes nothing returns nothinglocal trigger qB=GetTriggeringTrigger()local integer Id=GetHandleId(qB)local unit u=LoadUnitHandle(wx,StringHash("ItemNew"),Id)if GetWidgetLife(u)>.405 thencall DisableTrigger(qB)call IssueTargetOrderById(GetTriggerUnit(),$D000F,u)call EnableTrigger(qB)endifset qB=nullset u=nullendfunctionfunction Am takes nothing returns booleanif GetUnitAbilityLevel(GetFilterUnit(),'B037')>0 thenif GetUnitAbilityLevel(GetFilterUnit(),'B02O')==0 and GetUnitAbilityLevel(GetFilterUnit(),'BPSE')==0 thenif IsUnitPaused(GetFilterUnit())==false thenreturn trueendifendifendifreturn falseendfunctionfunction Nm takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer Gb=GetHandleId(t)local trigger qB=LoadTriggerHandle(wx,1,Gb)call TriggerClearActions(qB)call DestroyTrigger(qB)call FlushChildHashtable(wx,Gb)call DestroyTimer(t)set qB=nullset t=nullendfunctionfunction bm takes nothing returns nothinglocal timer t=CreateTimer()local integer Gb=GetHandleId(t)local location llocal integer Af=0local integer zb=16local group g=CreateGroup()local trigger qB=CreateTrigger()local integer Id=GetHandleId(qB)local unit u=GetSpellAbilityUnit()local unit fcall SaveUnitHandle(wx,StringHash("ItemNew"),Id,u)loopexitwhen Af==zbcall TriggerRegisterPlayerUnitEvent(qB,Player(Af),EVENT_PLAYER_UNIT_ISSUED_TARGET_ORDER,null)call TriggerRegisterPlayerUnitEvent(qB,Player(Af),EVENT_PLAYER_UNIT_ISSUED_POINT_ORDER,null)call TriggerRegisterPlayerUnitEvent(qB,Player(Af),EVENT_PLAYER_UNIT_ISSUED_ORDER,null)set Af=Af+1endloopcall TriggerAddCondition(qB,Condition(function Rm))call TriggerAddAction(qB,function Im)set l=GetUnitLoc(u)set g=AN(500,l,Condition(function Am))loopset f=FirstOfGroup(g)exitwhen f==nullif GetUnitAbilityLevel(f,'B03N')>0 thencall UnitRemoveAbility(f,'B037')endifif GetUnitAbilityLevel(f,'B037')>0 thencall IssueTargetOrderById(f,$D000F,u)endifcall GroupRemoveUnit(g,f)endloopcall RemoveLocation(l)call DestroyGroup(g)call SaveTriggerHandle(wx,1,Gb,qB)call TimerStart(t,5,false,function Nm)set t=nullset l=nullset g=nullset qB=nullset u=nullset f=nullendfunctionfunction cm takes nothing returns booleanreturn GetSpellAbilityId()=='A09B'endfunctionfunction Cm takes nothing returns nothinglocal timer t=GetExpiredTimer()local unit f=LoadUnitHandle(wx,1,GetHandleId(t))if GetUnitAbilityLevel(f,'B02Q')==0 thencall SetUnitTimeScalePercent(f,'d')endifcall DestroyTimer(t)set t=nullset f=nullendfunctionfunction dm takes nothing returns nothinglocal timer t=GetExpiredTimer()call SetUnitTimeScalePercent(LoadUnitHandle(wx,1,GetHandleId(t)),100.)call DestroyTimer(t)set t=nullendfunctionfunction Dm takes unit u returns nothinglocal timer t=CreateTimer()local timer t2=CreateTimer()local integer Gb=GetHandleId(t)local integer qh=GetHandleId(t2)call SetUnitTimeScalePercent(u,.0)call SaveUnitHandle(wx,1,Gb,u)call TimerStart(t,.3,false,function Cm)call SaveUnitHandle(wx,1,qh,u)call TimerStart(t2,3,false,function dm)set t=nullset t2=nullendfunctionfunction fm takes nothing returns nothinglocal group g=CreateGroup()local unit flocal unit clocal unit uA=GetSpellAbilityUnit()call GroupEnumUnitsInRange(g,GetWidgetX(uA),GetWidgetY(uA),500,Condition(function Kc))set c=CreateUnit(GetOwningPlayer(uA),'h011',0,0,0)call UnitAddAbility(c,'A03W')loopset f=FirstOfGroup(g)exitwhen f==nullif GetUnitTypeId(f)!='n002' thencall Dm(f)call IssueTargetOrderById(c,$D007F,f)endifcall GroupRemoveUnit(g,f)endloopcall DestroyGroup(g)set c=nullset g=nullset f=nullset uA=nullendfunctionfunction gm takes nothing returns booleanreturn GetSpellAbilityId()=='A0BI'endfunctionfunction Gm takes nothing returns nothinglocal group g=CreateGroup()local real rlocal unit flocal unit uA=GetSpellAbilityUnit()local player p=GetOwningPlayer(uA)local location T=GetUnitLoc(uA)local real zb=0call GroupEnumUnitsInRangeOfLoc(g,T,525.,null)call RemoveLocation(T)loopset f=FirstOfGroup(g)exitwhen f==nullif jb(f)and IsUnitEnemy(f,p)and GetUnitLifePercent(f)>=50. thenset r=GetUnitState(f,UNIT_STATE_MAX_LIFE)call UnitDamageTarget(uA,f,r*.08,false,false,null,DAMAGE_TYPE_UNIVERSAL,WEAPON_TYPE_WHOKNOWS)set zb=zb+r*.08if zb<=$5DC thencall SetWidgetLife(uA,GetWidgetLife(uA)+r*.08)call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\VampiricAura\\VampiricAuraTarget.mdl",f,"origin"))endifendifcall GroupRemoveUnit(g,f)endloopcall DestroyGroup(g)set g=nullset f=nullset uA=nullset T=nullendfunctionfunction Hm takes nothing returns booleanreturn GetSpellAbilityId()=='A0BM'endfunctionfunction jm takes nothing returns booleanlocal unit f=GetFilterUnit()if IsUnitType(f,UNIT_TYPE_STRUCTURE)or IsUnitEnemy(f,hA)==false or GetWidgetLife(f)<=.405 or IsUnitInvisible(f,hA)or jb(f)==false thenset f=nullreturn falseelseif GetUnitLifePercent(f)<=35.and(GetUnitUserData(f)!=0 or IsUnitType(f,UNIT_TYPE_HERO))thenset f=nullreturn falseendifset f=nullreturn trueendfunctionfunction Jm takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer Gb=GetHandleId(t)local integer In=LoadInteger(wx,Gb,0)local unit uA=LoadUnitHandle(wx,Gb,1)local unit km=LoadUnitHandle(wx,Gb,2)local group g=CreateGroup()local unit flocal integer i=0set hA=GetOwningPlayer(uA)call GroupEnumUnitsInRange(g,GetWidgetX(uA),GetWidgetY(uA),600.,Condition(function jm))loopset f=GroupPickRandomUnit(g)set i=i+1exitwhen f==null or km!=f or i==20endloopcall DestroyGroup(g)if f!=null thencall SaveUnitHandle(wx,Gb,2,f)call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\Monsoon\\MonsoonBoltTarget.mdl",f,"origin"))call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\ManaFlare\\ManaFlareBoltImpact.mdl",f,"head"))call UnitDamageTarget(uA,f,500,true,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_MAGIC,WEAPON_TYPE_WHOKNOWS)endifif In>16 or GetWidgetLife(uA)<=.405 thencall DestroyTimer(t)call FlushChildHashtable(wx,Gb)elsecall SaveInteger(wx,Gb,0,In+1)endifset t=nullset km=nullset uA=nullset g=nullset f=nullendfunctionfunction Km takes nothing returns nothinglocal timer t=CreateTimer()local integer Gb=GetHandleId(t)local unit uA=GetSpellAbilityUnit()call SaveInteger(wx,Gb,0,1)call SaveUnitHandle(wx,Gb,1,uA)call TimerStart(t,.5,true,function Jm)set t=nullset uA=nullendfunctionfunction Lm takes nothing returns booleanreturn GetSpellAbilityId()=='A0BP'endfunctionfunction mm takes nothing returns nothinglocal group g=CreateGroup()local real rlocal unit flocal unit uA=GetSpellAbilityUnit()local location T=GetUnitLoc(uA)local effect elocal integer In=1call GroupEnumUnitsInRangeOfLoc(g,T,550,Condition(function Kc))call RemoveLocation(T)loopset f=FirstOfGroup(g)exitwhen f==nullcall UnitDamageTarget(uA,f,350,true,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_MAGIC,WEAPON_TYPE_WHOKNOWS)call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Demon\\DemonBoltImpact\\DemonBoltImpact.mdl",f,"origin"))call GroupRemoveUnit(g,f)endloopcall DestroyGroup(g)call UnitAddAbility(uA,'A0BV')loopexitwhen In>6set e=AddSpecialEffectTarget("Abilities\\Spells\\Orc\\AncestralSpirit\\AncestralSpiritCaster.mdl",uA,"origin")call TriggerSleepAction(1)call DestroyEffect(e)set In=In+1endloopcall UnitRemoveAbility(uA,'A0BV')set g=nullset f=nullset e=nullset uA=nullset T=nullendfunctionfunction pm takes nothing returns booleanreturn GetItemTypeId(GetManipulatedItem())=='I045'endfunctionfunction Pm takes nothing returns nothingset Tx=Tx+1if IsTriggerEnabled(FO)==false thencall EnableTrigger(FO)endifendfunctionfunction Qm takes nothing returns booleanreturn UnitHasItemOfTypeBJ(GetFilterUnit(),'I045')endfunctionfunction sm takes nothing returns nothinglocal group g1=CreateGroup()local group g2=CreateGroup()local unit f1local unit f2local location Tset g1=ON(bj_mapInitialPlayableArea,Condition(function Qm))loopset f1=FirstOfGroup(g1)exitwhen f1==nullset T=GetUnitLoc(f1)call GroupEnumUnitsInRangeOfLoc(g2,T,550,null)call RemoveLocation(T)loopset f2=FirstOfGroup(g2)exitwhen f2==nullif GetWidgetLife(f2)>.405 and IsUnitAlly(f2,GetOwningPlayer(f1))and GetUnitLifePercent(f2)<50. thencall SetWidgetLife(f2,GetWidgetLife(f2)+20.)endifcall GroupRemoveUnit(g2,f2)endloopcall GroupRemoveUnit(g1,f1)endloopcall DestroyGroup(g1)call DestroyGroup(g2)set g1=nullset g2=nullset f1=nullset f2=nullset T=nullendfunctionfunction tm takes nothing returns booleanreturn GetSpellAbilityId()=='A0C5'endfunctionfunction Tm takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer Gb=GetHandleId(t)local group glocal group g2=CreateGroup()local integer In=LoadInteger(wx,1,Gb)local integer xc=LoadInteger(wx,2,Gb)local unit uA=LoadUnitHandle(wx,3,Gb)local unit flocal boolean blocal player plocal unit ff=CreateUnit(GetOwningPlayer(uA),'h00P',0,0,0)set g=LoadGroupHandle(wx,4,Gb)if In>xc or FirstOfGroup(g)==null thencall DestroyGroup(g)call DestroyTimer(t)elseset g2=ZC(g)set b=falseloopset f=FirstOfGroup(g2)exitwhen f==nullset b=trueif GetWidgetLife(f)>.405 and jb(f)thencall UnitDamageTarget(ff,f,50,false,false,null,DAMAGE_TYPE_UNIVERSAL,null)elsecall GroupRemoveUnit(g,f)endifcall DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\Possession\\PossessionTarget.mdl",f,"head"))call GroupRemoveUnit(g2,f)endloopif b thencall GroupEnumUnitsInRange(g2,GetWidgetX(uA),GetWidgetY(uA),550,null)set p=GetOwningPlayer(uA)loopset f=FirstOfGroup(g2)exitwhen f==nullif IsUnitAlly(f,p)and GetWidgetLife(f)>.405 thencall SetWidgetLife(f,GetWidgetLife(f)+50.)endifcall GroupRemoveUnit(g2,f)endloopendifcall SaveInteger(wx,1,Gb,In+1)endifcall RemoveUnit(ff)call DestroyGroup(g2)set t=nullset g=nullset g2=nullset uA=nullset f=nullset ff=nullendfunctionfunction um takes nothing returns nothinglocal group g=CreateGroup()local timer t=CreateTimer()local integer Gb=GetHandleId(t)local unit uA=GetSpellAbilityUnit()call GroupEnumUnitsInRange(g,GetSpellTargetX(),GetSpellTargetY(),300,Condition(function Kc))call SaveInteger(wx,1,Gb,1)call SaveInteger(wx,2,Gb,$A)call SaveUnitHandle(wx,3,Gb,uA)call SaveGroupHandle(wx,4,Gb,g)call TimerStart(t,1,true,function Tm)set g=nullset t=nullset uA=nullendfunctionfunction wm takes nothing returns booleanreturn GetItemTypeId(GetManipulatedItem())=='I045'endfunctionfunction Wm takes nothing returns nothingset Tx=Tx-1if Tx==0 thencall DisableTrigger(FO)endifendfunctionfunction Ym takes nothing returns nothinglocal unit u=GetEnumUnit()if not(IsUnitHidden(u)or IsUnitPaused(u))thenif GetUnitState(u,UNIT_STATE_MANA)>=$A+5*GetUnitAbilityLevel(u,'A0I9')thencall SetUnitState(u,UNIT_STATE_MANA,GetUnitState(u,UNIT_STATE_MANA)-$A-5*GetUnitAbilityLevel(u,'A0I9'))elsecall UnitRemoveAbility(u,'A0IG')call GroupRemoveUnit(HA,u)endifendifset u=nullendfunctionfunction zm takes nothing returns nothingcall ForGroup(HA,function Ym)endfunctionfunction vM takes nothing returns booleanreturn(GetItemTypeId(GetManipulatedItem())=='I01U')or(GetItemTypeId(GetManipulatedItem())=='I07N')endfunctionfunction eM takes nothing returns nothinglocal unit u=GetTriggerUnit()local player p=GetOwningPlayer(u)if GetUnitAbilityLevel(u,'B00R')==0 and jb(u)thencall SetPlayerAbilityAvailable(p,'A0IG',true)call UnitAddAbility(u,'A0IG')call UnitMakeAbilityPermanent(u,true,'A0IG')call UnitMakeAbilityPermanent(u,true,'A0I9')call GroupAddUnit(HA,u)if GetItemTypeId(GetManipulatedItem())=='I01U' thencall SetUnitAbilityLevel(u,'A0I9',1)elsecall SetUnitAbilityLevel(u,'A0I9',2)endifcall SetPlayerAbilityAvailable(p,'A0IG',false)elsecall UnitRemoveAbility(u,'A0IG')call GroupRemoveUnit(HA,u)endifset u=nullendfunctionfunction oM takes nothing returns booleanreturn(GetItemTypeId(GetManipulatedItem())=='I01U')or(GetItemTypeId(GetManipulatedItem())=='I07N')endfunctionfunction rM takes nothing returns nothingcall UnitRemoveAbility(GetTriggerUnit(),'A0IG')call GroupRemoveUnit(HA,GetTriggerUnit())endfunctionfunction aM takes nothing returns nothinglocal item it=GetManipulatedItem()local unit u=GetManipulatingUnit()local integer nM='I00H'local integer VM='I03S'local integer EM='B03L'local integer XM='A00W'local integer OM='A0BN'if GetItemTypeId(it)==nM thenif GetUnitAbilityLevel(u,EM)>0 or GetUnitAbilityLevel(u,OM)>0 thencall TriggerSleepAction(0)call UnitRemoveAbility(u,XM)endifendifif GetItemTypeId(it)==VM thenif GetUnitAbilityLevel(u,EM)>0 thencall TriggerSleepAction(0)call UnitRemoveAbility(u,OM)elseif GetUnitAbilityLevel(u,XM)>0 thencall UnitRemoveAbility(u,XM)endifendifendifset u=nullset it=nullendfunctionfunction IM takes nothing returns nothinglocal unit u=GetLearningUnit()local integer AM='A002'local integer XM='A00W'local integer OM='A0BN'if GetLearnedSkill()==AM thenif GetUnitAbilityLevel(u,XM)>0 thencall UnitRemoveAbility(u,XM)endifif GetUnitAbilityLevel(u,OM)>0 thencall UnitRemoveAbility(u,OM)endifendifset u=nullendfunctionfunction bM takes nothing returns nothinglocal item it=GetManipulatedItem()local unit u=GetManipulatingUnit()local integer nM='I00H'local integer XM='A00W'local integer VM='I03S'local integer OM='A0BN'local integer EM='B03L'local integer In=0local integer LC=0loopexitwhen In>5if GetItemTypeId(UnitItemInSlot(u,In))==VM thenset LC=LC+1endifset In=In+1endloopif GetItemTypeId(it)==VM and LC<=1 thencall UnitRemoveAbility(u,OM)if UnitHasItemOfTypeBJ(u,nM)and GetUnitAbilityLevel(u,EM)==0 thencall UnitAddAbility(u,XM)endifendifset LC=0set In=0loopexitwhen In>5if GetItemTypeId(UnitItemInSlot(u,In))==nM thenset LC=LC+1endifset In=In+1endloopif GetItemTypeId(it)==nM and LC<=1 thencall UnitRemoveAbility(u,XM)endifset u=nullset it=nullendfunction// Инициализация Колдунаfunction HeroInit1211117633 takes nothing returns nothing	local unit u=LoadUnitHandle(wx,StringHash("HeroInit"),0)	set br=u	set TE=CreateTrigger()	call TriggerRegisterUnitEvent(TE,u,EVENT_UNIT_SPELL_CAST)	call TriggerRegisterUnitEvent(TE,u,EVENT_UNIT_SPELL_FINISH)	call TriggerAddAction(TE,function Ik)	call TriggerAddCondition(TE,Condition(function Ek))	set UE=CreateTrigger()	call TriggerRegisterUnitEvent(UE,u,EVENT_UNIT_HERO_SKILL)	call TriggerAddAction(UE,function Ak)	set wE=CreateTrigger()	call DisableTrigger(wE)	call TriggerRegisterUnitEvent(wE,u,EVENT_UNIT_SPELL_EFFECT)	call TriggerAddCondition(wE,Condition(function Nk))	call TriggerAddAction(wE,function ck)	set u=nullendfunction//Инициализация Владыки Молнийfunction HeroInit1328558151 takes nothing returns nothing	local unit u=LoadUnitHandle(wx,StringHash("HeroInit"),0)	local integer Af=0	set Ir=u	set Mn=CreateTrigger()	call TriggerRegisterUnitEvent(Mn,u,EVENT_UNIT_SPELL_EFFECT)	call TriggerAddAction(Mn,function MF)	call TriggerAddCondition(Mn,Condition(function KF))	set pn=CreateTrigger()	call TriggerRegisterUnitEvent(pn,u,EVENT_UNIT_HERO_SKILL)	call TriggerAddAction(pn,function pF)	set Pn=CreateTrigger()	loop		exitwhen Af==8		call TriggerRegisterPlayerUnitEvent(Pn,Player(Af),EVENT_PLAYER_UNIT_ATTACKED,null)		set Af=Af+1	endloop	call DisableTrigger(Pn)	call TriggerAddAction(Pn,function sF)	call TriggerAddCondition(Pn,Condition(function QF))	set qn=CreateTrigger()	call TriggerRegisterUnitEvent(qn,u,EVENT_UNIT_SPELL_EFFECT)	call TriggerAddAction(qn,function uF)	call TriggerAddCondition(qn,Condition(function tF))	set u=nullendfunctionfunction cM takes nothing returns nothing	local unit u=LoadUnitHandle(wx,StringHash("HeroInit"),0)	set Ar=u	set AA=0	set oA=CreateTrigger()	call TriggerRegisterUnitEvent(oA,Ar,EVENT_UNIT_ISSUED_ORDER)	call TriggerAddAction(oA,function Fb)	set Sn=CreateTrigger()	call TriggerRegisterAnyUnitEventBJ(Sn,EVENT_PLAYER_UNIT_ATTACKED)	call TriggerAddCondition(Sn,Condition(function eg))	call TriggerAddAction(Sn,function xg)	set Qn=CreateTrigger()	call TriggerRegisterUnitEvent(Qn,u,EVENT_UNIT_HERO_SKILL)	call TriggerAddAction(Qn,function UF)	set sn=CreateTrigger()	call TriggerRegisterUnitEvent(sn,u,EVENT_UNIT_SPELL_EFFECT)	call TriggerAddCondition(sn,Condition(function WF))	call TriggerAddAction(sn,function YF)	set NA=CreateTrigger()	call TriggerAddAction(NA,function vg)	set Tn=CreateTrigger()	call TriggerAddAction(Tn,function ig)	call TriggerRegisterUnitEvent(Tn,u,EVENT_UNIT_SPELL_EFFECT)	call TriggerAddCondition(Tn,Condition(function rg))	set u=nullendfunction// Инициализация Лучницыfunction HeroInit1211117616 takes nothing returns nothing	call cM()endfunctionfunction HeroInit1211117655 takes nothing returns nothing	call cM()endfunction// Инициализация Падшего Воителяfunction HeroInit1429221442 takes nothing returns nothing	local unit u=LoadUnitHandle(wx,StringHash("HeroInit"),0)	set Er=u	call DB()	set zn=CreateTrigger()	call TriggerAddAction(zn,function Bg)	set Yn=CreateTrigger()	call DisableTrigger(Yn)	call TriggerRegisterAnyUnitEventBJ(Yn,EVENT_PLAYER_UNIT_DEATH)	call TriggerAddAction(Yn,function Ag)	call TriggerAddCondition(Yn,Condition(function Ig))	set yn=CreateTrigger()	call TriggerRegisterUnitEvent(yn,u,EVENT_UNIT_HERO_SKILL)	call TriggerAddAction(yn,function Rg)	call TriggerAddCondition(yn,Condition(function Og))	set Wn=CreateTrigger()	call TriggerAddAction(Wn,function Eg)	set wn=CreateTrigger()	call TriggerRegisterUnitEvent(wn,u,EVENT_UNIT_HERO_SKILL)	call TriggerAddAction(wn,function Vg)	set Un=CreateTrigger()	call TriggerRegisterTimerEvent(Un,.5,true)	call TriggerAddCondition(Un,Condition(function ag))	call TriggerAddAction(Un,function ng)	set u=nullendfunction// Инициализация Пиратаfunction HeroInit1160785968 takes nothing returns nothing	local unit u=LoadUnitHandle(wx,StringHash("HeroInit"),0)	local integer Af=0	local integer zb=16	set vV=CreateTrigger()	call TriggerRegisterUnitEvent(vV,u,EVENT_UNIT_SPELL_EFFECT)	call TriggerAddCondition(vV,Condition(function Gg))	call TriggerAddAction(vV,function Hg)	set Zn=CreateTrigger()	loop		exitwhen Af==zb		call TriggerRegisterPlayerUnitEvent(Zn,Player(Af),EVENT_PLAYER_UNIT_ATTACKED,null)		set Af=Af+1	endloop	call TriggerAddCondition(Zn,Condition(function dg))	call TriggerAddAction(Zn,function Fg)	set u=nullendfunction//Инициализация Война Светаfunction HeroInit1211117658 takes nothing returns nothing	local unit u=LoadUnitHandle(wx,StringHash("HeroInit"),0)	set eV=CreateTrigger()	call TriggerRegisterUnitEvent(eV,u,EVENT_UNIT_SPELL_EFFECT)	call TriggerAddCondition(eV,Condition(function kg))	call TriggerAddAction(eV,function Mg)	set xV=CreateTrigger()	call TriggerRegisterUnitEvent(xV,u,EVENT_UNIT_HERO_SKILL)	call TriggerAddCondition(xV,Condition(function qg))	call TriggerAddAction(xV,function Sg)	set oV=CreateTrigger()	call TriggerRegisterUnitEvent(oV,u,EVENT_UNIT_HERO_SKILL)	call TriggerAddCondition(oV,Condition(function tg))	call TriggerAddAction(oV,function ug)	set rV=CreateTrigger()	call TriggerRegisterUnitEvent(rV,u,EVENT_UNIT_SPELL_EFFECT)	call TriggerAddCondition(rV,Condition(function Ug))	call TriggerAddAction(rV,function wg)	set u=nullendfunction// Инициализация Наги-Гвардейцаfunction HeroInit1211117621 takes nothing returns nothing	local unit u=LoadUnitHandle(wx,StringHash("HeroInit"),0)	set uv=u	call UnitAddAbility(u,'A0F5')	set iV=CreateTrigger()	call TriggerRegisterUnitEvent(iV,u,EVENT_UNIT_HERO_SKILL)	call TriggerAddAction(iV,function Wg)	set aV=CreateTrigger()	call TriggerRegisterUnitEvent(aV,u,EVENT_UNIT_SPELL_EFFECT)	call TriggerAddCondition(aV,Condition(function zg))	call TriggerAddAction(aV,function vG)	set nV=CreateTrigger()	call DisableTrigger(nV)	call TriggerRegisterTimerEventPeriodic(nV,.25)	call TriggerAddCondition(nV,Condition(function eG))	call TriggerAddAction(nV,function xG)	set u=nullendfunction// Инициализация Иллюзионистаfunction HeroInit1211117653 takes nothing returns nothing	local unit u=LoadUnitHandle(wx,StringHash("HeroInit"),0)	call AddSpecialEffectTarget("Abilities\\Spells\\Undead\\AbsorbMana\\AbsorbManaBirthMissile.mdl",u,"hand,left")	set VV=CreateTrigger()	call TriggerAddAction(VV,function oG)	set EV=CreateTrigger()	call TriggerRegisterUnitEvent(EV,u,EVENT_UNIT_HERO_SKILL)	call TriggerAddCondition(EV,Condition(function rG))	call TriggerAddAction(EV,function iG)	set XV=CreateTrigger()	call TriggerRegisterUnitEvent(XV,u,EVENT_UNIT_ATTACKED)	call TriggerAddAction(XV,function aG)	set OV=CreateTrigger()	call TriggerRegisterUnitEvent(OV,u,EVENT_UNIT_SPELL_EFFECT)	call TriggerAddAction(OV,function nG)	set RV=CreateTrigger()	call TriggerRegisterUnitEvent(RV,u,EVENT_UNIT_SPELL_EFFECT)	call TriggerAddAction(RV,function EG)	set IV=CreateTrigger()	call TriggerRegisterUnitEvent(IV,u,EVENT_UNIT_SPELL_CAST)	call TriggerAddCondition(IV,Condition(function XG))	call TriggerAddAction(IV,function OG)	set u=nullendfunctionfunction CM takes nothing returns nothing	local unit u=LoadUnitHandle(wx,StringHash("HeroInit"),0)	call UnitAddAbility(u,'A09M')	call UnitAddAbility(u,'A0EJ')	call DisplayTimedTextToPlayer(GetOwningPlayer(u),0,0,$F,"|cfffefe22ВНИМАНИЕ:|r Для охотницы орбы предметов Сферы огня, Сферы льда, Меча льда, Жезла огня не работают или вообще нарушают нормальную работу атаки. Подробно читайте в разделе информации.")	set AV=CreateTrigger()	call TriggerRegisterUnitEvent(AV,u,EVENT_UNIT_HERO_SKILL)	call TriggerAddCondition(AV,Condition(function RG))	call TriggerAddAction(AV,function IG)	set NV=CreateTrigger()	call TriggerRegisterUnitEvent(NV,u,EVENT_UNIT_HERO_SKILL)	call TriggerAddCondition(NV,Condition(function AG))	call TriggerAddAction(NV,function NG)	set bV=CreateTrigger()	call TriggerRegisterUnitEvent(bV,u,EVENT_UNIT_SPELL_EFFECT)	call TriggerAddCondition(bV,Condition(function bG))	call TriggerAddAction(bV,function DG)	set BV=CreateTrigger()	call TriggerRegisterUnitEvent(BV,u,EVENT_UNIT_SPELL_EFFECT)	call TriggerAddCondition(BV,Condition(function GG))	call TriggerAddAction(BV,function HG)	call UnitAddAbility(u,'A09M')	call UnitAddAbility(u,'A0EJ')	set u=nullendfunction// Инициализация Охотницыfunction HeroInit1160785996 takes nothing returns nothing	call CM()endfunctionfunction HeroInit1160785997 takes nothing returns nothing	call CM()endfunction// Инициализация Хранителя Рощиfunction HeroInit1160785990 takes nothing returns nothing	local unit u=LoadUnitHandle(wx,StringHash("HeroInit"),0)	set Vo=u	set cV=CreateTrigger()	call TriggerRegisterUnitEvent(cV,u,EVENT_UNIT_SPELL_EFFECT)	call TriggerAddCondition(cV,Condition(function jG))	call TriggerAddAction(cV,function lG)	set CV=CreateTrigger()	call TriggerRegisterAnyUnitEventBJ(CV,EVENT_PLAYER_UNIT_SPELL_EFFECT)	call TriggerAddCondition(CV,Condition(function mG))	call TriggerAddAction(CV,function qG)	set dV=CreateTrigger()	call TriggerRegisterAnyUnitEventBJ(dV,EVENT_PLAYER_UNIT_SPELL_EFFECT)	call TriggerAddCondition(dV,Condition(function QG))	call TriggerAddAction(dV,function sG)	set DV=CreateTrigger()	call TriggerRegisterUnitEvent(DV,u,EVENT_UNIT_SPELL_EFFECT)	call TriggerAddCondition(DV,Condition(function SG))	call TriggerAddAction(DV,function TG)	set fV=CreateTrigger()	call TriggerRegisterUnitEvent(fV,u,EVENT_UNIT_SPELL_EFFECT)	call TriggerAddCondition(fV,Condition(function uG))	call TriggerAddAction(fV,function wG)	call Preload("Abilities\\Spells\\Human\\DispelMagic\\DispelMagicTarget.mdl")	set FV=CreateTrigger()	call TriggerRegisterUnitEvent(FV,u,EVENT_UNIT_SPELL_EFFECT)	call TriggerAddCondition(FV,Condition(function YG))	call TriggerAddAction(FV,function rh)	set bA=CreateTrigger()	call TriggerAddAction(bA,function UG)	set u=nullendfunction//Инициализация Повелителя Холодаfunction HeroInit1429221441 takes nothing returns nothing	local unit u=LoadUnitHandle(wx,StringHash("HeroInit"),0)	set gV=CreateTrigger()	call TriggerRegisterUnitEvent(gV,u,EVENT_UNIT_SPELL_EFFECT)	call TriggerAddCondition(gV,Condition(function ih))	call TriggerAddAction(gV,function Xh)	set GV=CreateTrigger()	call TriggerRegisterUnitEvent(GV,u,EVENT_UNIT_ATTACKED)	call TriggerAddCondition(GV,Condition(function Oh))	call TriggerAddAction(GV,function Ih)	call Preload("Abilities\\Spells\\Undead\\FreezingBreath\\FreezingBreathTargetArt.mdl")	set hV=CreateTrigger()	call TriggerRegisterUnitEvent(hV,u,EVENT_UNIT_SPELL_EFFECT)	call TriggerAddCondition(hV,Condition(function Nh))	call TriggerAddAction(hV,function fh)	call Preload("Abilities\\Spells\\Undead\\FrostArmor\\FrostArmorTarget.mdl")	set u=nullendfunction// Инициализация вождя орковfunction HeroInit1328558129 takes nothing returns nothing	local unit u=LoadUnitHandle(wx,StringHash("HeroInit"),0)	set HV=CreateTrigger()	call TriggerRegisterUnitEvent(HV,u,EVENT_UNIT_SPELL_EFFECT)	call TriggerAddCondition(HV,Condition(function jh))	call TriggerAddAction(HV,function kh)	set u=nullendfunction// Инициализация Рыцаряfunction HeroInit1211117624 takes nothing returns nothing	local unit u=LoadUnitHandle(wx,StringHash("HeroInit"),0)	set jV=CreateTrigger()	call TriggerRegisterUnitEvent(jV,u,EVENT_UNIT_SPELL_EFFECT)	call TriggerAddCondition(jV,Condition(function lh))	call TriggerAddAction(jV,function mh)	set JV=CreateTrigger()	call TriggerRegisterUnitEvent(JV,u,EVENT_UNIT_SPELL_EFFECT)	call TriggerAddCondition(JV,Condition(function Mh))	call TriggerAddAction(JV,function Ph)	set kV=CreateTrigger()	call DisableTrigger(kV)	call TriggerRegisterUnitEvent(kV,u,EVENT_UNIT_SPELL_EFFECT)	call TriggerAddCondition(kV,Condition(function Qh))	call TriggerAddAction(kV,function Sh)	set u=nullendfunction// Инициализация Вампираfunction HeroInit1311781447 takes nothing returns nothing	local unit u=LoadUnitHandle(wx,StringHash("HeroInit"),0)	local integer Af=0	local integer zb	set px=u	call UnitAddAbility(u,'A0CF')	set zb=16	set KV=CreateTrigger()	call TriggerRegisterUnitEvent(KV,u,EVENT_UNIT_SPELL_EFFECT)	call TriggerAddCondition(KV,Condition(function th))	call TriggerAddAction(KV,function wh)	set lV=CreateTrigger()	call TriggerRegisterUnitEvent(lV,u,EVENT_UNIT_HERO_SKILL)	call TriggerAddAction(lV,function Wh)	set LV=CreateTrigger()	call DisableTrigger(LV)	call TriggerRegisterTimerEventPeriodic(LV,1.)	call TriggerAddAction(LV,function Yh)	set mV=CreateTrigger()	call TriggerRegisterUnitEvent(mV,u,EVENT_UNIT_SPELL_EFFECT)	call DisableTrigger(mV)	call TriggerAddCondition(mV,Condition(function zh))	call TriggerAddAction(mV,function Zh)	set MV=CreateTrigger()	call TriggerRegisterUnitEvent(MV,u,EVENT_UNIT_HERO_SKILL)	call TriggerAddAction(MV,function eH)	set pV=CreateTrigger()	loop		exitwhen Af==zb		call TriggerRegisterPlayerUnitEvent(pV,Player(Af),EVENT_PLAYER_UNIT_DEATH,null)		set Af=Af+1	endloop	call DisableTrigger(pV)	call TriggerAddCondition(pV,Condition(function xH))	call TriggerAddAction(pV,function oH)	set PV=CreateTrigger()	call TriggerRegisterUnitEvent(PV,u,EVENT_UNIT_SPELL_EFFECT)	call TriggerAddCondition(PV,Condition(function rH))	call TriggerAddAction(PV,function EH)	set Af=0	set qV=CreateTrigger()	loop		exitwhen Af==zb		call TriggerRegisterPlayerUnitEvent(qV,Player(Af),EVENT_PLAYER_UNIT_ATTACKED,null)		set Af=Af+1	endloop	call DisableTrigger(qV)	call TriggerAddCondition(qV,Condition(function AH))	call TriggerAddAction(qV,function NH)	set QV=CreateTrigger()	call DisableTrigger(QV)	call TriggerRegisterTimerEventPeriodic(QV,.25)	call TriggerAddAction(QV,function bH)	set u=nullendfunction//Инициализация Мастера Тенейfunction HeroInit1160785988 takes nothing returns nothing	local unit u=LoadUnitHandle(wx,StringHash("HeroInit"),0)	set hx=u	set u=nullendfunctionfunction dM takes nothing returns nothing	local unit u=LoadUnitHandle(wx,StringHash("HeroInit"),0)	local integer Af=0	local integer zb	set gx=u	set zb=16	set vE=CreateTrigger()	call TriggerRegisterUnitEvent(vE,u,EVENT_UNIT_HERO_SKILL)	call TriggerAddAction(vE,function Ej)	set eE=CreateTrigger()	loop		exitwhen Af==zb		call TriggerRegisterPlayerUnitEvent(eE,Player(Af),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)		set Af=Af+1	endloop	call DisableTrigger(eE)	call TriggerAddAction(eE,function Xj)	set xE=CreateTrigger()	call TriggerRegisterUnitEvent(xE,u,EVENT_UNIT_SPELL_EFFECT)	call TriggerAddCondition(xE,Condition(function Rj))	call TriggerAddAction(xE,function Ij)	set u=nullendfunction// Инициализация Странникаfunction HeroInit1211117623 takes nothing returns nothing	call dM()endfunctionfunction HeroInit1211117657 takes nothing returns nothing	call dM()endfunction//Инициализация Горного Короляfunction HeroInit1211117645 takes nothing returns nothing	local unit u=LoadUnitHandle(wx,StringHash("HeroInit"),0)	call UnitAddAbility(u,'A0AK')	call UnitAddAbility(u,'A0EO')	set oE=CreateTrigger()	call TriggerRegisterUnitEvent(oE,u,EVENT_UNIT_SPELL_EFFECT)	call TriggerAddAction(oE,function Nj)	set rE=CreateTrigger()	call TriggerRegisterUnitEvent(rE,u,EVENT_UNIT_SPELL_EFFECT)	call TriggerAddCondition(rE,Condition(function bj))	call TriggerAddAction(rE,function cj)	set iE=CreateTrigger()	call TriggerRegisterUnitEvent(iE,u,EVENT_UNIT_HERO_SKILL)	call TriggerAddAction(iE,function Cj)	set aE=CreateTrigger()	call DisableTrigger(aE)	call TriggerRegisterUnitEvent(aE,u,EVENT_UNIT_ATTACKED)	call TriggerAddAction(aE,function dj)	set nE=CreateTrigger()	call TriggerRegisterUnitEvent(nE,u,EVENT_UNIT_SPELL_EFFECT)	call TriggerAddCondition(nE,Condition(function Dj))	call TriggerAddAction(nE,function fj)	set u=nullendfunction// Инициализация Берсеркераfunction HeroInit1328558146 takes nothing returns nothing	local unit u=LoadUnitHandle(wx,StringHash("HeroInit"),0)	call UnitAddAbility(u,'A0AA')	call UnitAddAbility(u,'A0AB')	set VE=CreateTrigger()	call TriggerRegisterUnitEvent(VE,u,EVENT_UNIT_HERO_SKILL)	call TriggerAddAction(VE,function gj)	set EE=CreateTrigger()	call TriggerRegisterUnitEvent(EE,u,EVENT_UNIT_SPELL_EFFECT)	call TriggerAddAction(EE,function hj)	set XE=CreateTrigger()	call TriggerRegisterUnitEvent(XE,u,EVENT_UNIT_SPELL_EFFECT)	call TriggerAddAction(XE,function Hj)	set OE=CreateTrigger()	call DisableTrigger(OE)	call TriggerRegisterTimerEventPeriodic(OE,.01)	call TriggerAddAction(OE,function mj)	set u=nullendfunction// Инициализация Морлокаfunction HeroInit1160785987 takes nothing returns nothing	local unit u=LoadUnitHandle(wx,StringHash("HeroInit"),0)	set Mx=u	set IE=CreateTrigger()	call TriggerRegisterUnitEvent(IE,u,EVENT_UNIT_HERO_SKILL)	call TriggerAddAction(IE,function Mj)	set AE=CreateTrigger()	call DisableTrigger(AE)	call TriggerRegisterUnitEvent(AE,u,EVENT_UNIT_ATTACKED)	call TriggerAddAction(AE,function pj)	set NE=CreateTrigger()	call TriggerRegisterUnitEvent(NE,u,EVENT_UNIT_HERO_SKILL)	call TriggerAddAction(NE,function tj)	set bE=CreateTrigger()	call DisableTrigger(bE)	call TriggerRegisterTimerEventPeriodic(bE,.25)	call TriggerAddAction(bE,function Tj)	set BE=CreateTrigger()	call TriggerRegisterUnitEvent(BE,u,EVENT_UNIT_SPELL_EFFECT)	call TriggerAddAction(BE,function yj)	set u=nullendfunction// Инициализация Скелета-магаfunction HeroInit1160785986 takes nothing returns nothing	local unit u=LoadUnitHandle(wx,StringHash("HeroInit"),0)	set Qe=u	set cE=CreateTrigger()	call TriggerRegisterUnitEvent(cE,u,EVENT_UNIT_SPELL_EFFECT)	call TriggerAddAction(cE,function Zj)	call TriggerAddCondition(cE,Condition(function Yj))	set CE=CreateTrigger()	call TriggerRegisterUnitEvent(CE,u,EVENT_UNIT_SPELL_EFFECT)	call TriggerAddAction(CE,function eJ)	call TriggerAddCondition(CE,Condition(function vJ))	set dE=CreateTrigger()	call TriggerRegisterUnitEvent(dE,u,EVENT_UNIT_HERO_SKILL)	call TriggerAddCondition(dE,Condition(function oJ))	call TriggerAddAction(dE,function rJ)	set DE=CreateTrigger()	call TriggerAddAction(DE,function iJ)	set fE=CreateTrigger()	call TriggerRegisterUnitEvent(fE,u,EVENT_UNIT_SPELL_EFFECT)	call TriggerAddCondition(fE,Condition(function aJ))	call TriggerAddAction(fE,function EJ)	set u=nullendfunction// Инициализация Скелета-вораfunction HeroInit1429221429 takes nothing returns nothing	local unit u=LoadUnitHandle(wx,StringHash("HeroInit"),0)	set FE=CreateTrigger()	call TriggerRegisterUnitEvent(FE,u,EVENT_UNIT_SPELL_EFFECT)	call TriggerAddCondition(FE,Condition(function XJ))	call TriggerAddAction(FE,function IJ)	set gE=CreateTrigger()	call TriggerRegisterUnitEvent(gE,u,EVENT_UNIT_HERO_SKILL)	call TriggerAddAction(gE,function AJ)	set GE=CreateTrigger()	call DisableTrigger(GE)	call TriggerRegisterAnyUnitEventBJ(GE,EVENT_PLAYER_UNIT_ATTACKED)	call TriggerAddAction(GE,function NJ)	set hE=CreateTrigger()	call TriggerRegisterUnitEvent(hE,u,EVENT_UNIT_HERO_SKILL)	call TriggerAddAction(hE,function bJ)	set HE=CreateTrigger()	call DisableTrigger(HE)	call TriggerRegisterUnitEvent(HE,u,EVENT_UNIT_ATTACKED)	call TriggerAddAction(HE,function BJ)	set u=nullendfunction// Инициализация Генералаfunction HeroInit1211117638 takes nothing returns nothing	local unit u=LoadUnitHandle(wx,StringHash("HeroInit"),0)	set jE=CreateTrigger()	call TriggerRegisterUnitEvent(jE,u,EVENT_UNIT_HERO_SKILL)	call TriggerAddAction(jE,function CJ)	set JE=CreateTrigger()	call DisableTrigger(JE)	call TriggerRegisterAnyUnitEventBJ(JE,EVENT_PLAYER_UNIT_ATTACKED)	call TriggerAddCondition(JE,Condition(function DJ))	call TriggerAddAction(JE,function fJ)	set kE=CreateTrigger()	call TriggerRegisterUnitEvent(kE,u,EVENT_UNIT_SPELL_EFFECT)	call TriggerAddAction(kE,function FJ)	set u=nullendfunction//Инициализация Королевы Змейfunction HeroInit1311781193 takes nothing returns nothing	local unit u=LoadUnitHandle(wx,StringHash("HeroInit"),0)	set KE=CreateTrigger()	call TriggerRegisterUnitEvent(KE,u,EVENT_UNIT_SPELL_EFFECT)	call TriggerAddCondition(KE,Condition(function gJ))	call TriggerAddAction(KE,function HJ)	set u=nullendfunction// Инициализация Повелителя Землиfunction HeroInit1211117634 takes nothing returns nothing	local unit u=LoadUnitHandle(wx,StringHash("HeroInit"),0)	set LE=CreateTrigger()	call TriggerRegisterUnitEvent(LE,u,EVENT_UNIT_SPELL_EFFECT)	call TriggerAddCondition(LE,Condition(function QJ))	call TriggerAddAction(LE,function tJ)	set mE=CreateTrigger()	call TriggerRegisterUnitEvent(mE,u,EVENT_UNIT_SPELL_EFFECT)	call TriggerAddCondition(mE,Condition(function uJ))	call TriggerAddAction(mE,function UJ)	set ME=CreateTrigger()	call TriggerRegisterUnitEvent(ME,u,EVENT_UNIT_SPELL_CAST)	call TriggerAddAction(ME,function wJ)	set pE=CreateTrigger()	call TriggerRegisterUnitEvent(pE,u,EVENT_UNIT_SPELL_EFFECT)	call TriggerAddAction(pE,function WJ)	set lE=CreateTrigger()	call TriggerRegisterUnitEvent(lE,u,EVENT_UNIT_SPELL_EFFECT)	call TriggerAddAction(lE,function qJ)	set u=nullendfunction// Инициализация Вурдалакаfunction HeroInit1160785975 takes nothing returns nothing	local unit u=LoadUnitHandle(wx,StringHash("HeroInit"),0)	call UnitAddAbility(u,'A0FH')	set PE=CreateTrigger()	call TriggerRegisterUnitEvent(PE,u,EVENT_UNIT_SPELL_EFFECT)	call TriggerAddAction(PE,function YJ)	call Preload("Objects\\Spawnmodels\\Other\\PandarenBrewmasterBlood\\PandarenBrewmasterBlood.mdl")	set qE=CreateTrigger()	call TriggerRegisterUnitEvent(qE,u,EVENT_UNIT_HERO_SKILL)	call TriggerAddCondition(qE,Condition(function ZJ))	call TriggerAddAction(qE,function ek)	set u=nullendfunction// Инициализация Шаманаfunction HeroInit1160785974 takes nothing returns nothing	local unit u=LoadUnitHandle(wx,StringHash("HeroInit"),0)	set QE=CreateTrigger()	call TriggerRegisterUnitEvent(QE,u,EVENT_UNIT_HERO_SKILL)	call TriggerAddAction(QE,function xk)	set sE=CreateTrigger()	call DisableTrigger(sE)	call TriggerRegisterAnyUnitEventBJ(sE,EVENT_PLAYER_UNIT_DEATH)	call TriggerAddAction(sE,function ok)	set SE=CreateTrigger()	call TriggerRegisterUnitEvent(SE,u,EVENT_UNIT_SPELL_EFFECT)	call TriggerAddCondition(SE,Condition(function rk))	call TriggerAddAction(SE,function ak)	set tE=CreateTrigger()	call TriggerRegisterUnitEvent(tE,u,EVENT_UNIT_SPELL_ENDCAST)	call TriggerRegisterUnitEvent(tE,u,EVENT_UNIT_SPELL_FINISH)	call TriggerAddCondition(tE,Condition(function nk))	call TriggerAddAction(tE,function Vk)	set u=nullendfunction// Инициализация Мясникаfunction HeroInit1328558133 takes nothing returns nothing	local unit u=LoadUnitHandle(wx,StringHash("HeroInit"),0)	local integer Af=0	local integer zb	set oe=u	set zb=16	set WE=CreateTrigger()	call TriggerRegisterUnitEvent(WE,u,EVENT_UNIT_SPELL_EFFECT)	call TriggerAddAction(WE,function Ck)	set yE=CreateTrigger()	loop		exitwhen Af==zb		call TriggerRegisterPlayerUnitEvent(yE,Player(Af),EVENT_PLAYER_UNIT_ATTACKED,null)		set Af=Af+1	endloop	call DisableTrigger(yE)	call TriggerAddAction(yE,function fk)	call TriggerAddCondition(yE,Condition(function Dk))	set YE=CreateTrigger()	call TriggerRegisterUnitEvent(YE,u,EVENT_UNIT_HERO_SKILL)	call TriggerAddAction(YE,function Fk)	set zE=CreateTrigger()	call DisableTrigger(zE)	call TriggerRegisterTimerEventPeriodic(zE,15.)	call TriggerAddCondition(zE,Condition(function gk))	call TriggerAddAction(zE,function Gk)	set u=nullendfunction// Инициализация Големаfunction HeroInit1328558132 takes nothing returns nothing	local unit u=LoadUnitHandle(wx,StringHash("HeroInit"),0)	set ZE=CreateTrigger()	call TriggerRegisterUnitEvent(ZE,u,EVENT_UNIT_SPELL_EFFECT)	call TriggerAddCondition(ZE,Condition(function hk))	call TriggerAddAction(ZE,function jk)	set vX=CreateTrigger()	call TriggerRegisterUnitEvent(vX,u,EVENT_UNIT_HERO_SKILL)	call TriggerAddCondition(vX,Condition(function Jk))	call TriggerAddAction(vX,function kk)	set eX=CreateTrigger()	call TriggerRegisterUnitEvent(eX,u,EVENT_UNIT_ATTACKED)	call DisableTrigger(eX)	call TriggerAddCondition(eX,Condition(function Kk))	call TriggerAddAction(eX,function Lk)	set u=nullendfunction// Инициализация Сотканного из Кровиfunction HeroInit1311781176 takes nothing returns nothing	local unit u=LoadUnitHandle(wx,StringHash("HeroInit"),0)	set jA=u	set xX=CreateTrigger()	call TriggerRegisterUnitEvent(xX,u,EVENT_UNIT_SPELL_EFFECT)	call TriggerAddAction(xX,function mk)	set oX=CreateTrigger()	call TriggerRegisterUnitEvent(oX,u,EVENT_UNIT_SPELL_EFFECT)	call TriggerAddAction(oX,function Mk)	set rX=CreateTrigger()	call TriggerRegisterUnitEvent(rX,u,EVENT_UNIT_SPELL_EFFECT)	call TriggerAddCondition(rX,Condition(function Pk))	call TriggerAddAction(rX,function Qk)	set u=nullendfunction// Инициализация Тёмного Рыцаряfunction HeroInit1211117622 takes nothing returns nothing	local unit u=LoadUnitHandle(wx,StringHash("HeroInit"),0)	set Wv=u	call UnitAddAbility(u,'A0A8')	set iX=CreateTrigger()	call TriggerRegisterUnitEvent(iX,u,EVENT_UNIT_SPELL_EFFECT)	call TriggerAddCondition(iX,Condition(function sk))	call TriggerAddAction(iX,function tk)	set aX=CreateTrigger()	call TriggerRegisterUnitEvent(aX,u,EVENT_UNIT_HERO_SKILL)	call TriggerAddAction(aX,function Tk)	set nX=CreateTrigger()	call DisableTrigger(nX)	call TriggerRegisterAnyUnitEventBJ(nX,EVENT_PLAYER_UNIT_ATTACKED)	call TriggerAddCondition(nX,Condition(function uk))	call TriggerAddAction(nX,function wk)	set VX=CreateTrigger()	call TriggerRegisterUnitEvent(VX,u,EVENT_UNIT_HERO_SKILL)	call TriggerAddAction(VX,function Wk)	set EX=CreateTrigger()	call DisableTrigger(EX)	call TriggerRegisterAnyUnitEventBJ(EX,EVENT_PLAYER_UNIT_ATTACKED)	call TriggerAddCondition(EX,Condition(function yk))	call TriggerAddAction(EX,function Yk)	set XX=CreateTrigger()	call TriggerRegisterUnitEvent(XX,u,EVENT_UNIT_SPELL_EFFECT)	call TriggerRegisterUnitEvent(XX,u,EVENT_UNIT_HERO_SKILL)	call TriggerAddCondition(XX,Condition(function zk))	call TriggerAddAction(XX,function Zk)	set u=nullendfunction//Инициализация Королевы Пауковfunction HeroInit1160785972 takes nothing returns nothing	local unit u=LoadUnitHandle(wx,StringHash("HeroInit"),0)	set wv=u	set OX=CreateTrigger()	call TriggerRegisterUnitEvent(OX,u,EVENT_UNIT_HERO_SKILL)	call TriggerAddCondition(OX,Condition(function vK))	call TriggerAddAction(OX,function eK)	set RX=CreateTrigger()	call DisableTrigger(RX)	call TriggerRegisterTimerEventPeriodic(RX,.25)	call TriggerAddCondition(RX,Condition(function xK))	call TriggerAddAction(RX,function oK)	set IX=CreateTrigger()	call TriggerRegisterUnitEvent(IX,u,EVENT_UNIT_HERO_SKILL)	call TriggerAddCondition(IX,Condition(function rK))	call TriggerAddAction(IX,function iK)	set AX=CreateTrigger()	call DisableTrigger(AX)	call TriggerRegisterTimerEventPeriodic(AX,.5)	call TriggerAddCondition(AX,Condition(function aK))	call TriggerAddAction(AX,function VK)	set u=nullendfunction// Инициализация Валькирииfunction HeroInit1160785971 takes nothing returns nothing	local unit u=LoadUnitHandle(wx,StringHash("HeroInit"),0)	local integer Af=0	local integer zb	set Uv=u	set zb=16	set NX=CreateTrigger()	call TriggerRegisterUnitEvent(NX,u,EVENT_UNIT_SPELL_EFFECT)	call TriggerAddCondition(NX,Condition(function XK))	call TriggerAddAction(NX,function RK)	set bX=CreateTrigger()	loop		exitwhen Af==zb		call TriggerRegisterPlayerUnitEvent(bX,Player(Af),EVENT_PLAYER_UNIT_ATTACKED,null)		set Af=Af+1	endloop	call DisableTrigger(bX)	call TriggerAddCondition(bX,Condition(function AK))	call TriggerAddAction(bX,function NK)	set BX=CreateTrigger()	call TriggerRegisterUnitEvent(BX,u,EVENT_UNIT_HERO_SKILL)	call TriggerAddCondition(BX,Condition(function bK))	call TriggerAddAction(BX,function BK)	set Af=0	set cX=CreateTrigger()	loop		exitwhen Af==zb		call TriggerRegisterPlayerUnitEvent(cX,Player(Af),EVENT_PLAYER_UNIT_ATTACKED,null)		set Af=Af+1	endloop	call DisableTrigger(cX)	call TriggerAddCondition(cX,Condition(function cK))	call TriggerAddAction(cX,function CK)	set u=nullendfunction// Инициализация Война Плетиfunction HeroInit1429221424 takes nothing returns nothing	local unit u=LoadUnitHandle(wx,StringHash("HeroInit"),0)	local integer Af=0	local integer zb	call UnitAddAbility(u,'A0E3')	set zb=16	set CX=CreateTrigger()	call TriggerRegisterUnitEvent(CX,u,EVENT_UNIT_SPELL_EFFECT)	call TriggerAddCondition(CX,Condition(function fK))	call TriggerAddAction(CX,function gK)	set dX=CreateTrigger()	call DisableTrigger(dX)	loop		exitwhen Af==zb		call TriggerRegisterPlayerUnitEvent(dX,Player(Af),EVENT_PLAYER_UNIT_ATTACKED,null)		set Af=Af+1	endloop	call TriggerAddCondition(dX,Condition(function GK))	call TriggerAddAction(dX,function HK)	set DX=CreateTrigger()	call TriggerRegisterUnitEvent(DX,u,EVENT_UNIT_SPELL_EFFECT)	call TriggerAddCondition(DX,Condition(function jK))	call TriggerAddAction(DX,function kK)	set u=nullendfunction// Инициализация Знахаряfunction HeroInit1328558130 takes nothing returns nothing	local unit u=LoadUnitHandle(wx,StringHash("HeroInit"),0)	set fX=CreateTrigger()	call TriggerRegisterUnitEvent(fX,u,EVENT_UNIT_SPELL_EFFECT)	call TriggerAddCondition(fX,Condition(function KK))	call TriggerAddAction(fX,function MK)	set FX=CreateTrigger()	call TriggerRegisterUnitEvent(FX,u,EVENT_UNIT_SPELL_EFFECT)	call TriggerAddCondition(FX,Condition(function pK))	call TriggerAddAction(FX,function WK)	set u=nullendfunction// Инициализация Древней Жрицыfunction HeroInit1160785970 takes nothing returns nothing	local unit u=LoadUnitHandle(wx,StringHash("HeroInit"),0)	set qx=u	set gX=CreateTrigger()	call TriggerRegisterUnitEvent(gX,u,EVENT_UNIT_HERO_SKILL)	call TriggerAddCondition(gX,Condition(function YK))	call TriggerAddAction(gX,function zK)	set GX=CreateTrigger()	call TriggerRegisterUnitEvent(GX,u,EVENT_UNIT_SPELL_EFFECT)	call DisableTrigger(GX)	call TriggerAddCondition(GX,Condition(function ZK))	call TriggerAddAction(GX,function el)	set hX=CreateTrigger()	call TriggerRegisterUnitEvent(hX,u,EVENT_UNIT_SPELL_EFFECT)	call TriggerAddCondition(hX,Condition(function ol))	call TriggerAddAction(hX,function rl)	set HX=CreateTrigger()	call DisableTrigger(HX)	call TriggerRegisterTimerEventPeriodic(HX,.25)	call TriggerAddAction(HX,function il)	set jX=CreateTrigger()	call TriggerRegisterUnitEvent(jX,u,EVENT_UNIT_SPELL_EFFECT)	call TriggerAddCondition(jX,Condition(function al))	call TriggerAddAction(jX,function Xl)	set u=nullendfunction//Инициализация Пивовараfunction HeroInit1311780948 takes nothing returns nothing	local unit u=LoadUnitHandle(wx,StringHash("HeroInit"),0)	set Sv=u	set JX=CreateTrigger()	call TriggerRegisterUnitEvent(JX,u,EVENT_UNIT_SPELL_EFFECT)	call TriggerAddCondition(JX,Condition(function Ol))	call TriggerAddAction(JX,function Il)	set kX=CreateTrigger()	call TriggerRegisterUnitEvent(kX,u,EVENT_UNIT_HERO_SKILL)	call TriggerAddCondition(kX,Condition(function Al))	call TriggerAddAction(kX,function Nl)	set KX=CreateTrigger()	call DisableTrigger(KX)	call TriggerRegisterTimerEventPeriodic(KX,1.)	call TriggerAddAction(KX,function bl)	set LX=CreateTrigger()	call TriggerRegisterUnitEvent(LX,u,EVENT_UNIT_HERO_SKILL)	call TriggerAddCondition(LX,Condition(function Cl))	call TriggerAddAction(LX,function dl)	set mX=CreateTrigger()	call TriggerRegisterUnitEvent(mX,u,EVENT_UNIT_ATTACKED)	call DisableTrigger(mX)	call TriggerAddAction(mX,function Dl)	set u=nullendfunction// Инициализация Наги-Сиреныfunction HeroInit1211117619 takes nothing returns nothing	local unit u=LoadUnitHandle(wx,StringHash("HeroInit"),0)	local integer Af=0	local integer zb	set Pe=u	set zb=16	set MX=CreateTrigger()	call TriggerRegisterUnitEvent(MX,u,EVENT_UNIT_SPELL_EFFECT)	call TriggerAddCondition(MX,Condition(function fl))	call TriggerAddAction(MX,function Hl)	set pX=CreateTrigger()	call TriggerRegisterUnitEvent(pX,u,EVENT_UNIT_HERO_SKILL)	call TriggerAddCondition(pX,Condition(function jl))	call TriggerAddAction(pX,function Jl)	set PX=CreateTrigger()	call DisableTrigger(PX)	call TriggerRegisterAnyUnitEventBJ(PX,EVENT_PLAYER_UNIT_DEATH)	call TriggerAddAction(PX,function kl)	set qX=CreateTrigger()	call TriggerRegisterUnitEvent(qX,u,EVENT_UNIT_HERO_SKILL)	call TriggerAddCondition(qX,Condition(function Kl))	call TriggerAddAction(qX,function Ll)	set QX=CreateTrigger()	call DisableTrigger(QX)	call TriggerRegisterUnitEvent(QX,u,EVENT_UNIT_SPELL_EFFECT)	call TriggerAddCondition(QX,Condition(function ml))	call TriggerAddAction(QX,function Ml)	set sX=CreateTrigger()	loop		exitwhen Af==zb		call TriggerRegisterPlayerUnitEvent(sX,Player(Af),EVENT_PLAYER_UNIT_ATTACKED,null)		set Af=Af+1	endloop	call DisableTrigger(sX)	call TriggerAddCondition(sX,Condition(function ql))	call TriggerAddAction(sX,function Ql)	set u=nullendfunction// Инициализация Повелителя Зверейfunction HeroInit1311780949 takes nothing returns nothing	local unit u=LoadUnitHandle(wx,StringHash("HeroInit"),0)	set Tv=u	set SX=CreateTrigger()	call TriggerRegisterUnitEvent(SX,u,EVENT_UNIT_SPELL_EFFECT)	call TriggerAddCondition(SX,Condition(function sl))	call TriggerAddAction(SX,function Tl)	set tX=CreateTrigger()	call TriggerRegisterUnitEvent(tX,u,EVENT_UNIT_HERO_SKILL)	call TriggerAddCondition(tX,Condition(function ul))	call TriggerAddAction(tX,function Ul)	set TX=CreateTrigger()	call DisableTrigger(TX)	call TriggerRegisterAnyUnitEventBJ(TX,EVENT_PLAYER_UNIT_DEATH)	call TriggerAddAction(TX,function wl)	call TriggerAddCondition(TX,Condition(function Wl))	set uX=CreateTrigger()	call TriggerRegisterUnitEvent(uX,u,EVENT_UNIT_SPELL_EFFECT)	call TriggerAddCondition(uX,Condition(function yl))	call TriggerAddAction(uX,function zl)	set u=nullendfunction// Инициализация Повелителя Времениfunction HeroInit1160785973 takes nothing returns nothing	local unit u=LoadUnitHandle(wx,StringHash("HeroInit"),0)	set yv=u	set UX=CreateTrigger()	call TriggerRegisterUnitEvent(UX,u,EVENT_UNIT_SPELL_EFFECT)	call TriggerAddAction(UX,function Zl)	set wX=CreateTrigger()	call TriggerRegisterUnitEvent(wX,u,EVENT_UNIT_HERO_SKILL)	call TriggerAddAction(wX,function eL)	set WX=CreateTrigger()	call TriggerRegisterTimerEventPeriodic(WX,1.)	call TriggerAddAction(WX,function xL)	set yX=CreateTrigger()	call TriggerRegisterUnitEvent(yX,u,EVENT_UNIT_HERO_REVIVABLE)	call DisableTrigger(yX)	call TriggerAddAction(yX,function oL)	set YX=CreateTrigger()	call TriggerRegisterUnitEvent(YX,u,EVENT_UNIT_SPELL_EFFECT)	call DisableTrigger(YX)	call TriggerAddCondition(YX,Condition(function rL))	call TriggerAddAction(YX,function iL)	set zX=CreateTrigger()	call TriggerRegisterUnitEvent(zX,u,EVENT_UNIT_HERO_SKILL)	call TriggerAddAction(zX,function aL)	set ZX=CreateTrigger()	call DisableTrigger(ZX)	call TriggerRegisterTimerEvent(ZX,60.,true)	call TriggerAddAction(ZX,function nL)	set vO=CreateTrigger()	call TriggerRegisterUnitEvent(vO,u,EVENT_UNIT_SPELL_EFFECT)	call TriggerAddCondition(vO,Condition(function VL))	call TriggerAddAction(vO,function RL)	set u=nullendfunctionfunction DM takes nothing returns nothing	local unit u=LoadUnitHandle(wx,StringHash("HeroInit"),0)	set Dx=u	set eO=CreateTrigger()	call TriggerRegisterAnyUnitEventBJ(eO,EVENT_PLAYER_UNIT_SPELL_EFFECT)	call TriggerAddCondition(eO,Condition(function IL))	call TriggerAddAction(eO,function NL)	set xO=CreateTrigger()	call TriggerRegisterAnyUnitEventBJ(xO,EVENT_PLAYER_UNIT_SPELL_ENDCAST)	call TriggerRegisterAnyUnitEventBJ(xO,EVENT_PLAYER_UNIT_SPELL_FINISH)	call TriggerAddCondition(xO,Condition(function bL))	call TriggerAddAction(xO,function BL)	set oO=CreateTrigger()	call TriggerRegisterUnitEvent(oO,u,EVENT_UNIT_SPELL_EFFECT)	call TriggerAddCondition(oO,Condition(function cL))	call TriggerAddAction(oO,function CL)	set rO=CreateTrigger()	call TriggerRegisterUnitEvent(rO,u,EVENT_UNIT_SPELL_EFFECT)	call TriggerAddAction(rO,function fL)	set iO=CreateTrigger()	call TriggerRegisterUnitEvent(iO,u,EVENT_UNIT_HERO_SKILL)	call TriggerAddAction(iO,function FL)	set aO=CreateTrigger()	call TriggerRegisterUnitEvent(aO,u,EVENT_UNIT_SPELL_EFFECT)	call TriggerAddAction(aO,function gL)	set nO=CreateTrigger()	call TriggerRegisterUnitEvent(nO,u,EVENT_UNIT_SPELL_FINISH)	call TriggerRegisterUnitEvent(nO,u,EVENT_UNIT_SPELL_ENDCAST)	call TriggerAddAction(nO,function GL)	set VO=CreateTrigger()	call DisableTrigger(VO)	call TriggerRegisterTimerEventPeriodic(VO,1.)	call TriggerAddAction(VO,function jL)	set u=nullendfunction// Инициализация Паладинаfunction HeroInit1211117618 takes nothing returns nothing	call DM()endfunctionfunction HeroInit1211117651 takes nothing returns nothing	call DM()endfunctionfunction gM takes nothing returns nothinglocal integer i=GetPlayerId(GetOwningPlayer(GetEventDamageSource()))if GetEventDamage()<=GetWidgetLife(GetTriggerUnit())thenset tA[i]=tA[i]+GetEventDamage()elseset tA[i]=tA[i]+GetWidgetLife(GetTriggerUnit())endifendfunctionfunction GM takes nothing returns nothinglocal integer i=GetPlayerId(GetOwningPlayer(GetTriggerUnit()))if GetEventDamage()<GetWidgetLife(GetTriggerUnit())thenset TA[i]=TA[i]+GetEventDamage()elseset TA[i]=TA[i]+GetWidgetLife(GetTriggerUnit())endifendfunctionfunction HM takes nothing returns nothinglocal integer i=0set JA=CreateTrigger()call TriggerAddAction(JA,function GM)loopexitwhen i==8if gv[i]!=null thencall TriggerRegisterUnitEvent(JA,gv[i],EVENT_UNIT_DAMAGED)endifset i=i+1endloopendfunctionfunction jM takes nothing returns nothingcall jD()endfunctionfunction kM takes nothing returns booleanreturn tv==falseendfunctionfunction KM takes nothing returns nothing	call MakeRandomRuneInArea(GetRandomReal(GetRectMinX(Ci),GetRectMaxX(Ci)),GetRandomReal(GetRectMinY(Ci),GetRectMaxY(Ci)))endfunctionfunction LM takes nothing returns nothinglocal timer t=GetExpiredTimer()set He=falsecall DestroyTimer(t)set t=nullendfunctionfunction mM takes nothing returns nothinglocal group g=CreateGroup()local unit flocal timer t=CreateTimer()call mB()if tv thenreturnendifset ce=truecall TriggerExecute(wO)call PauseTaverns(true)call Rd()if hv>=16 thencall EnableTrigger(vR)endifif hv>=17 thencall EnableTrigger(eR)endifif hv>=18 thencall EnableTrigger(xR)endifif hv>=19 thencall EnableTrigger(oR)endifcall GroupEnumUnitsInRect(g,Hr,null)loopset f=FirstOfGroup(g)exitwhen f==nullif GetUnitTypeId(f)!='n002' and IsUnitType(f,UNIT_TYPE_HERO)==false and GetOwningPlayer(f)!=Player($F)thencall KillUnit(f)call RemoveUnit(f)endifcall GroupRemoveUnit(g,f)endloopif uo thencall EnableTrigger(lO)elsecall EnableTrigger(LO)endifcall DestroyGroup(g)set He=truecall TimerStart(t,6.25,false,function LM)set f=nullset g=nullset t=nullendfunctionfunction pM takes nothing returns nothing	call DisplayTextToPlayer(GetLocalPlayer(),.0,.0,"4...")	call DestroyTimer(GetExpiredTimer())endfunctionfunction PM takes nothing returns nothing	call DisplayTextToPlayer(GetLocalPlayer(),.0,.0,"3...")	call DestroyTimer(GetExpiredTimer())endfunctionfunction qM takes nothing returns nothing	call DisplayTextToPlayer(GetLocalPlayer(),.0,.0,"2...")	call DestroyTimer(GetExpiredTimer())endfunctionfunction QM takes nothing returns nothing	call DisplayTextToPlayer(GetLocalPlayer(),.0,.0,"1...")	call DestroyTimer(GetExpiredTimer())endfunctionfunction sM takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer Gb=GetHandleId(t)local boolean b=LoadBoolean(wx,1,Gb)local integer In=1call SaveBoolean(wx,1,StringHash("pr2"),false)if b thencall PauseUnit(Nx,false)call TriggerRegisterUnitLifeEvent(SO,Nx,LESS_THAN_OR_EQUAL,7000.)call TriggerRegisterUnitLifeEvent(tO,Nx,LESS_THAN_OR_EQUAL,3000.)call EnableTrigger(uO)call EnableTrigger(zO)call EnableTrigger(sO)call EnableTrigger(lO)elsecall PauseUnit(Bx,false)call EnableTrigger(uO)call EnableTrigger(sO)endifloopexitwhen In>8call PauseUnit(gv[In],false)call PauseUnit(Wo[In],false)set In=In+1endloopcall DestroyTimer(t)set t=nullendfunctionfunction SM takes nothing returns nothinglocal timer t=CreateTimer()local timer t2=CreateTimer()local timer t3=CreateTimer()local timer t4=CreateTimer()local timer t5=CreateTimer()local integer Gb=GetHandleId(t5)local integer In=1local integer zb=fvlocal boolean b=(hv==20)local real xlocal real yset Pv=truecall PauseTaverns(true)call EnableTrigger(pO)loopexitwhen In>zbcall SetUnitPositionLoc(gv[In],GetRandomLocInRect(Qr))call SetUnitFacing(gv[In],90)call PanCameraToTimedLocForPlayer(qe[In],GetRectCenter(Yr),0)call SelectUnitForPlayerSingle(gv[In],qe[In])set x=GetUnitX(gv[In])set y=-3325.call SetUnitPosition(Wo[In],x,y)call SetUnitFacing(Wo[In],90)call PauseUnit(Wo[In],true)set In=In+1endloopcall PC()if b thencall EnableTrigger(zO)call SetPlayerFlagBJ(PLAYER_STATE_GIVES_BOUNTY,false,Player($B))set Nx=CreateUnitAtLoc(Player($B),ae,GetRectCenter(sr),270)call SetHeroLevel(Nx,$FA,false)call SetUnitManaPercentBJ(Nx,'d')call SetUnitUserData(Nx,2)call PauseUnit(Nx,true)elsecall EnableTrigger(YO)set Bx=CreateUnitAtLoc(Player($B),Hv[hv],GetRectCenter(sr),270)call SetUnitUserData(Bx,2)call PauseUnit(Bx,true)call TriggerRegisterUnitEvent(mO,Bx,EVENT_UNIT_DAMAGED)if hv==5 thencall HM()endifcall EnableTrigger(JA)endifcall SaveBoolean(wx,1,StringHash("pr2"),true)call RemoveSharMoln()call TimerStart(t,2,false,function pM)call TimerStart(t2,3,false,function PM)call TimerStart(t3,4,false,function qM)call TimerStart(t4,5,false,function QM)call SaveBoolean(wx,1,Gb,b)call TimerStart(t5,6,false,function sM)set t=nullset t2=nullset t3=nullset t4=nullset t5=nullendfunctionfunction TM takes nothing returns nothinglocal unit u=GetEnteringUnit()local location l=GetRectCenter(Pr)call SetUnitPositionLoc(u,l)call RemoveLocation(l)set u=nullset l=nullendfunctionfunction wM takes nothing returns nothinglocal timer tt=GetExpiredTimer()local integer LD=GetHandleId(tt)local integer In=LoadInteger(wx,1,LD)if In>19 thenset Zo=truecall FlushChildHashtable(wx,LD)call DestroyTimer(tt)elsecall Ed(jv[In])call SaveInteger(wx,1,LD,In+1)endifset tt=nullendfunctionfunction WM takes nothing returns nothinglocal timer t=GetExpiredTimer()local timer tt=CreateTimer()local integer LD=GetHandleId(tt)call SaveInteger(wx,1,LD,5)call TimerStart(tt,2,true,function wM)call DestroyTimer(t)set t=nullset tt=nullendfunctionfunction yM takes nothing returns nothinglocal timer t=CreateTimer()call DisableTrigger(SO)call EnableTrigger(TO)call Vd()call TimerStart(t,1.2,false,function WM)set t=nullendfunctionfunction zM takes nothing returns nothinglocal timer tt=GetExpiredTimer()local integer LD=GetHandleId(tt)local integer In=LoadInteger(wx,1,LD)if In>$A thenset Zo=truecall FlushChildHashtable(wx,LD)call DestroyTimer(tt)elsecall Ed('n01X')call SaveInteger(wx,1,LD,In+1)endifset tt=nullendfunctionfunction ZM takes nothing returns nothinglocal timer t=GetExpiredTimer()local timer tt=CreateTimer()local integer LD=GetHandleId(tt)call SaveInteger(wx,1,LD,1)call TimerStart(tt,1.25,true,function zM)call DestroyTimer(t)set t=nullset tt=nullendfunctionfunction vp takes nothing returns nothinglocal timer t=CreateTimer()call DisableTrigger(tO)call EnableTrigger(TO)set Zo=falsecall Vd()call TimerStart(t,1.2,false,function ZM)set t=nullendfunctionfunction op takes nothing returns nothinglocal unit f=GetDyingUnit()local location L=Location(GetRandomReal(GetRectMinX(Ci),GetRectMaxX(Ci)),GetRandomReal(GetRectMinY(Ci),GetRectMaxY(Ci)))if IsUnitInGroup(f,zo)thencall GroupRemoveUnit(zo,f)endifif CountUnitsInGroup(zo)<1 and Zo thencall DisableTrigger(TO)call SetUnitPositionLoc(Nx,L)call RemoveLocation(L)call ShowUnit(Nx,true)call SetUnitInvulnerable(Nx,false)call PauseUnit(Nx,false)call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\AnimateDead\\AnimateDeadTarget.mdl",Nx,"origin"))endifset f=nullset L=nullendfunctionfunction ip takes nothing returns nothinglocal group g=CreateGroup()local integer i=1local integer LC=0local integer rlocal unit array gglocal unit ulocal location Tlocal unit flocal player plocal boolean bcall GroupEnumUnitsOfPlayer(g,Player($B),null)loopexitwhen i>8set p=GetOwningPlayer(gv[i])set b=(GetPlayerSlotState(p)==PLAYER_SLOT_STATE_PLAYING)if To[i]and b thenset LC=LC+1set gg[LC]=gv[i]endifset i=i+1endloopif LC==0 thenreturnendifset r=GetRandomInt(1,LC)set u=gg[r]set T=GetUnitLoc(u)loopset f=FirstOfGroup(g)exitwhen f==nullcall IssuePointOrderByIdLoc(f,$D000F,T)call GroupRemoveUnit(g,f)endloopcall RemoveLocation(T)call DestroyGroup(g)set i=1loopexitwhen gg[i]==nullset gg[i]=nullset i=i+1endloopset u=nullset T=nullset g=nullset p=nullendfunctionfunction np takes nothing returns booleanreturn(tv==false)endfunctionfunction Vp takes nothing returns booleanreturn(GetOwningPlayer(GetLeavingUnit())==GetFilterPlayer())endfunctionfunction Ep takes nothing returns nothingcall RemoveUnit(GetLeavingUnit())call DisplayTextToForce(gN(Condition(function Vp)),"Вaш юнит нe дoлжeн нaхoдитьcя в дaннoй oблacти.")endfunctionfunction Op takes nothing returns nothinglocal integer nC=0local integer Rp=qvlocal unit ulocal integer qc=hvlocal integer In=1local real Ip=GetRectMaxX(Jr)local real Ap=GetRectMaxY(Jr)local real Np=GetRectMaxX(kr)local real bp=GetRectMaxY(kr)local real Bp=GetRectMinX(Jr)local real cp=GetRectMinY(Jr)local real Cp=GetRectMinX(kr)local real dp=GetRectMinY(kr)set kA=CreateUnit(Player($B),'h011',0,0,0)if Rp==1 thenset nC=18endifif Rp==2 thenset nC=27endifif Rp==3 thenset nC=35endifif Rp==4 thenset nC=40endifif Rp==5 thenset nC=45endifif Rp==6 thenset nC=50endifif Rp==7 thenset nC=55endifif Rp==8 thenset nC=62endifset Do=nCset u=CreateUnit(Player($B),jv[qc],GetRandomReal(Cp,Np),GetRandomReal(dp,bp),270)call SetUnitUserData(u,1)if qc==9 thencall af(u)endifset In=1loopexitwhen In>nCcall CreateUnit(Player($B),Hv[qc],GetRandomReal(Cp,Np),GetRandomReal(dp,bp),270)call CreateUnit(Player($B),Hv[qc],GetRandomReal(Bp,Ip),GetRandomReal(cp,Ap),0)set In=In+1endloopset u=CreateUnit(Player($B),jv[qc],GetRandomReal(Bp,Ip),GetRandomReal(cp,Ap),0)call SetUnitUserData(u,1)if qc==9 thencall af(u)endifcall EnableTrigger(yO)call TriggerExecute(WO)call EnableTrigger(WO)set u=nullendfunctionfunction fp takes nothing returns nothinglocal unit u=GetEnumUnit()call IssuePointOrderByIdLoc(u,$D000F,kx)set u=nullendfunctionfunction Fp takes nothing returns nothinglocal integer L=1local unit array glocal integer i=0local integer rlocal player gp=Player($B)local group gr=CreateGroup()local boolean b1local boolean b2local player Gplocal integer rClocal player plocal unit fcall GroupEnumUnitsOfPlayer(gr,gp,null)loopexitwhen L>8set f=gv[L]set b1=To[L]set b2=(IsUnitInGroup(f,rr)==false)if b1 and f!=null and b2 thenset i=i+1set g[i]=fendifset L=L+1endloopif i==0 thenelseif Jx==false thenset Jx=trueset r=GetRandomInt(1,i)set Lx=g[r]elseset Gp=GetOwningPlayer(Lx)set rC=me[GetPlayerId(Gp)+1]set b1=To[rC]set b2=(IsUnitInGroup(Lx,rr)==false)if b1==false or b2==false or Lx==null thenset r=GetRandomInt(1,i)set Lx=g[r]endifendifcall RemoveLocation(kx)set kx=GetUnitLoc(Lx)call ForGroup(gr,function fp)endifcall DestroyGroup(gr)set L=1set gr=nullset p=nullset Gp=nullloopexitwhen(L>i)set g[L]=nullset L=L+1endloopset gp=nullendfunctionfunction Hp takes nothing returns booleanreturn GetOwningPlayer(GetFilterUnit())==Player($B)and GetWidgetLife(GetFilterUnit())>.405endfunctionfunction jp takes nothing returns nothinglocal boolexpr b=Condition(function Hp)local timer t=CreateTimer()set bj_wantDestroyGroup=trueif CountUnitsInGroup(ON(jr,b))==0 and tv==false thenset ce=falsecall DisableTrigger(yO)call DisableTrigger(WO)if uo thencall DisableTrigger(lO)elsecall DisableTrigger(LO)endifset Jx=falsecall rd()call jD()set He=truecall TimerStart(t,6.25,false,function WB)endifset b=nullset t=nullendfunctionfunction kp takes nothing returns booleanreturn GetUnitUserData(GetDyingUnit())==2 and GetOwningPlayer(GetDyingUnit())==Player($B)and GetDyingUnit()!=Nx and tv==falseendfunctionfunction Kp takes nothing returns nothinglocal timer t=CreateTimer()local integer In=1local integer zb=fvcall DisableTrigger(YO)call DisableTrigger(JA)set Pv=falsecall DisableTrigger(uO)call DisableTrigger(sO)call DisableTrigger(pO)loopexitwhen In>zbcall AdjustPlayerStateBJ(40*hv,qe[In],PLAYER_STATE_RESOURCE_GOLD)call AdjustPlayerStateBJ(5,qe[In],PLAYER_STATE_RESOURCE_LUMBER)set In=In+1endloopcall YD(GetOwningPlayer(GetKillingUnit()))call rd()call jD()set He=truecall TimerStart(t,6.25,false,function WB)set t=nullendfunctionfunction Lp takes nothing returns booleanreturn GetDyingUnit()==Nxendfunctionfunction Mp takes nothing returns nothingcall DisableTrigger(zO)set Pv=falsecall DisableTrigger(pO)call DisableTrigger(uO)call DisableTrigger(sO)call DisableTrigger(lO)call lC()endfunctionfunction qp takes nothing returns nothinglocal timer t=GetExpiredTimer()call TransmissionFromUnitTypeWithNameBJ(bj_FORCE_ALL_PLAYERS,Player(11),'O006',"Орн",Location(464.0,-2496.0),null,"Вы погубили всех моих зверюшек.Теперь я лично займусь вами, гладиаторы!",1,8.,false)call DestroyTimer(t)set t=nullendfunctionfunction Qp takes nothing returns nothinglocal timer t=GetExpiredTimer()call TransmissionFromUnitTypeWithNameBJ(bj_FORCE_ALL_PLAYERS,Player($B),'O006',"Орн",Location(464.0,-2496.0),null,"Я удивлён, что вы продержались так долго. Пожалуй, стоит вам усложнить испытание.",1,8.,false)call DestroyTimer(t)set t=nullendfunctionfunction Sp takes nothing returns nothinglocal string ddlocal integer qc=hvif qc==16 thenset dd="|cfffefe22ВНИМАНИЕ:|r с этого раунда во время сражения герои будут терять по 50 единиц здоровья в секунду!|R"endifif qc==17 thenset dd="|cfffefe22ВНИМАНИЕ:|r с этого раунда во время сражения герои будут терять по 30 единиц здоровья в секунду!|R"endifif qc==18 thenset dd="|cfffefe22ВНИМАНИЕ:|r с этого раунда во время сражения герои будут терять по 100 единиц здоровья в секунду!|R"endifif qc==19 thenset dd="|cfffefe22ВНИМАНИЕ:|r с этого раунда каждый раз за использование заклинаний или предметов герои будут получать по 300 урона!|R"endifcall DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,10,dd)call DestroyTimer(GetExpiredTimer())set dd=nullendfunctionfunction tp takes nothing returns nothinglocal integer In=0local integer qc=hvlocal string ddlocal timer tlocal timer ttlocal boolean b=uoloopexitwhen In>7call DisplayTimedTextToPlayer(Player(In),0,0,$E,"|cffffcc00Волна - "+I2S(hv)+": "+bx[hv]+"|R")set In=In+1endloopif qc==1 thenif b thenset dd="|cffffcc00Заклинания врагов: Удар по земле [250 ед. урона и замедление на 8 сек.]|R"elseset dd="|cffffcc00Заклинания врагов: Удар по земле [150 ед. урона и замедление на 4 сек.]|R"endifendifif qc==2 thenif b thenset dd="|cffffcc00Заклинания врагов: Аура возмездия [35% урона возвращается]; Громовая поступь [100 урона, оглушает на 2 секунды].|R"elseset dd="|cffffcc00Заклинания врагов: Аура возмездия [20% урона возвращается].|R"endifendifif qc==3 thenif b thenset dd="|cffffcc00Заклинания врагов: Змеиная ловкость [25% шанс уклониться от атаки]; Омоложение [1000 ед. в течении 6 сек.]|R"elseset dd="|cffffcc00Заклинания врагов: Змеиная ловкость [25% шанс уклониться от атаки]; Омоложение [600 ед. в течении 6 сек.]|R"endifendifif qc==4 thenif b thenset dd="|cffffcc00Заклинания врагов: Лик смерти [500 ед. урона]; Ловчий [ловит в сетку героев на 4 сек., не-героев на 15 сек.]|R"elseset dd="|cffffcc00Заклинания врагов: Лик смерти [500 ед. урона].|R"endifendifif qc==5 thenset dd="|cffffcc00Заклинания Мегабосса: Огненный дождь [200 ед. урона каждый камень]; Громовая поступь [300 ед. урона + 4 сек. оглушения]; Сильный удар [16% шанс оглушить на 2 сек.]; Смертельный удар [32% шанс нанести двойной урон]; Ясновидение.|R"endifif qc==6 thenset dd="|cffffcc00Заклинания врагов: Жар Преисподней [40 ед. урона в сек.]; Проклятие [40% шанс, что герой промахнется]; Увечье [Снижение урона на 30% + скорости боя и перемещения на 60%]; Магическая защита [снижение урона от магии на 25%].|R"endifif qc==7 thenif b thenset dd="|cffffcc00Заклинания врагов: Ядовитое облако [35 ед. урона в сек.]; Леденящий крик [снижение урона на 75%].|R"elseset dd="|cffffcc00Заклинания врагов: Ядовитое облако [35 ед. урона в сек.]; Леденящий крик [снижение урона на 50%].|R"endifendifif qc==8 thenset dd="|cffffcc00Заклинания врагов: Невосприимчивость к магии; Молот бурь [400 ед. урона + 3 сек. оглушения.]; Вампиризм [75%]; Демоническая сила [50%].|R"endifif qc==9 thenif b thenset dd="|cffffcc00Заклинания врагов: Божественный щит [15 сек.]; Ледяная звезда [400 ед. урона цели и столько же окружающим юнитам.]; Сон [усыпляет героев на 4 сек., не-героев на 10 сек.]|R"elseset dd="|cffffcc00Заклинания врагов: Божественный щит [15 сек.]; Ледяная звезда [400 ед. урона цели и столько же окружающим юнитам.]|R"endifendifif qc==$A thenset dd="|cffffcc00Заклинания Мегабосса: Омоложение [2000 ед. в течении 8 сек.]; Ярость проклятых [100% скорости]; Замедление [75% скорости перемещения + 50% скорости боя]; Огненный голем; Ясновидение.|R"endifif qc==$B thenif b thenset dd="|cffffcc00Заклинания врагов: Полная невидимость; Сожжение маны [50 маны за удар].|R"elseset dd="|cffffcc00Заклинания врагов: Полная невидимость.|R"endifendifif qc==$C thenif b thenset dd="|cffffcc00Заклинания врагов: Громовая поступь [250 ед. урона + 2 сек. оглушения]; Гнев деревьев [200 ед. в сек в течение 5 сек.]; Кровожадность [+180% скорости атаки]; Сильный удар [30% шанс оглушить на 2 сек. и нанести 250 ед. урона.]|R"elseset dd="|cffffcc00Заклинания врагов: Громовая поступь [250 ед. урона + 2 сек. оглушения]; Гнев деревьев [90 ед. в сек в течение 5 сек.]; Кровожадность [+90% скорости атаки]; Сильный удар [30% шанс оглушить на 2 сек. и нанести 250 ед. урона.]|R"endifendifif qc==$D thenif b thenset dd="|cffffcc00Заклинания врагов: Невосприимчивость к магии; Бросить камень [100 ед. урона + 2 сек. оглушения]; Боевой дух [60%].|R"elseset dd="|cffffcc00Заклинания врагов: Невосприимчивость к магии; Бросить камень [100 ед. урона + 2 сек. оглушения]; Боевой дух [40%].|R"endifendifif qc==$E thenset dd="|cffffcc00Заклинания врагов: Молот бурь [750 ед. урона + 4 сек. оглушения]; Отравленный нож [100 в течение 5 сек.]|R"endifif qc==$F thenset dd="|cffffcc00Заклинания Мегабосса: Иллюзии [3 иллюзии урон наносят 100%, получают 100% урона]; Сожжение маны [200 ед. за удар]; Изгнание в астрал [8 сек.]; Безмолвие [Предотвращены все виды атак и заклинания]: Ясновидение.|R"endifif qc==16 thenif b thenset dd="|cffffcc00Заклинания боссов: магический огонь [400 ед.]; Замедление [75% скорости перемещения и 75% скорости боя].Заклинания крипов: магический огонь [400 ед.]|R"elseset dd="|cffffcc00Заклинания боссов: магический огонь [250 ед.]; Замедление [50% скорости перемещения и 25% скорости боя].Заклинания крипов: магический огонь [250 ед.]|R"endifendifif qc==17 thenif b thenset dd="|cffffcc00Заклинания боссов: змеиная ловкость [100% уклона].Заклинания крипов: Очищение [снимает все эффекты и понижает скорость перемещения на 10 сек.]|R"elseset dd="|cffffcc00Заклинания боссов: змеиная ловкость [90% уклона].Заклинания крипов: Очищение [снимает все эффекты и понижает скорость перемещения на 5 сек.]|R"endifendifif qc==18 thenif b thenset dd="|cffffcc00Заклинания боссов: сильный удар [100% вероятность оглушить на 1 сек.]Заклинания крипов: безмолвие [на 7 сек. запрещает использовать скиллы.]|R"elseset dd="|cffffcc00Заклинания боссов: сильный удар [100% вероятность оглушить на 0.5 сек.]Заклинания крипов: безмолвие [на 4 сек. запрещает использовать скиллы.]|R"endifendifif qc==19 thenif b thenset dd="|cffffcc00Заклинания боссов: полиморф [8 сек.]Заклинания крипов: волшебный огонь [-60 ед. защиты].|R"elseset dd="|cffffcc00Заклинания боссов: полиморф [6 сек.]Заклинания крипов: волшебный огонь [-30 ед. защиты].|R"endifendifset In=0loopexitwhen In>7call DisplayTimedTextToPlayer(Player(In),0,0,$F,dd)set In=In+1endloopif qc==20 thenset t=CreateTimer()call TimerStart(t,3,false,function qp)endifif qc==16 thenset t=CreateTimer()call TimerStart(t,6,false,function Qp)endifset tt=CreateTimer()call TimerStart(tt,8,false,function Sp)set dd=nullset t=nullset tt=nullendfunctionfunction up takes nothing returns booleanif IsUnitType(GetFilterUnit(),UNIT_TYPE_HERO)thencall UnitDamageTarget(kA,GetFilterUnit(),50,false,false,null,DAMAGE_TYPE_UNIVERSAL,null)endifreturn falseendfunctionfunction Up takes nothing returns nothinglocal group g=CreateGroup()call GroupEnumUnitsInRect(g,bj_mapInitialPlayableArea,Condition(function up))call DestroyGroup(g)if ce==false thencall DisableTrigger(GetTriggeringTrigger())endifset g=nullendfunctionfunction Wp takes nothing returns booleanif IsUnitType(GetFilterUnit(),UNIT_TYPE_HERO)thencall SetUnitState(GetFilterUnit(),UNIT_STATE_MANA,GetUnitState(GetFilterUnit(),UNIT_STATE_MANA)-30.)endifreturn falseendfunctionfunction yp takes nothing returns nothinglocal group g=CreateGroup()call GroupEnumUnitsInRect(g,bj_mapInitialPlayableArea,Condition(function Wp))call DestroyGroup(g)if ce==false thencall DisableTrigger(GetTriggeringTrigger())endifset g=nullendfunctionfunction zp takes nothing returns booleanreturn(GetOwningPlayer(GetDyingUnit())==Player($B))endfunctionfunction Zp takes nothing returns nothingcall SetWidgetLife(GetKillingUnit(),(GetUnitStateSwap(UNIT_STATE_LIFE,GetKillingUnit())-100.))call TriggerSleepAction(2)if((ce==false))thencall DisableTrigger(GetTriggeringTrigger())endifendfunctionfunction eP takes nothing returns booleanreturn GetOwningPlayer(GetSpellAbilityUnit())!=Player($B)endfunctionfunction xP takes nothing returns nothinglocal unit u=GetSpellAbilityUnit()if jb(u)thencall UnitDamageTarget(kA,u,300,false,false,null,DAMAGE_TYPE_UNIVERSAL,null)call TriggerSleepAction(2)if ce==false thencall DisableTrigger(oR)endifendifset u=nullendfunctionfunction rP takes nothing returns booleanreturn((GetUnitTypeId(GetDyingUnit())!='E00E' and GetUnitTypeId(GetDyingUnit())!='E00J' and IsUnitIllusion(GetDyingUnit())==false and IsUnitType(GetDyingUnit(),UNIT_TYPE_HERO)and GetUnitUserData(GetDyingUnit())!=$B and GetUnitUserData(GetDyingUnit())!=$C)!=null)!=nullendfunctionfunction iP takes nothing returns nothingcall PauseUnit(GetEnumUnit(),false)endfunctionfunction aP takes nothing returns booleanreturn GetUnitTypeId(GetEnumUnit())=='h00P'endfunctionfunction nP takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer Gb=GetHandleId(t)local integer n=LoadInteger(wx,1,Gb)local integer i1=LoadInteger(wx,2,Gb)local integer i2=LoadInteger(wx,3,Gb)local integer In=1local integer zb=fvlocal location L=Location(GetRectCenterX(Yr),GetRectCenterY(Yr))local string ddloopexitwhen In>zbif(GetLocalPlayer()==GetOwningPlayer(gv[In]))thencall PanCameraToTimed(GetLocationX(L),GetLocationY(L),0)endifset In=In+1endloopcall RemoveLocation(L)if(bj_cineFadeContinueTimer!=null)thencall DestroyTimer(bj_cineFadeContinueTimer)endifif(bj_cineFadeFinishTimer!=null)thencall DestroyTimer(bj_cineFadeFinishTimer)endifcall EnableUserUI(false)call SetCineFilterTexture("ReplaceableTextures\\CameraMasks\\White_mask.blp")call SetCineFilterBlendMode(BLEND_MODE_BLEND)call SetCineFilterTexMapFlags(TEXMAP_FLAG_NONE)call SetCineFilterStartUV(0,0,1,1)call SetCineFilterEndUV(0,0,1,1)call SetCineFilterStartColor(0,0,0,$FF)call SetCineFilterEndColor(0,0,0,0)call SetCineFilterDuration(1)call DisplayCineFilter(true)set bj_cineFadeFinishTimer=CreateTimer()call TimerStart(bj_cineFadeFinishTimer,1,false,function FinishCinematicFadeBJ)set In=0if n==1 thenset dd="|cffffcc00Вторая Дуэль|R"elseif n==2 thenset dd="|cffffcc00Третья Дуэль|R"elseset dd="|cffffcc00Четвертая Дуэль|R"endifendifloopexitwhen In>7call DisplayTextToPlayer(Player(In),0,0,dd)set In=In+1endloopcall ShowUnit(gv[xo[i1]],true)call ShowUnit(gv[xo[i2]],true)set We=falseset oo=oo+1set ao[1]=gv[xo[i1]]set ao[2]=gv[xo[i2]]call YC(ao[1],ao[2])call DestroyTimer(t)set t=nullset dd=nullset L=nullendfunctionfunction VP takes nothing returns nothinglocal timer t=GetExpiredTimer()call EnableTrigger(wR)call DestroyTimer(t)set t=nullendfunctionfunction EP takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer i=1call rd()loopexitwhen i>8call UnitResetCooldown(gv[i])set i=i+1endloopcall DestroyTimer(t)set t=nullendfunctionfunction XP takes nothing returns nothinglocal texttag tt=LoadTextTagHandle(eA,GetHandleId(Er),$C)call DestroyTimer(GetExpiredTimer())set ZI=vAcall SetTextTagText(tt,I2S(R2I(ZI)),.0276)set tt=nullendfunctionfunction OP takes nothing returns nothing	local integer i	local integer In=1	local integer jc	local integer zb=fv	local integer i1=0	local integer i2=0	local boolean RP=false	local boolean bb=We	local unit array u	local unit uD	local unit IP	local unit d=GetDyingUnit()	local integer AP	local player pD	local player pW	local group g	local integer n=oo	local integer LC=0	local timer t=CreateTimer()	local timer t2=CreateTimer()	local integer array DC	local group NP=CreateGroup()	local unit f	local location L	local integer Gb	local timer bP	loop		exitwhen In>zb		if gv[In]!=null and GetPlayerSlotState(GetOwningPlayer(gv[In]))!=PLAYER_SLOT_STATE_LEFT then			set LC=LC+1		endif		set In=In+1	endloop	set u[1]=ao[1]	set u[2]=ao[2]	set DC[1]=GetUnitUserData(u[1])	set DC[2]=GetUnitUserData(u[2])	if d==null then		if bb then			set IP=u[1]			set uD=u[2]		else			if To[DC[1]]==false then				set IP=u[2]				set uD=u[1]			else				set IP=u[1]				set uD=u[2]			endif		endif	else		if u[1]!=d and u[2]!=d then			return		endif		if d==u[1]then			set AP=2		else			set AP=1		endif		if To[DC[AP]]==false then			set uD=u[1]			set IP=u[2]			set RP=true		else			set uD=d			set IP=u[AP]		endif	endif	set pD=GetOwningPlayer(uD)	set pW=GetOwningPlayer(IP)	call DisableTrigger(rR)	call DisableTrigger(wR)	set L=Location(GetRandomReal(GetRectMinX(qr),GetRectMaxX(qr)),GetRandomReal(GetRectMinY(qr),GetRectMaxY(qr)))	call SetUnitPositionLoc(uD,L)	call RemoveLocation(L)	set L=Location(GetRandomReal(GetRectMinX(qr),GetRectMaxX(qr)),GetRandomReal(GetRectMinY(qr),GetRectMaxY(qr)))	call SetUnitPositionLoc(IP,L)	call RemoveLocation(L)	call SetWidgetLife(IP,GetUnitState(IP,UNIT_STATE_MAX_LIFE))	call UnitRemoveBuffs(uD,false,true)	call UnitRemoveBuffs(IP,false,true)	call TimerStart(t,.1,false,function VP)	call SuspendHeroXP(uD,false)	call SuspendHeroXP(IP,false)	call SetPlayerAlliance(GetOwningPlayer(u[1]),GetOwningPlayer(u[2]),ALLIANCE_PASSIVE,true)	call SetPlayerAlliance(GetOwningPlayer(u[1]),GetOwningPlayer(u[2]),ALLIANCE_HELP_REQUEST,true)	call SetPlayerAlliance(GetOwningPlayer(u[1]),GetOwningPlayer(u[2]),ALLIANCE_HELP_RESPONSE,true)	call SetPlayerAlliance(GetOwningPlayer(u[1]),GetOwningPlayer(u[2]),ALLIANCE_SHARED_XP,true)	call SetPlayerAlliance(GetOwningPlayer(u[1]),GetOwningPlayer(u[2]),ALLIANCE_SHARED_SPELLS,true)	call SetPlayerAlliance(GetOwningPlayer(u[1]),GetOwningPlayer(u[2]),ALLIANCE_SHARED_VISION,true)	call SetPlayerAlliance(GetOwningPlayer(u[1]),GetOwningPlayer(u[2]),ALLIANCE_SHARED_CONTROL,false)	call SetPlayerAlliance(GetOwningPlayer(u[1]),GetOwningPlayer(u[2]),ALLIANCE_SHARED_ADVANCED_CONTROL,false)	call SetPlayerAlliance(GetOwningPlayer(u[2]),GetOwningPlayer(u[1]),ALLIANCE_PASSIVE,true)	call SetPlayerAlliance(GetOwningPlayer(u[2]),GetOwningPlayer(u[1]),ALLIANCE_HELP_REQUEST,true)	call SetPlayerAlliance(GetOwningPlayer(u[2]),GetOwningPlayer(u[1]),ALLIANCE_HELP_RESPONSE,true)	call SetPlayerAlliance(GetOwningPlayer(u[2]),GetOwningPlayer(u[1]),ALLIANCE_SHARED_XP,true)	call SetPlayerAlliance(GetOwningPlayer(u[2]),GetOwningPlayer(u[1]),ALLIANCE_SHARED_SPELLS,true)	call SetPlayerAlliance(GetOwningPlayer(u[2]),GetOwningPlayer(u[1]),ALLIANCE_SHARED_VISION,true)	call SetPlayerAlliance(GetOwningPlayer(u[2]),GetOwningPlayer(u[1]),ALLIANCE_SHARED_CONTROL,false)	call SetPlayerAlliance(GetOwningPlayer(u[2]),GetOwningPlayer(u[1]),ALLIANCE_SHARED_ADVANCED_CONTROL,false)	if RP==false then		set i=0		if bb==false then			loop				exitwhen i>7				call DisplayTextToPlayer(Player(i),0,0,"|Cffff0000Победитель   -   "+GetPlayerName(pW)+"|R")				set i=i+1			endloop			call SetPlayerState(pW,PLAYER_STATE_RESOURCE_GOLD,GetPlayerState(pW,PLAYER_STATE_RESOURCE_GOLD)+300-50*n)			call SetPlayerState(pW,PLAYER_STATE_RESOURCE_LUMBER,GetPlayerState(pW,PLAYER_STATE_RESOURCE_LUMBER)+$A-n)		else			loop				exitwhen i>7				call DisplayTextToPlayer(Player(i),0,0,"|cfffefe22ВНИМАНИЕ:|r Игроки не получат вознаграждения, т.к. состоялась ничья!")				set i=i+1			endloop		endif	endif	if LC>=4 and n==1 then		set i1=Lc()		set i2=Lc()	else		if LC>=6 and n==2 then			set i1=Lc()			set i2=Lc()		else			if LC==8 and n==3 then				set i1=Lc()				set i2=Lc()			endif		endif	endif	call DestroyTimer(fo)	call DestroyTimerDialog(Fo)	call Ec(Eo)	call GroupEnumUnitsInRect(NP,bj_mapInitialPlayableArea,Condition(function aP))	loop		set f=FirstOfGroup(NP)		exitwhen f==null		if IsUnitType(f,UNIT_TYPE_HERO)==false then			call KillUnit(f)			call RemoveUnit(f)		endif		call GroupRemoveUnit(NP,f)	endloop	call DestroyGroup(NP)	if i2!=0 then		call ShowUnit(IP,false)		if(bj_cineFadeContinueTimer!=null)then			call DestroyTimer(bj_cineFadeContinueTimer)		endif		if(bj_cineFadeFinishTimer!=null)then			call DestroyTimer(bj_cineFadeFinishTimer)		endif		call EnableUserUI(false)		call SetCineFilterTexture("ReplaceableTextures\\CameraMasks\\Black_mask.blp")		call SetCineFilterBlendMode(BLEND_MODE_BLEND)		call SetCineFilterTexMapFlags(TEXMAP_FLAG_NONE)		call SetCineFilterStartUV(0,0,1,1)		call SetCineFilterEndUV(0,0,1,1)		call SetCineFilterStartColor(0,0,0,0)		call SetCineFilterEndColor(0,0,0,$FF)		call SetCineFilterDuration(1)		call DisplayCineFilter(true)		set t=null		set t=CreateTimer()		set Gb=GetHandleId(t)		call SaveInteger(wx,1,Gb,n)		call SaveInteger(wx,2,Gb,i1)		call SaveInteger(wx,3,Gb,i2)		call TimerStart(t,1,false,function nP)		set t=null	else		call ForceClear(io)		set In=1		set bP=CreateTimer()		call TimerStart(bP,.5,false,function EP)		set bP=null		loop			exitwhen In>zb			set L=Location(GetRandomReal(GetRectMinX(qr),GetRectMaxX(qr)),GetRandomReal(GetRectMinY(qr),GetRectMaxY(qr)))			call SetUnitPositionLoc(gv[In],L)			call RemoveLocation(L)			call eC(gv[In])			set In=In+1		endloop		set In=1		loop			exitwhen In>zb			call ShowUnit(gv[In],true)			set In=In+1		endloop		set g=CreateGroup()		call GroupEnumUnitsInRect(g,bj_mapInitialPlayableArea,null)		call ForGroup(g,function iP)		call DestroyGroup(g)		call DisableTrigger(iR)		call jD()		set In=0		loop			exitwhen In>zb-1			set jc=0			loop				exitwhen jc>zb-1				if In != jc and GetPlayerSlotState(Player(In)) != PLAYER_SLOT_STATE_LEFT and  GetPlayerSlotState(Player(jc))!=PLAYER_SLOT_STATE_LEFT then					call SetPlayerAlliance(Player(In),Player(jc),ALLIANCE_PASSIVE,true)					call SetPlayerAlliance(Player(In),Player(jc),ALLIANCE_HELP_REQUEST,true)					call SetPlayerAlliance(Player(In),Player(jc),ALLIANCE_HELP_RESPONSE,true)					call SetPlayerAlliance(Player(In),Player(jc),ALLIANCE_SHARED_XP,true)					call SetPlayerAlliance(Player(In),Player(jc),ALLIANCE_SHARED_SPELLS,true)					call SetPlayerAlliance(Player(In),Player(jc),ALLIANCE_SHARED_VISION,true)					call SetPlayerAlliance(Player(In),Player(jc),ALLIANCE_SHARED_CONTROL,false)					call SetPlayerAlliance(Player(In),Player(jc),ALLIANCE_SHARED_ADVANCED_CONTROL,false)					call SetPlayerAlliance(Player(jc),Player(In),ALLIANCE_PASSIVE,true)					call SetPlayerAlliance(Player(jc),Player(In),ALLIANCE_HELP_REQUEST,true)					call SetPlayerAlliance(Player(jc),Player(In),ALLIANCE_HELP_RESPONSE,true)					call SetPlayerAlliance(Player(jc),Player(In),ALLIANCE_SHARED_XP,true)					call SetPlayerAlliance(Player(jc),Player(In),ALLIANCE_SHARED_SPELLS,true)					call SetPlayerAlliance(Player(jc),Player(In),ALLIANCE_SHARED_VISION,true)					call SetPlayerAlliance(Player(jc),Player(In),ALLIANCE_SHARED_CONTROL,false)					call SetPlayerAlliance(Player(jc),Player(In),ALLIANCE_SHARED_ADVANCED_CONTROL,false)				endif				set jc=jc+1			endloop			set In=In+1		endloop		set We=false		set Ve=false		set He=true		call TimerStart(t2,6.25,false,function WB)	endif	set g=null	set NP=null	set f=null	set uD=null	set IP=null	set pD=null	set pW=null	set u[1]=null	set u[2]=null	set t=null	set t2=null	set d=null	set L=null	call TimerStart(CreateTimer(),.5,false,function XP)endfunctionfunction cP takes nothing returns booleanreturn((IsUnitType(GetLeavingUnit(),UNIT_TYPE_HERO)==false and jb(GetLeavingUnit()))!=null)!=nullendfunctionfunction CP takes nothing returns nothingcall KillUnit(GetLeavingUnit())endfunctionfunction DP takes nothing returns nothing//	set Jv = CreateMultiboard()//	call MultiboardSetTitleText(Jv, "Статистика")//	call MultiboardSetColumnCount(Jv, 9)//	call MultiboardSetRowCount(Jv, fv + 4)	call CreateMultiboardBJ(9,(fv+4),"Cтaтиcтикa")	set Jv=bj_lastCreatedMultiboard	call MultiboardSetItemValueBJ(Jv,0,0,I2S(0))	call MultiboardSetItemValueBJ(Jv,7,0,("0.0%"))	call MultiboardSetItemValueBJ(Jv,1,1,"")	call MultiboardSetItemValueBJ(Jv,2,1,"")	call MultiboardSetItemColorBJ(Jv,0,2,'d',60.,40.,10.)	call MultiboardSetItemWidthBJ(Jv,1,0,3.)	call MultiboardSetItemWidthBJ(Jv,2,0,1.5)	call MultiboardSetItemWidthBJ(Jv,3,0,10.)	set bj_forLoopAIndex=1	set bj_forLoopAIndexEnd=fv	loop		exitwhen bj_forLoopAIndex>bj_forLoopAIndexEnd		call MultiboardSetItemValueBJ(Jv,3,(bj_forLoopAIndex+1),GetPlayerName(Player(-1+(Fv[bj_forLoopAIndex]))))		set bj_forLoopAIndex=bj_forLoopAIndex+1	endloop	set bj_forLoopAIndex=4	set bj_forLoopAIndexEnd=9	loop		exitwhen bj_forLoopAIndex>bj_forLoopAIndexEnd		call MultiboardSetItemWidthBJ(Jv,bj_forLoopAIndex,0,5.5)		set bj_forLoopAIndex=bj_forLoopAIndex+1	endloop	call MultiboardSetItemValueBJ(Jv,3,1,"Убитo:")	call MultiboardSetItemValueBJ(Jv,4,1,"кpипoв")	call MultiboardSetItemValueBJ(Jv,5,1,"бoccoв")	call MultiboardSetItemValueBJ(Jv,6,1,"Уpoвeнь")	call MultiboardSetItemValueBJ(Jv,7,1,"Улyчшeния")	call MultiboardSetItemValueBJ(Jv,8,1,"Cмepтeй")	call MultiboardSetItemValueBJ(Jv,9,1,"Peйтинг")	call MultiboardSetItemWidthBJ(Jv,7,0,7.5)	call MultiboardSetItemWidthBJ(Jv,9,0,7.5)	set bj_forLoopAIndex=1	set bj_forLoopAIndexEnd=(fv+2)	loop		exitwhen bj_forLoopAIndex>bj_forLoopAIndexEnd		call MultiboardSetItemValueBJ(Jv,1,(bj_forLoopAIndex+1),I2S(bj_forLoopAIndex))		set bj_forLoopAIndex=bj_forLoopAIndex+1	endloop	call MultiboardSetItemValueBJ(Jv,0,(fv+3),"")	call MultiboardSetItemValueBJ(Jv,0,(fv+2),"")	call MultiboardSetItemValueBJ(Jv,0,(fv+4),"")	call MultiboardSetItemValueBJ(Jv,3,(fv+2),"|cffffcc00Вoлнa:")	call MultiboardSetItemValueBJ(Jv,4,(fv+2),("|cffffcc00"+("1"+(" [ "+(bx[1]+" ]")))))	call MultiboardSetItemValueBJ(Jv,3,(fv+3),"|cffffcc00Вpeмя игpы:")	call MultiboardSetItemValueBJ(Jv,3,(fv+4),"|Cffff0000Мoд: |R")	call MultiboardSetItemWidthBJ(Jv,4,(fv+2),25.)	call MultiboardSetItemWidthBJ(Jv,4,(fv+4),25.)	call MultiboardSetItemStyleBJ(Jv,0,0,true,false)	set bj_forLoopAIndex=1	set bj_forLoopAIndexEnd=fv	loop		exitwhen bj_forLoopAIndex>bj_forLoopAIndexEnd		call MultiboardSetItemStyleBJ(Jv,2,(bj_forLoopAIndex+1),false,true)		call MultiboardSetItemIconBJ(Jv,2,(bj_forLoopAIndex+1),"ReplaceableTextures\\WorldEditUI\\Editor-Random-Unit.blp")		set bj_forLoopAIndex=bj_forLoopAIndex+1	endloop	call MultiboardDisplay(Jv,true)endfunctionfunction FP takes nothing returns nothinglocal unit u=GetLevelingUnit()local integer DC=GetUnitUserData(u)set Ue[DC]=GetHeroLevel(u)//if g_flag_b or g_flag_tk then//call pc()//endifif Sx thencall TriggerExecute(RR)endifset u=nullendfunctionfunction GP takes nothing returns nothinglocal unit u=GetDyingUnit()local unit Ng=GetKillingUnit()local player p=GetOwningPlayer(Ng)local integer DC=me[GetPlayerId(p)+1]if GetOwningPlayer(u)==Player($B)and GetUnitUserData(u)==0 and Ng!=null thenset Kv[DC]=Kv[DC]+1//if g_flag_b or g_flag_tk then//call pc()//endifif Sx thencall TriggerExecute(RR)endifendifset u=nullset Ng=nullset p=nullendfunctionfunction jP takes nothing returns nothinglocal unit u=GetDyingUnit()local unit Ng=GetKillingUnit()local player p=GetOwningPlayer(Ng)local integer DC=me[GetPlayerId(p)+1]if GetOwningPlayer(u)==Player($B)and GetUnitUserData(u)==1 and Ng!=null thencall DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,7.,rA[GetPlayerId(p)]+GetPlayerName(p)+"|r   у б и л    б о с с а!!!")set lv[DC]=lv[DC]+1//if g_flag_b or g_flag_tk then//call pc()//endifif Sx thencall TriggerExecute(RR)endifendifset u=nullset Ng=nullset p=nullendfunctionfunction kP takes nothing returns nothing	local integer id=GetResearched()	if id=='R007' then		return	endif	set Oe=me[(1+GetPlayerId(GetOwningPlayer(GetResearchingUnit())))]	set Ee[Oe]=(Ee[Oe]+1)//if g_flag_b or g_flag_tk then//call pc()//endif	if Sx then		call TriggerExecute(RR)	endifendfunctionfunction lP takes nothing returns nothing	set mv=mv+1	if mv==60 then		set mv=0		set Mv=Mv+1	endif	if mv<$A then		call MultiboardSetItemValueBJ(Jv,4,(fv+3),(I2S(Mv)+(":"+("0"+I2S(mv)))))	else		call MultiboardSetItemValueBJ(Jv,4,(fv+3),(I2S(Mv)+(":"+I2S(mv))))	endifendfunctionfunction mP takes nothing returns nothing	local integer R=0	local boolean array MP	local integer pP=fv	local integer PP=1	local integer jc	local integer qP	local integer zb	local integer QP=number_of_heroes+1	set MP[0]=false	loop		exitwhen PP>pP		set Re=100.*(I2R(Ee[PP])/I2R(Xe))		set kv[PP]=Kv[PP]*2+Ue[PP]*30+lv[PP]*20+R2I(Re)*7-Lv[PP]*$F-30		set MP[PP]=false		set PP=PP+1	endloop	set jc=1	loop		exitwhen jc>pP		set zb=-$3E8		set MP[R]=true		set PP=1		loop			exitwhen PP>pP			if((zb<kv[PP])and(MP[PP]==false))then				set zb=kv[PP]				set Re=(100.*(I2R(Ee[PP])/I2R(Xe)))				set qP=1				loop					exitwhen qP>QP					if(ie[PP]==qP-1)then						call MultiboardSetItemIconBJ(Jv,2,(jc+1),g_hero_icons[qP])					endif					set qP=qP+1				endloop				call MultiboardSetItemValueBJ(Jv,3,(jc+1),Ke[PP])				call MultiboardSetItemValueBJ(Jv,4,(jc+1),I2S(Kv[PP]))				call MultiboardSetItemValueBJ(Jv,5,(jc+1),I2S(lv[PP]))				call MultiboardSetItemValueBJ(Jv,6,(jc+1),I2S(Ue[PP]))				call MultiboardSetItemValueBJ(Jv,7,(jc+1),(R2SW(Re,0,1)+"%"))				call MultiboardSetItemValueBJ(Jv,8,(jc+1),I2S(Lv[PP]))				call MultiboardSetItemValueBJ(Jv,9,(jc+1),I2S(kv[PP]))				set xo[jc]=PP				set R=PP			endif			set PP=PP+1		endloop		set jc=jc+1	endloopendfunctionfunction tP takes nothing returns nothing	local player p=GetTriggerPlayer()	if Ze[(1+GetPlayerId(p))]==false then		set pv=pv+1		set Ze[(1+GetPlayerId(p))]=true		call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,("|cff808070"+(GetPlayerName(GetTriggerPlayer())+(" хочет немедленно начать раунд! ("+(I2S(pv)+("\\"+(I2S(qv)+")|R")))))))		if pv>=qv then			call DestroyTimer(ir)			if Sx then				call DisableTrigger(CommandLineReady)				call bD()			endif//			if g_flag_b or g_flag_tk then//				call DisableTrigger(CommandLineReady)//				call tc()//			endif		endif	endif	set p=nullendfunctionfunction uP takes nothing returns nothinglocal timer t=GetExpiredTimer()call tc()call DestroyTimer(t)set t=nullendfunctionfunction UP takes nothing returns nothinglocal timer t=GetExpiredTimer()call EnableTrigger(CommandLineReady)call EnableTrigger(VR)call DestroyTimer(t)set t=nullendfunctionfunction wP takes nothing returns nothinglocal integer qc=hvlocal integer zb=fvlocal integer Bc=qvlocal integer bc=$Flocal timerdialog WPlocal integer Cclocal integer Inlocal real wlocal timer t=CreateTimer()local timer tLlocal timer JD=CreateTimer()call Pc()call Vc()call DisableTrigger(VR)if qc==$A then//call TriggerExecute(pI)returnendifset In=1loopexitwhen In>zbset Ze[In]=falsecall DestroyTimerDialog(Be[In])call DestroyTimer(be[In])call AdjustPlayerStateBJ(6+qc,qe[In],PLAYER_STATE_RESOURCE_LUMBER)if GetPlayerSlotState(qe[In])==PLAYER_SLOT_STATE_PLAYING thencall ReviveHeroLoc(gv[In],GetUnitLoc(gv[In]),false)if GetWidgetLife(gv[In])<=.405 thencall DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\Resurrect\\ResurrectCaster.mdl",gv[In],"origin"))endifendifset In=In+1endloopcall Ac()call PauseTaverns(false)call PauseShops(false)if qv>1 and ne==false and ModuloInteger(qc,3)==0 and qc!=0 thenset ne=truecall TriggerExecute(cR)elseset ne=falseset hv=hv+1set qc=qc+1if qc==2 thencall DisableTrigger(CommandLineRepick)endifset Cc=Nc(qc,bc,Bc)set In=1loopexitwhen In>zbcall AdjustPlayerStateBJ(Cc,qe[In],PLAYER_STATE_RESOURCE_GOLD)set In=In+1endloopcall MultiboardSetItemValueBJ(Jv,4,zb+4,"|cffffcc00"+I2S(qc))call SetForceAllianceStateBJ(fe,Fe,3)call SetForceAllianceStateBJ(Fe,fe,3)set He=truecall TimerStart(JD,6.25,false,function WB)call TimerStart(t,2,false,function UP)if qc==1 thenset w=90elseset w=60endifcall Gc()set tL=CreateTimer()set Gv=tLcall TimerStart(tL,w,false,function uP)set ue=CreateTimerDialog(tL)call TimerDialogDisplay(ue,true)call TimerDialogSetTitle(ue,"Осталось")call DestroyTimer(ir)set ir=nullset ir=CreateTimer()call TimerStart(ir,w-3,false,function Kb)endifset WP=nullset t=nullset JD=nullset tL=nullendfunctionfunction YP takes nothing returns nothinglocal timer t=GetExpiredTimer()call TriggerExecute(JR)call DestroyTimer(t)set t=nullendfunctionfunction zP takes nothing returns nothinglocal integer In=1local integer zb=fvlocal unit flocal timer t=CreateTimer()local timer JD=CreateTimer()local group g=CreateGroup()local location lset ce=truecall TimerStart(t,.6,false,function YP)call PauseTaverns(true)loopexitwhen In>zbset l=GetUnitLoc(gv[In])call ReviveHeroLoc(gv[In],l,false)call RemoveLocation(l)if IsPlayerInForce(qe[In],fe)thencall SetUnitPositionLoc(gv[In],GetRandomLocInRect(oi))elsecall SetUnitPositionLoc(gv[In],GetRandomLocInRect(xi))endifcall UnitRemoveBuffsBJ(2,gv[In])call SelectUnitForPlayerSingle(gv[In],qe[In])call PanCameraToTimedLocForPlayer(qe[In],GetUnitLoc(gv[In]),0)call DestroyEffect(AddSpecialEffectLoc("Abilities\\Spells\\NightElf\\Blink\\BlinkTarget.mdl",GetUnitLoc(gv[In])))set In=In+1endloopset g=IN(Hr)loopset f=FirstOfGroup(g)exitwhen f==nullif GetUnitTypeId(f)!='n002' and IsUnitType(f,UNIT_TYPE_HERO)==false and GetOwningPlayer(f)!=Player($F)thencall KillUnit(f)call RemoveUnit(f)endifcall GroupRemoveUnit(g,f)endloopcall DestroyGroup(g)set He=truecall TimerStart(JD,6.25,false,function WB)set f=nullset g=nullset t=nullset JD=nullset l=nullendfunctionfunction vq takes nothing returns nothinglocal timer t=GetExpiredTimer()set He=falsecall DestroyTimer(t)set t=nullendfunctionfunction eq takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer Gb=GetHandleId(t)local timer tt=CreateTimer()local timerdialog d=LoadTimerDialogHandle(wx,1,Gb)local integer In=1local integer zb=fvset ce=falsecall DisableTrigger(jR)call DisableTrigger(kR)call EnableTrigger(BR)loopexitwhen In>zbcall TimerDialogDisplayForPlayerBJ(false,Be[In],qe[In])set In=In+1endloopcall SetForceAllianceStateBJ(fe,Fe,3)call SetForceAllianceStateBJ(Fe,fe,3)set In=1loopexitwhen In>zbcall UnitRemoveBuffsBJ(1,gv[In])call SetUnitPositionLocFacingBJ(gv[In],GetRandomLocInRect(qr),270)call SelectUnitForPlayerSingle(gv[In],qe[In])call PanCameraToTimedLocForPlayer(GetOwningPlayer(gv[In]),GetUnitLoc(gv[In]),0)set In=In+1endloopcall TriggerExecute(AR)set He=truecall TimerStart(tt,6.25,false,function vq)call DestroyTimer(t)call DestroyTimerDialog(d)set t=nullset tt=nullset d=nullendfunctionfunction xq takes nothing returns nothinglocal timer t=CreateTimer()local integer Gb=GetHandleId(t)local timerdialog dcall TimerStart(t,$B4,false,function eq)set d=CreateTimerDialog(t)call SaveTimerDialogHandle(wx,1,Gb,d)call TimerDialogDisplay(d,true)call TimerDialogSetTitle(d,"Раунд")set t=nullset d=nullendfunctionfunction rq takes nothing returns booleanreturn GetOwningPlayer(GetEnteringUnit())==Player($B)endfunctionfunction iq takes nothing returns nothinglocal unit u=GetEnteringUnit()call KillUnit(u)call RemoveUnit(u)set u=nullendfunctionfunction nq takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer Gb=GetHandleId(t)local timerdialog d=LoadTimerDialogHandle(wx,1,Gb)call DestroyTimerDialog(d)call DestroyTimer(t)call TriggerExecute(CR)set Gv=nullset ue=nullset t=nullset d=nullendfunctionfunction Vq takes nothing returns nothinglocal timer t=CreateTimer()local integer Gb=GetHandleId(t)local timerdialog dlocal integer i=0call DisableTrigger(CommandLineReady)loopexitwhen i>7call DisplayTextToPlayer(Player(i),0,0,"|cff706638Следующий раунд - Командная дуэль")set i=i+1endloopcall MultiboardSetItemValueBJ(Jv,4,Ae+Ne+4,"|cffffcc00Дуэль")call DestroyTimer(Gv)call DestroyTimerDialog(ue)call TimerStart(t,30,false,function nq)set d=CreateTimerDialog(t)call SaveTimerDialogHandle(wx,1,Gb,d)call TimerDialogSetTitle(d,"Осталось")call TimerDialogDisplay(d,true)call DestroyTimer(ir)set ir=nullset ir=CreateTimer()call TimerStart(ir,27,false,function Kb)set t=nullset d=nullendfunctionfunction Xq takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer i=0loopexitwhen i>7call DisplayTextToPlayer(Player(i),0,0,"3...")set i=i+1endloopcall DestroyTimer(t)set t=nullendfunctionfunction Oq takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer i=0loopexitwhen i>7call DisplayTextToPlayer(Player(i),0,0,"2...")set i=i+1endloopcall DestroyTimer(t)set t=nullendfunctionfunction Rq takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer i=0loopexitwhen i>7call DisplayTextToPlayer(Player(i),0,0,"1...")set i=i+1endloopcall DestroyTimer(t)set t=nullendfunctionfunction Iq takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer In=1local integer xc=fvlocal group g=CreateGroup()local integer n=0local integer n2=0local unit fcall SaveBoolean(wx,1,StringHash("pr"),false)loopexitwhen In>xccall PauseUnit(gv[In],false)set In=In+1endloopcall GroupEnumUnitsInRect(g,Pr,null)loopset f=FirstOfGroup(g)exitwhen f==nullif(IsPlayerInForce(GetOwningPlayer(f),fe)and IsUnitType(f,UNIT_TYPE_HERO)and(To[GetUnitUserData(f)]or GetWidgetLife(f)>.405))thenset n=n+1endifcall GroupRemoveUnit(g,f)endloopcall GroupEnumUnitsInRect(g,Pr,null)loopset f=FirstOfGroup(g)exitwhen f==nullif(IsPlayerInForce(GetOwningPlayer(f),Fe)and IsUnitType(f,UNIT_TYPE_HERO)and(To[GetUnitUserData(f)]or GetWidgetLife(f)>.405))thenset n2=n2+1endifcall GroupRemoveUnit(g,f)endloopcall DestroyGroup(g)if n==0 or n2==0 thencall TriggerExecute(dR)returnendifset Ho=nset jo=n2call TriggerExecute(DR)call EnableTrigger(dR)call DestroyTimer(t)set t=nullset g=nullset f=nullendfunctionfunction Aq takes nothing returns nothinglocal integer In=1local integer xc=Aelocal group g=CreateGroup()local timer t=CreateTimer()local timer t2=CreateTimer()local timer t3=CreateTimer()local timer t4=CreateTimer()local location Lcall PauseShops(true)call SetForceAllianceStateBJ(Fe,fe,0)call SetForceAllianceStateBJ(fe,Fe,0)set Ve=trueset pv=0loopexitwhen In>xcif To[In]or GetWidgetLife(gv[In])>.405 thenset L=Location(GetRandomReal(GetRectMinX(Qr),GetRectMaxX(Qr)),GetRandomReal(GetRectMinY(Qr),GetRectMaxY(Qr)))call SetUnitPositionLoc(gv[In],L)call SetUnitFacing(gv[In],90.)call RemoveLocation(L)elseset L=Location(GetRandomReal(GetRectMinX(Qr),GetRectMaxX(Qr)),GetRandomReal(GetRectMinY(Qr),GetRectMaxY(Qr)))call ReviveHeroLoc(gv[In],L,false)call SetUnitFacingTimed(gv[In],90.,0)call RemoveLocation(L)endifset In=In+1endloopset In=Ae+1set xc=fvloopexitwhen In>xcif To[In]or GetWidgetLife(gv[In])>.405 thenset L=Location(GetRandomReal(GetRectMinX(Bi),GetRectMaxX(Bi)),GetRandomReal(GetRectMinY(Bi),GetRectMaxY(Bi)))call SetUnitPositionLoc(gv[In],L)call SetUnitFacing(gv[In],270.)call RemoveLocation(L)elseset L=Location(GetRandomReal(GetRectMinX(Bi),GetRectMaxX(Bi)),GetRandomReal(GetRectMinY(Bi),GetRectMaxY(Bi)))call ReviveHeroLoc(gv[In],L,false)call SetUnitFacingTimed(gv[In],270.,0)endifset In=In+1endloopset In=1set xc=fvloopexitwhen In>xcset L=Location(GetRectCenterX(Yr),GetRectCenterY(Yr))if GetLocalPlayer()==GetOwningPlayer(gv[In])thencall PanCameraToTimed(GetLocationX(L),GetLocationY(L),0)endifcall RemoveLocation(L)call UnitResetCooldown(gv[In])call SetUnitState(gv[In],UNIT_STATE_LIFE,GetUnitState(gv[In],UNIT_STATE_MAX_LIFE))call SetUnitState(gv[In],UNIT_STATE_MANA,GetUnitState(gv[In],UNIT_STATE_MAX_MANA))if GetLocalPlayer()==GetOwningPlayer(gv[In])thencall ClearSelection()call SelectUnit(gv[In],true)endifset In=In+1endloopcall PC()set In=0loopexitwhen In>7call DisplayTextToPlayer(Player(In),0,0,"|cffffcc00Победители получат 200 золотых монет и 15 дерева.|r")set In=In+1endloopcall SaveBoolean(wx,1,StringHash("pr"),true)set In=0loopexitwhen In>7call DisplayTextToPlayer(Player(In),0,0,"4...")set In=In+1endloopcall TimerStart(t,1,false,function Xq)call TimerStart(t2,2,false,function Oq)call TimerStart(t3,3,false,function Rq)call TimerStart(t4,4,false,function Iq)set t=nullset t2=nullset t3=nullset t4=nullset g=nullset L=nullendfunctionfunction bq takes nothing returns booleanreturn((IsUnitType(GetDyingUnit(),UNIT_TYPE_HERO)and GetUnitUserData(GetDyingUnit())!=$B and GetUnitUserData(GetDyingUnit())!=$C)!=null)!=nullendfunctionfunction Bq takes nothing returns nothingcall PauseUnit(GetEnumUnit(),false)endfunctionfunction cq takes nothing returns nothinglocal group g=CreateGroup()local unit u=GetDyingUnit()local player pl=GetOwningPlayer(u)local integer plocal integer zblocal integer t=jolocal integer s=Holocal timer JDlocal unit fif IsPlayerInForce(pl,fe)thenset s=s-1elseset t=t-1endifif t==0 or s==0 thencall DestroyTimerDialog(Fo)call DestroyTimer(fo)set Fo=nullset fo=nullcall DisableTrigger(dR)set t=1set zb=fvcall DisableTrigger(wR)loopexitwhen t>zbcall UnitRemoveBuffsBJ(1,gv[t])call UnitResetCooldown(gv[t])call SetUnitPositionLoc(gv[t],GetRandomLocInRect(qr))set t=t+1endloopcall EnableTrigger(wR)if s==0 thencall DisplayTextToForce(bj_FORCE_ALL_PLAYERS,("|cffffcc00Победитель   -   Клан Тьмы"))set p=Ae+1elsecall DisplayTextToForce(bj_FORCE_ALL_PLAYERS,("|cffffcc00Победитель   -   Клан Света"))set p=1set zb=Aeendifset t=ploopexitwhen t>zbcall AdjustPlayerStateBJ($C8,GetOwningPlayer(gv[t]),PLAYER_STATE_RESOURCE_GOLD)call AdjustPlayerStateBJ($F,GetOwningPlayer(gv[t]),PLAYER_STATE_RESOURCE_LUMBER)set t=t+1endloopset g=IN(bj_mapInitialPlayableArea)call ForGroup(g,function Bq)call GroupClear(g)call PanCameraToTimed(GetLocationX(GetRectCenter(qr)),GetLocationY(GetRectCenter(qr)),0)call TriggerExecute(AR)set g=IN(Pr)loopset f=FirstOfGroup(g)exitwhen f==nullif IsUnitType(f,UNIT_TYPE_HERO)!=true thencall KillUnit(f)call RemoveUnit(f)endifcall GroupRemoveUnit(g,f)endloopcall DestroyGroup(g)set Ve=falseset He=truecall TimerStart(JD,6.25,false,function WB)elseset jo=tset Ho=sendifset g=nullset f=nullset u=nullset pl=nullset JD=nullendfunctionfunction dq takes nothing returns nothinglocal timer t=GetExpiredTimer()call DestroyTimerDialog(Fo)call DestroyTimer(t)call TriggerExecute(fR)set Fo=nullset fo=nullset t=nullendfunctionfunction Dq takes nothing returns nothinglocal real w=150.local integer qc=hvset fo=CreateTimer()call TimerStart(fo,w,false,function dq)set Fo=CreateTimerDialog(fo)call TimerDialogSetTitle(Fo,"Дуэль")call TimerDialogDisplay(Fo,true)endfunctionfunction Fq takes nothing returns nothingcall PauseUnit(GetEnumUnit(),false)endfunctionfunction gq takes nothing returns booleanreturn((IsUnitType(GetFilterUnit(),UNIT_TYPE_HERO)==false)!=null)!=nullendfunctionfunction Gq takes nothing returns nothingcall KillUnit(GetEnumUnit())call RemoveUnit(GetEnumUnit())endfunctionfunction hq takes nothing returns nothinglocal timer t=GetExpiredTimer()set He=falsecall DestroyTimer(t)set t=nullendfunctionfunction Hq takes nothing returns nothinglocal integer In=1local integer zb=fvlocal group g=CreateGroup()local timer t=CreateTimer()call DisableTrigger(dR)loopexitwhen In>zbcall PanCameraToTimedLocForPlayer(GetOwningPlayer(gv[In]),GetRectCenter(qr),0)call UnitRemoveBuffsBJ(1,gv[In])call UnitResetCooldown(gv[In])call SetUnitPositionLoc(gv[In],GetRandomLocInRect(qr))set In=In+1endloopcall DisplayTextToForce(bj_FORCE_ALL_PLAYERS,"|cfffefe22ВНИМАНИЕ:|r Состоялась ничья, никто не получит вознаграждения.")set g=IN(bj_mapInitialPlayableArea)call ForGroup(g,function Fq)call ConditionalTriggerExecute(AR)set g=ON(Pr,Condition(function gq))call ForGroup(g,function Gq)call DestroyGroup(g)set Ve=falseset He=truecall TimerStart(t,6.25,false,function hq)set g=nullset t=nullendfunction//function Kq takes nothing returns nothing//local integer R=0//local boolean array MP//local integer pP=Ae//local integer PP=1//local integer jc//local integer qP//local integer zb//local integer QP=number_of_heroes+1//set MP[0]=false//loop//exitwhen PP>pP//set Re=100.*(I2R(Ee[PP])/I2R(Xe))//set kv[PP]=(Ue[PP]-1)*30+lv[PP]*20+R2I(Re)*7-Lv[PP]*$F+Ce[PP]*25//set MP[PP]=false//set PP=PP+1//endloop//set jc=1//loop//exitwhen jc>pP//set zb=-$3E8//set MP[R]=true//set PP=1//loop//exitwhen PP>pP//if zb<kv[PP]and MP[PP]==false then//set zb=kv[PP]//set Re=(100.*(I2R(Ee[PP])/I2R(Xe)))//set qP=1//loop//exitwhen qP>QP//if ie[PP]==qP-1 then//call MultiboardSetItemIconBJ(Jv,2,jc+2,g_hero_icons[qP])//endif//set qP=qP+1//endloop//call MultiboardSetItemValueBJ(Jv,3,(jc+2),Ke[PP])//call MultiboardSetItemValueBJ(Jv,4,(jc+2),I2S(Kv[PP]))//call MultiboardSetItemValueBJ(Jv,5,(jc+2),I2S(lv[PP]))//call MultiboardSetItemValueBJ(Jv,6,(jc+2),I2S(Ce[PP]))//call MultiboardSetItemValueBJ(Jv,7,(jc+2),I2S(Ue[PP]))//call MultiboardSetItemValueBJ(Jv,8,(jc+2),(R2SW(Re,0,1)+"%"))//call MultiboardSetItemValueBJ(Jv,9,(jc+2),I2S(Lv[PP]))//call MultiboardSetItemValueBJ(Jv,$A,(jc+2),I2S(kv[PP]))//set R=PP//endif//set PP=PP+1//endloop//set jc=jc+1//endloop//endfunction//function Lq takes nothing returns nothing//local integer R=0//local boolean array MP//local integer pP=Ne//local integer mq=Ae//local integer PP=1//local integer jc//local integer qP//local integer zb//local integer QP=number_of_heroes+1//set MP[0]=false//loop//exitwhen PP>pP//set Re=100.*(I2R(Ee[PP+mq])/I2R(Xe))//set kv[PP+mq]=(Ue[PP+mq]-1)*30+lv[PP+mq]*20+R2I(Re)*7-Lv[PP+mq]*$F+Ce[PP+mq]*25//set MP[PP]=false//set PP=PP+1//endloop//set jc=1//loop//exitwhen jc>pP//set zb=-$3E8//set MP[R]=true//set PP=1//loop//exitwhen PP>pP//if zb<kv[PP+mq]and MP[PP]==false then//set zb=kv[PP+mq]//set Re=(100.*(I2R(Ee[PP+mq])/I2R(Xe)))//set qP=1//loop//exitwhen qP>QP//if ie[PP+mq]==qP-1 then//call MultiboardSetItemIconBJ(Jv,2,jc+mq+3,g_hero_icons[qP])//endif//set qP=qP+1//endloop//call MultiboardSetItemValueBJ(Jv,3,(jc+mq+3),Ke[PP+mq])//call MultiboardSetItemValueBJ(Jv,4,(jc+mq+3),I2S(Kv[PP+mq]))//call MultiboardSetItemValueBJ(Jv,5,(jc+mq+3),I2S(lv[PP+mq]))//call MultiboardSetItemValueBJ(Jv,6,(jc+mq+3),I2S(Ce[PP+mq]))//call MultiboardSetItemValueBJ(Jv,7,(jc+mq+3),I2S(Ue[PP+mq]))//call MultiboardSetItemValueBJ(Jv,8,(jc+mq+3),(R2SW(Re,0,1)+"%"))//call MultiboardSetItemValueBJ(Jv,9,(jc+mq+3),I2S(Lv[PP+mq]))//call MultiboardSetItemValueBJ(Jv,$A,(jc+mq+3),I2S(kv[PP+mq]))//set R=PP//endif//set PP=PP+1//endloop//set jc=jc+1//endloop//endfunction//function pq takes nothing returns nothing//	local integer Pq=Ae//	local integer In=1//	local integer Qq//	local integer sq=0//	local integer Sq=0//	local integer tq=0//	local integer Tq=0//	set de=0//	set De=0//	loop//		exitwhen In>Pq//		set de=de+kv[In]//		set sq=sq+Kv[In]//		set Sq=Sq+lv[In]//		set tq=tq+Ce[In]//		set Tq=Tq+Lv[In]//		set In=In+1//	endloop//	call MultiboardSetItemValueBJ(Jv,10,2,I2S(de))//	call MultiboardSetItemValueBJ(Jv,9,2,I2S(Tq))//	call MultiboardSetItemValueBJ(Jv,6,2,I2S(tq))//	call MultiboardSetItemValueBJ(Jv,5,2,I2S(Sq))//	call MultiboardSetItemValueBJ(Jv,4,2,I2S(sq))//	set sq=0//	set Sq=0//	set tq=0//	set Tq=0//	set In=Pq+1//	set Qq=fv//	loop//		exitwhen In>Qq//		set De=De+kv[In]//		set sq=sq+Kv[In]//		set Sq=Sq+lv[In]//		set tq=tq+Ce[In]//		set Tq=Tq+Lv[In]//		set In=In+1//	endloop//	set In=3+Pq//	call MultiboardSetItemValueBJ(Jv,$A,In,I2S(De))//	call MultiboardSetItemValueBJ(Jv,9,In,I2S(Tq))//	call MultiboardSetItemValueBJ(Jv,6,In,I2S(tq))//	call MultiboardSetItemValueBJ(Jv,5,In,I2S(Sq))//	call MultiboardSetItemValueBJ(Jv,4,In,I2S(sq))//endfunctionfunction Uq takes nothing returns nothingcall CustomDefeatBJ(GetTriggerPlayer(),"")endfunctionfunction Wq takes nothing returns booleanreturn((GetUnitTypeId(GetDyingUnit())!='E00E' and GetUnitTypeId(GetDyingUnit())!='E00J' and IsUnitType(GetDyingUnit(),UNIT_TYPE_HERO)and IsUnitIllusion(GetDyingUnit())==false)!=null)!=nullendfunctionfunction yq takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer Gb=GetHandleId(t)local unit u=LoadUnitHandle(wx,1,Gb)local integer Yq=LoadInteger(wx,2,Gb)local player pd=GetOwningPlayer(u)local location lcall DestroyTimerDialog(Be[Yq])if ce and ge[GetPlayerId(pd)+1]==false thenif IsPlayerInForce(pd,fe)thenset l=GetRandomLocInRect(oi)call ReviveHeroLoc(u,l,false)call RemoveLocation(l)elseset l=GetRandomLocInRect(xi)call ReviveHeroLoc(u,l,false)call RemoveLocation(l)endifcall SetUnitManaPercentBJ(u,60.)set l=GetUnitLoc(u)call PanCameraToTimedLocForPlayer(pd,l,0)call RemoveLocation(l)call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\Resurrect\\ResurrectCaster.mdl",u,"origin"))endifcall DestroyTimer(t)set u=nullset pd=nullset l=nullset t=nullendfunction// б ткfunction zq takes nothing returns nothinglocal unit zD=GetKillingUnit()local unit Zq=GetDyingUnit()local player pk=GetOwningPlayer(zD)local player pd=GetOwningPlayer(Zq)local integer vQ=me[GetPlayerId(pk)+1]local integer eQ=me[GetPlayerId(pd)+1]local integer Yq=GetUnitUserData(Zq)local integer IDif zD!=null thenset Ce[vQ]=Ce[vQ]+1set Lv[eQ]=Lv[eQ]+1if pk==pd thencall DisplayTextToForce(bj_FORCE_ALL_PLAYERS,"|Cffff0000"+GetPlayerName(pk)+" совершил самоубийство ! ! !|R")elseif IsUnitAlly(zD,pd)thencall DisplayTextToForce(bj_FORCE_ALL_PLAYERS,"|Cffff0000"+GetPlayerName(pk)+"|R убил своего союзника |cff808070"+GetPlayerName(pd)+"|R")elseif pk==Player($B)thencall DisplayTextToForce(bj_FORCE_ALL_PLAYERS,"|Cffff0000"+GetPlayerName(pk)+"|R убили |cff808070"+GetPlayerName(pd)+"|R")elsecall DisplayTextToForce(bj_FORCE_ALL_PLAYERS,"|Cffff0000"+GetPlayerName(pk)+"|R убил |cff808070"+GetPlayerName(pd)+"|R")endifendifendifendif//call pc()set be[Yq]=CreateTimer()set ID=GetHandleId(be[Yq])call SaveUnitHandle(wx,1,ID,Zq)call SaveInteger(wx,2,ID,Yq)call TimerStart(be[Yq],$F,false,function yq)set Be[Yq]=CreateTimerDialog(be[Yq])call TimerDialogSetTitle(Be[Yq],"Воскрешение")if GetLocalPlayer()==pd thencall TimerDialogDisplay(Be[Yq],true)endifset zD=nullset Zq=nullset pk=nullset pd=nullendfunctionfunction oQ takes rect r returns locationreturn Location(GetRandomReal(GetRectMinX(r),GetRectMaxX(r)),GetRandomReal(GetRectMinY(r),GetRectMaxY(r)))endfunctionfunction rQ takes nothing returns nothinglocal unit flocal integer qc=hvlocal integer In=1local location lset l=oQ(ai)set f=CreateUnitAtLoc(Player($B),jv[qc],l,GetRandomReal(0,360))if qc==9 thencall af(f)endifcall RemoveLocation(l)call SetUnitUserData(f,1)call GroupAddUnit(Se[3],f)set l=oQ(Xi)set f=CreateUnitAtLoc(Player($B),jv[qc],l,GetRandomReal(0,360))if qc==9 thencall af(f)endifcall RemoveLocation(l)call SetUnitUserData(f,1)call GroupAddUnit(Se[7],f)set l=oQ(Oi)set f=CreateUnitAtLoc(Player($B),jv[qc],l,GetRandomReal(0,360))if qc==9 thencall af(f)endifcall RemoveLocation(l)call SetUnitUserData(f,1)call GroupAddUnit(Se[8],f)loopexitwhen In>4if In<=2 thenset l=oQ(ai)set f=CreateUnitAtLoc(Player($B),Hv[qc],l,GetRandomReal(0,360))call RemoveLocation(l)call GroupAddUnit(Se[3],f)set l=oQ(Xi)set f=CreateUnitAtLoc(Player($B),Hv[qc],l,GetRandomReal(0,360))call RemoveLocation(l)call GroupAddUnit(Se[7],f)set l=oQ(ii)set f=CreateUnitAtLoc(Player($B),Hv[qc],l,GetRandomReal(0,360))call RemoveLocation(l)call GroupAddUnit(Se[2],f)endifif In<=3 thenset l=oQ(ri)set f=CreateUnitAtLoc(Player($B),Hv[qc],l,GetRandomReal(0,360))call RemoveLocation(l)call GroupAddUnit(Se[1],f)set l=oQ(Vi)set f=CreateUnitAtLoc(Player($B),Hv[qc],l,GetRandomReal(0,360))call RemoveLocation(l)call GroupAddUnit(Se[5],f)set l=oQ(ni)set f=CreateUnitAtLoc(Player($B),Hv[qc],l,GetRandomReal(0,360))call RemoveLocation(l)call GroupAddUnit(Se[4],f)set l=oQ(Ei)set f=CreateUnitAtLoc(Player($B),Hv[qc],l,GetRandomReal(0,360))call RemoveLocation(l)call GroupAddUnit(Se[6],f)set l=oQ(Oi)set f=CreateUnitAtLoc(Player($B),Hv[qc],l,GetRandomReal(0,360))call RemoveLocation(l)call GroupAddUnit(Se[8],f)endifset l=oQ(Ri)set f=CreateUnitAtLoc(Player($B),Hv[qc],l,GetRandomReal(0,360))call RemoveLocation(l)call GroupAddUnit(Se[9],f)set In=In+1endloopset f=nullset l=nullendfunctionfunction aQ takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer Gb=GetHandleId(t)local integer k=LoadInteger(wx,1,Gb)local integer c=LoadInteger(wx,2,Gb)local integer id=LoadInteger(wx,3,Gb)local integer qc=LoadInteger(wx,4,Gb)local location llocal unit fif ce and qc==hv thenset l=GetRandomLocInRect(Te[k])set f=CreateUnitAtLoc(Player($B),id,l,GetRandomReal(0,360))if id=='n00V' thencall af(f)endifcall RemoveLocation(l)call SetUnitUserData(f,c)call GroupAddUnit(Se[k],f)endifcall DestroyTimer(t)set l=nullset f=nullset t=nullendfunctionfunction nQ takes nothing returns nothinglocal unit u1=GetDyingUnit()local unit u2=GetChangingUnit()local integer In=1local timer tlocal integer Gblocal integer DClocal integer idlocal integer ch=0local real ZFlocal unit ulocal integer qc=hvif u1!=null thenif GetOwningPlayer(u1)!=Player($B)thenreturnendifset u=u1elseif u2!=null thenset u=u2endifendifloopexitwhen In>9if IsUnitInGroup(u,Se[In])thenset ch=Incall GroupRemoveUnit(Se[In],u)endifset In=In+1endloopif ch==0 thenreturnendifset t=CreateTimer()set Gb=GetHandleId(t)set DC=GetUnitUserData(u)set id=GetUnitTypeId(u)if DC==0 thenset ZF=18elseset ZF=30endifcall SaveInteger(wx,1,Gb,ch)call SaveInteger(wx,2,Gb,DC)call SaveInteger(wx,3,Gb,id)call SaveInteger(wx,4,Gb,qc)call TimerStart(t,ZF,false,function aQ)set t=nullset u1=nullset u2=nullset u=nullendfunctionfunction EQ takes nothing returns booleanreturn GetItemTypeId(GetManipulatedItem())=='I01R'endfunctionfunction XQ takes nothing returns nothinglocal item it=GetManipulatedItem()local unit u=GetTriggerUnit()local player p=GetOwningPlayer(u)local integer i=0local integer MB=1loopexitwhen i>5if GetItemTypeId(UnitItemInSlot(u,i))=='I01R' and UnitItemInSlot(u,i)!=it thenset MB=MB+1endifset i=i+1endloopif MB>1 thencall DisplayTextToPlayer(p,0,0,"|cffff2400ОШИБКА:|r Нельзя носить больше одного Доспеха Бога.")call TriggerSleepAction(.01)call UnitRemoveItem(u,it)endifset it=nullset u=nullset p=nullendfunctionfunction OQ takes nothing returns nothinglocal integer i=0set KR=CreateTrigger()loopexitwhen i>7call TriggerRegisterPlayerUnitEvent(KR,Player(i),EVENT_PLAYER_UNIT_PICKUP_ITEM,null)set i=i+1endloopcall TriggerAddAction(KR,function XQ)call TriggerAddCondition(KR,Condition(function EQ))endfunctionfunction RQ takes unit WD,integer IQ returns booleanlocal integer pN=0local item AQloopset AQ=UnitItemInSlot(WD,pN)if(AQ!=null)and(GetItemTypeId(AQ)==IQ)thenset AQ=nullreturn trueendifset pN=pN+1exitwhen pN>=6endloopset AQ=nullreturn falseendfunctionfunction NQ takes nothing returns booleanreturn GetItemTypeId(GetManipulatedItem())=='I005' or GetItemTypeId(GetManipulatedItem())=='I01P'endfunctionfunction bQ takes nothing returns nothinglocal item it=GetManipulatedItem()local unit u=GetTriggerUnit()local boolean BQlocal boolean cQcall UnitRemoveAbility(u,'A07V')call UnitRemoveAbility(u,'A05R')call TriggerSleepAction(.01)set BQ=RQ(u,'I01P')set cQ=RQ(u,'I005')if BQ thencall UnitAddAbility(u,'A05R')call UnitMakeAbilityPermanent(u,true,'A05R')elseif cQ thencall UnitAddAbility(u,'A07V')call UnitMakeAbilityPermanent(u,true,'A07V')endifendifset it=nullset u=nullendfunctionfunction CQ takes nothing returns nothinglocal integer i=0set lR=CreateTrigger()loopexitwhen i>7call TriggerRegisterPlayerUnitEvent(lR,Player(i),EVENT_PLAYER_UNIT_PICKUP_ITEM,null)call TriggerRegisterPlayerUnitEvent(lR,Player(i),EVENT_PLAYER_UNIT_DROP_ITEM,null)set i=i+1endloopcall TriggerAddAction(lR,function bQ)call TriggerAddCondition(lR,Condition(function NQ))endfunctionfunction dQ takes nothing returns nothinglocal item it=GetManipulatedItem()local integer Id=GetItemTypeId(it)local unit u=GetTriggerUnit()local player pif(Id=='I06J' and UnitHasItemOfTypeBJ(u,'I013'))or(Id=='I013' and UnitHasItemOfTypeBJ(u,'I06J'))thencall TriggerSleepAction(.01)set p=GetOwningPlayer(u)call DisplayTextToPlayer(p,0,0,"|cffff2400ОШИБКА:|r Нельзя носить гипер-сапоги и сапоги-невидимки одновременно.")call UnitRemoveItem(u,it)endifset it=nullset u=nullset p=nullendfunctionfunction fQ takes nothing returns nothinglocal item it=GetManipulatedItem()local integer Id=GetItemTypeId(it)local unit u=GetTriggerUnit()local player plocal integer Aflocal integer Inif Id=='I029' or Id=='I076' thencall TriggerSleepAction(.01)set p=GetOwningPlayer(u)set Af=0set In=1loopexitwhen In>6if GetItemTypeId(UnitItemInSlot(u,In-1))=='I029' or GetItemTypeId(UnitItemInSlot(u,In-1))=='I076' thenset Af=Af+1if Af>=2 thencall DisplayTextToPlayer(p,0,0,"|cffff2400ОШИБКА:|r Можно носить либо только один рыцарский щит либо одну кирасу рыцаря!")call UnitRemoveItem(u,UnitItemInSlot(u,In-1))endifendifset In=In+1endloopendifset it=nullset u=nullset p=nullendfunctionfunction gQ takes nothing returns nothinglocal rect WN=bj_mapInitialPlayableArealocal real GQ=GetRectMaxX(WN)local real max_y=GetRectMaxY(WN)local real hQ=GetRectMinX(WN)local real HQ=GetRectMinY(WN)local real xl=GQ-hQlocal integer a=R2I(xl/256)+1local integer b=alocal integer c=1local integer d=1local real elocal real floopexitwhen c>bset e=c*256loopexitwhen d>bset KA=KA+1set f=d*256set lA[KA]=Rect(hQ+e-256-5.,HQ+f-256-5.,hQ+e+5.,HQ+f+5.)set d=d+1endloopset d=0set c=c+1endloopset WN=nullendfunctionfunction kQ takes nothing returns nothinglocal unit u=GetResearchingUnit()local integer DC=GetUnitUserData(u)local real y=GetUnitY(u)local real x=GetUnitX(u)local player p=GetOwningPlayer(u)local integer id=GetResearched()local unit Jblocal integer Hblocal integer array GBlocal integer Inlocal item array itif id=='R007' thenset wo[DC]=wo[DC]+1set Hb=wo[DC]set GB[1]='A0GR'set GB[2]='A0GS'set GB[3]='A0GT'set GB[4]='A0GU'set GB[5]='A0HC'if Hb==1 thenset Jb=CreateUnit(p,'n02X',x,y,0)call SetUnitUserData(Jb,DC)set Wo[DC]=Jbcall UnitAddAbility(Jb,GB[1])elseset Jb=Wo[DC]set In=0loopexitwhen In>Hbset it[In]=UnitRemoveItemFromSlot(Jb,In)set In=In+1endloopcall UnitRemoveAbility(Jb,GB[Hb-1])call UnitAddAbility(Jb,GB[Hb])set In=0loopexitwhen In>Hbcall UnitAddItem(Jb,it[In])set it[In]=nullset In=In+1endloopendifendifset u=nullset p=nullset Jb=nullendfunctionfunction lQ takes nothing returns booleanreturn jb(GetEnteringUnit())==falseendfunctionfunction LQ takes nothing returns nothinglocal unit u=GetEnteringUnit()local integer DC=GetUnitUserData(u)local unit XC=gv[DC]local real x=GetUnitX(XC)local real y=GetUnitY(XC)call SetUnitPosition(u,x,y)call IssueTargetOrderById(u,$D0003,XC)set XC=nullset u=nullendfunctionfunction MQ takes nothing returns booleanreturn GetSpellAbilityId()=='A0GV'endfunctionfunction pQ takes nothing returns nothinglocal unit u=GetSpellAbilityUnit()local integer DC=GetUnitUserData(u)local unit XC=gv[DC]local real x=GetUnitX(XC)local real y=GetUnitY(XC)call TriggerSleepAction(.1)call SetUnitPosition(u,x,y)call IssueTargetOrderById(u,$D0003,XC)set u=nullset XC=nullendfunctionfunction qQ takes nothing returns booleanreturn GetSpellAbilityId()=='A0GX'endfunctionfunction QQ takes nothing returns nothinglocal unit u=GetSpellAbilityUnit()local player p=GetOwningPlayer(u)local integer DC=GetUnitUserData(u)local integer Hb=wo[DC]local integer array idlocal integer LC=yo[DC]local integer Inlocal item array itlocal integer array GBlocal real IC=GetUnitFacing(u)local real y=GetUnitY(u)local real x=GetUnitX(u)set GB[1]='A0GR'set GB[2]='A0GS'set GB[3]='A0GT'set GB[4]='A0GU'set GB[5]='A0HC'set id[0]='n02X'set id[1]='n02Y'set id[2]='n02Z'set id[3]='e00O'set id[4]='e00P'set LC=LC+1if LC>4 thenset LC=0endifset yo[DC]=LCset In=0loopexitwhen In>Hbset it[In]=UnitRemoveItemFromSlot(u,In)set In=In+1endloopcall KillUnit(u)call RemoveUnit(u)set Wo[DC]=CreateUnit(p,id[LC],x,y,IC)set u=Wo[DC]call SetUnitUserData(u,DC)call UnitAddAbility(u,GB[Hb])if(GetLocalPlayer()==p)thencall SelectUnit(u,true)endifset In=0loopexitwhen In>Hbcall UnitAddItem(u,it[In])set In=In+1endloopset u=nullset p=nullset In=0loopexitwhen In>Hbset it[In]=nullset In=In+1endloopendfunctionfunction SQ takes nothing returns booleanreturn jb(GetManipulatingUnit())==falseendfunctionfunction tQ takes nothing returns nothinglocal unit u=GetManipulatingUnit()local item it=GetManipulatedItem()call lB(u,it)set u=nullset it=nullendfunctionfunction uQ takes nothing returns booleanreturn((GetSpellAbilityId()=='AItb' or GetSpellAbilityId()=='A05X' or GetSpellAbilityId()=='A0A0' or GetSpellAbilityId()=='A057' or GetSpellAbilityId()=='A0BZ')and(jb(GetSpellAbilityUnit())==false))endfunctionfunction UQ takes nothing returns nothinglocal unit u=GetSpellAbilityUnit()call IssueImmediateOrderById(u,$D0004)set u=nullendfunctionfunction WQ takes nothing returns nothingcall MD(GetHandleId(GetDyingUnit()))endfunctionfunction YQ takes nothing returns booleanreturn GetSpellAbilityId()=='A049'endfunctionfunction zQ takes nothing returns nothinglocal unit c=CreateUnit(GetOwningPlayer(GetSpellAbilityUnit()),'h00P',GetSpellTargetX(),GetSpellTargetY(),0)call UnitAddAbility(c,'A0GA')call UnitApplyTimedLife(c,'BTLF',$A)call IssuePointOrderById(c,$D01F9,GetSpellTargetX(),GetSpellTargetY())set c=nullendfunctionfunction xs takes nothing returns booleanreturn((jb(GetEnteringUnit())and IsUnitType(GetEnteringUnit(),UNIT_TYPE_STRUCTURE)==false and GetOwningPlayer(GetEnteringUnit())!=Player($B))!=null)!=nullendfunctionfunction os takes nothing returns nothing	local timer t=GetExpiredTimer()	local integer Gb=GetHandleId(t)	local unit u=LoadUnitHandle(wx,1,Gb)	local real x=GetUnitX(u)	local real y=GetUnitY(u)	local location L	if Pv or Ve then		if((GetRectMinX(jr)<=x)and(x<=GetRectMaxX(jr))and(GetRectMinY(jr)<=y)and(y<=GetRectMaxY(jr)))or((GetRectMinX(Hr)<=x)and(x<=GetRectMaxX(Hr))and(GetRectMinY(Hr)<=y)and(y<=GetRectMaxY(Hr)))then			set L=Location(GetRectCenterX(Pr),GetRectCenterY(Pr))			call SetUnitPositionLoc(u,L)			call RemoveLocation(L)		endif	else//		if((g_flag_b or g_flag_tk)and(ce==false))then//			if((GetRectMinX(jr)<=x)and(x<=GetRectMaxX(jr))and(GetRectMinY(jr)<=y)and(y<=GetRectMaxY(jr)))or((GetRectMinX(Pr)<=x)and(x<=GetRectMaxX(Pr))and(GetRectMinY(Pr)<=y)and(y<=GetRectMaxY(Pr)))then//				set L=Location(GetRectCenterX(qr),GetRectCenterY(qr))//				call SetUnitPositionLoc(u,L)//				call RemoveLocation(L)//			endif//		else			if ce then				if((GetRectMinX(Hr)<=x)and(x<=GetRectMaxX(Hr))and(GetRectMinY(Hr)<=y)and(y<=GetRectMaxY(Hr)))or((GetRectMinX(Pr)<=x)and(x<=GetRectMaxX(Pr))and(GetRectMinY(Pr)<=y)and(y<=GetRectMaxY(Pr)))then					set L=Location(GetRectCenterX(jr),GetRectCenterY(jr))					call SetUnitPositionLoc(u,L)					call RemoveLocation(L)				endif			endif//		endif	endif	call FlushChildHashtable(wx,Gb)	call DestroyTimer(t)	set t=null	set u=null	set L=nullendfunctionfunction is takes nothing returns nothinglocal unit u=GetEnteringUnit()local timer t=CreateTimer()local integer Gb=GetHandleId(t)call SaveUnitHandle(wx,1,Gb,u)call TimerStart(t,.0,false,function os)set u=nullset t=nullendfunctionfunction ns takes nothing returns booleanreturn GetSpellAbilityId()=='AIil'endfunctionfunction Vs takes nothing returns booleanif(IsUnitIllusion(GetFilterUnit()))and(GetUnitTypeId(GetFilterUnit())=='N02E')thencall AddUnitAnimationProperties(GetFilterUnit(),"Stand Alternate",false)endifreturn falseendfunctionfunction Es takes nothing returns nothinglocal group gif(GetUnitTypeId(GetSpellTargetUnit())=='N02E')thencall TriggerSleepAction(.01)set g=CreateGroup()call GroupEnumUnitsInRect(g,bj_mapInitialPlayableArea,Condition(function Vs))call DestroyGroup(g)endifset g=nullendfunctionfunction Os takes nothing returns booleanreturn GetOwningPlayer(GetFilterUnit())==Player($B)endfunctionfunction Rs takes nothing returns nothinglocal group g=CreateGroup()local destructable d=GetDyingDestructable()local location l=Location(GetDestructableX(d),GetDestructableY(d))local unit fcall GroupEnumUnitsInRangeOfLoc(g,l,500,Condition(function Os))call RemoveLocation(l)loopset f=FirstOfGroup(g)exitwhen f==nullcall KillUnit(f)call GroupRemoveUnit(g,f)endloopcall DestroyGroup(g)set g=nullset d=nullset l=nullset f=nullendfunctionfunction As takes nothing returns booleanreturn((GetSpellAbilityId()=='AIil')and((GetUnitTypeId(GetSpellTargetUnit())=='n00K')or(GetUnitTypeId(GetSpellTargetUnit())=='n00Z')or(GetUnitTypeId(GetSpellTargetUnit())=='n017')or(GetSpellTargetUnit()==Nx)))endfunctionfunction Ns takes nothing returns nothingcall DisplayTimedTextToPlayer(GetOwningPlayer(GetSpellAbilityUnit()),0,0,5.,"Посох Иллюзий не действует на мегабоссов.")call IssueImmediateOrderById(GetSpellAbilityUnit(),$D0004)endfunctionfunction Bs takes nothing returns nothinglocal unit u=GetEnteringUnit()if jb(u)and GetUnitTypeId(u)!='u001' and GetUnitTypeId(u)!='u003' and GetUnitTypeId(u)!='u004' and GetUnitTypeId(u)!='n002' and IsUnitType(u,UNIT_TYPE_HERO)==false thencall KillUnit(u)call RemoveUnit(u)call DisplayTextToPlayer(GetOwningPlayer(u),0,0,"|Cffff0000Ваш юнит не должен находиться в данной области.|R")endifset u=nullendfunctionfunction Cs takes nothing returns nothinglocal unit u=GetEnteringUnit()if jb(u)and GetUnitTypeId(u)!='u001' and GetUnitTypeId(u)!='u003' and GetUnitTypeId(u)!='u004' and GetUnitTypeId(u)!='n002' and IsUnitType(u,UNIT_TYPE_HERO)==false thenif IsUnitType(u,UNIT_TYPE_FLYING)thenelsecall KillUnit(u)call RemoveUnit(u)call DisplayTextToPlayer(GetOwningPlayer(u),0,0,"|Cffff0000Ваш юнит не должен находиться в данной области.|R")endifendifset u=nullendfunctionfunction Ds takes nothing returns boolean	return ce==false and Pv==false and Ve==false and Cx==false and tv==falseendfunction// Телепорт в центр ареныfunction TeleportToCenterArena takes nothing returns nothing	local player p=GetTriggerPlayer()	local integer rC=me[GetPlayerId(p)+1]	local unit u=gv[rC]	local player Gp	local group g	local unit f	local location T	if cx[rC]==false then		set cx[rC]=true		if GetWidgetLife(u)>.405 then			if(GetLocalPlayer()==p)then				call ClearSelection()				call SelectUnit(u,true)			endif			set g=CreateGroup()			call GroupEnumUnitsOfPlayer(g,p,null)			loop				set f=FirstOfGroup(g)				exitwhen f==null				if(IsUnitType(f,UNIT_TYPE_HERO)==false and GetUnitTypeId(f)!='n002')or(GetUnitTypeId(f)=='E00E' or GetUnitTypeId(f)=='E00J')then					if lb(jr,GetUnitX(f),GetUnitY(f))==false then						set T=Location(GetRandomReal(GetRectMinX(vi),GetRectMaxX(vi)),GetRandomReal(GetRectMinY(vi),GetRectMaxY(vi)))						call SetUnitPositionLoc(f,T)						call RemoveLocation(T)						set Gp=GetOwningPlayer(f)						if(GetLocalPlayer()==Gp)then							call SelectUnit(f,true)						endif					endif				endif				call GroupRemoveUnit(g,f)			endloop			call DestroyGroup(g)			set T=Location(GetRandomReal(GetRectMinX(vi),GetRectMaxX(vi)),GetRandomReal(GetRectMinY(vi),GetRectMaxY(vi)))			call SetUnitPositionLoc(u,T)			if(GetLocalPlayer()==p)then				call PanCameraToTimed(GetLocationX(T),GetLocationY(T),.0)			endif			call DestroyEffect(AddSpecialEffectLoc("Abilities\\Spells\\NightElf\\Blink\\BlinkTarget.mdl",T))			call RemoveLocation(T)		endif	endif	set u=null	set p=null	set g=null	set T=null	set f=null	set Gp=nullendfunctionfunction gs takes nothing returns booleanreturn GetSpellAbilityId()=='A02D' or GetSpellAbilityId()=='A09F'endfunctionfunction Gs takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer Gb=GetHandleId(t)local unit c=LoadUnitHandle(wx,1,Gb)call SetUnitMoveSpeed(c,500)call DestroyTimer(t)set c=nullset t=nullendfunctionfunction hs takes nothing returns nothinglocal unit u=GetSpellAbilityUnit()local timer t=CreateTimer()local integer Gb=GetHandleId(t)if RectContainsUnit(Hr,u)thencall SaveUnitHandle(wx,1,Gb,u)call TimerStart(t,.1,false,function Gs)endifset t=nullset u=nullendfunctionfunction js takes nothing returns booleanreturn GetOwningPlayer(GetDyingUnit())==Player($B)and GetUnitUserData(GetDyingUnit())==1endfunctionfunction Js takes nothing returns nothingcall AddSpecialEffectLoc("Objects\\Spawnmodels\\Orc\\Orcblood\\BattrollBlood.mdl",GetUnitLoc(GetDyingUnit()))endfunctionfunction DisplayHeroSpeed takes nothing returns nothinglocal player p=GetTriggerPlayer()local integer DC=me[GetPlayerId(p)+1]call DisplayTextToPlayer(p,0,0,"Скорость перемещения : |Cffff0000"+I2S(R2I(GetUnitMoveSpeed(gv[DC])))+"|R")set p=nullendfunctionfunction ClearDisplay takes nothing returns nothingif GetTriggerPlayer()==GetLocalPlayer()thencall ClearTextMessages()endifendfunctionfunction Ms takes nothing returns nothingcall DisableTrigger(GetTriggeringTrigger())set Ox=truecall DisplayTextToForce(bj_FORCE_ALL_PLAYERS,"|Cffff0000Тecтoвый peжим включeн|R")call EnableTrigger(aI)call EnableTrigger(nI)call EnableTrigger(VI)call EnableTrigger(EI)endfunctionfunction Ps takes nothing returns nothingcall AdjustPlayerStateBJ($186A0,Player(0),PLAYER_STATE_RESOURCE_GOLD)call AdjustPlayerStateBJ($186A0,Player(0),PLAYER_STATE_RESOURCE_LUMBER)endfunctionfunction Qs takes nothing returns booleanreturn((IsUnitType(GetFilterUnit(),UNIT_TYPE_HERO))!=null)!=nullendfunctionfunction Ss takes nothing returns nothinglocal integer In=1local integer Hblocal group g=CreateGroup()local unit floopexitwhen In>$FAif GetEventPlayerChatString()=="-у "+I2S(In)or GetEventPlayerChatString()=="-y "+I2S(In)thenset Hb=Inendifset In=In+1endloopset g=dN(Player(0),Condition(function Qs))loopset f=FirstOfGroup(g)exitwhen f==nullcall SetHeroLevel(f,Hb,false)call GroupRemoveUnit(g,f)endloopcall DestroyGroup(g)set f=nullset g=nullendfunctionfunction Ts takes nothing returns nothingcall SetPlayerMaxHeroesAllowed(-1,Player(0))endfunctionfunction Us takes nothing returns booleanreturn(Rx==false)endfunctionfunction ws takes nothing returns nothingif(Us())thenset Rx=truecall UnitAddAbility(gv[1],'A0A7')elseset Rx=falsecall UnitRemoveAbility(gv[1],'A0A7')endifendfunctionfunction IS takes nothing returns nothingset wx=InitHashtable()call vC()endfunctionfunction NS takes nothing returns nothing	local integer N=0	local integer In=1	local player p=GetTriggerPlayer()	local integer rC	loop		exitwhen In>fv		if GetPlayerController(qe[In])==MAP_CONTROL_USER then			set N=N+1			if p!=qe[In]and GetPlayerSlotState(qe[In])==PLAYER_SLOT_STATE_PLAYING then				set rC=me[(1+GetPlayerId(qe[In]))]				call DisplayTimedTextToPlayer(p,0,0,$C,(("|Cffff0000"+I2S(N))+(". "+GetUnitName(gv[rC]))))			endif		endif		set In=In+1	endloopendfunctionfunction BS takes nothing returns nothinglocal player p=GetTriggerPlayer()local player p2local integer In=1local integer cS=0local integer CS=Zc(p)local integer rClocal integer Uclocal boolean blocal boolean dSlocal boolean bb=falseif GetEventPlayerChatString()=="-обв"or GetEventPlayerChatString()=="-swapall"thenset cS=1loopexitwhen cS>8 or bbif GetPlayerSlotState(Ux[cS])==PLAYER_SLOT_STATE_EMPTY thenelseset p2=Ux[cS]set rC=me[(1+GetPlayerId(p))]set Uc=me[(1+GetPlayerId(p2))]if gv[rC]==null or gv[Uc]==null or cS==CS thenelsecall SaveBoolean(wx,rC,StringHash("p"+I2S(rC)+"or"+I2S(Uc)),true)set b=LoadBoolean(wx,rC,StringHash("p"+I2S(rC)+"or"+I2S(Uc)))set dS=LoadBoolean(wx,Uc,StringHash("p"+I2S(Uc)+"or"+I2S(rC)))if b==dS thenset bb=trueset In=1loopexitwhen In>8call SaveBoolean(wx,rC,StringHash("p"+I2S(rC)+"or"+I2S(In)),false)call SaveBoolean(wx,Uc,StringHash("p"+I2S(Uc)+"or"+I2S(In)),false)set In=In+1endloopcall Tc(p,p2)elsecall DisplayTimedTextToPlayer(p2,0,0,$C,"|Cffff0000"+GetUnitName(gv[rC])+" |Rхочет обменяться героями, для согласия введите |Cffff0000-об "+I2S(CS)+"|R")endifendifendifset cS=cS+1endloopelseloopexitwhen In>8 or cS!=0if GetEventPlayerChatString()=="-об "+I2S(In)or GetEventPlayerChatString()=="-swap "+I2S(In)thenset cS=Inendifset In=In+1endloopif cS==0 or GetPlayerSlotState(Ux[cS])==PLAYER_SLOT_STATE_EMPTY thenreturnendifset p2=Ux[cS]set rC=me[(1+GetPlayerId(p))]set Uc=me[(1+GetPlayerId(p2))]if gv[rC]==null or gv[Uc]==null or cS==CS thenreturnendifcall SaveBoolean(wx,rC,StringHash("p"+I2S(rC)+"or"+I2S(Uc)),true)set b=LoadBoolean(wx,rC,StringHash("p"+I2S(rC)+"or"+I2S(Uc)))set dS=LoadBoolean(wx,Uc,StringHash("p"+I2S(Uc)+"or"+I2S(rC)))if b==dS thenset In=1loopexitwhen In>8call SaveBoolean(wx,rC,StringHash("p"+I2S(rC)+"or"+I2S(In)),false)call SaveBoolean(wx,Uc,StringHash("p"+I2S(Uc)+"or"+I2S(In)),false)set In=In+1endloopcall Tc(p,p2)returnendifcall DisplayTimedTextToPlayer(p2,0,0,$C,"|Cffff0000"+GetUnitName(gv[rC])+" |Rхочет обменяться героями, для согласия введите |Cffff0000-об "+I2S(CS)+"|R")endifset p=nullset p2=nullendfunctionfunction fS takes nothing returns nothinglocal integer In=1local player p=GetTriggerPlayer()local integer rC=me[GetPlayerId(p)+1]loopexitwhen In>8call SaveBoolean(wx,rC,In,false)set In=In+1endloopset p=nullendfunctionfunction FS takes nothing returns nothinglocal integer i=0set FI=CreateTrigger()loopexitwhen i>7call TriggerRegisterPlayerChatEvent(FI,Player(i),"-обн",true)call TriggerRegisterPlayerChatEvent(FI,Player(i),"-swapno",true)set i=i+1endloopcall TriggerAddAction(FI,function fS)endfunctionfunction RepickHero takes nothing returns nothing	local player p=GetTriggerPlayer()	local integer id=GetPlayerId(p)+1	local integer rC=me[id]	local integer In=1	local integer cS=0	if gv[rC]!=null then		if GetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD)>=50 then			if(lo[rC]==false and(ke[id]or Xx))then				loop					exitwhen In>8					if p==Ux[In]then						set cS=In					endif					set In=In+1				endloop				if cS!=0 then					set In=1					loop						exitwhen In>8						call SaveBoolean(wx,In,StringHash("p"+I2S(In)+"or"+I2S(cS)),false)						set In=In+1					endloop				endif				set lo[rC]=true				call SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,GetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD)-50)				call OC(p)			endif		else			call DisplayTextToPlayer(p,0,0,"Для репика необходимо 50 золотых.")		endif	endif	set p=nullendfunctionfunction hS takes integer ID returns booleanreturn ID=='I06M' or ID=='I02H' or ID=='I02I' or ID=='I01Y' or ID=='I081' or ID=='I021' or ID=='I020' or ID=='I01Z' or ID=='I022' or ID=='I023' or ID=='I01L' or ID=='I03L' or ID=='I03M' or ID=='I01M' or ID=='I01A' or ID=='I01J' or ID=='I01D' or ID=='I07K' or ID=='I07E'endfunctionfunction HS takes nothing returns nothinglocal timer ti=GetExpiredTimer()local integer Gb=GetHandleId(ti)local real x=LoadReal(wx,1,Gb)local real y=LoadReal(wx,2,Gb)local integer jS=LoadInteger(wx,3,Gb)local integer ID=LoadInteger(wx,4,Gb)local item t=CreateItem(ID,x,y)call SetItemUserData(t,jS)call DestroyTimer(ti)set t=nullset ti=nullendfunctionfunction JS takes nothing returns nothinglocal timer ti=GetExpiredTimer()local integer Gb=GetHandleId(ti)local real x=LoadReal(wx,1,Gb)local real y=LoadReal(wx,2,Gb)local integer jS=LoadInteger(wx,3,Gb)local integer ID=LoadInteger(wx,4,Gb)local integer Jb=LoadInteger(wx,5,Gb)local item t=CreateItem(ID,x,y)call SetItemUserData(t,jS)call SetItemCharges(t,Jb)call DestroyTimer(ti)set t=nullset ti=nullendfunctionfunction kS takes unit u,integer id returns booleanlocal integer In=1loopexitwhen In>6if GetItemTypeId(UnitItemInSlot(u,In-1))==id thenreturn trueendifset In=In+1endloopreturn falseendfunctionfunction KS takes unit u,integer id,item yc returns nothinglocal integer In=1local item itloopexitwhen In>6if GetItemTypeId(UnitItemInSlot(u,In-1))==id thenset it=UnitItemInSlot(u,In-1)endifset In=In+1endloopcall SetItemCharges(it,GetItemCharges(it)+GetItemCharges(yc))endfunctionfunction lS takes unit u,item it returns nothinglocal integer In=1local integer TT=0local integer array LSlocal item Wclocal item ycloopexitwhen In>6if GetItemTypeId(UnitItemInSlot(u,In-1))==GetItemTypeId(it)thenset TT=TT+1set LS[TT]=In-1endifset In=In+1endloopset Wc=UnitItemInSlot(u,LS[1])set yc=UnitItemInSlot(u,LS[2])if TT>1 thenif Wc==it thencall SetItemCharges(yc,GetItemCharges(Wc)+GetItemCharges(yc))call RemoveItem(Wc)elsecall SetItemCharges(Wc,GetItemCharges(Wc)+GetItemCharges(yc))call RemoveItem(yc)endifendifset Wc=nullset yc=nullendfunctionfunction mS takes unit u returns integerlocal integer i=0local integer MB=0loopexitwhen i>5if GetItemTypeId(UnitItemInSlot(u,i))!=0 thenset MB=MB+1endifset i=i+1endloopreturn MBendfunctionfunction MS takes unit u,integer pS,boolean PS,boolean qS returns booleanlocal integer pN=0local integer QS=0local item AQif pS==0 thenreturn falseendifloopset AQ=UnitItemInSlot(u,pN)if GetItemTypeId(AQ)==pS thenif PS thencall RemoveItem(AQ)endifif qS thenset QS=QS+1elsereturn trueendifendifset pN=pN+1exitwhen pN>=6 or QS>=2endloopif QS>=2 thenreturn trueendifset AQ=nullreturn falseendfunctionfunction sS takes boolean qS,unit u,integer ID,integer SS,integer tS,integer TS,integer uS,integer US,integer wS,integer WS,integer yS,integer YS,integer zS,integer ZS returns nothinglocal item itif qS thenif ID==SS thencall MS(u,tS,true,false)elsecall MS(u,tS,true,true)endifelseif ID!=SS thencall MS(u,tS,true,false)endifendifif ID!=TS thencall MS(u,uS,true,false)endifif ID!=US thencall MS(u,wS,true,false)endifif ID!=WS thencall MS(u,yS,true,false)endifif ID!=YS thencall MS(u,zS,true,false)endifcall DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\AIam\\AIamTarget.mdl",u,"origin"))set it=UnitAddItemById(u,ZS)call SetItemUserData(it,GetUnitUserData(u))set it=nullendfunctionfunction vt takes boolean qS,unit u,integer SS,integer TS,integer US,integer WS,integer YS,integer ZS returns nothinglocal item itif qS thencall MS(u,SS,true,true)elsecall MS(u,SS,true,false)endifcall MS(u,TS,true,false)call MS(u,US,true,false)call MS(u,WS,true,false)call MS(u,YS,true,false)call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\AIam\\AIamTarget.mdl",u,"origin"))set it=UnitAddItemById(u,ZS)call SetItemUserData(it,GetUnitUserData(u))set it=nullendfunctionfunction et takes nothing returns nothing	local unit u=GetManipulatingUnit()	local item it=GetManipulatedItem()	local integer xt=GetItemUserData(it)	local integer ot=GetItemTypeId(it)	local integer rt	local boolean b=false	local real x=GetItemX(it)	local real y=GetItemY(it)	local timer ti=CreateTimer()	local integer Gb=GetHandleId(ti)	local item t	local integer Jb=GetItemCharges(it)	local integer at=ot	local integer array GB	local integer nt	if((GetUnitUserData(u)!=GetItemUserData(it)and GetItemUserData(it)!=0)or GetItemType(it)!=ITEM_TYPE_CAMPAIGN)then		return	endif	set rt=Md(ot,false)	if jb(u)==false then		set nt=wo[GetUnitUserData(u)]+1	else		set nt=6	endif	if mS(u)==nt then		if hS(rt)then			if kS(u,rt)then				set b=true				call KS(u,rt,it)			endif		endif		if(MS(u,'I000',false,false)or ot=='I04J')and(MS(u,'I002',false,false)or ot=='I04Q')and(MS(u,'I003',false,false)or ot=='I032')then			set b=true			call sS(false,u,ot,'I04J','I000','I04Q','I002','I032','I003',0,0,0,0,'I001')			set ot=0		endif		if((MS(u,'I000',false,true))or(ot=='I04J' and MS(u,'I000',false,false)))and(MS(u,'I004',false,false)or ot=='I04X')and(MS(u,'I006',false,false)or ot=='I038')then			set b=true			call sS(true,u,ot,'I04J','I000','I04X','I004','I038','I006',0,0,0,0,'I005')			set ot=0		endif		if(MS(u,'I007',false,false)or ot=='I04V')and(MS(u,'I008',false,false)or ot=='I04H')and(MS(u,'I00A',false,false)or ot=='I037')then			set b=true			call sS(false,u,ot,'I04V','I007','I04H','I008','I037','I00A',0,0,0,0,'I009')			set ot=0		endif		if(MS(u,'I001',false,false)or ot=='I05B')and(MS(u,'I00C',false,false)or ot=='I04P')and(MS(u,'I00D',false,false)or ot=='I02R')then			set b=true			call sS(false,u,ot,'I05B','I001','I04P','I00C','I02R','I00D',0,0,0,0,'I00B')			set ot=0		endif		if(MS(u,'I004',false,false)or ot=='I04X')and(MS(u,'I00E',false,false)or ot=='I04K')and(MS(u,'I00C',false,false)or ot=='I04P')and(MS(u,'I00G',false,false)or ot=='I02S')then			set b=true			call sS(false,u,ot,'I04X','I004','I04K','I00E','I04P','I00C','I02S','I00G',0,0,'I00F')			set ot=0		endif		if(MS(u,'I00I',false,false)or ot=='I04M')and(MS(u,'I00J',false,false)or ot=='I02Y')then			set b=true			call sS(false,u,ot,'I04M','I00I','I02Y','I00J',0,0,0,0,0,0,'I00H')			set ot=0		endif		if((MS(u,'I002',false,true))or(ot=='I04Q' and MS(u,'I002',false,false)))and(MS(u,'I007',false,false)or ot=='I04V')and(MS(u,'I00K',false,false)or ot=='I04O')and(MS(u,'I00M',false,false)or ot=='I036')then			set b=true			call sS(true,u,ot,'I04Q','I002','I04V','I007','I04O','I00K','I036','I00M',0,0,'I00L')			set ot=0		endif		if(MS(u,'I00N',false,false)or ot=='I04Y')and(MS(u,'I00E',false,false)or ot=='I04K')and(MS(u,'I00P',false,false)or ot=='I03K')and(MS(u,'I00Q',false,false)or ot=='I02V')then			set b=true			call sS(false,u,ot,'I04Y','I00N','I04K','I00E','I03K','I00P','I02V','I00Q',0,0,'I00O')			set ot=0		endif		if(MS(u,'I00T',false,false)or ot=='I05M')and(MS(u,'I00U',false,false)or ot=='I03C')then			set b=true			call sS(false,u,ot,'I05M','I00T','I03C','I00U',0,0,0,0,0,0,'I00V')			set ot=0		endif		if(MS(u,'I00S',false,false)or ot=='I04R')and(MS(u,'I00E',false,false)or ot=='I04K')and(MS(u,'I00R',false,false)or ot=='I04N')and(MS(u,'I00U',false,false)or ot=='I03C')then			set b=true			call sS(false,u,ot,'I04R','I00S','I04K','I00E','I04N','I00R','I03C','I00U',0,0,'I00T')			set ot=0		endif		if(MS(u,'I00S',false,false)or ot=='I04R')and(MS(u,'I019',false,false)or ot=='I04I')and(MS(u,'I00X',false,false)or ot=='I03B')then			set b=true			call sS(false,u,ot,'I04R','I00S','I04I','I019','I03B','I00X',0,0,0,0,'I00W')			set ot=0		endif		if(MS(u,'I00R',false,false)or ot=='I04N')and(MS(u,'I02F',false,false)or ot=='I02J')then			set b=true			call sS(false,u,ot,'I04N','I00R','I02J','I02F',0,0,0,0,0,0,'I02G')			set ot=0		endif		if(MS(u,'I02G',false,false)or ot=='I04Z')and(MS(u,'I00S',false,false)or ot=='I04R')and(MS(u,'I010',false,false)or ot=='I02Q')then			set b=true			call sS(false,u,ot,'I04Z','I02G','I04R','I00S','I02Q','I010',0,0,0,0,'I00Z')			set ot=0		endif		if(MS(u,'I001',false,false)or ot=='I05B')and(MS(u,'I00I',false,false)or ot=='I04M')and(MS(u,'I00K',false,false)or ot=='I04O')and(MS(u,'I012',false,false)or ot=='I02U')then			set b=true			call sS(false,u,ot,'I05B','I001','I04M','I00I','I04O','I00K','I02U','I012',0,0,'I011')			set ot=0		endif		if(MS(u,'I00K',false,false)or ot=='I04O')and(MS(u,'I00Y',false,false)or ot=='I04U')and(MS(u,'I014',false,false)or ot=='I03F')then			set b=true			call sS(false,u,ot,'I04O','I00K','I04U','I00Y','I03F','I014',0,0,0,0,'I013')			set ot=0		endif		if(MS(u,'I00I',false,false)or ot=='I04M')and(MS(u,'I008',false,false)or ot=='I04H')and(MS(u,'I009',false,false)or ot=='I05H')and(MS(u,'I016',false,false)or ot=='I02Z')then			set b=true			call sS(false,u,ot,'I04M','I00I','I04H','I008','I05H','I009','I02Z','I016',0,0,'I015')			set ot=0		endif		if((MS(u,'I009',false,true))or(ot=='I05H' and MS(u,'I009',false,false)))and(MS(u,'I018',false,false)or ot=='I03G')then			set b=true			call sS(true,u,ot,'I05H','I009','I03G','I018',0,0,0,0,0,0,'I017')			set ot=0		endif		if(MS(u,'I01E',false,false)or ot=='I04L')and(MS(u,'I00E',false,false)or ot=='I04K')and(MS(u,'I00P',false,false)or ot=='I03K')and(MS(u,'I01G',false,false)or ot=='I03J')then			set b=true			call sS(false,u,ot,'I04L','I01E','I04K','I00E','I03K','I00P','I03J','I01G',0,0,'I01F')			set ot=0		endif		if(MS(u,'I00N',false,false)or ot=='I04Y')and(MS(u,'I01H',false,false)or ot=='I033')then			set b=true			call sS(false,u,ot,'I04Y','I00N','I033','I01H',0,0,0,0,0,0,'I01I')			set ot=0		endif		if(MS(u,'I019',false,false)or ot=='I04I')and(MS(u,'I01K',false,false)or ot=='I04S')and(MS(u,'I01O',false,false)or ot=='I03I')then			set b=true			call sS(false,u,ot,'I04I','I019','I04S','I01K','I03I','I01O',0,0,0,0,'I01N')			set ot=0		endif		if(MS(u,'I005',false,false)or ot=='I05I')and(MS(u,'I00B',false,false)or ot=='I050')and(MS(u,'I01Q',false,false)or ot=='I031')then			set b=true			call sS(false,u,ot,'I05I','I005','I050','I00B','I031','I01Q',0,0,0,0,'I01P')			set ot=0		endif		if(MS(u,'I00O',false,false)or ot=='I054')and(MS(u,'I01F',false,false)or ot=='I05V')and(MS(u,'I01I',false,false)or ot=='I05C')and(MS(u,'I01S',false,false)or ot=='I02W')then			set b=true			call sS(false,u,ot,'I054','I00O','I05V','I01F','I05C','I01I','I02W','I01S',0,0,'I01R')			set ot=0		endif		if(MS(u,'I00W',false,false)or ot=='I05L')and(MS(u,'I00R',false,false)or ot=='I04N')and(MS(u,'I01T',false,false)or ot=='I039')then			set b=true			call sS(false,u,ot,'I05L','I00W','I04N','I00R','I039','I01T',0,0,0,0,'I01B')			set ot=0		endif		if(MS(u,'I01V',false,false)or ot=='I03A')and(MS(u,'I01U',false,false)or ot=='I05K')then			set b=true			call sS(false,u,ot,'I03A','I01V','I05K','I01U',0,0,0,0,0,0,'I07N')			set ot=0		endif		if(MS(u,'I002',false,false)or ot=='I04Q')and(MS(u,'I000',false,false)or ot=='I04J')and(MS(u,'I019',false,false)or ot=='I04I')and(MS(u,'I01V',false,false)or ot=='I03A')and(MS(u,'I02A',false,false)or ot=='I04W')then			set b=true			call sS(false,u,ot,'I04Q','I002','I04I','I019','I03A','I01V','I04W','I02A','I04J','I000','I01U')			set ot=0		endif		if(MS(u,'I00R',false,false)or ot=='I04N')and(MS(u,'I01W',false,false)or ot=='I04G')and(MS(u,'I024',false,false)or ot=='I04T')and(MS(u,'I01X',false,false)or ot=='I03H')then			set b=true			call sS(false,u,ot,'I04N','I00R','I04G','I01W','I04T','I024','I03H','I01X',0,0,'I025')			set ot=0		endif		if(MS(u,'I00P',false,false)or ot=='I03K')and(MS(u,'I024',false,false)or ot=='I04T')and(MS(u,'I027',false,false)or ot=='I030')then			set b=true			call sS(false,u,ot,'I03K','I00P','I04T','I024','I030','I027',0,0,0,0,'I026')			set ot=0		endif		if(MS(u,'I000',false,false)or ot=='I04J')and(MS(u,'I00P',false,false)or ot=='I03K')and(MS(u,'I00E',false,false)or ot=='I04K')and(MS(u,'I028',false,false)or ot=='I03E')then			set b=true			call sS(false,u,ot,'I04J','I000','I03K','I00P','I04K','I00E','I03E','I028',0,0,'I029')			set ot=0		endif		if(MS(u,'I00I',false,false)or ot=='I04M')and(MS(u,'I02A',false,false)or ot=='I04W')and(MS(u,'I019',false,false)or ot=='I04I')and(MS(u,'I02B',false,false)or ot=='I02X')then			set b=true			call sS(false,u,ot,'I04M','I00I','I04W','I02A','I04I','I019','I02X','I02B',0,0,'I02C')			set ot=0		endif		if(MS(u,'I02E',false,false)or ot=='I05E')and(MS(u,'I02D',false,false)or ot=='I035')then			set b=true			call sS(false,u,ot,'I05E','I02E','I035','I02D',0,0,0,0,0,0,'I03Z')			set ot=0		endif		if(MS(u,'I00E',false,false)or ot=='I04K')and(MS(u,'I01E',false,false)or ot=='I04L')and(MS(u,'I007',false,false)or ot=='I04V')and(MS(u,'I02D',false,false)or ot=='I035')then			set b=true			call sS(false,u,ot,'I04K','I00E','I04L','I01E','I04V','I007','I035','I02D',0,0,'I02E')			set ot=0		endif		if(MS(u,'I00F',false,false)or ot=='I051')and(MS(u,'I00L',false,false)or ot=='I05G')and(MS(u,'I02K',false,false)or ot=='I03D')then			set b=true			call sS(false,u,ot,'I051','I00F','I05G','I00L','I03D','I02K',0,0,0,0,'I02L')			set ot=0		endif		if(MS(u,'I00C',false,false)or ot=='I04P')and(MS(u,'I00K',false,false)or ot=='I04O')and(MS(u,'I00S',false,false)or ot=='I04R')and(MS(u,'I02M',false,false)or ot=='I034')then			set b=true			call sS(false,u,ot,'I04P','I00C','I04O','I00K','I04R','I00S','I034','I02M',0,0,'I02N')			set ot=0		endif		if(MS(u,'I00C',false,false)or ot=='I04P')and(MS(u,'I00I',false,false)or ot=='I04M')and(MS(u,'I00S',false,false)or ot=='I04R')and(MS(u,'I00P',false,false)or ot=='I03K')and(MS(u,'I02O',false,false)or ot=='I02T')then			set b=true			call sS(false,u,ot,'I04P','I00C','I04M','I00I','I04R','I00S','I03K','I00P','I02T','I02O','I02P')			set ot=0		endif		if(MS(u,'I007',false,false)or ot=='I04V')and(MS(u,'I01N',false,false)or ot=='I05T')and(MS(u,'I03P',false,false)or ot=='I03O')then			set b=true			call sS(false,u,ot,'I04V','I007','I05T','I01N','I03O','I03P',0,0,0,0,'I03N')			set ot=0		endif		if(MS(u,'I007',false,false)or ot=='I04V')and(MS(u,'I00H',false,false)or ot=='I057')and(MS(u,'I03Q',false,false)or ot=='I03R')then			set b=true			call sS(false,u,ot,'I04V','I007','I057','I00H','I03R','I03Q',0,0,0,0,'I03S')			set ot=0		endif		if(MS(u,'I015',false,false)or ot=='I058')and(MS(u,'I011',false,false)or ot=='I053')and(MS(u,'I03V',false,false)or ot=='I03U')then			set b=true			call sS(false,u,ot,'I058','I015','I053','I011','I03U','I03V',0,0,0,0,'I03T')			set ot=0		endif		if(MS(u,'I00P',false,false)or ot=='I03K')and(MS(u,'I026',false,false)or ot=='I059')and(MS(u,'I03X',false,false)or ot=='I03W')then			set b=true			call sS(false,u,ot,'I03K','I00P','I059','I026','I03W','I03X',0,0,0,0,'I03Y')			set ot=0		endif		if((MS(u,'I00S',false,true))or(ot=='I04R' and MS(u,'I00S',false,false)))and(MS(u,'I00R',false,false)or ot=='I04N')and(MS(u,'I040',false,false)or ot=='I041')then			set b=true			call sS(true,u,ot,'I04R','I00S','I04N','I00R','I041','I040',0,0,0,0,'I042')			set ot=0		endif		if(MS(u,'I042',false,false)or ot=='I060')and(MS(u,'I01E',false,false)or ot=='I04L')and(MS(u,'I044',false,false)or ot=='I043')then			set b=true			call sS(false,u,ot,'I060','I042','I04L','I01E','I043','I044',0,0,0,0,'I045')			set ot=0		endif		if(MS(u,'I042',false,false)or ot=='I060')and(MS(u,'I019',false,false)or ot=='I04I')and(MS(u,'I046',false,false)or ot=='I047')then			set b=true			call sS(false,u,ot,'I060','I042','I04I','I019','I047','I046',0,0,0,0,'I048')			set ot=0		endif		if(MS(u,'I042',false,false)or ot=='I060')and(MS(u,'I00E',false,false)or ot=='I04K')and(MS(u,'I04A',false,false)or ot=='I04B')then			set b=true			call sS(false,u,ot,'I060','I042','I04K','I00E','I04B','I04A',0,0,0,0,'I049')			set ot=0		endif		if(MS(u,'I04D',false,false)or ot=='I064')and(MS(u,'I04C',false,false)or ot=='I04E')then			set b=true			call sS(false,u,ot,'I064','I04D','I04E','I04C',0,0,0,0,0,0,'I04F')			set ot=0		endif		if(MS(u,'I00O',false,false)or ot=='I054')and(MS(u,'I00P',false,false)or ot=='I03K')and(MS(u,'I04C',false,false)or ot=='I04E')then			set b=true			call sS(false,u,ot,'I054','I00O','I03K','I00P','I04E','I04C',0,0,0,0,'I04D')			set ot=0		endif		if((MS(u,'I00E',false,true))or(ot=='I04K' and MS(u,'I00E',false,false)))and(MS(u,'I00O',false,false)or ot=='I054')and(MS(u,'I06T',false,false)or ot=='I06S')then			set b=true			call sS(true,u,ot,'I04K','I00E','I054','I00O','I06S','I06T',0,0,0,0,'I06R')			set ot=0		endif		if(MS(u,'I00L',false,false)or ot=='I05G')and(MS(u,'I06W',false,false)or ot=='I06Y')then			set b=true			call sS(false,u,ot,'I05G','I00L','I06Y','I06W',0,0,0,0,0,0,'I06V')			set ot=0		endif		if(MS(u,'I001',false,false)or ot=='I05B')and(MS(u,'I06W',false,false)or ot=='I06Y')and(MS(u,'I00C',false,false)or ot=='I04P')and(MS(u,'I007',false,false)or ot=='I04V')then			set b=true			call sS(false,u,ot,'I05B','I001','I06Y','I06W','I04P','I00C','I04V','I007',0,0,'I07T')			set ot=0		endif		if(MS(u,'I00Y',false,false)or ot=='I04U')and(MS(u,'I06L',false,false)or ot=='I071')then			set b=true			call sS(false,u,ot,'I04U','I00Y','I071','I06L',0,0,0,0,0,0,'I06J')			set ot=0		endif		if(MS(u,'I00O',false,false)or ot=='I054')and(MS(u,'I025',false,false)or ot=='I05S')and(MS(u,'I074',false,false)or ot=='I073')then			set b=true			call sS(false,u,ot,'I054','I00O','I05S','I025','I073','I074',0,0,0,0,'I072')			set ot=0		endif		if(MS(u,'I029',false,false)or ot=='I05P')and(MS(u,'I01F',false,false)or ot=='I05V')and(MS(u,'I077',false,false)or ot=='I079')then			set b=true			call sS(false,u,ot,'I05P','I029','I05V','I01F','I079','I077',0,0,0,0,'I076')			set ot=0		endif		if(MS(u,'I00N',false,false)or ot=='I04Y')and(MS(u,'I00H',false,false)or ot=='I057')and(MS(u,'I07B',false,false)or ot=='I07D')then			set b=true			call sS(false,u,ot,'I04Y','I00N','I057','I00H','I07D','I07B',0,0,0,0,'I07A')			set ot=0		endif		if(MS(u,'I019',false,false)or ot=='I04I')and(MS(u,'I00P',false,false)or ot=='I03K')and(MS(u,'I02N',false,false)or ot=='I05D')and(MS(u,'I07Q',false,false)or ot=='I07S')then			set b=true			call sS(false,u,ot,'I04I','I019','I03K','I00P','I05D','I02N','I07S','I07Q',0,0,'I07P')			set ot=0		endif		if(MS(u,'I01F',false,false)or ot=='I03J')and(MS(u,'I07A',false,false)or ot=='I07D')and(MS(u,'I063',false,false)or ot=='I04A')then			set b=true			call sS(false,u,ot,'I03J','I01F','I07D','I07A','I04A','I063',0,0,0,0,'I04B')			set ot=0		endif		if b==false then			call SaveReal(wx,1,Gb,x)			call SaveReal(wx,2,Gb,y)			call SaveInteger(wx,3,Gb,xt)			call SaveInteger(wx,4,Gb,at)			call SaveInteger(wx,5,Gb,Jb)			call TimerStart(ti,.0,false,function JS)		endif	else		set t=UnitAddItemById(u,rt)		call SetItemUserData(t,xt)		call SetItemCharges(t,Jb)		if hS(rt)then			call lS(u,t)			return		endif		if MS(u,'I000',false,false)and MS(u,'I002',false,false)and MS(u,'I003',false,false)then			call vt(false,u,'I000','I002','I003',0,0,'I001')		endif		if MS(u,'I000',false,true)and MS(u,'I004',false,false)and MS(u,'I006',false,false)then			call vt(true,u,'I000','I004','I006',0,0,'I005')		endif		if MS(u,'I007',false,false)and MS(u,'I008',false,false)and MS(u,'I00A',false,false)then			call vt(false,u,'I007','I008','I00A',0,0,'I009')		endif		if MS(u,'I001',false,false)and MS(u,'I00C',false,false)and MS(u,'I00D',false,false)then			call vt(false,u,'I001','I00C','I00D',0,0,'I00B')		endif		if MS(u,'I004',false,false)and MS(u,'I00E',false,false)and MS(u,'I00C',false,false)and MS(u,'I00G',false,false)then			call vt(false,u,'I004','I00E','I00C','I00G',0,'I00F')		endif		if MS(u,'I00I',false,false)and MS(u,'I00J',false,false)then			call vt(false,u,'I00I','I00J',0,0,0,'I00H')		endif		if MS(u,'I002',false,true)and MS(u,'I007',false,false)and MS(u,'I00K',false,false)and MS(u,'I00M',false,false)then			call vt(true,u,'I002','I007','I00K','I00M',0,'I00L')		endif		if MS(u,'I00N',false,false)and MS(u,'I00E',false,false)and MS(u,'I00Q',false,false)and MS(u,'I00P',false,false)then			call vt(false,u,'I00N','I00E','I00Q','I00P',0,'I00O')		endif		if MS(u,'I00T',false,false)and MS(u,'I00U',false,false)then			call vt(false,u,'I00T','I00U',0,0,0,'I00V')		endif		if MS(u,'I00S',false,false)and MS(u,'I00E',false,false)and MS(u,'I00R',false,false)and MS(u,'I00U',false,false)then			call vt(false,u,'I00S','I00E','I00R','I00U',0,'I00T')		endif		if MS(u,'I00S',false,false)and MS(u,'I019',false,false)and MS(u,'I00X',false,false)then			call vt(false,u,'I00S','I019','I00X',0,0,'I00W')		endif		if MS(u,'I00R',false,false)and MS(u,'I02F',false,false)then			call vt(false,u,'I00R','I02F',0,0,0,'I02G')		endif		if MS(u,'I02G',false,false)and MS(u,'I00S',false,false)and MS(u,'I010',false,false)then			call vt(false,u,'I02G','I00S','I010',0,0,'I00Z')		endif		if MS(u,'I001',false,false)and MS(u,'I00I',false,false)and MS(u,'I00K',false,false)and MS(u,'I012',false,false)then			call vt(false,u,'I001','I00I','I00K','I012',0,'I011')		endif		if MS(u,'I00K',false,false)and MS(u,'I00Y',false,false)and MS(u,'I014',false,false)then			call vt(false,u,'I00K','I00Y','I014',0,0,'I013')		endif		if MS(u,'I00I',false,false)and MS(u,'I008',false,false)and MS(u,'I009',false,false)and MS(u,'I016',false,false)then			call vt(false,u,'I00I','I008','I009','I016',0,'I015')		endif		if MS(u,'I009',false,true)and MS(u,'I018',false,false)then			call vt(true,u,'I009','I018',0,0,0,'I017')		endif		if MS(u,'I01E',false,false)and MS(u,'I00E',false,false)and MS(u,'I00P',false,false)and MS(u,'I01G',false,false)then			call vt(false,u,'I01E','I00E','I00P','I01G',0,'I01F')		endif		if MS(u,'I00N',false,false)and MS(u,'I01H',false,false)then			call vt(false,u,'I00N','I01H',0,0,0,'I01I')		endif		if MS(u,'I019',false,false)and MS(u,'I01K',false,false)and MS(u,'I01O',false,false)then			call vt(false,u,'I019','I01K','I01O',0,0,'I01N')		endif		if MS(u,'I005',false,false)and MS(u,'I00B',false,false)and MS(u,'I01Q',false,false)then			call vt(false,u,'I005','I00B','I01Q',0,0,'I01P')		endif		if MS(u,'I00O',false,false)and MS(u,'I01F',false,false)and MS(u,'I01I',false,false)and MS(u,'I01S',false,false)then			call vt(false,u,'I00O','I01F','I01I','I01S',0,'I01R')		endif		if MS(u,'I00W',false,false)and MS(u,'I00R',false,false)and MS(u,'I01T',false,false)then			call vt(false,u,'I00W','I00R','I01T',0,0,'I01B')		endif		if MS(u,'I01V',false,false)and MS(u,'I01U',false,false)then			call vt(false,u,'I01V','I01U',0,0,0,'I07N')		endif		if MS(u,'I002',false,false)and MS(u,'I000',false,false)and MS(u,'I019',false,false)and MS(u,'I01V',false,false)and MS(u,'I02A',false,false)then			call vt(false,u,'I002','I019','I01V','I02A','I000','I01U')		endif		if MS(u,'I00R',false,false)and MS(u,'I01W',false,false)and MS(u,'I024',false,false)and MS(u,'I01X',false,false)then			call vt(false,u,'I00R','I01W','I024','I01X',0,'I025')		endif		if MS(u,'I00P',false,false)and MS(u,'I024',false,false)and MS(u,'I027',false,false)then			call vt(false,u,'I00P','I024','I027',0,0,'I026')		endif		if MS(u,'I000',false,false)and MS(u,'I00P',false,false)and MS(u,'I00E',false,false)and MS(u,'I028',false,false)then			call vt(false,u,'I000','I00P','I00E','I028',0,'I029')		endif		if MS(u,'I00I',false,false)and MS(u,'I02A',false,false)and MS(u,'I019',false,false)and MS(u,'I02B',false,false)then			call vt(false,u,'I00I','I02A','I019','I02B',0,'I02C')		endif		if MS(u,'I02E',false,false)and MS(u,'I02D',false,false)then			call vt(false,u,'I02E','I02D',0,0,0,'I03Z')		endif		if MS(u,'I00E',false,false)and MS(u,'I01E',false,false)and MS(u,'I007',false,false)and MS(u,'I02D',false,false)then			call vt(false,u,'I00E','I01E','I007','I02D',0,'I02E')		endif		if MS(u,'I00F',false,false)and MS(u,'I00L',false,false)and MS(u,'I02K',false,false)then			call vt(false,u,'I00F','I00L','I02K',0,0,'I02L')		endif		if MS(u,'I00C',false,false)and MS(u,'I00K',false,false)and MS(u,'I00S',false,false)and MS(u,'I02M',false,false)then			call vt(false,u,'I00C','I00K','I00S','I02M',0,'I02N')		endif		if MS(u,'I00C',false,false)and MS(u,'I00I',false,false)and MS(u,'I00S',false,false)and MS(u,'I00P',false,false)and MS(u,'I02O',false,false)then			call vt(false,u,'I00C','I00I','I00S','I00P','I02O','I02P')		endif		if MS(u,'I007',false,false)and MS(u,'I01N',false,false)and MS(u,'I03P',false,false)then			call vt(false,u,'I007','I01N','I03P',0,0,'I03N')		endif		if MS(u,'I007',false,false)and MS(u,'I00H',false,false)and MS(u,'I03Q',false,false)then			call vt(false,u,'I007','I00H','I03Q',0,0,'I03S')		endif		if MS(u,'I015',false,false)and MS(u,'I011',false,false)and MS(u,'I03V',false,false)then			call vt(false,u,'I015','I011','I03V',0,0,'I03T')		endif		if MS(u,'I00P',false,false)and MS(u,'I026',false,false)and MS(u,'I03X',false,false)then			call vt(false,u,'I00P','I026','I03X',0,0,'I03Y')		endif		if MS(u,'I00S',false,true)and MS(u,'I00R',false,false)and MS(u,'I040',false,false)then			call vt(true,u,'I00S','I00R','I040',0,0,'I042')		endif		if MS(u,'I042',false,false)and MS(u,'I01E',false,false)and MS(u,'I044',false,false)then			call vt(false,u,'I042','I01E','I044',0,0,'I045')		endif		if MS(u,'I042',false,false)and MS(u,'I019',false,false)and MS(u,'I046',false,false)then			call vt(false,u,'I042','I019','I046',0,0,'I048')		endif		if MS(u,'I042',false,false)and MS(u,'I00E',false,false)and MS(u,'I04A',false,false)then			call vt(false,u,'I042','I00E','I04A',0,0,'I049')		endif		if MS(u,'I04D',false,false)and MS(u,'I04C',false,false)then			call vt(false,u,'I04D','I04C',0,0,0,'I04F')		endif		if MS(u,'I00O',false,false)and MS(u,'I00P',false,false)and MS(u,'I04C',false,false)then			call vt(false,u,'I00O','I00P','I04C',0,0,'I04D')		endif		if MS(u,'I00E',false,true)and MS(u,'I00O',false,false)and MS(u,'I06T',false,false)then			call vt(true,u,'I00E','I00O','I06T',0,0,'I06R')		endif		if MS(u,'I00L',false,false)and MS(u,'I06W',false,false)then			call vt(false,u,'I00L','I06W',0,0,0,'I07O')		endif		if MS(u,'I001',false,false)and MS(u,'I007',false,false)and MS(u,'I00C',false,false)and MS(u,'I06W',false,false)then			call vt(false,u,'I001','I007','I00C','I06W',0,'I07T')		endif		if MS(u,'I00Y',false,false)and MS(u,'I06L',false,false)then			call vt(false,u,'I00Y','I06L',0,0,0,'I06J')		endif		if MS(u,'I00O',false,false)and MS(u,'I025',false,false)and MS(u,'I074',false,false)then			call vt(false,u,'I00O','I025','I074',0,0,'I072')		endif		if MS(u,'I029',false,false)and MS(u,'I01F',false,false)and MS(u,'I077',false,false)then			call vt(false,u,'I029','I01F','I077',0,0,'I076')		endif		if MS(u,'I00N',false,false)and MS(u,'I00H',false,false)and MS(u,'I07B',false,false)then			call vt(false,u,'I00N','I00H','I07B',0,0,'I07A')		endif		if MS(u,'I019',false,false)and MS(u,'I00P',false,false)and MS(u,'I02N',false,false)and MS(u,'I07Q',false,false)then			call vt(false,u,'I019','I00P','I02N','I07Q',0,'I07P')		endif		if MS(u,'I01F',false,false)and MS(u,'I07A',false,false)and MS(u,'I063',false,false)then			call vt(false,u,'I01F','I07A','I063',0,0,'I04B')		endif	endif	set t=null	set u=null	set it=null	set ti=nullendfunctionfunction Et takes nothing returns nothing	local item it=GetSoldItem()	local integer itid=GetItemTypeId(it)	local unit u=GetBuyingUnit()	local real x=GetUnitX(u)	local real y=GetUnitY(u)	if Sx then		if itid=='I07L' or itid=='I07F' or itid=='I06H' or itid=='I01C' or itid=='I06N' or itid=='I06P' or itid=='I066' or itid=='I067' or itid=='I068' or itid=='I069' or itid=='I06A' or itid=='I06B' or itid=='I06I' or itid=='I06C' or itid=='I06D' or itid=='I06E' or itid=='I06K' or itid=='I06F' or itid=='I06G' or itid=='I080' then			call SetItemUserData(it,0)		else			call SetItemUserData(it,GetUnitUserData(u))		endif	else		call SetItemUserData(it,GetUnitUserData(u))	endif	call SetItemPosition(it,x,y)	set it=null	set u=nullendfunctionfunction Ot takes nothing returns nothinglocal unit u=GetManipulatingUnit()local player p=GetOwningPlayer(u)local item it=GetManipulatedItem()local integer ot=GetItemTypeId(it)local real x=GetItemX(it)local real y=GetItemY(it)local integer jS=GetItemUserData(it)local item tlocal timer ti=CreateTimer()local integer Gb=GetHandleId(ti)if GetUnitUserData(u)!=jS and jS!=0 and GetItemType(it)==ITEM_TYPE_CAMPAIGN thencall SaveReal(wx,1,Gb,x)call SaveReal(wx,2,Gb,y)call SaveInteger(wx,3,Gb,jS)call SaveInteger(wx,4,Gb,ot)call TimerStart(ti,.0,false,function HS)endifset u=nullset it=nullset t=nullset ti=nullendfunctionfunction It takes item it returns unitlocal integer In=1loopexitwhen In>8if UnitHasItem(gv[In],it)thenreturn gv[In]endifif UnitHasItem(Wo[In],it)thenreturn Wo[In]endifif UnitHasItem(So[In],it)thenreturn So[In]endifset In=In+1endloopreturn nullendfunctionfunction At takes nothing returns nothinglocal timer ti=GetExpiredTimer()local integer Gb=GetHandleId(ti)local item it=LoadItemHandle(wx,1,Gb)local integer ID=LoadInteger(wx,2,Gb)local integer xt=LoadInteger(wx,3,Gb)local unit u=LoadUnitHandle(wx,4,Gb)local integer Nt=GetUnitUserData(u)local real x=GetItemX(it)local real y=GetItemY(it)local group g=CreateGroup()local integer UnitIDlocal integer Jblocal item tlocal unit flocal unit clocal unit cc=gv[Nt]local unit bt=Wo[Nt]local unit zlocal boolean b=falselocal boolean Bt=falseset g=cN('n002')loopset f=FirstOfGroup(g)exitwhen f==nullif GetUnitUserData(f)==Nt thenset c=fendifcall GroupRemoveUnit(g,f)endloopcall DestroyGroup(g)if GetWidgetLife(it)!=1 thenif it==null thenreturnendifif UnitHasItem(c,it)or UnitHasItem(cc,it)or UnitHasItem(bt,it)thencall SetWidgetLife(it,1)if UnitHasItem(c,it)thenset z=cendifif UnitHasItem(cc,it)thenset z=ccendifif UnitHasItem(bt,it)thenset z=btendifcall UnitRemoveItem(z,it)call SaveBoolean(wx,GetHandleId(it),GetHandleId(z),true)returnelseif xt==0 thenset z=It(it)if z!=null thencall SetWidgetLife(it,1)call UnitRemoveItem(z,it)call SaveBoolean(wx,GetHandleId(it),GetHandleId(z),true)returnendifelseset z=It(it)if z!=null thenset Bt=trueendifendifendifendifif LoadBoolean(wx,GetHandleId(it),GetHandleId(u))thenset b=truecall SaveBoolean(wx,GetHandleId(it),GetHandleId(u),false)endifset Jb=GetItemCharges(it)call RemoveItem(it)if Bt thenset x=GetUnitX(z)set y=GetUnitY(z)endifset t=CreateItem(ID,x,y)call SetItemCharges(t,Jb)call SetItemUserData(t,xt)if b thencall UnitAddItem(u,t)endifcall DestroyTimer(ti)set t=nullset it=nullset ti=nullset f=nullset c=nullset u=nullset g=nullset z=nullendfunctionfunction ct takes nothing returns nothinglocal unit u=GetManipulatingUnit()local item it=GetManipulatedItem()local integer ot=GetItemTypeId(it)local integer Ct=Md(ot,true)local timer ti=CreateTimer()local integer Gb=GetHandleId(ti)call SaveItemHandle(wx,1,Gb,it)call SaveInteger(wx,2,Gb,Ct)call SaveInteger(wx,3,Gb,GetItemUserData(it))call SaveUnitHandle(wx,4,Gb,u)call TimerStart(ti,.0,false,function At)set u=nullset it=nullset ti=nullendfunctionfunction Dt takes integer id returns booleanreturn id=='vamp' or id=='tdex' or id=='tint' or id=='tstr'endfunctionfunction ft takes integer id returns integerif id=='vamp' thenreturn'I07G'endifif id=='tdex' thenreturn'I07H'endifif id=='tint' thenreturn'I07I'endifif id=='tstr' thenreturn'I07J'endifreturn 0endfunctionfunction Ft takes nothing returns integer	local integer r	set r=GetRandomInt(0,'d')	if r<8 and Sx then		return'I06K'	endif	set r=GetRandomInt(0,'d')	if r<9 then		return'I06H'	endif	set r=GetRandomInt(0,'d')	if r<$A then		return'I07F'	endif	set r=GetRandomInt(0,'d')	if r<$B then		return'I01C'	endif	set r=GetRandomInt(0,'d')	if r<$C then		return'I066'	endif	set r=GetRandomInt(0,'d')	if r<$D then		return'I06P'	endif	set r=GetRandomInt(0,'d')	if r<$E then		return'I068'	endif	set r=GetRandomInt(0,'d')	if r<$F then		return'I06E'	endif	set r=GetRandomInt(0,'d')	if r<16 then		return'I06N'	endif	set r=GetRandomInt(0,'d')	if r<17 then		return'I06G'	endif	set r=GetRandomInt(0,'d')	if r<18 then		return'I06F'	endif	set r=GetRandomInt(0,'d')	if r<19 then		return'I067'	endif	set r=GetRandomInt(0,'d')	if r<20 then		return'I06I'	endif	set r=GetRandomInt(0,'d')	if r<21 then		return'I069'	endif	set r=GetRandomInt(0,'d')	if r<=50 then		return'I06D'	else		return'I06C'	endifendfunctionfunction gt takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer Gb=GetHandleId(t)local real x=LoadReal(wx,1,Gb)local real y=LoadReal(wx,2,Gb)local integer id=LoadInteger(wx,3,Gb)call CreateItem(id,x,y)call FlushChildHashtable(wx,Gb)call DestroyTimer(t)set t=nullendfunctionfunction Gt takes nothing returns nothinglocal unit u=GetManipulatingUnit()local item it=GetManipulatedItem()local real x=GetItemX(it)local real y=GetItemY(it)local integer id=GetItemTypeId(it)local integer DC=GetUnitUserData(u)local timer t=CreateTimer()local integer Gb=GetHandleId(t)local integer randomlocal integer idNewItemif Dt(id)thenif jb(u)==false thenif gv[DC]!=null and GetWidgetLife(gv[DC])>.405 and To[DC]thencall UnitAddItemById(gv[DC],ft(id))elsecall SaveReal(wx,1,Gb,x)call SaveReal(wx,2,Gb,y)call SaveInteger(wx,3,Gb,id)call TimerStart(t,.0,false,function gt)endifelsecall UnitAddItemById(u,ft(id))endifendifif id=='rspl' thencall UnitAddItemById(GetManipulatingUnit(),Ft())endifset t=nullset it=nullset u=nullendfunctionfunction Ht takes nothing returns booleanreturn GetItemTypeId(GetManipulatedItem())=='I00Z'endfunctionfunction jt takes nothing returns nothing	local integer array Jt	local integer array kt	local integer In=1	local unit u=GetTriggerUnit()	local item it=GetManipulatedItem()	set kt[1]='A01O'	set Jt[1]='H002'	set kt[2]='A03Z'	set Jt[2]='O002'	set kt[3]='A05S'	set Jt[3]='U002'	set kt[4]='A08E'	set Jt[4]='E002'	set kt[5]='A06P'	set Jt[5]='E005'	set kt[6]='A08J'	set Jt[6]='H00A'	set kt[7]='A08M'	set Jt[7]='H00B'	set kt[8]='A08P'	set Jt[8]='H001'	set kt[9]='A02X'	set Jt[9]='H007'	set kt[$A]='A091'	set Jt[$A]='N00H'	set kt[$B]='A094'	set Jt[$B]='N018'	set kt[$C]='A09N'	set Jt[$C]='E00B'	set Jt[$D]='U00A'	set kt[$D]='A0DF'	set Jt[$E]='E00F'	set kt[$E]='A0DW'	set Jt[$F]='O00G'	set kt[$F]='A0ID'	call TriggerSleepAction(.5)	if UnitHasItemOfTypeBJ(u,GetItemTypeId(it))then		loop			exitwhen In>$F			if GetUnitTypeId(u)==Jt[In]then				call UnitAddAbility(u,kt[In])				if In==$C then					set se=true				endif			endif			set In=In+1		endloop	endif	set it=null	set u=nullendfunctionfunction lt takes nothing returns booleanreturn GetItemTypeId(GetManipulatedItem())=='I00Z'endfunctionfunction Lt takes nothing returns nothing	local integer array Jt	local integer array kt	local integer In	local integer LC=0	local unit u=GetTriggerUnit()	local item it=GetManipulatedItem()	set kt[1]='A01O'	set Jt[1]='H002'	set kt[2]='A03Z'	set Jt[2]='O002'	set kt[3]='A05S'	set Jt[3]='U002'	set kt[4]='A08E'	set Jt[4]='E002'	set kt[5]='A06P'	set Jt[5]='E005'	set kt[6]='A08J'	set Jt[6]='H00A'	set kt[7]='A08M'	set Jt[7]='H00B'	set kt[8]='A08P'//	if g_flag_b or g_flag_tk then//		set Jt[8]='H00T'//	else	set Jt[8]='H001'//	endif	set kt[9]='A02X'//	if g_flag_b or g_flag_tk then//		set Jt[9]='H00Y'//	else	set Jt[9]='H007'//	endif	set kt[$A]='A091'	set Jt[$A]='N00H'	set kt[$B]='A094'	set Jt[$B]='N018'	set kt[$C]='A09N'	set Jt[$C]='E00B'	set Jt[$D]='U00A'	set kt[$D]='A0DF'	set Jt[$E]='E00F'	set kt[$E]='A0DW'	set Jt[$F]='O00G'	set kt[$F]='A0ID'	set In=0	loop		exitwhen In>5		if GetItemTypeId(UnitItemInSlot(u,In))=='I00Z' then			set LC=LC+1		endif		set In=In+1	endloop	call TriggerSleepAction(.5)	set In=1	if LC<=1 then		loop			exitwhen In>$F			if GetUnitTypeId(u)==Jt[In]then				call UnitRemoveAbility(u,kt[In])				if In==$C then					set se=false				endif			endif			set In=In+1		endloop	endif	set it=null	set u=nullendfunctionfunction Mt takes nothing returns booleanreturn(hv<=7)endfunctionfunction pt takes nothing returns nothingcall CustomDefeatBJ(GetTriggerPlayer(),"")endfunction//function qt takes nothing returns nothing//local player p=GetTriggerPlayer()//local integer i=GetPlayerId(p)//if Yo[i]!=true then//set Yo[i]=true//call DisplayTextToPlayer(p,0,0,"debug log enabled, txt file saved in C:\\Log_LiA\\Debug//thank you for using")//endif//set p=null//endfunctionfunction St takes nothing returns nothinglocal string ddif GetDyingUnit()!=null thenif GetOwningPlayer(GetDyingUnit())!=Player($B)or GetUnitUserData(GetDyingUnit())!=0 thenset dd=GetUnitName(GetDyingUnit())+" Dying"call sN(dd)returnendifendifif GetManipulatingUnit()!=null and GetManipulatedItem()!=null thenset dd="Unit "+GetUnitName(GetManipulatingUnit())+" USE "+GetItemName(GetManipulatedItem())call sN(dd)returnendifif GetSpellAbilityUnit()!=null thenset dd="Unit "+GetUnitName(GetSpellAbilityUnit())+" SPELL EFFECT "+GetObjectName(GetSpellAbilityId())call sN(dd)returnendifif GetTriggerPlayer()!=null and GetPlayerSlotState(GetTriggerPlayer())!=PLAYER_SLOT_STATE_PLAYING thenset dd="Player "+GetPlayerName(GetTriggerPlayer())+" Leave"call sN(dd)returnendifif GetTriggerPlayer()!=null and GetPlayerSlotState(GetTriggerPlayer())==PLAYER_SLOT_STATE_PLAYING and GetTriggerPlayer()!=Player($B)thenset dd=GetPlayerName(GetTriggerPlayer())+" : "+GetEventPlayerChatString()call sN(dd)returnendifset dd=nullendfunctionfunction Ut takes nothing returns nothing	local player p=GetTriggerPlayer()	local integer rC=me[GetPlayerId(p)+1]	local integer In=1	loop		exitwhen In>8		call SaveBoolean(wx,rC,StringHash("p"+I2S(rC)+"or"+I2S(In)),false)		set In=In+1	endloop	call Nd(p)	if tv==false and Sx then		call cb(p,av)	endif	set p=nullendfunctionfunction Yt takes nothing returns nothingcall CameraSetupApplyForPlayer(true,Nn,GetEnumPlayer(),.0)endfunctionfunction zt takes nothing returns nothingcall ForForce(bj_FORCE_ALL_PLAYERS,function Yt)endfunctionfunction vT takes nothing returns nothinglocal unit dy=GetDyingUnit()local integer DC=GetUnitUserData(dy)local player p=GetOwningPlayer(dy)if tv==false and IsUnitType(dy,UNIT_TYPE_HERO)and DC!=$B and DC!=$C and p!=Player($B)thenif Sx thenset To[DC]=falsecall GroupAddUnit(rr,dy)if GetOwningPlayer(GetKillingUnit())==Player($B)thenset Lv[DC]=Lv[DC]+1endifif((UB())and(ce or Pv))thencall rc()endifcall mB()call TriggerExecute(RR)endif//if g_flag_b or g_flag_tk then//set To[DC]=false//endifendifset dy=nullset p=nullendfunctionfunction RunInitializationTriggers takes nothing returns nothing	call ConditionalTriggerExecute(trig_MapInitialization)endfunctionfunction InitCustomTeams takes nothing returns nothing	call SetPlayerTeam(Player(0),0)	call SetPlayerState(Player(0),PLAYER_STATE_ALLIED_VICTORY,1)	call SetPlayerTeam(Player(1),0)	call SetPlayerState(Player(1),PLAYER_STATE_ALLIED_VICTORY,1)	call SetPlayerTeam(Player(2),0)	call SetPlayerState(Player(2),PLAYER_STATE_ALLIED_VICTORY,1)	call SetPlayerTeam(Player(3),0)	call SetPlayerState(Player(3),PLAYER_STATE_ALLIED_VICTORY,1)	call SetPlayerTeam(Player(4),0)	call SetPlayerState(Player(4),PLAYER_STATE_ALLIED_VICTORY,1)	call SetPlayerTeam(Player(5),0)	call SetPlayerState(Player(5),PLAYER_STATE_ALLIED_VICTORY,1)	call SetPlayerTeam(Player(6),0)	call SetPlayerState(Player(6),PLAYER_STATE_ALLIED_VICTORY,1)	call SetPlayerTeam(Player(7),0)	call SetPlayerState(Player(7),PLAYER_STATE_ALLIED_VICTORY,1)	call SetPlayerAllianceStateAllyBJ(Player(0),Player(1),true)	call SetPlayerAllianceStateAllyBJ(Player(0),Player(2),true)	call SetPlayerAllianceStateAllyBJ(Player(0),Player(3),true)	call SetPlayerAllianceStateAllyBJ(Player(0),Player(4),true)	call SetPlayerAllianceStateAllyBJ(Player(0),Player(5),true)	call SetPlayerAllianceStateAllyBJ(Player(0),Player(6),true)	call SetPlayerAllianceStateAllyBJ(Player(0),Player(7),true)	call SetPlayerAllianceStateAllyBJ(Player(1),Player(0),true)	call SetPlayerAllianceStateAllyBJ(Player(1),Player(2),true)	call SetPlayerAllianceStateAllyBJ(Player(1),Player(3),true)	call SetPlayerAllianceStateAllyBJ(Player(1),Player(4),true)	call SetPlayerAllianceStateAllyBJ(Player(1),Player(5),true)	call SetPlayerAllianceStateAllyBJ(Player(1),Player(6),true)	call SetPlayerAllianceStateAllyBJ(Player(1),Player(7),true)	call SetPlayerAllianceStateAllyBJ(Player(2),Player(0),true)	call SetPlayerAllianceStateAllyBJ(Player(2),Player(1),true)	call SetPlayerAllianceStateAllyBJ(Player(2),Player(3),true)	call SetPlayerAllianceStateAllyBJ(Player(2),Player(4),true)	call SetPlayerAllianceStateAllyBJ(Player(2),Player(5),true)	call SetPlayerAllianceStateAllyBJ(Player(2),Player(6),true)	call SetPlayerAllianceStateAllyBJ(Player(2),Player(7),true)	call SetPlayerAllianceStateAllyBJ(Player(3),Player(0),true)	call SetPlayerAllianceStateAllyBJ(Player(3),Player(1),true)	call SetPlayerAllianceStateAllyBJ(Player(3),Player(2),true)	call SetPlayerAllianceStateAllyBJ(Player(3),Player(4),true)	call SetPlayerAllianceStateAllyBJ(Player(3),Player(5),true)	call SetPlayerAllianceStateAllyBJ(Player(3),Player(6),true)	call SetPlayerAllianceStateAllyBJ(Player(3),Player(7),true)	call SetPlayerAllianceStateAllyBJ(Player(4),Player(0),true)	call SetPlayerAllianceStateAllyBJ(Player(4),Player(1),true)	call SetPlayerAllianceStateAllyBJ(Player(4),Player(2),true)	call SetPlayerAllianceStateAllyBJ(Player(4),Player(3),true)	call SetPlayerAllianceStateAllyBJ(Player(4),Player(5),true)	call SetPlayerAllianceStateAllyBJ(Player(4),Player(6),true)	call SetPlayerAllianceStateAllyBJ(Player(4),Player(7),true)	call SetPlayerAllianceStateAllyBJ(Player(5),Player(0),true)	call SetPlayerAllianceStateAllyBJ(Player(5),Player(1),true)	call SetPlayerAllianceStateAllyBJ(Player(5),Player(2),true)	call SetPlayerAllianceStateAllyBJ(Player(5),Player(3),true)	call SetPlayerAllianceStateAllyBJ(Player(5),Player(4),true)	call SetPlayerAllianceStateAllyBJ(Player(5),Player(6),true)	call SetPlayerAllianceStateAllyBJ(Player(5),Player(7),true)	call SetPlayerAllianceStateAllyBJ(Player(6),Player(0),true)	call SetPlayerAllianceStateAllyBJ(Player(6),Player(1),true)	call SetPlayerAllianceStateAllyBJ(Player(6),Player(2),true)	call SetPlayerAllianceStateAllyBJ(Player(6),Player(3),true)	call SetPlayerAllianceStateAllyBJ(Player(6),Player(4),true)	call SetPlayerAllianceStateAllyBJ(Player(6),Player(5),true)	call SetPlayerAllianceStateAllyBJ(Player(6),Player(7),true)	call SetPlayerAllianceStateAllyBJ(Player(7),Player(0),true)	call SetPlayerAllianceStateAllyBJ(Player(7),Player(1),true)	call SetPlayerAllianceStateAllyBJ(Player(7),Player(2),true)	call SetPlayerAllianceStateAllyBJ(Player(7),Player(3),true)	call SetPlayerAllianceStateAllyBJ(Player(7),Player(4),true)	call SetPlayerAllianceStateAllyBJ(Player(7),Player(5),true)	call SetPlayerAllianceStateAllyBJ(Player(7),Player(6),true)	call SetPlayerAllianceStateVisionBJ(Player(0),Player(1),true)	call SetPlayerAllianceStateVisionBJ(Player(0),Player(2),true)	call SetPlayerAllianceStateVisionBJ(Player(0),Player(3),true)	call SetPlayerAllianceStateVisionBJ(Player(0),Player(4),true)	call SetPlayerAllianceStateVisionBJ(Player(0),Player(5),true)	call SetPlayerAllianceStateVisionBJ(Player(0),Player(6),true)	call SetPlayerAllianceStateVisionBJ(Player(0),Player(7),true)	call SetPlayerAllianceStateVisionBJ(Player(1),Player(0),true)	call SetPlayerAllianceStateVisionBJ(Player(1),Player(2),true)	call SetPlayerAllianceStateVisionBJ(Player(1),Player(3),true)	call SetPlayerAllianceStateVisionBJ(Player(1),Player(4),true)	call SetPlayerAllianceStateVisionBJ(Player(1),Player(5),true)	call SetPlayerAllianceStateVisionBJ(Player(1),Player(6),true)	call SetPlayerAllianceStateVisionBJ(Player(1),Player(7),true)	call SetPlayerAllianceStateVisionBJ(Player(2),Player(0),true)	call SetPlayerAllianceStateVisionBJ(Player(2),Player(1),true)	call SetPlayerAllianceStateVisionBJ(Player(2),Player(3),true)	call SetPlayerAllianceStateVisionBJ(Player(2),Player(4),true)	call SetPlayerAllianceStateVisionBJ(Player(2),Player(5),true)	call SetPlayerAllianceStateVisionBJ(Player(2),Player(6),true)	call SetPlayerAllianceStateVisionBJ(Player(2),Player(7),true)	call SetPlayerAllianceStateVisionBJ(Player(3),Player(0),true)	call SetPlayerAllianceStateVisionBJ(Player(3),Player(1),true)	call SetPlayerAllianceStateVisionBJ(Player(3),Player(2),true)	call SetPlayerAllianceStateVisionBJ(Player(3),Player(4),true)	call SetPlayerAllianceStateVisionBJ(Player(3),Player(5),true)	call SetPlayerAllianceStateVisionBJ(Player(3),Player(6),true)	call SetPlayerAllianceStateVisionBJ(Player(3),Player(7),true)	call SetPlayerAllianceStateVisionBJ(Player(4),Player(0),true)	call SetPlayerAllianceStateVisionBJ(Player(4),Player(1),true)	call SetPlayerAllianceStateVisionBJ(Player(4),Player(2),true)	call SetPlayerAllianceStateVisionBJ(Player(4),Player(3),true)	call SetPlayerAllianceStateVisionBJ(Player(4),Player(5),true)	call SetPlayerAllianceStateVisionBJ(Player(4),Player(6),true)	call SetPlayerAllianceStateVisionBJ(Player(4),Player(7),true)	call SetPlayerAllianceStateVisionBJ(Player(5),Player(0),true)	call SetPlayerAllianceStateVisionBJ(Player(5),Player(1),true)	call SetPlayerAllianceStateVisionBJ(Player(5),Player(2),true)	call SetPlayerAllianceStateVisionBJ(Player(5),Player(3),true)	call SetPlayerAllianceStateVisionBJ(Player(5),Player(4),true)	call SetPlayerAllianceStateVisionBJ(Player(5),Player(6),true)	call SetPlayerAllianceStateVisionBJ(Player(5),Player(7),true)	call SetPlayerAllianceStateVisionBJ(Player(6),Player(0),true)	call SetPlayerAllianceStateVisionBJ(Player(6),Player(1),true)	call SetPlayerAllianceStateVisionBJ(Player(6),Player(2),true)	call SetPlayerAllianceStateVisionBJ(Player(6),Player(3),true)	call SetPlayerAllianceStateVisionBJ(Player(6),Player(4),true)	call SetPlayerAllianceStateVisionBJ(Player(6),Player(5),true)	call SetPlayerAllianceStateVisionBJ(Player(6),Player(7),true)	call SetPlayerAllianceStateVisionBJ(Player(7),Player(0),true)	call SetPlayerAllianceStateVisionBJ(Player(7),Player(1),true)	call SetPlayerAllianceStateVisionBJ(Player(7),Player(2),true)	call SetPlayerAllianceStateVisionBJ(Player(7),Player(3),true)	call SetPlayerAllianceStateVisionBJ(Player(7),Player(4),true)	call SetPlayerAllianceStateVisionBJ(Player(7),Player(5),true)	call SetPlayerAllianceStateVisionBJ(Player(7),Player(6),true)	call SetPlayerTeam(Player(11),1)	call SetPlayerState(Player(11),PLAYER_STATE_ALLIED_VICTORY,1)endfunction// Инициализация триггеровfunction CreateTriggers takes nothing returns nothing	local integer i	local player p		set CommandLineTeleport = CreateTrigger()	set CommandLineRandom = CreateTrigger()	set CommandLineSpeed = CreateTrigger()	set CommandLineReady = CreateTrigger()	set CommandLineClear = CreateTrigger()	set CommandLineRepick = CreateTrigger()	set CommandLineZoom = CreateTrigger()		set i = 8	loop		set i = i - 1		set p = Player(i)		if GetPlayerSlotState(p) == PLAYER_SLOT_STATE_PLAYING and GetPlayerController(p) == MAP_CONTROL_USER then			call TriggerRegisterPlayerChatEvent(CommandLineTeleport, p, "-тп", true)			call TriggerRegisterPlayerChatEvent(CommandLineTeleport, p, "-ТП", true)			call TriggerRegisterPlayerChatEvent(CommandLineTeleport, p, "-tp", true)			call TriggerRegisterPlayerChatEvent(CommandLineTeleport, p, "-TP", true)			call TriggerRegisterPlayerEventEndCinematic(CommandLineTeleport, p)						call TriggerRegisterPlayerChatEvent(CommandLineRandom, p ,"-с", true)			call TriggerRegisterPlayerChatEvent(CommandLineRandom, p, "-c", true)						call TriggerRegisterPlayerChatEvent(CommandLineSpeed, p, "-сп", true)			call TriggerRegisterPlayerChatEvent(CommandLineSpeed, p, "-sp", true)						call TriggerRegisterPlayerChatEvent(CommandLineReady, p, "+", true)						call TriggerRegisterPlayerChatEvent(CommandLineClear, p, "-о", true)			call TriggerRegisterPlayerChatEvent(CommandLineClear, p, "-o", true)						call TriggerRegisterPlayerChatEvent(CommandLineRepick, p, "-ре", true)			call TriggerRegisterPlayerChatEvent(CommandLineRepick, p, "-re", true)						call TriggerRegisterPlayerChatEvent(CommandLineZoom, p, "-зум", false)		endif		exitwhen i == 0	endloop	call TriggerAddCondition(CommandLineTeleport,Condition(function Ds))	call TriggerAddAction(CommandLineTeleport, function TeleportToCenterArena)	call DisableTrigger(CommandLineTeleport)		call TriggerAddAction(CommandLineRandom, function PickRandomHero)	call DisableTrigger(CommandLineRandom)		call TriggerAddAction(CommandLineSpeed,function DisplayHeroSpeed)		call TriggerAddAction(CommandLineReady,function tP)	call DisableTrigger(CommandLineReady)		call TriggerAddAction(CommandLineClear,function ClearDisplay)		call TriggerAddAction(CommandLineRepick,function RepickHero)	call DisableTrigger(CommandLineRepick)	call TriggerAddAction(CommandLineZoom,function setZoom)endfunctionfunction main takes nothing returns nothing	local integer i	local integer pN	local integer PN	local version v	local integer HN	local integer Af	local integer zb	call SetCameraBounds(-3328.+GetCameraMargin(CAMERA_MARGIN_LEFT),-3584.+GetCameraMargin(CAMERA_MARGIN_BOTTOM),3328.-GetCameraMargin(CAMERA_MARGIN_RIGHT),3072.-GetCameraMargin(CAMERA_MARGIN_TOP),-3328.+GetCameraMargin(CAMERA_MARGIN_LEFT),3072.-GetCameraMargin(CAMERA_MARGIN_TOP),3328.-GetCameraMargin(CAMERA_MARGIN_RIGHT),-3584.+GetCameraMargin(CAMERA_MARGIN_BOTTOM))	call SetDayNightModels("Environment\\DNC\\DNCLordaeron\\DNCLordaeronTerrain\\DNCLordaeronTerrain.mdl","Environment\\DNC\\DNCLordaeron\\DNCLordaeronUnit\\DNCLordaeronUnit.mdl")	call SetTerrainFogEx(0,3000.,5000.,.5,.0,.0,.0)	call NewSoundEnvironment("Default")	call SetAmbientDaySound("CityScapeDay")	call SetAmbientNightSound("CityScapeNight")	call SetMapMusic("Music",true,0)	set Hr=Rect(-960.,-3616.,3328.,-1376.)	set jr=Rect(-3424.,-1376.,1504.,3168.)	set Jr=Rect(-3264.,-64.,-2432.,896.)	set kr=Rect(-1216.,2272.,-192.,2976.)	set Kr=Rect(-2400.,-608.,-2272.,-480.)	set lr=Rect(-1888.,-800.,-1760.,-672.)	set Lr=Rect(-1696.,288.,-1568.,416.)	set mr=Rect(-2208.,1888.,-2080.,2016.)	set Mr=Rect(224.,-608.,352.,-480.)	set pr=Rect(736.,1376.,864.,1504.)	set Pr=Rect(-3424.,-3648.,-960.,-1344.)	set qr=Rect(96.,-2816.,800.,-2144.)	set Qr=Rect(-2560.,-3072.,-1728.,-2752.)	set sr=Rect(-2272.,-2240.,-2016.,-1984.)	set Sr=Rect(-2784.,-960.,1248.,2528.)	set tr=Rect(2336.,-224.,2400.,-160.)	set Tr=Rect(2592.,-352.,2656.,-288.)	set ur=Rect(2080.,-480.,2144.,-416.)	set Ur=Rect(2240.,-416.,2304.,-352.)	set wr=Rect(1504.,-1120.,3296.,512.)	set Wr=Rect(-960.,-3360.,1472.,-1344.)	set yr=Rect(1312.,-3584.,3264.,-2368.)	set Yr=Rect(-2144.,-2592.,-2112.,-2560.)	set zr=Rect(2496.,-544.,2560.,-480.)	set Zr=Rect(1984.,-672.,2048.,-608.)	set vi=Rect(-960.,672.,-608.,1088.)	set ei=Rect(1440.,-1504.,3328.,3136.)	set xi=Rect(-2880.,1760.,-2464.,2368.)	set oi=Rect(608.,-960.,1184.,-384.)	set ri=Rect(-832.,-1184.,-512.,-896.)	set ii=Rect(896.,800.,1216.,1088.)	set ai=Rect(-480.,96.,-192.,352.)	set ni=Rect(-1792.,-416.,-1504.,-160.)	set Vi=Rect(-2624.,-1088.,-2464.,-928.)	set Ei=Rect(-2912.,416.,-2656.,672.)	set Xi=Rect(-1632.,960.,-1312.,1312.)	set Oi=Rect(32.,1792.,416.,2144.)	set Ri=Rect(-1216.,2272.,-864.,2656.)	set Ii=Rect(-2880.,2432.,-2752.,2560.)	set Ai=Rect(-2880.,1504.,-2752.,1632.)	set Ni=Rect(1120.,-256.,1216.,-160.)	set bi=Rect(1120.,-1088.,1216.,-992.)	set Bi=Rect(-2592.,-2304.,-1728.,-1952.)	set ci=Rect(2304.,2048.,2432.,2176.)	set Ci=Rect(-3008.,-3232.,-1376.,-1632.)//	set di=Rect(2336.,-3200.,2432.,-3104.)//	set Di=Rect(2720.,-3200.,2816.,-3104.)//	set fi=Rect(1952.,-3200.,2048.,-3104.)	set qi=Rect(-608.,-2368.,-320.,-2112.)	set Qi=Rect(-3264.,-1472.,-832.,-1216.)	set si=Rect(64.,2752.,1440.,3008.)	set Si=Rect(-800.,-3008.,-768.,-2976.)	set Ti=Rect(2432.,-3008.,2560.,-2912.)	set ui=Rect(1792.,-3616.,3168.,-2304.)	set Ui=Rect(2464.,-3008.,2528.,-2976.)	set wi=Rect(-1216.,-3648.,-960.,-1440.)	set Wi=Rect(-3424.,-3648.,-1152.,-3392.)	set yi=Rect(-3424.,-1472.,-832.,-1216.)	set Yi=Rect(-3424.,-3424.,-3136.,-1440.)	set zi=Rect(-3424.,-1248.,-3008.,-192.)	set Zi=Rect(-3424.,-224.,-3136.,-64.)	set va=Rect(-3424.,-96.,-3264.,64.)	set ea=Rect(-960.,-2752.,-704.,-2112.)	set xa=Rect(-192.,-1472.,1504.,-1216.)	set oa=Rect(-960.,-3616.,1216.,-3264.)	set ra=Rect(1184.,-3616.,1344.,-3392.)	set ia=Rect(1312.,-3616.,3328.,-3520.)	set aa=Rect(3264.,-3616.,3328.,-2336.)	set na=Rect(1472.,-2368.,3328.,-1088.)	set Va=Rect(1344.,-1248.,1472.,3168.)	set Ea=Rect(-64.,2752.,1376.,3168.)	set Xa=Rect(-192.,2880.,-32.,3168.)	set Oa=Rect(-320.,3008.,-160.,3168.)	set Ra=Rect(-1248.,3008.,-1088.,3168.)	set Ia=Rect(-1376.,2880.,-1216.,3168.)	set Aa=Rect(-3424.,2752.,-1344.,3168.)	set Na=Rect(-3424.,1088.,-3008.,2784.)	set ba=Rect(-3424.,960.,-3136.,1120.)	set Ba=Rect(-3424.,832.,-3264.,992.)	set ca=Rect(-864.,-1504.,-160.,-1344.)	set Ca=Rect(64.,2176.,1344.,2720.)	set da=Rect(448.,1920.,1344.,2240.)	set Da=Rect(576.,1792.,1344.,1952.)	set fa=Rect(-2368.,2272.,-1472.,2688.)	set Fa=Rect(-2432.,1472.,-2112.,1984.)	set ga=Rect(-2912.,1120.,-2624.,1632.)	set Ga=Rect(-3008.,832.,-2688.,1152.)	set ha=Rect(-2112.,.0,-1760.,480.)	set Ha=Rect(-1696.,128.,-1472.,448.)	set ja=Rect(384.,640.,960.,896.)	set Ja=Rect(832.,1280.,1152.,1536.)	set ka=Rect(1024.,1152.,1312.,1312.)	set Ka=Rect(864.,-96.,1120.,480.)	set la=Rect(192.,-224.,832.,96.)	set La=Rect(96.,-1184.,608.,-832.)	set ma=Rect(224.,-672.,512.,-480.)	set Ma=Rect(-1664.,-1152.,-1280.,-896.)	set pa=Rect(-2912.,-1088.,-2464.,-672.)	set Pa=Rect(-2528.,-704.,-2240.,-512.)	set qa=Rect(-2976.,-672.,-2624.,-288.)	set Qa=Rect(-2816.,-352.,-2432.,-64.)	set sa=Rect(-2880.,2496.,-2336.,2688.)	set Sa=Rect(-1184.,1024.,-928.,1472.)	set Ta=Rect(-704.,992.,-320.,1536.)	set ua=Rect(-704.,256.,-352.,736.)	set Ua=Rect(-1280.,224.,-896.,672.)	set wa=Rect(640.,1664.,768.,1824.)	set Wa=Rect(1152.,1024.,1312.,1184.)	set ya=Rect(320.,512.,448.,672.)	set Ya=Rect(512.,1152.,640.,1408.)	set za=Rect(448.,896.,640.,1152.)	set Za=Rect(576.,256.,736.,416.)	set vn=Rect(768.,-224.,928.,-64.)	set en=Rect(960.,-288.,1088.,-96.)	set xn=Rect(1024.,-384.,1152.,-256.)	set on=Rect(992.,-608.,1152.,-448.)	set rn=Rect(-448.,640.,-320.,768.)	set in=Rect(-384.,960.,-256.,1088.)	set an=Rect(-1312.,928.,-1184.,1312.)	set nn=Rect(-1440.,1120.,-1280.,1280.)	set Vn=Rect(-1504.,2432.,-1408.,2560.)	set En=Rect(-2272.,-672.,-2112.,-512.)	set Xn=Rect(-1984.,-704.,-1824.,-544.)	set On=Rect(-1792.,-1216.,-1632.,-800.)	set Rn=Rect(-4096.,128.,-3616.,768.)	set An=Rect(-1024.,3616.,-384.,4096.)	set Nn=CreateCameraSetup()	call CameraSetupSetField(Nn,CAMERA_FIELD_ZOFFSET,90.,.0)	call CameraSetupSetField(Nn,CAMERA_FIELD_ROTATION,90.,.0)	call CameraSetupSetField(Nn,CAMERA_FIELD_ANGLE_OF_ATTACK,340.,.0)	call CameraSetupSetField(Nn,CAMERA_FIELD_TARGET_DISTANCE,1363.6,.0)	call CameraSetupSetField(Nn,CAMERA_FIELD_ROLL,.0,.0)	call CameraSetupSetField(Nn,CAMERA_FIELD_FIELD_OF_VIEW,70.,.0)	call CameraSetupSetField(Nn,CAMERA_FIELD_FARZ,5000.,.0)	call CameraSetupSetDestPosition(Nn,2354.5,-53.,.0)	set bn=CreateCameraSetup()	call CameraSetupSetField(bn,CAMERA_FIELD_ZOFFSET,.0,.0)	call CameraSetupSetField(bn,CAMERA_FIELD_ROTATION,90.,.0)	call CameraSetupSetField(bn,CAMERA_FIELD_ANGLE_OF_ATTACK,304.,.0)	call CameraSetupSetField(bn,CAMERA_FIELD_TARGET_DISTANCE,1650.,.0)	call CameraSetupSetField(bn,CAMERA_FIELD_ROLL,.0,.0)	call CameraSetupSetField(bn,CAMERA_FIELD_FIELD_OF_VIEW,70.,.0)	call CameraSetupSetField(bn,CAMERA_FIELD_FARZ,5000.,.0)	call CameraSetupSetDestPosition(bn,2488.6,-3024.1,.0)	set yI=CreateDestructable('LTba',1024.,-192.,1.,1.096,0)	set YI=CreateDestructable('LTba',1088.,-320.,240.,1.183,1)	set SI=CreateDestructable('LTbx',-2784.,1696.,178.,1.252,0)	set sI=CreateDestructable('LTbx',-2720.,1632.,253.,1.12,0)	set QI=CreateDestructable('LTbx',-2720.,1568.,358.,1.184,0)	set UI=CreateDestructable('LTex',-1824.,-736.,295.,1.203,0)	set wI=CreateDestructable('LTex',-2336.,-544.,52.,1.215,0)	set WI=CreateDestructable('LTex',864.,1376.,35.,1.231,0)	set tI=CreateDestructable('LTex',-2144.,1952.,301.,1.421,0)	set uI=CreateDestructable('LTex',-1632.,352.,107.,1.176,0)	set TI=CreateDestructable('LTex',288.,-544.,49.,1.145,0)	call ConfigureNeutralVictim()	set eN=Filter(function mN)	set filterIssueHauntOrderAtLocBJ=Filter(function IssueHauntOrderAtLocBJFilter)	set filterEnumDestructablesInCircleBJ=Filter(function XN)	set filterGetUnitsInRectOfPlayer=Filter(function GetUnitsInRectOfPlayerFilter)	set filterGetUnitsOfTypeIdAll=Filter(function GetUnitsOfTypeIdAllFilter)	set filterGetUnitsOfPlayerAndTypeId=Filter(function GetUnitsOfPlayerAndTypeIdFilter)	set filterMeleeTrainedUnitIsHeroBJ=Filter(function MeleeTrainedUnitIsHeroBJFilter)	set filterLivingPlayerUnitsOfTypeId=Filter(function LivingPlayerUnitsOfTypeIdFilter)	set pN=0	loop		exitwhen pN==16		set bj_FORCE_PLAYER[pN]=CreateForce()		call ForceAddPlayer(bj_FORCE_PLAYER[pN],Player(pN))		set pN=pN+1	endloop	set bj_FORCE_ALL_PLAYERS=CreateForce()	call ForceEnumPlayers(bj_FORCE_ALL_PLAYERS,null)	set bj_cineModePriorSpeed=GetGameSpeed()	set bj_cineModePriorFogSetting=IsFogEnabled()	set bj_cineModePriorMaskSetting=IsFogMaskEnabled()	set pN=0	loop		exitwhen pN>=bj_MAX_QUEUED_TRIGGERS		set bj_queuedExecTriggers[pN]=null		set bj_queuedExecUseConds[pN]=false		set pN=pN+1	endloop	set bj_isSinglePlayer=false	set PN=0	set pN=0	loop		exitwhen pN>=$C		if(GetPlayerController(Player(pN))==MAP_CONTROL_USER and GetPlayerSlotState(Player(pN))==PLAYER_SLOT_STATE_PLAYING)then			set PN=PN+1		endif		set pN=pN+1	endloop	set bj_isSinglePlayer=(PN==1)	set bj_rescueSound=CreateSoundFromLabel("Rescue",false,false,false,$2710,$2710)	set bj_questDiscoveredSound=CreateSoundFromLabel("QuestNew",false,false,false,$2710,$2710)	set bj_questUpdatedSound=CreateSoundFromLabel("QuestUpdate",false,false,false,$2710,$2710)	set bj_questCompletedSound=CreateSoundFromLabel("QuestCompleted",false,false,false,$2710,$2710)	set bj_questFailedSound=CreateSoundFromLabel("QuestFailed",false,false,false,$2710,$2710)	set bj_questHintSound=CreateSoundFromLabel("Hint",false,false,false,$2710,$2710)	set bj_questSecretSound=CreateSoundFromLabel("SecretFound",false,false,false,$2710,$2710)	set bj_questItemAcquiredSound=CreateSoundFromLabel("ItemReward",false,false,false,$2710,$2710)	set bj_questWarningSound=CreateSoundFromLabel("Warning",false,false,false,$2710,$2710)	set bj_victoryDialogSound=CreateSoundFromLabel("QuestCompleted",false,false,false,$2710,$2710)	set bj_defeatDialogSound=CreateSoundFromLabel("QuestFailed",false,false,false,$2710,$2710)	call DelayedSuspendDecayCreate()	set v=VersionGet()	if(v==VERSION_REIGN_OF_CHAOS)then		set bj_MELEE_MAX_TWINKED_HEROES=bj_MELEE_MAX_TWINKED_HEROES_V0	else		set bj_MELEE_MAX_TWINKED_HEROES=bj_MELEE_MAX_TWINKED_HEROES_V1	endif	call InitQueuedTriggers()	call InitRescuableBehaviorBJ()	call InitDNCSounds()	call InitMapRects()	call InitSummonableCaps()	set HN=0	loop		set bj_stockAllowedPermanent[HN]=false		set bj_stockAllowedCharged[HN]=false		set bj_stockAllowedArtifact[HN]=false		set HN=HN+1		exitwhen HN>$A	endloop	call SetAllItemTypeSlots($B)	call SetAllUnitTypeSlots($B)	set bj_stockUpdateTimer=CreateTimer()	call TimerStart(bj_stockUpdateTimer,bj_STOCK_RESTOCK_INITIAL_DELAY,false,function lN)	set bj_stockItemPurchased=CreateTrigger()	call TriggerRegisterPlayerUnitEvent(bj_stockItemPurchased,Player($F),EVENT_PLAYER_UNIT_SELL_ITEM,null)	call TriggerAddAction(bj_stockItemPurchased,function RemovePurchasedItem)	call DetectGameStarted()	call ExecuteFunc("xT")	call ExecuteFunc("uN")	call ExecuteFunc("UN")	call ExecuteFunc("fb")	set i = 0	set i = 0	loop		exitwhen(i > 8)		set Fv[i] = 0		set kv[i] = 0		set Kv[i] = 0		set lv[i] = 0		set Lv[i] = 0		set ie[i] = 0		set Ee[i] = 0		set be[i] = CreateTimer()		set Ce[i] = 0		set ge[i] = false		set Je[i] = 0		set ke[i] = false		set Ke[i] = ""		set me[i] = 0		set Ue[i] = 1		set Ze[i] = false		set vx[i] = false		set nx[i] = false		set cx[i] = false		set xo[i] = 0		set Ko[i] = 0		set lo[i] = false		set To[i] = false		set wo[i] = 0		set yo[i] = 0		set Yo[i] = false		set i = i + 1	endloop	set Gv=CreateTimer()	set i=0	loop		exitwhen(i>5)		set Yv[i]=0		set Zv[i]=0		set vo[i]=0		set i=i+1	endloop	set fe=CreateForce()	set Fe=CreateForce()	set i=0	loop		exitwhen(i>9)		set Se[i]=CreateGroup()		set i=i+1	endloop	set i=0	loop		exitwhen(i>7)		set ze[i]=false		set i=i+1	endloop	set Ex=CreateTimer()	set i=0	loop		exitwhen(i>16)		set bx[i]=""		set i=i+1	endloop	set fx=1	set Hx=CreateGroup()	set lx=CreateGroup()	set mx=CreateGroup()	set i=0	loop		exitwhen(i>46)		set g_hero_icons[i]=""		set i=i+1	endloop	set io=CreateForce()	set no=CreateGroup()	set Xo=CreateTimer()	set bo=CreateGroup()	set i=0	loop		exitwhen(i>40)		set g_Heroes[i]=0		set i=i+1	endloop	set do=1.	set fo=CreateTimer()	set ko=CreateGroup()	set qo=CreateTimer()	set zo=CreateGroup()	set rr=CreateGroup()	set ir=CreateTimer()	set Vr=CreateTimer()	set Af=0	set zb=16	call CreateTriggers()		set Bn=CreateTrigger()	loop		exitwhen Af==zb		call TriggerRegisterPlayerUnitEvent(Bn,Player(Af),EVENT_PLAYER_UNIT_DEATH,null)		set Af=Af+1	endloop	call TriggerAddAction(Bn,function Vf)	set trig_MapInitialization=CreateTrigger()	call TriggerAddAction(trig_MapInitialization,function MapInit)	set dn=CreateTrigger()	call TriggerAddAction(dn,function Hf)//	set Dn=CreateTrigger()//	call TriggerAddAction(Dn,function kf)	set Af=0	set zb=16	set fn=CreateTrigger()	loop		exitwhen Af==zb		call TriggerRegisterPlayerUnitEvent(fn,Player(Af),EVENT_PLAYER_UNIT_ATTACKED,null)		set Af=Af+1	endloop	call TriggerAddCondition(fn,Condition(function lf))	call TriggerAddAction(fn,function Lf)	set Fn=CreateTrigger()	call TriggerRegisterTimerEventPeriodic(Fn,60.)	call TriggerAddCondition(Fn,Condition(function Mf))	call TriggerAddAction(Fn,function pf)	set gn=CreateTrigger()	call TriggerRegisterEnterRectSimple(gn,Hr)	call TriggerAddAction(gn,function qf)	set Gn=CreateTrigger()	call TriggerRegisterLeaveRectSimple(Gn,Hr)	call TriggerAddAction(Gn,function sf)	set hn=CreateTrigger()	call DisableTrigger(hn)	call TriggerRegisterTimerEventPeriodic(hn,2.)	call TriggerAddCondition(hn,Condition(function tf))	call TriggerAddAction(hn,function Tf)	set Hn=CreateTrigger()	call DisableTrigger(Hn)	call TriggerRegisterGameStateEventTimeOfDay(Hn,EQUAL,12.)	call TriggerAddAction(Hn,function Uf)	set jn=CreateTrigger()	call DisableTrigger(jn)	call TriggerRegisterGameStateEventTimeOfDay(jn,EQUAL,24.)	call TriggerAddAction(jn,function Wf)	set trig_PickHost=CreateTrigger()	call TriggerRegisterTimerEvent(trig_PickHost,.01,false)	call TriggerAddAction(trig_PickHost,function PlayerPickHost)	set kn=CreateTrigger()	call TriggerRegisterTimerEvent(kn,10.,false)	call TriggerAddAction(kn,function eF)	set Kn=CreateTrigger()	call TriggerAddAction(Kn,function oF)	set Af=0	set zb=16	set ln=CreateTrigger()	loop		exitwhen Af==zb		call TriggerRegisterPlayerUnitEvent(ln,Player(Af),EVENT_PLAYER_UNIT_SELL,null)		set Af=Af+1	endloop	call TriggerAddCondition(ln,Condition(function FF))	call TriggerAddAction(ln,function PickHeroInTavern)	set Af=0	set zb=16	set Ln=CreateTrigger()	loop		exitwhen Af==zb		call TriggerRegisterPlayerUnitEvent(Ln,Player(Af),EVENT_PLAYER_HERO_REVIVE_FINISH,null)		set Af=Af+1	endloop	call TriggerAddAction(Ln,function HF)	set Af=0	set zb=16	set sV=CreateTrigger()	loop		exitwhen Af==zb		call TriggerRegisterPlayerUnitEvent(sV,Player(Af),EVENT_PLAYER_UNIT_DEATH,null)		set Af=Af+1	endloop	call DisableTrigger(sV)	call TriggerAddCondition(sV,Condition(function BH))	call TriggerAddAction(sV,function cH)	set Af=0	set zb=16	set SV=CreateTrigger()	loop		exitwhen Af==zb		call TriggerRegisterPlayerUnitEvent(SV,Player(Af),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)		set Af=Af+1	endloop	call DisableTrigger(SV)	call TriggerAddCondition(SV,Condition(function dH))	call TriggerAddAction(SV,function DH)	set Af=0	set zb=16	set tV=CreateTrigger()	loop		exitwhen Af==zb		call TriggerRegisterPlayerUnitEvent(tV,Player(Af),EVENT_PLAYER_UNIT_DEATH,null)		set Af=Af+1	endloop	call DisableTrigger(tV)	call TriggerAddCondition(tV,Condition(function FH))	call TriggerAddAction(tV,function gH)	set Af=0	set zb=16	set TV=CreateTrigger()	loop		exitwhen Af==zb		call TriggerRegisterPlayerUnitEvent(TV,Player(Af),EVENT_PLAYER_HERO_SKILL,null)		set Af=Af+1	endloop	call TriggerAddAction(TV,function hH)	set Af=0	set zb=16	set uV=CreateTrigger()	loop		exitwhen Af==zb		call TriggerRegisterPlayerUnitEvent(uV,Player(Af),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)		set Af=Af+1	endloop	call DisableTrigger(uV)	call TriggerAddCondition(uV,Condition(function jH))	call TriggerAddAction(uV,function KH)	set Af=0	set zb=16	set UV=CreateTrigger()	loop		exitwhen Af==zb		call TriggerRegisterPlayerUnitEvent(UV,Player(Af),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)		set Af=Af+1	endloop	call TriggerAddCondition(UV,Condition(function LH))	call TriggerAddAction(UV,function MH)	set Af=0	set zb=16	set wV=CreateTrigger()	loop		exitwhen Af==zb		call TriggerRegisterPlayerUnitEvent(wV,Player(Af),EVENT_PLAYER_UNIT_ATTACKED,null)		set Af=Af+1	endloop	call DisableTrigger(wV)	call TriggerAddCondition(wV,Condition(function QH))	call TriggerAddAction(wV,function SH)	set Af=0	set zb=16	set WV=CreateTrigger()	loop		exitwhen Af==zb		call TriggerRegisterPlayerUnitEvent(WV,Player(Af),EVENT_PLAYER_UNIT_DEATH,null)		set Af=Af+1	endloop	call DisableTrigger(WV)	call TriggerAddCondition(WV,Condition(function uH))	call TriggerAddAction(WV,function UH)	set Af=0	set zb=16	set yV=CreateTrigger()	loop		exitwhen Af==zb		call TriggerRegisterPlayerUnitEvent(yV,Player(Af),EVENT_PLAYER_HERO_SKILL,null)		set Af=Af+1	endloop	call TriggerAddAction(yV,function WH)	set Af=0	set zb=16	set YV=CreateTrigger()	loop		exitwhen Af==zb		call TriggerRegisterPlayerUnitEvent(YV,Player(Af),EVENT_PLAYER_UNIT_ATTACKED,null)		set Af=Af+1	endloop	call DisableTrigger(YV)	call TriggerAddCondition(YV,Condition(function vj))	call TriggerAddAction(YV,function ej)	set Af=0	set zb=16	set zV=CreateTrigger()	loop		exitwhen Af==zb		call TriggerRegisterPlayerUnitEvent(zV,Player(Af),EVENT_PLAYER_HERO_SKILL,null)		set Af=Af+1	endloop	call TriggerAddAction(zV,function oj)	set ZV=CreateTrigger()	call DisableTrigger(ZV)	call TriggerRegisterAnyUnitEventBJ(ZV,EVENT_PLAYER_UNIT_ATTACKED)	call TriggerAddAction(ZV,function nj)	set EO=CreateTrigger()	call TriggerRegisterAnyUnitEventBJ(EO,EVENT_PLAYER_UNIT_DROP_ITEM)	call TriggerRegisterAnyUnitEventBJ(EO,EVENT_PLAYER_UNIT_PICKUP_ITEM)	call TriggerAddAction(EO,function JL)	set XO=CreateTrigger()	call TriggerRegisterAnyUnitEventBJ(XO,EVENT_PLAYER_UNIT_SPELL_EFFECT)	call TriggerAddCondition(XO,Condition(function KL))	call TriggerAddAction(XO,function ML)	set Af=0	set zb=16	set OO=CreateTrigger()	loop		exitwhen Af==zb		call TriggerRegisterPlayerUnitEvent(OO,Player(Af),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)		set Af=Af+1	endloop	call TriggerAddCondition(OO,Condition(function PL))	call TriggerAddAction(OO,function QL)	set Af=0	set zb=16	set RO=CreateTrigger()	loop		exitwhen Af==zb		call TriggerRegisterPlayerUnitEvent(RO,Player(Af),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)		set Af=Af+1	endloop	call TriggerAddCondition(RO,Condition(function SL))	call TriggerAddAction(RO,function TL)	set Af=0	set zb=16	set IO=CreateTrigger()	loop		exitwhen Af==zb		call TriggerRegisterPlayerUnitEvent(IO,Player(Af),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)		set Af=Af+1	endloop	call TriggerAddCondition(IO,Condition(function UL))	call TriggerAddAction(IO,function WL)	set AO=CreateTrigger()	call TriggerRegisterAnyUnitEventBJ(AO,EVENT_PLAYER_UNIT_SPELL_EFFECT)	call TriggerAddCondition(AO,Condition(function YL))	call TriggerAddAction(AO,function zL)	set Af=0	set zb=16	set NO=CreateTrigger()	loop		exitwhen Af==zb		call TriggerRegisterPlayerUnitEvent(NO,Player(Af),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)		set Af=Af+1	endloop	call TriggerAddAction(NO,function rm)	call TriggerAddCondition(NO,Condition(function em))	set Af=0	set zb=16	set bO=CreateTrigger()	loop		exitwhen Af==zb		call TriggerRegisterPlayerUnitEvent(bO,Player(Af),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)		set Af=Af+1	endloop	call TriggerAddAction(bO,function Em)	call TriggerAddCondition(bO,Condition(function nm))	set Af=0	set zb=16	set BO=CreateTrigger()	loop		exitwhen Af==zb		call TriggerRegisterPlayerUnitEvent(BO,Player(Af),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)		set Af=Af+1	endloop	call TriggerAddCondition(BO,Condition(function Om))	call TriggerAddAction(BO,function bm)	set Af=0	set zb=16	set cO=CreateTrigger()	loop		exitwhen Af==zb		call TriggerRegisterPlayerUnitEvent(cO,Player(Af),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)		set Af=Af+1	endloop	call TriggerAddCondition(cO,Condition(function cm))	call TriggerAddAction(cO,function fm)	set Af=0	set zb=16	set CO=CreateTrigger()	loop		exitwhen Af==zb		call TriggerRegisterPlayerUnitEvent(CO,Player(Af),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)		set Af=Af+1	endloop	call TriggerAddCondition(CO,Condition(function gm))	call TriggerAddAction(CO,function Gm)	set dO=CreateTrigger()	call TriggerRegisterAnyUnitEventBJ(dO,EVENT_PLAYER_UNIT_SPELL_EFFECT)	call TriggerAddCondition(dO,Condition(function Hm))	call TriggerAddAction(dO,function Km)	set DO=CreateTrigger()	call TriggerRegisterAnyUnitEventBJ(DO,EVENT_PLAYER_UNIT_SPELL_EFFECT)	call TriggerAddCondition(DO,Condition(function Lm))	call TriggerAddAction(DO,function mm)	set fO=CreateTrigger()	call TriggerRegisterAnyUnitEventBJ(fO,EVENT_PLAYER_UNIT_PICKUP_ITEM)	call TriggerAddCondition(fO,Condition(function pm))	call TriggerAddAction(fO,function Pm)	set FO=CreateTrigger()	call DisableTrigger(FO)	call TriggerRegisterTimerEventPeriodic(FO,.5)	call TriggerAddAction(FO,function sm)	set gO=CreateTrigger()	call TriggerRegisterAnyUnitEventBJ(gO,EVENT_PLAYER_UNIT_SPELL_EFFECT)	call TriggerAddCondition(gO,Condition(function tm))	call TriggerAddAction(gO,function um)	set GO=CreateTrigger()	call TriggerRegisterAnyUnitEventBJ(GO,EVENT_PLAYER_UNIT_DROP_ITEM)	call TriggerAddCondition(GO,Condition(function wm))	call TriggerAddAction(GO,function Wm)	set hO=CreateTrigger()	call TriggerRegisterTimerEventPeriodic(hO,1.)	call TriggerAddAction(hO,function zm)	set HO=CreateTrigger()	call TriggerRegisterAnyUnitEventBJ(HO,EVENT_PLAYER_UNIT_USE_ITEM)	call TriggerAddCondition(HO,Condition(function vM))	call TriggerAddAction(HO,function eM)	set HA=CreateGroup()	set jO=CreateTrigger()	call TriggerRegisterAnyUnitEventBJ(jO,EVENT_PLAYER_UNIT_DROP_ITEM)	call TriggerAddCondition(jO,Condition(function oM))	call TriggerAddAction(jO,function rM)	set Af=0	set zb=16	set JO=CreateTrigger()	loop		exitwhen Af==zb		call TriggerRegisterPlayerUnitEvent(JO,Player(Af),EVENT_PLAYER_UNIT_PICKUP_ITEM,null)		set Af=Af+1	endloop	call TriggerAddAction(JO,function aM)	set Af=0	set zb=16	set kO=CreateTrigger()	loop		exitwhen Af==zb		call TriggerRegisterPlayerUnitEvent(kO,Player(Af),EVENT_PLAYER_HERO_SKILL,null)		set Af=Af+1	endloop	call TriggerAddAction(kO,function IM)	set Af=0	set zb=16	set KO=CreateTrigger()	loop		exitwhen Af==zb		call TriggerRegisterPlayerUnitEvent(KO,Player(Af),EVENT_PLAYER_UNIT_DROP_ITEM,null)		set Af=Af+1	endloop	call TriggerAddAction(KO,function bM)	set lO=CreateTrigger()	call DisableTrigger(lO)	call TriggerRegisterTimerEvent(lO,1,true)	call TriggerAddAction(lO,function jB)	set LO=CreateTrigger()	call DisableTrigger(LO)	call TriggerRegisterTimerEvent(LO,2,true)	call TriggerAddAction(LO,function jB)	set mO=CreateTrigger()	call TriggerAddAction(mO,function gM)	set MO=CreateTrigger()	call TriggerAddAction(MO,function jM)	set pO=CreateTrigger()	call DisableTrigger(pO)	call TriggerRegisterTimerEventPeriodic(pO,20.)	call TriggerAddCondition(pO,Condition(function kM))	call TriggerAddAction(pO,function KM)	set qO=CreateTrigger()	call TriggerAddAction(qO,function mM)	set QO=CreateTrigger()	call TriggerAddAction(QO,function SM)	set sO=CreateTrigger()	call DisableTrigger(sO)	call TriggerRegisterEnterRectSimple(sO,Hr)	call TriggerRegisterEnterRectSimple(sO,jr)	call TriggerAddAction(sO,function TM)	set SO=CreateTrigger()	call TriggerAddAction(SO,function yM)	set tO=CreateTrigger()	call TriggerAddAction(tO,function vp)	set Af=0	set zb=16	set TO=CreateTrigger()	loop		exitwhen Af==zb		call TriggerRegisterPlayerUnitEvent(TO,Player(Af),EVENT_PLAYER_UNIT_DEATH,null)		set Af=Af+1	endloop	call DisableTrigger(TO)	call TriggerAddAction(TO,function op)	set uO=CreateTrigger()	call DisableTrigger(uO)	call TriggerRegisterTimerEventPeriodic(uO,2.4)	call TriggerAddAction(uO,function ip)	set UO=CreateTrigger()	call TriggerRegisterEnterRectSimple(UO,ei)	call TriggerAddCondition(UO,Condition(function np))	call TriggerAddAction(UO,function Ep)	set wO=CreateTrigger()	call TriggerAddAction(wO,function Op)	set WO=CreateTrigger()	call DisableTrigger(WO)	call TriggerRegisterTimerEvent(WO,3.5,true)	call TriggerAddAction(WO,function Fp)	set yO=CreateTrigger()	call DisableTrigger(yO)	call TriggerRegisterTimerEventPeriodic(yO,2.)	call TriggerAddAction(yO,function jp)	set Af=0	set zb=16	set YO=CreateTrigger()	loop		exitwhen Af==zb		call TriggerRegisterPlayerUnitEvent(YO,Player(Af),EVENT_PLAYER_UNIT_DEATH,null)		set Af=Af+1	endloop	call DisableTrigger(YO)	call TriggerAddCondition(YO,Condition(function kp))	call TriggerAddAction(YO,function Kp)	set Af=0	set zb=16	set zO=CreateTrigger()	loop		exitwhen Af==zb		call TriggerRegisterPlayerUnitEvent(zO,Player(Af),EVENT_PLAYER_UNIT_DEATH,null)		set Af=Af+1	endloop	call DisableTrigger(zO)	call TriggerAddCondition(zO,Condition(function Lp))	call TriggerAddAction(zO,function Mp)	set ZO=CreateTrigger()	call TriggerAddAction(ZO,function tp)	set vR=CreateTrigger()	call DisableTrigger(vR)	call TriggerRegisterTimerEventPeriodic(vR,1.)	call TriggerAddAction(vR,function Up)	set eR=CreateTrigger()	call DisableTrigger(eR)	call TriggerRegisterTimerEventPeriodic(eR,1.)	call TriggerAddAction(eR,function yp)	set xR=CreateTrigger()	call DisableTrigger(xR)	call TriggerRegisterAnyUnitEventBJ(xR,EVENT_PLAYER_UNIT_DEATH)	call TriggerAddCondition(xR,Condition(function zp))	call TriggerAddAction(xR,function Zp)	set Af=0	set zb=16	set oR=CreateTrigger()	call DisableTrigger(oR)	loop		exitwhen Af==zb		call TriggerRegisterPlayerUnitEvent(oR,Player(Af),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)		set Af=Af+1	endloop	call TriggerAddCondition(oR,Condition(function eP))	call TriggerAddAction(oR,function xP)	set Af=0	set zb=16	set rR=CreateTrigger()	loop		exitwhen Af==zb		call TriggerRegisterPlayerUnitEvent(rR,Player(Af),EVENT_PLAYER_UNIT_DEATH,null)		set Af=Af+1	endloop	call DisableTrigger(rR)	call TriggerAddCondition(rR,Condition(function rP))	call TriggerAddAction(rR,function OP)	set iR=CreateTrigger()	call DisableTrigger(iR)	call TriggerRegisterLeaveRectSimple(iR,Pr)	call TriggerAddCondition(iR,Condition(function cP))	call TriggerAddAction(iR,function CP)	set aR=CreateTrigger()	call TriggerAddAction(aR,function DP)	set Af=0	set zb=16	set nR=CreateTrigger()	loop		exitwhen Af==zb		call TriggerRegisterPlayerUnitEvent(nR,Player(Af),EVENT_PLAYER_HERO_LEVEL,null)		set Af=Af+1	endloop	call TriggerAddAction(nR,function FP)	set Af=0	set zb=16	set VR=CreateTrigger()	loop		exitwhen Af==zb		call TriggerRegisterPlayerUnitEvent(VR,Player(Af),EVENT_PLAYER_UNIT_DEATH,null)		set Af=Af+1	endloop	call TriggerAddAction(VR,function GP)	set Af=0	set zb=16	set ER=CreateTrigger()	loop		exitwhen Af==zb		call TriggerRegisterPlayerUnitEvent(ER,Player(Af),EVENT_PLAYER_UNIT_DEATH,null)		set Af=Af+1	endloop	call TriggerAddAction(ER,function jP)	set XR=CreateTrigger()	call TriggerRegisterAnyUnitEventBJ(XR,EVENT_PLAYER_UNIT_RESEARCH_FINISH)	call TriggerAddAction(XR,function kP)	set OR=CreateTrigger()	call TriggerRegisterTimerEventPeriodic(OR,1.)	call TriggerAddAction(OR,function lP)	set RR=CreateTrigger()	call TriggerAddAction(RR,function mP)	set AR=CreateTrigger()	call TriggerAddAction(AR,function wP)	set NR=CreateTrigger()	call TriggerAddAction(NR,function zP)	set bR=CreateTrigger()	call TriggerAddAction(bR,function xq)	set BR=CreateTrigger()	call DisableTrigger(BR)	call TriggerRegisterEnterRectSimple(BR,jr)	call TriggerAddCondition(BR,Condition(function rq))	call TriggerAddAction(BR,function iq)	set cR=CreateTrigger()	call TriggerAddAction(cR,function Vq)	set CR=CreateTrigger()	call TriggerAddAction(CR,function Aq)	set Af=0	set zb=16	set dR=CreateTrigger()	loop		exitwhen Af==zb		call TriggerRegisterPlayerUnitEvent(dR,Player(Af),EVENT_PLAYER_UNIT_DEATH,null)		set Af=Af+1	endloop	call DisableTrigger(dR)	call TriggerAddCondition(dR,Condition(function bq))	call TriggerAddAction(dR,function cq)	set DR=CreateTrigger()	call TriggerAddAction(DR,function Dq)	set fR=CreateTrigger()	call TriggerAddAction(fR,function Hq)//	set FR=CreateTrigger()//	call TriggerAddAction(FR,function Jq)//	set gR=CreateTrigger()//	call TriggerAddAction(gR,function Kq)//	set GR=CreateTrigger()//	call TriggerAddAction(GR,function Lq)//	set hR=CreateTrigger()//	call TriggerAddAction(hR,function pq)	set HR=CreateTrigger()	call TriggerRegisterPlayerStateEvent(HR,Player(0),PLAYER_STATE_RESOURCE_LUMBER,GREATER_THAN_OR_EQUAL,300.)	call TriggerRegisterPlayerStateEvent(HR,Player(1),PLAYER_STATE_RESOURCE_LUMBER,GREATER_THAN_OR_EQUAL,300.)	call TriggerRegisterPlayerStateEvent(HR,Player(2),PLAYER_STATE_RESOURCE_LUMBER,GREATER_THAN_OR_EQUAL,300.)	call TriggerRegisterPlayerStateEvent(HR,Player(3),PLAYER_STATE_RESOURCE_LUMBER,GREATER_THAN_OR_EQUAL,300.)	call TriggerRegisterPlayerStateEvent(HR,Player(4),PLAYER_STATE_RESOURCE_LUMBER,GREATER_THAN_OR_EQUAL,300.)	call TriggerRegisterPlayerStateEvent(HR,Player(5),PLAYER_STATE_RESOURCE_LUMBER,GREATER_THAN_OR_EQUAL,300.)	call TriggerRegisterPlayerStateEvent(HR,Player(6),PLAYER_STATE_RESOURCE_LUMBER,GREATER_THAN_OR_EQUAL,300.)	call TriggerRegisterPlayerStateEvent(HR,Player(7),PLAYER_STATE_RESOURCE_LUMBER,GREATER_THAN_OR_EQUAL,300.)	call TriggerAddAction(HR,function Uq)	set Af=0	set zb=16	set jR=CreateTrigger()	loop	exitwhen Af==zb		call TriggerRegisterPlayerUnitEvent(jR,Player(Af),EVENT_PLAYER_UNIT_DEATH,null)		set Af=Af+1	endloop	call DisableTrigger(jR)	call TriggerAddCondition(jR,Condition(function Wq))	call TriggerAddAction(jR,function zq)		set JR=CreateTrigger()	call TriggerAddAction(JR,function rQ)	set Af=0	set zb=16	set kR=CreateTrigger()	loop		exitwhen Af==zb		call TriggerRegisterPlayerUnitEvent(kR,Player(Af),EVENT_PLAYER_UNIT_DEATH,null)		call TriggerRegisterPlayerUnitEvent(kR,Player(Af),EVENT_PLAYER_UNIT_CHANGE_OWNER,null)		set Af=Af+1	endloop	call DisableTrigger(kR)	call TriggerAddAction(kR,function nQ)	call OQ()	call CQ()	set Af=0	set zb=16	set LR=CreateTrigger()	loop		exitwhen Af==zb		call TriggerRegisterPlayerUnitEvent(LR,Player(Af),EVENT_PLAYER_UNIT_PICKUP_ITEM,null)		set Af=Af+1	endloop	call TriggerAddAction(LR,function dQ)	set Af=0	set zb=16	set mR=CreateTrigger()	loop		exitwhen Af==zb		call TriggerRegisterPlayerUnitEvent(mR,Player(Af),EVENT_PLAYER_UNIT_PICKUP_ITEM,null)		set Af=Af+1	endloop	call TriggerAddAction(mR,function fQ)	set MR=CreateTrigger()	call TriggerRegisterTimerEventSingle(MR,1.)	call TriggerAddAction(MR,function gQ)	set pR=CreateTrigger()	call TriggerAddAction(pR,function Gc)	set Af=0	set zb=16	set PR=CreateTrigger()	loop		exitwhen Af==zb		call TriggerRegisterPlayerUnitEvent(PR,Player(Af),EVENT_PLAYER_UNIT_RESEARCH_FINISH,null)		set Af=Af+1	endloop	call TriggerAddAction(PR,function kQ)	set Af=0	set zb=16	set qR=CreateTrigger()	loop		exitwhen Af==zb		call TriggerRegisterEnterRectSimple(qR,wi)		call TriggerRegisterEnterRectSimple(qR,Wi)		call TriggerRegisterEnterRectSimple(qR,yi)		call TriggerRegisterEnterRectSimple(qR,Yi)		call TriggerRegisterEnterRectSimple(qR,zi)		call TriggerRegisterEnterRectSimple(qR,Zi)		call TriggerRegisterEnterRectSimple(qR,va)		call TriggerRegisterEnterRectSimple(qR,ea)		call TriggerRegisterEnterRectSimple(qR,oa)		call TriggerRegisterEnterRectSimple(qR,ra)		call TriggerRegisterEnterRectSimple(qR,ia)		call TriggerRegisterEnterRectSimple(qR,aa)		call TriggerRegisterEnterRectSimple(qR,na)		call TriggerRegisterEnterRectSimple(qR,Va)		call TriggerRegisterEnterRectSimple(qR,Ea)		call TriggerRegisterEnterRectSimple(qR,Xa)		call TriggerRegisterEnterRectSimple(qR,Oa)		call TriggerRegisterEnterRectSimple(qR,Ra)		call TriggerRegisterEnterRectSimple(qR,Ia)		call TriggerRegisterEnterRectSimple(qR,Aa)		call TriggerRegisterEnterRectSimple(qR,Na)		call TriggerRegisterEnterRectSimple(qR,ba)		call TriggerRegisterEnterRectSimple(qR,Ba)		set Af=Af+1	endloop	call TriggerAddCondition(qR,Condition(function lQ))	call TriggerAddAction(qR,function LQ)	set Af=0	set zb=16	set QR=CreateTrigger()	loop		exitwhen Af==zb		call TriggerRegisterPlayerUnitEvent(QR,Player(Af),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)		set Af=Af+1	endloop	call TriggerAddCondition(QR,Condition(function MQ))	call TriggerAddAction(QR,function pQ)	set Af=0	set zb=16	set sR=CreateTrigger()	loop		exitwhen Af==zb		call TriggerRegisterPlayerUnitEvent(sR,Player(Af),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)		set Af=Af+1	endloop	call TriggerAddCondition(sR,Condition(function qQ))	call TriggerAddAction(sR,function QQ)	set Af=0	set zb=16	set SR=CreateTrigger()	loop		exitwhen Af==zb		call TriggerRegisterPlayerUnitEvent(SR,Player(Af),EVENT_PLAYER_UNIT_PICKUP_ITEM,null)		set Af=Af+1	endloop	call TriggerAddCondition(SR,Condition(function SQ))	call TriggerAddAction(SR,function tQ)	set Af=0	set zb=16	set tR=CreateTrigger()	loop		exitwhen Af==zb		call TriggerRegisterPlayerUnitEvent(tR,Player(Af),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)		set Af=Af+1	endloop	call TriggerAddCondition(tR,Condition(function uQ))	call TriggerAddAction(tR,function UQ)	set TR=CreateTrigger()	call TriggerRegisterAnyUnitEventBJ(TR,EVENT_PLAYER_UNIT_DEATH)	call TriggerAddAction(TR,function WQ)	set Af=0	set zb=16	set uR=CreateTrigger()	loop		exitwhen Af==zb		call TriggerRegisterPlayerUnitEvent(uR,Player(Af),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)		set Af=Af+1	endloop	call TriggerAddCondition(uR,Condition(function YQ))	call TriggerAddAction(uR,function zQ)	set wR=CreateTrigger()	call TriggerRegisterEnterRectSimple(wR,Pr)	call TriggerRegisterEnterRectSimple(wR,jr)	call TriggerRegisterEnterRectSimple(wR,Hr)	call TriggerAddCondition(wR,Condition(function xs))	call TriggerAddAction(wR,function is)	set WR=CreateTrigger()	call TriggerRegisterAnyUnitEventBJ(WR,EVENT_PLAYER_UNIT_SPELL_EFFECT)	call TriggerAddCondition(WR,Condition(function ns))	call TriggerAddAction(WR,function Es)	set yR=CreateTrigger()	call TriggerRegisterDeathEvent(yR,WI)	call TriggerRegisterDeathEvent(yR,TI)	call TriggerRegisterDeathEvent(yR,UI)	call TriggerRegisterDeathEvent(yR,wI)	call TriggerRegisterDeathEvent(yR,uI)	call TriggerRegisterDeathEvent(yR,tI)	call TriggerAddAction(yR,function Rs)	set YR=CreateTrigger()	call TriggerRegisterAnyUnitEventBJ(YR,EVENT_PLAYER_UNIT_SPELL_CAST)	call TriggerAddCondition(YR,Condition(function As))	call TriggerAddAction(YR,function Ns)	set zR=CreateTrigger()	call TriggerRegisterEnterRectSimple(zR,ei)	call TriggerAddAction(zR,function Bs)	set ZR=CreateTrigger()	call TriggerRegisterEnterRectSimple(ZR,si)	call TriggerRegisterEnterRectSimple(ZR,Qi)	call TriggerAddAction(ZR,function Cs)	set Af=0	set zb=16	set eI=CreateTrigger()	loop		exitwhen Af==zb		call TriggerRegisterPlayerUnitEvent(eI,Player(Af),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)		set Af=Af+1	endloop	call TriggerAddCondition(eI,Condition(function gs))	call TriggerAddAction(eI,function hs)	set xI=CreateTrigger()	call TriggerRegisterAnyUnitEventBJ(xI,EVENT_PLAYER_UNIT_DEATH)	call TriggerAddCondition(xI,Condition(function js))	call TriggerAddAction(xI,function Js)	set trig_GameModeTest=CreateTrigger()	call DisableTrigger(trig_GameModeTest)	call TriggerRegisterPlayerChatEvent(trig_GameModeTest,Player(0),"-т",true)	call TriggerRegisterPlayerChatEvent(trig_GameModeTest,Player(0),"-t",true)	call TriggerAddAction(trig_GameModeTest,function Ms)	set aI=CreateTrigger()	call DisableTrigger(aI)	call TriggerRegisterPlayerChatEvent(aI,Player(0),"-р",true)	call TriggerRegisterPlayerChatEvent(aI,Player(0),"-r",true)	call TriggerAddAction(aI,function Ps)	set nI=CreateTrigger()	call DisableTrigger(nI)	call TriggerRegisterPlayerChatEvent(nI,Player(0),"-у ",false)	call TriggerRegisterPlayerChatEvent(nI,Player(0),"-y ",false)	call TriggerAddAction(nI,function Ss)	set VI=CreateTrigger()	call DisableTrigger(VI)	call TriggerRegisterPlayerChatEvent(VI,Player(0),"-м",true)	call TriggerRegisterPlayerChatEvent(VI,Player(0),"-m",true)	call TriggerAddAction(VI,function Ts)	set EI=CreateTrigger()	call DisableTrigger(EI)	call TriggerRegisterPlayerChatEvent(EI,Player(0),"-з",true)	call TriggerRegisterPlayerChatEvent(EI,Player(0),"-z",true)	call TriggerAddAction(EI,function ws)	set dI=CreateTrigger()	call TriggerRegisterTimerEventSingle(dI,.1)	call TriggerAddAction(dI,function IS)	set DI=CreateTrigger()	call DisableTrigger(DI)	call TriggerRegisterPlayerChatEvent(DI,Player(0),"-об",true)	call TriggerRegisterPlayerChatEvent(DI,Player(1),"-об",true)	call TriggerRegisterPlayerChatEvent(DI,Player(2),"-об",true)	call TriggerRegisterPlayerChatEvent(DI,Player(3),"-об",true)	call TriggerRegisterPlayerChatEvent(DI,Player(4),"-об",true)	call TriggerRegisterPlayerChatEvent(DI,Player(5),"-об",true)	call TriggerRegisterPlayerChatEvent(DI,Player(6),"-об",true)	call TriggerRegisterPlayerChatEvent(DI,Player(7),"-об",true)	call TriggerRegisterPlayerChatEvent(DI,Player(0),"-swap",true)	call TriggerRegisterPlayerChatEvent(DI,Player(1),"-swap",true)	call TriggerRegisterPlayerChatEvent(DI,Player(2),"-swap",true)	call TriggerRegisterPlayerChatEvent(DI,Player(3),"-swap",true)	call TriggerRegisterPlayerChatEvent(DI,Player(4),"-swap",true)	call TriggerRegisterPlayerChatEvent(DI,Player(5),"-swap",true)	call TriggerRegisterPlayerChatEvent(DI,Player(6),"-swap",true)	call TriggerRegisterPlayerChatEvent(DI,Player(7),"-swap",true)	call TriggerAddAction(DI,function NS)	set fI=CreateTrigger()	call DisableTrigger(fI)	call TriggerRegisterPlayerChatEvent(fI,Player(0),"-об",false)	call TriggerRegisterPlayerChatEvent(fI,Player(1),"-об",false)	call TriggerRegisterPlayerChatEvent(fI,Player(2),"-об",false)	call TriggerRegisterPlayerChatEvent(fI,Player(3),"-об",false)	call TriggerRegisterPlayerChatEvent(fI,Player(4),"-об",false)	call TriggerRegisterPlayerChatEvent(fI,Player(5),"-об",false)	call TriggerRegisterPlayerChatEvent(fI,Player(6),"-об",false)	call TriggerRegisterPlayerChatEvent(fI,Player(7),"-об",false)	call TriggerRegisterPlayerChatEvent(fI,Player(0),"-swap",false)	call TriggerRegisterPlayerChatEvent(fI,Player(1),"-swap",false)	call TriggerRegisterPlayerChatEvent(fI,Player(2),"-swap",false)	call TriggerRegisterPlayerChatEvent(fI,Player(3),"-swap",false)	call TriggerRegisterPlayerChatEvent(fI,Player(4),"-swap",false)	call TriggerRegisterPlayerChatEvent(fI,Player(5),"-swap",false)	call TriggerRegisterPlayerChatEvent(fI,Player(6),"-swap",false)	call TriggerRegisterPlayerChatEvent(fI,Player(7),"-swap",false)	call TriggerAddAction(fI,function BS)	call FS()	set Af=0	set zb=16	set GI=CreateTrigger()	loop		exitwhen Af==zb		call TriggerRegisterPlayerUnitEvent(GI,Player(Af),EVENT_PLAYER_UNIT_PICKUP_ITEM,null)		set Af=Af+1	endloop	call TriggerAddAction(GI,function et)	call Preload("Abilities\\Spells\\Items\\AIam\\AIamTarget.mdl")	set Af=0	set zb=16	set hI=CreateTrigger()	loop		exitwhen Af==zb		call TriggerRegisterPlayerUnitEvent(hI,Player(Af),EVENT_PLAYER_UNIT_SELL_ITEM,null)		set Af=Af+1	endloop	call TriggerAddAction(hI,function Et)	set Af=0	set zb=16	set HI=CreateTrigger()	loop		exitwhen Af==zb		call TriggerRegisterPlayerUnitEvent(HI,Player(Af),EVENT_PLAYER_UNIT_PICKUP_ITEM,null)		set Af=Af+1	endloop	call TriggerAddAction(HI,function Ot)	set Af=0	set zb=16	set jI=CreateTrigger()	loop		exitwhen Af==zb		call TriggerRegisterPlayerUnitEvent(jI,Player(Af),EVENT_PLAYER_UNIT_DROP_ITEM,null)		set Af=Af+1	endloop	call TriggerAddAction(jI,function ct)	set Af=0	set zb=16	set JI=CreateTrigger()	loop		exitwhen Af==zb		call TriggerRegisterPlayerUnitEvent(JI,Player(Af),EVENT_PLAYER_UNIT_PICKUP_ITEM,null)		set Af=Af+1	endloop	call TriggerAddAction(JI,function Gt)	set kI=CreateTrigger()	call TriggerRegisterAnyUnitEventBJ(kI,EVENT_PLAYER_UNIT_PICKUP_ITEM)	call TriggerAddCondition(kI,Condition(function Ht))	call TriggerAddAction(kI,function jt)	set KI=CreateTrigger()	call TriggerRegisterAnyUnitEventBJ(KI,EVENT_PLAYER_UNIT_DROP_ITEM)	call TriggerAddCondition(KI,Condition(function lt))	call TriggerAddAction(KI,function Lt)	set lI=CreateTrigger()	call TriggerRegisterPlayerStateEvent(lI,Player(0),PLAYER_STATE_RESOURCE_GOLD,GREATER_THAN_OR_EQUAL,4000.)	call TriggerRegisterPlayerStateEvent(lI,Player(1),PLAYER_STATE_RESOURCE_GOLD,GREATER_THAN_OR_EQUAL,4000.)	call TriggerRegisterPlayerStateEvent(lI,Player(2),PLAYER_STATE_RESOURCE_GOLD,GREATER_THAN_OR_EQUAL,4000.)	call TriggerRegisterPlayerStateEvent(lI,Player(3),PLAYER_STATE_RESOURCE_GOLD,GREATER_THAN_OR_EQUAL,4000.)	call TriggerRegisterPlayerStateEvent(lI,Player(4),PLAYER_STATE_RESOURCE_GOLD,GREATER_THAN_OR_EQUAL,4000.)	call TriggerRegisterPlayerStateEvent(lI,Player(5),PLAYER_STATE_RESOURCE_GOLD,GREATER_THAN_OR_EQUAL,4000.)	call TriggerRegisterPlayerStateEvent(lI,Player(6),PLAYER_STATE_RESOURCE_GOLD,GREATER_THAN_OR_EQUAL,4000.)	call TriggerRegisterPlayerStateEvent(lI,Player(7),PLAYER_STATE_RESOURCE_GOLD,GREATER_THAN_OR_EQUAL,4000.)	call TriggerAddCondition(lI,Condition(function Mt))	call TriggerAddAction(lI,function pt)	//set LI=CreateTrigger()	//call TriggerRegisterPlayerChatEvent(LI,Player(0),"-dl",true)	//call TriggerRegisterPlayerChatEvent(LI,Player(1),"-dl",true)	//call TriggerRegisterPlayerChatEvent(LI,Player(2),"-dl",true)	//call TriggerRegisterPlayerChatEvent(LI,Player(3),"-dl",true)	//call TriggerRegisterPlayerChatEvent(LI,Player(4),"-dl",true)	//call TriggerRegisterPlayerChatEvent(LI,Player(5),"-dl",true)	//call TriggerRegisterPlayerChatEvent(LI,Player(6),"-dl",true)	//call TriggerRegisterPlayerChatEvent(LI,Player(7),"-dl",true)	//call TriggerAddAction(LI,function qt)	set mI=CreateTrigger()	call TriggerRegisterAnyUnitEventBJ(mI,EVENT_PLAYER_UNIT_DEATH)	call TriggerRegisterAnyUnitEventBJ(mI,EVENT_PLAYER_UNIT_USE_ITEM)	call TriggerRegisterAnyUnitEventBJ(mI,EVENT_PLAYER_UNIT_SPELL_EFFECT)	call TriggerRegisterPlayerChatEvent(mI,Player(0),"-",false)	call TriggerRegisterPlayerChatEvent(mI,Player(1),"-",false)	call TriggerRegisterPlayerChatEvent(mI,Player(2),"-",false)	call TriggerRegisterPlayerChatEvent(mI,Player(3),"-",false)	call TriggerRegisterPlayerChatEvent(mI,Player(4),"-",false)	call TriggerRegisterPlayerChatEvent(mI,Player(5),"-",false)	call TriggerRegisterPlayerChatEvent(mI,Player(6),"-",false)	call TriggerRegisterPlayerChatEvent(mI,Player(7),"-",false)	call TriggerRegisterPlayerEventLeave(mI,Player(0))	call TriggerRegisterPlayerEventLeave(mI,Player(1))	call TriggerRegisterPlayerEventLeave(mI,Player(2))	call TriggerRegisterPlayerEventLeave(mI,Player(3))	call TriggerRegisterPlayerEventLeave(mI,Player(4))	call TriggerRegisterPlayerEventLeave(mI,Player(5))	call TriggerRegisterPlayerEventLeave(mI,Player(6))	call TriggerRegisterPlayerEventLeave(mI,Player(7))	call TriggerAddAction(mI,function St)	set t_WhenPlayerLeave=CreateTrigger()	call TriggerRegisterPlayerEvent(t_WhenPlayerLeave,Player(0),EVENT_PLAYER_LEAVE)	call TriggerRegisterPlayerEvent(t_WhenPlayerLeave,Player(1),EVENT_PLAYER_LEAVE)	call TriggerRegisterPlayerEvent(t_WhenPlayerLeave,Player(2),EVENT_PLAYER_LEAVE)	call TriggerRegisterPlayerEvent(t_WhenPlayerLeave,Player(3),EVENT_PLAYER_LEAVE)	call TriggerRegisterPlayerEvent(t_WhenPlayerLeave,Player(4),EVENT_PLAYER_LEAVE)	call TriggerRegisterPlayerEvent(t_WhenPlayerLeave,Player(5),EVENT_PLAYER_LEAVE)	call TriggerRegisterPlayerEvent(t_WhenPlayerLeave,Player(6),EVENT_PLAYER_LEAVE)	call TriggerRegisterPlayerEvent(t_WhenPlayerLeave,Player(7),EVENT_PLAYER_LEAVE)	call TriggerAddAction(t_WhenPlayerLeave,function Ut)	//	set pI=CreateTrigger()//	call TriggerAddAction(pI,function Wt)	set PI=CreateTrigger()	call DisableTrigger(PI)	call TriggerRegisterTimerEventPeriodic(PI,.5)	call TriggerAddAction(PI,function zt)	set Af=0	set zb=16	set qI=CreateTrigger()	loop		exitwhen Af==zb		call TriggerRegisterPlayerUnitEvent(qI,Player(Af),EVENT_PLAYER_UNIT_DEATH,null)		set Af=Af+1	endloop	call TriggerAddAction(qI,function vT)	call ConditionalTriggerExecute(trig_MapInitialization)endfunctionfunction config takes nothing returns nothing	call SetMapName("|cffffcc00Жизнь на арене|r |cff8080802.7g|r")	call SetMapDescription("|Cffff0000by ЦeЗapЬ|R|n45 paзличных гepoeв.|nCpaжaйтecь зa cвoю жизнь!|n|n|Cff107015l i f e i n a r e n a . u c o z . r u|R")	call SetPlayers(9)	call SetTeams(9)	call SetGamePlacement(MAP_PLACEMENT_TEAMS_TOGETHER)	call DefineStartLocation(0,2496.,-2752.)	call DefineStartLocation(1,2496.,-2752.)	call DefineStartLocation(2,2496.,-2752.)	call DefineStartLocation(3,2496.,-2752.)	call DefineStartLocation(4,2496.,-2752.)	call DefineStartLocation(5,2496.,-2752.)	call DefineStartLocation(6,2496.,-2752.)	call DefineStartLocation(7,2496.,-2752.)	call DefineStartLocation(8,2432.,2432.)	call SetPlayerStartLocation(Player(0),0)	call SetPlayerColor(Player(0),ConvertPlayerColor(0))	call SetPlayerRacePreference(Player(0),RACE_PREF_NIGHTELF)	call SetPlayerRaceSelectable(Player(0),false)	call SetPlayerController(Player(0),MAP_CONTROL_USER)	call SetPlayerStartLocation(Player(1),1)	call SetPlayerColor(Player(1),ConvertPlayerColor(1))	call SetPlayerRacePreference(Player(1),RACE_PREF_NIGHTELF)	call SetPlayerRaceSelectable(Player(1),false)	call SetPlayerController(Player(1),MAP_CONTROL_USER)	call SetPlayerStartLocation(Player(2),2)	call SetPlayerColor(Player(2),ConvertPlayerColor(2))	call SetPlayerRacePreference(Player(2),RACE_PREF_NIGHTELF)	call SetPlayerRaceSelectable(Player(2),false)	call SetPlayerController(Player(2),MAP_CONTROL_USER)	call SetPlayerStartLocation(Player(3),3)	call SetPlayerColor(Player(3),ConvertPlayerColor(3))	call SetPlayerRacePreference(Player(3),RACE_PREF_NIGHTELF)	call SetPlayerRaceSelectable(Player(3),false)	call SetPlayerController(Player(3),MAP_CONTROL_USER)	call SetPlayerStartLocation(Player(4),4)	call SetPlayerColor(Player(4),ConvertPlayerColor(4))	call SetPlayerRacePreference(Player(4),RACE_PREF_NIGHTELF)	call SetPlayerRaceSelectable(Player(4),false)	call SetPlayerController(Player(4),MAP_CONTROL_USER)	call SetPlayerStartLocation(Player(5),5)	call SetPlayerColor(Player(5),ConvertPlayerColor(5))	call SetPlayerRacePreference(Player(5),RACE_PREF_NIGHTELF)	call SetPlayerRaceSelectable(Player(5),false)	call SetPlayerController(Player(5),MAP_CONTROL_USER)	call SetPlayerStartLocation(Player(6),6)	call SetPlayerColor(Player(6),ConvertPlayerColor(6))	call SetPlayerRacePreference(Player(6),RACE_PREF_NIGHTELF)	call SetPlayerRaceSelectable(Player(6),false)	call SetPlayerController(Player(6),MAP_CONTROL_USER)	call SetPlayerStartLocation(Player(7),7)	call SetPlayerColor(Player(7),ConvertPlayerColor(7))	call SetPlayerRacePreference(Player(7),RACE_PREF_NIGHTELF)	call SetPlayerRaceSelectable(Player(7),false)	call SetPlayerController(Player(7),MAP_CONTROL_USER)	call SetPlayerStartLocation(Player($B),8)	call ForcePlayerStartLocation(Player($B),8)	call SetPlayerColor(Player($B),ConvertPlayerColor($B))	call SetPlayerRacePreference(Player($B),RACE_PREF_UNDEAD)	call SetPlayerRaceSelectable(Player($B),false)	call SetPlayerController(Player($B),MAP_CONTROL_COMPUTER)	call InitCustomTeams()	call SetStartLocPrioCount(0,7)	call SetStartLocPrio(0,0,1,MAP_LOC_PRIO_HIGH)	call SetStartLocPrio(0,1,2,MAP_LOC_PRIO_HIGH)	call SetStartLocPrio(0,2,3,MAP_LOC_PRIO_HIGH)	call SetStartLocPrio(0,3,4,MAP_LOC_PRIO_HIGH)	call SetStartLocPrio(0,4,5,MAP_LOC_PRIO_HIGH)	call SetStartLocPrio(0,5,6,MAP_LOC_PRIO_HIGH)	call SetStartLocPrio(0,6,7,MAP_LOC_PRIO_HIGH)	call SetStartLocPrioCount(1,7)	call SetStartLocPrio(1,0,0,MAP_LOC_PRIO_HIGH)	call SetStartLocPrio(1,1,2,MAP_LOC_PRIO_HIGH)	call SetStartLocPrio(1,2,3,MAP_LOC_PRIO_HIGH)	call SetStartLocPrio(1,3,4,MAP_LOC_PRIO_HIGH)	call SetStartLocPrio(1,4,5,MAP_LOC_PRIO_HIGH)	call SetStartLocPrio(1,5,6,MAP_LOC_PRIO_HIGH)	call SetStartLocPrio(1,6,7,MAP_LOC_PRIO_HIGH)	call SetStartLocPrioCount(2,7)	call SetStartLocPrio(2,0,0,MAP_LOC_PRIO_HIGH)	call SetStartLocPrio(2,1,1,MAP_LOC_PRIO_HIGH)	call SetStartLocPrio(2,2,3,MAP_LOC_PRIO_HIGH)	call SetStartLocPrio(2,3,4,MAP_LOC_PRIO_HIGH)	call SetStartLocPrio(2,4,5,MAP_LOC_PRIO_HIGH)	call SetStartLocPrio(2,5,6,MAP_LOC_PRIO_HIGH)	call SetStartLocPrio(2,6,7,MAP_LOC_PRIO_HIGH)	call SetStartLocPrioCount(3,7)	call SetStartLocPrio(3,0,0,MAP_LOC_PRIO_HIGH)	call SetStartLocPrio(3,1,1,MAP_LOC_PRIO_HIGH)	call SetStartLocPrio(3,2,2,MAP_LOC_PRIO_HIGH)	call SetStartLocPrio(3,3,4,MAP_LOC_PRIO_HIGH)	call SetStartLocPrio(3,4,5,MAP_LOC_PRIO_HIGH)	call SetStartLocPrio(3,5,6,MAP_LOC_PRIO_HIGH)	call SetStartLocPrio(3,6,7,MAP_LOC_PRIO_HIGH)	call SetStartLocPrioCount(4,7)	call SetStartLocPrio(4,0,0,MAP_LOC_PRIO_HIGH)	call SetStartLocPrio(4,1,1,MAP_LOC_PRIO_HIGH)	call SetStartLocPrio(4,2,2,MAP_LOC_PRIO_HIGH)	call SetStartLocPrio(4,3,3,MAP_LOC_PRIO_HIGH)	call SetStartLocPrio(4,4,5,MAP_LOC_PRIO_HIGH)	call SetStartLocPrio(4,5,6,MAP_LOC_PRIO_HIGH)	call SetStartLocPrio(4,6,7,MAP_LOC_PRIO_HIGH)	call SetStartLocPrioCount(5,7)	call SetStartLocPrio(5,0,0,MAP_LOC_PRIO_HIGH)	call SetStartLocPrio(5,1,1,MAP_LOC_PRIO_HIGH)	call SetStartLocPrio(5,2,2,MAP_LOC_PRIO_HIGH)	call SetStartLocPrio(5,3,3,MAP_LOC_PRIO_HIGH)	call SetStartLocPrio(5,4,4,MAP_LOC_PRIO_HIGH)	call SetStartLocPrio(5,5,6,MAP_LOC_PRIO_HIGH)	call SetStartLocPrio(5,6,7,MAP_LOC_PRIO_HIGH)	call SetStartLocPrioCount(6,7)	call SetStartLocPrio(6,0,0,MAP_LOC_PRIO_HIGH)	call SetStartLocPrio(6,1,1,MAP_LOC_PRIO_HIGH)	call SetStartLocPrio(6,2,2,MAP_LOC_PRIO_HIGH)	call SetStartLocPrio(6,3,3,MAP_LOC_PRIO_HIGH)	call SetStartLocPrio(6,4,4,MAP_LOC_PRIO_HIGH)	call SetStartLocPrio(6,5,5,MAP_LOC_PRIO_HIGH)	call SetStartLocPrio(6,6,7,MAP_LOC_PRIO_HIGH)	call SetStartLocPrioCount(7,7)	call SetStartLocPrio(7,0,0,MAP_LOC_PRIO_HIGH)	call SetStartLocPrio(7,1,1,MAP_LOC_PRIO_HIGH)	call SetStartLocPrio(7,2,2,MAP_LOC_PRIO_HIGH)	call SetStartLocPrio(7,3,3,MAP_LOC_PRIO_HIGH)	call SetStartLocPrio(7,4,4,MAP_LOC_PRIO_HIGH)	call SetStartLocPrio(7,5,5,MAP_LOC_PRIO_HIGH)	call SetStartLocPrio(7,6,6,MAP_LOC_PRIO_HIGH)endfunctionfunction oT takes nothing returns boolean	local integer QN=wA	call FlushStoredInteger(Nv,"val:"+QA[QN],PA[QN])	call FlushStoredInteger(Nv,"chk:"+QA[QN],QA[QN])	set PA[QN]=null	set QA[QN]=null	set sA[QN]=0	return trueendfunctionfunction xT takes nothing returns nothing	set UA=CreateTrigger()	call TriggerAddCondition(UA,Condition(function oT))endfunction